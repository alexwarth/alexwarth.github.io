var qb=Object.defineProperty;var Wb=(Ai,$e,xe)=>$e in Ai?qb(Ai,$e,{enumerable:!0,configurable:!0,writable:!0,value:xe}):Ai[$e]=xe;var R=(Ai,$e,xe)=>Wb(Ai,typeof $e!="symbol"?$e+"":$e,xe);(async()=>{(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Ai(r,t,e){return new Uint8Array([144|r&15,t&127,e&127])}function $e(r,t,e){return new Uint8Array([128|r&15,t&127,e&127])}const xe=2,Vp="#ccc",qp="#ddd",Wp="#888",_p="#888",Hp="#aab",$l="#bbd",to="#dde",Gl="#88c",zp="#88c",jp="#bbb",$p="#eee",xr=5,br=11,ni=5,Ci=3,Sr=150,Si=class Si{constructor(t,e){R(this,"cssFontString");R(this,"baselineAdjustment");this.sizeInPixels=t,this.cssFontString=e(t),this.baselineAdjustment=Math.round(t/3)}};R(Si,"button",new Si(18,t=>`500 ${t}px Inter`)),R(Si,"selector",new Si(16,t=>`500 ${t}px Inter`)),R(Si,"pad",new Si(14,t=>`${t}px Inter`));let ht=Si;const Ge=48e3,he=1/Ge,kt=2*Math.PI,eo=0,io=1,De=2,Yi=3,Xi=4,ro=5,so=6,no=7,oo=8,ao=new Map([["gain",eo],["tempo",io],["glide",De],["slide",Yi],["pressure",Xi],["paramA",ro],["paramB",so],["paramC",no],["paramD",oo]]);function Gp(r){return 440*Math.pow(2,(r-69)/12)}function Up(r,t){const e=Math.floor(t),i=t-e,s=r[e-1<0?r.length-1:e-1],n=r[e],o=r[(e+1)%r.length],a=r[(e+2)%r.length],l=(o-s)/2,h=n-o,c=l+h,u=c+h+(a-n)/2,d=c+u;return((u*i-d)*i+l)*i+n}function Ul(r){if(r>3)return 1;if(r<-3)return-1;{const t=r*r;return r*(27+t)/(27+9*t)}}function Te(r,t,e){return Math.max(t,Math.min(r,e))}class Kp{constructor(){R(this,"windowMs",150);R(this,"history",[])}addPos(t){this.history.push({pos:t,t:performance.now()})}get speed(){const t=performance.now();if(this.history=this.history.filter(({t:s})=>t-s<=this.windowMs),this.history.length<2)return 0;let e=0;for(let s=1;s<this.history.length;s++)e+=Math.abs(this.history[s].pos-this.history[s-1].pos);const i=this.history[this.history.length-1].t-this.history[0].t;return e/i}}const Yp=document.getElementById("ui"),ct=document.createElement("canvas"),y=ct.getContext("2d");Yp.appendChild(ct);function Kl(){ct.style.width=innerWidth+"px",ct.style.height=innerHeight+"px",ct.width=innerWidth*devicePixelRatio,ct.height=innerHeight*devicePixelRatio,y.scale(devicePixelRatio,devicePixelRatio)}window.addEventListener("resize",Kl),Kl();const Xp=2e3;let gs="",Yl=0;function lo(r){gs=r,Yl=Date.now()}function Jp(){if(gs.length>0&&Date.now()-Yl<Xp){y.font="16px Inter";const{width:r}=y.measureText(gs);y.beginPath(),y.fillStyle="#00ff",y.fillText(gs,innerWidth-r-20,innerHeight-20),y.fill()}}const Qp=""+new URL("msynth-worklet-C39bHXAS.js",import.meta.url).href;let Xl;function Zp(r){Xl=r}const Ii=new AudioContext({latencyHint:"balanced",sampleRate:Ge});await Ii.audioWorklet.addModule(Qp);let ho="need initialization";ct.addEventListener("pointerdown",()=>{(Ii.state==="suspended"||Ii.state==="interrupted")&&Ii.resume(),ho==="need initialization"&&(ho="initializing",console.log("initializing"),Xl(),ho="ready",console.log("ready"))});class Ue{constructor(t){R(this,"parent",null);R(this,"children",[]);R(this,"posHints",[]);R(this,"x",0);R(this,"y",0);R(this,"w",0);R(this,"h",0);this.options=t}addChild(t,e="next"){return t.parent=this,this.children.push(t),this.posHints.push(e),this.layout(),this}layout(){var i,s,n,o,a,l,h,c;let t=this.x,e=this.y;for(let u=0;u<this.children.length;u++){const d=this.children[u],f=this.posHints[u];switch(d.x=Math.round(((s=(i=d.options).x)==null?void 0:s.call(i))??d.x),d.y=Math.round(((o=(n=d.options).y)==null?void 0:o.call(n))??d.y),d.w=Math.round(((l=(a=d.options).w)==null?void 0:l.call(a))??d.w),d.h=Math.round(((c=(h=d.options).h)==null?void 0:c.call(h))??d.h),f){case"next":switch(d.x=t,d.y=e,this.options.layoutMode??"none"){case"row":d.h=this.h,t+=d.w;break;case"column":d.w=this.w,e+=d.h;break;case"none":throw new Error('cannot have a child w/ posHint "next" when layoutMode is "none"')}break;case"top left":d.x=this.x,d.y=this.y;break;case"top right":d.x=this.rightX-d.w,d.y=this.y;break;case"bottom left":d.x=this.x,d.y=this.bottomY-d.h;break;case"bottom right":d.x=this.rightX-d.w,d.y=this.bottomY-d.h;break}d.layout()}}get bottomY(){return this.y+this.h}get rightX(){return this.x+this.w}get centerY(){return this.y+this.h/2}get centerX(){return this.x+this.w/2}contains(t,e){return this.x<=t&&t<=this.rightX&&this.y<=e&&e<=this.bottomY}render(){this.options.hasBackground&&(y.beginPath(),y.fillStyle="#eee",y.rect(this.x,this.y,this.w,this.h),y.fill(),y.beginPath(),y.fillStyle=this.lightBackgroundColor,y.roundRect(this.x+2,this.y+2,this.w-2,this.h-2,ni),y.fill())}renderOnTop(){}recursiveRender(){y.save(),y.beginPath(),y.rect(this.x,this.y,this.w,this.h),y.clip(),y.save(),this.render(),y.restore();for(const t of this.children)t.recursiveRender();y.restore()}recursiveRenderOnTop(){for(const t of this.children)t.recursiveRenderOnTop();y.save(),this.renderOnTop(),y.restore()}onPointerDown(t,e){return null}onPointerMove(t,e){}onPointerUp(t,e){}recursiveOnPointerDown(t,e){if(!this.contains(t,e))return null;for(const i of this.children){const s=i.recursiveOnPointerDown(t,e);if(s)return s}return this.onPointerDown(t,e)}get backgroundColor(){return this.isActive?$l:Vp}get lightBackgroundColor(){return this.isActive?to:qp}get foregroundColor(){return this.isActive?Gl:Wp}textWidth(t,e){y.save(),y.font=e.cssFontString;const i=y.measureText(t).width;return y.restore(),i}renderLabel(t,e=ht.button){y.beginPath(),y.font=e.cssFontString,y.fillStyle=this.foregroundColor,y.fillText(t,this.centerX-y.measureText(t).width/2,this.centerY+e.baselineAdjustment),y.fill()}get isActive(){var t,e,i;return((e=(t=this.options).isActive)==null?void 0:e.call(t))??((i=this.parent)==null?void 0:i.isActive)??!1}}const Mi=new class extends Ue{constructor(){super({layoutMode:"none",x:()=>0,y:()=>0,w:()=>innerWidth,h:()=>innerHeight})}recursiveRender(){const r=this.options.w(),t=this.options.h();(this.w!==r||this.h!==t)&&(this.w=r,this.h=t,this.layout()),super.recursiveRender()}};class Jl extends Ue{constructor(t){super({layoutMode:"row",w:()=>this.children.reduce((e,i)=>e+i.w,0),...t})}}class Ql extends Ue{constructor(t){super({layoutMode:"column",h:()=>this.children.reduce((e,i)=>e+i.h,0),...t})}}class Zl extends Ue{constructor(t){super({hasBackground:!0,...t})}render(){super.render(),this.renderLabel(this.options.label())}onPointerDown(){var t,e;return(e=(t=this.options).pointerDownFn)==null||e.call(t),this}onPointerUp(){var t,e;return(e=(t=this.options).pointerUpFn)==null||e.call(t),this}}class tm extends Ue{constructor(e){super({hasBackground:!0,...e});R(this,"angle0",null)}render(){super.render();const e=.3*Math.min(this.w,this.h);y.globalAlpha=.2,y.beginPath(),y.fillStyle=this.backgroundColor,y.arc(this.centerX,this.centerY,e,0,kt),y.lineTo(this.centerX,this.centerY),y.fill(),y.globalAlpha=1,y.beginPath(),y.arc(this.centerX,this.centerY,e,kt/4,kt*this.value+kt/4),y.lineTo(this.centerX,this.centerY),y.fill(),y.beginPath(),y.fillStyle=this.lightBackgroundColor,y.arc(this.centerX,this.centerY,e-5,0,kt),y.lineTo(this.centerX,this.centerY),y.fill(),this.renderLabel(this.options.label,ht.selector)}get value(){return this.options.getValue()}set value(e){this.options.setValue(e)}onPointerDown(e,i){return this.angle0=Math.atan2(i-this.centerY,e-this.centerX),this}onPointerMove(e,i){const s=Math.atan2(i-this.centerY,e-this.centerX),n=((s-this.angle0+Math.PI)%kt+kt)%kt-Math.PI;this.options.setValue(Te(this.value+n/kt,0,1)),this.angle0=s}onPointerUp(e,i){this.angle0=null}}class em extends Ue{constructor(e){super({hasBackground:!0,...e});R(this,"x0",null);R(this,"value0",null)}render(){var e,i;super.render(),this.renderLabel(((i=(e=this.options).label)==null?void 0:i.call(e,this.options.getValue()))??`${this.options.getValue()}`)}onPointerDown(e,i){return this.x0=e,this.value0=this.options.getValue(),this}onPointerMove(e,i){const s=e-this.x0;this.options.setValue(Te(Math.round(this.value0+s/10),this.options.minValue??0,this.options.maxValue??100))}}class im extends Ue{constructor(e){super({hasBackground:!0,...e});R(this,"radius",8);R(this,"pos0",null);R(this,"value0",null)}render(){super.render();const e=this.options.getXValue(),i=this.options.getYValue();y.globalAlpha=.2,y.fillStyle=this.backgroundColor,y.beginPath(),y.arc(this.x+this.radius+e*(this.w-2*this.radius),this.bottomY-this.radius-i*(this.h-2*this.radius),this.radius,0,kt),y.fill(),y.globalAlpha=1,y.beginPath(),y.arc(this.x+this.radius+e*(this.w-2*this.radius),this.bottomY-this.radius-i*(this.h-2*this.radius),this.radius/2,0,kt),y.fill(),this.renderLabel(this.options.label,ht.selector)}onPointerDown(e,i){return this.pos0={x:e,y:i},this.value0={x:this.options.getXValue(),y:this.options.getYValue()},this}onPointerMove(e,i){const s=Te(this.value0.x+(e-this.pos0.x)/(this.w-this.radius*2),0,1),n=Te(this.value0.y-(i-this.pos0.y)/(this.h-this.radius*2),0,1);this.options.setXValue(s),this.options.setYValue(n),lo(`${this.options.label} = (${s.toFixed(3)}, ${n.toFixed(3)})`)}onPointerUp(e,i){this.pos0=null,this.value0=null}}class co extends Ue{constructor(e){super({w:()=>this.textWidth(this.options.valueToString(this.options.getValue()))+2*xr,h:()=>ht.selector.sizeInPixels+2*xr,...e});R(this,"lineSpacing",1.25);R(this,"labels");R(this,"maxLabelWidth");R(this,"pointerPos");R(this,"popUp");R(this,"selection");const{values:i,valueToString:s,placeCurrentValueAtY0:n}=e;this.labels=i.map(s),n||this.labels.unshift(""),this.maxLabelWidth=this.labels.map(o=>this.textWidth(o)).reduce((o,a)=>Math.max(o,a))+2*xr}onPointerDown(e,i){this.pointerPos={initial:{x:e,y:i},current:{x:e,y:i}};const s=this.pointerPos.initial.x<innerWidth/2,n=1.125*Sr+this.maxLabelWidth;return this.popUp={w:n,h:(this.labels.length+.5)*ht.selector.sizeInPixels*this.lineSpacing,x:s?this.pointerPos.initial.x-Sr/2:this.pointerPos.initial.x-n+Sr/2,y:this.pointerPos.initial.y-ht.selector.sizeInPixels},this.options.placeCurrentValueAtY0&&(this.popUp.y-=ht.selector.sizeInPixels*this.options.values.indexOf(this.options.getValue())),this.selection={x:this.popUp.x+(s?Sr:.125*Sr),y0:this.popUp.y+(this.options.placeCurrentValueAtY0?0:ht.selector.sizeInPixels)},this}onPointerMove(e,i){this.pointerPos.current.x=e,this.pointerPos.current.y=i;const s=this.popUp.y+(this.options.placeCurrentValueAtY0?1:2)*ht.selector.sizeInPixels,n=Math.round((i-s)/(ht.selector.sizeInPixels*this.lineSpacing));if(n<0)return;const o=this.options.values[Math.min(n,this.options.values.length-1)];o!==this.options.getValue()&&(this.options.setValue(o),this.parent.layout())}onPointerUp(e,i){this.pointerPos=void 0}render(){this.renderLabel(this.options.valueToString(this.options.getValue()),ht.selector)}renderOnTop(){if(!this.pointerPos)return;y.fillStyle="rgba(255, 255, 255, 0.5)",y.filter="drop-shadow(5px 5px 5px)",y.beginPath(),y.roundRect(this.popUp.x,this.popUp.y,this.popUp.w,this.popUp.h,ni),y.fill(),y.filter="none",y.filter="blur(10px)",y.fillStyle="rgba(255, 255, 255, 0.8)",y.beginPath(),y.roundRect(this.popUp.x,this.popUp.y,this.popUp.w,this.popUp.h,ni),y.fill(),y.filter="none",y.font=ht.selector.cssFontString;let e=this.selection.y0;for(const i of this.options.values)e+=ht.selector.sizeInPixels*this.lineSpacing,this.renderValue(this.options.valueToString(i),this.options.getValue()===i,this.selection.x,e)}renderValue(e,i,s,n){i&&(y.filter="blur(10px)",y.beginPath(),y.fillStyle=to,y.roundRect(s-xr,n-ht.selector.sizeInPixels+ht.selector.baselineAdjustment,this.maxLabelWidth+2*xr,ht.selector.sizeInPixels,ni*2),y.fill(),y.filter="none"),y.beginPath(),y.fillStyle=i?"#333":"#999",y.fillText(e,s,n),y.fill()}textWidth(e,i=ht.selector){return super.textWidth(e,i)}}const vs=new Map;ct.addEventListener("pointerdown",r=>{const t=Mi.recursiveOnPointerDown(r.offsetX,r.offsetY);t&&(vs.set(r.pointerId,t),ct.setPointerCapture(r.pointerId),r.preventDefault(),r.stopImmediatePropagation(),console.log("FYI a thing ate up a pointer down event"),t.onPointerMove(r.offsetX,r.offsetY))}),ct.addEventListener("pointermove",r=>{const t=vs.get(r.pointerId);t&&(t.onPointerMove(r.offsetX,r.offsetY),r.preventDefault())}),ct.addEventListener("pointerup",th),ct.addEventListener("pointercancel",th);function th(r){const t=vs.get(r.pointerId);t&&(t.onPointerUp(r.offsetX,r.offsetY),vs.delete(r.pointerId),r.preventDefault()),ct.releasePointerCapture(r.pointerId)}class Tt{constructor(t,e,i){this.name=t,this.code=e,this.options=i}}const eh=[new Tt("rebel yell",`
mod = paramA lglide(t: 0.05) norm abs scale(min: 0.45, max: 0.55)
freq = noteFreq * (1 + (noise * paramB scale(min: 0, max: 0.2)))
dry = freq pulse(w: mod) lpf(cf: 6000, q: 0.2) adsr(a: 0.03, d: 0, s: 1, r: 0.1)
out = dry + 0.5 * dry delay(t: 0.4)
    `,{octave:1,mode:"mpe",paramA:0,paramB:.1}),new Tt("hello again",`
osc1 = (noteFreq / 4) pulse
osc2 = 300 ad(a: 0.2, d: 0.5) >> pulse(w: 0.5, sync: osc1)
out = osc2 adsr(a: 0.05, d: 0, s: 1, r: 0.2) >> dcBlock
    `,{octave:-1}),new Tt("duran duran",`
delayAmt = 0.6
detuneAmt = paramD
portamento = paramA
freq = (paramB abs - 0.5) switch2(pos: noteFreq * 2, neg: noteFreq) eglide(t: portamento)
f1 = freq / 2
f2 = freq * detuneAmt escale(min: 1.001, max: 1.025)
oscs = 0.3 * f1 pulse + 0.7 * f2 pulse
dry = oscs lpf12(cf: 24000 * paramC, q: 1) ad(a: 0, d: .75 beats)
out = dry + delayAmt * dry delay(t: 0.75 beats)
    `,{mono:!0,mode:"piano",tempo:123,paramC:.95,paramD:.2}),new Tt("stranger things",`
cf = 10000 adsr(a: 0.001, d: 0, s: 1, r: 0.5)
q = (paramB norm - 0.5) abs scale(min: 0.15, max: 1)
pwmRate = 0.218
osc1 = noteFreq pulse(w: pwmRate sine norm scale(min: 0.2, max: 0.8))
osc2 = (2 * noteFreq * 1.005) pulse(w: pwmRate sine norm scale(min: 0.4, max: 0.6))
out = (osc1 + osc2) lpf(cf, q) adsr(a: 0, d: 0, s: 1, r: paramA) >> dcBlock
    `,{octave:-2,paramA:.8,paramB:.5,tempo:80,triggerPeriod:1/8,noteDuration:.5}),new Tt("tom sawyer",`
w = 0.5 + (1/5) sine norm scale(min: 0, max: 0.4)
detune1 = 0.091 * 0.01
detune2 = 0.836 * 0.01
delayAmt = paramB
oscs =
  (
    (noteFreq * (1 - detune1)) pulse(w) +
    (noteFreq * (1 + detune1)) pulse(w) +
    (noteFreq * (1 - 3 * detune2)) pulse(w) +
    (noteFreq * (1 + 3 * detune2)) pulse(w)
  ) / 4
cf = 10000 * (adsr(a: 0.05, d: 0, s: 1, r: 6) escale(min: 0, max: 1))
dry = oscs lpf12(cf, q: paramA) adsr(a: 0, d: 0, s: 1, r: 12)
out = dry + delayAmt * dry delay(t: 0.15) >> dcBlock
    `,{mode:"piano",octave:-2,paramA:.755,paramB:.127}),new Tt("guitar",`
cutoff = paramA
feedback = paramB scale(min: 0.9, max: 0.999)
burst  = noise gate(t: 0.005) * noteVel
filter = (burst + filter) delay(t: 1 / noteFreq) lpf12(cf: 20000 * cutoff, q: 0) * feedback
out = burst + filter adsr(a: 0, d: 0, s: 1, r: 0.1)
    `,{paramA:1,paramB:.99,octave:-1,mode:"strum"}),new Tt("12 string",`
cutoff = paramA
feedback = paramB scale(min: 0.9, max: 0.999)
burst  = noise gate(t: 0.005) * noteVel
string1 = (burst + string1) delay(t: 1 / noteFreq) lpf12(cf: 20000 * cutoff, q: 0) * feedback
string2 = (burst + string2) delay(t: 1 / (noteFreq * 2)) lpf12(cf: 20000 * cutoff, q: 0) * feedback
out = burst + (string1 + string2) adsr(a: 0, d: 0, s: 1, r: 0.1)
    `,{paramA:1,paramB:.99,octave:-1,mode:"strum"}),new Tt("strum bass",`
out = noteFreq sine adsr(a: 0.01, d: 0.01, s: 1, r: 0.1)
    `,{paramA:.2,paramB:1,octave:-2,mode:"strum"}),new Tt("rick and morty",`
sound1 = noise bpf(cf: 0.2 sine * 800 + 1200, q: 1)
sound2 = noise bpf(cf: -(0.25 sine) * 800 + 1200, q: 1)
ring = (sound1 + sound1 delay(t: 2) + sound2) * (1 / 0.25 beats) pulse norm * 0.5
out = ring adsr(a: 0.01, d: 0, s: 1, r: 2)
    `,{tempo:83}),new Tt("pwm",`
out = noteFreq pulse(w: slide lglide(t: 0.05) norm scale(min: 0.2, max: 0.8)) adsr(a: 0.05, d: 0, s: 1, r: 0.4)
    `),new Tt("pwm pencil",`
out = noteFreq pulse(w: slide lglide(t: 0.05) norm scale(min: 0.2, max: 0.8)) adsr(a: 0.05, d: 0, s: 1, r: 0.4) * pressure
    `),new Tt("sine",`
out = noteFreq sine adsr(a: 0.01, d: 0, s: 1, r: 0.3)
    `),new Tt("ddd",`
preDistGain = paramA scale(min: 0.1, max: 5)
postDistGain = paramB * 10
directSignalGain = (slide - 0.5) abs * 3
feedbackGain = paramC scale(min: 0, max: 0.9)
feedbackDelay = 0.1 * paramD

in = noteFreq saw adsr(a: 0.03, d: 0, s: 1, r: 0.1)

nonLinearDist = (in * preDistGain + feedback) >> softClip
feedback = nonLinearDist * feedbackGain >> delay(t: feedbackDelay)
out = nonLinearDist * postDistGain + in * directSignalGain
    `,{octave:0,mode:"mpe",paramA:.5,paramB:.5,paramC:.5,paramD:.5}),new Tt("user 1","out = noteFreq saw adsr(a: 0.03, d: 0, s: 1, r: 0.1) >> junoChorus(type: paramA)",{octave:0,mode:"mpe"}),new Tt("user 2","out = noteFreq sine adsr(a: 0.01, d: 0, s: 1, r: 0.3)",{octave:0,mode:"mpe"}),new Tt("user 3","out = noteFreq sine adsr(a: 0.01, d: 0, s: 1, r: 0.3)",{octave:0,mode:"mpe"})];let uo=[],ih=[];(()=>{let r="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=0,e=0;t<r.length;t++)(t%2?ih:uo).push(e=e+r[t])})();function rm(r){if(r<768)return!1;for(let t=0,e=uo.length;;){let i=t+e>>1;if(r<uo[i])e=i;else if(r>=ih[i])t=i+1;else return!0;if(t==e)return!1}}function rh(r){return r>=127462&&r<=127487}const sh=8205;function sm(r,t,e=!0,i=!0){return(e?nh:nm)(r,t,i)}function nh(r,t,e){if(t==r.length)return t;t&&oh(r.charCodeAt(t))&&ah(r.charCodeAt(t-1))&&t--;let i=fo(r,t);for(t+=lh(i);t<r.length;){let s=fo(r,t);if(i==sh||s==sh||e&&rm(s))t+=lh(s),i=s;else if(rh(s)){let n=0,o=t-2;for(;o>=0&&rh(fo(r,o));)n++,o-=2;if(n%2==0)break;t+=2}else break}return t}function nm(r,t,e){for(;t>0;){let i=nh(r,t-2,e);if(i<t)return i;t--}return 0}function fo(r,t){let e=r.charCodeAt(t);if(!ah(e)||t+1==r.length)return e;let i=r.charCodeAt(t+1);return oh(i)?(e-55296<<10)+(i-56320)+65536:e}function oh(r){return r>=56320&&r<57344}function ah(r){return r>=55296&&r<56320}function lh(r){return r<65536?1:2}class G{lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){[t,e]=Ji(this,t,e);let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(e,this.length,s,1),Re.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){[t,e]=Ji(this,t,e);let i=[];return this.decompose(t,e,i,0),Re.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new kr(this),n=new kr(t);for(let o=e,a=e;;){if(s.next(o),n.next(o),o=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(a+=s.value.length,s.done||a>=i)return!0}}iter(t=1){return new kr(this,t)}iterRange(t,e=this.length){return new ch(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new uh(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}constructor(){}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?G.empty:t.length<=32?new ot(t):Re.from(ot.split(t,[]))}}class ot extends G{constructor(t,e=om(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let n=0;;n++){let o=this.text[n],a=s+o.length;if((e?i:a)>=t)return new am(s,a,i,o);s=a+1,i++}}decompose(t,e,i,s){let n=t<=0&&e>=this.length?this:new ot(hh(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(s&1){let o=i.pop(),a=ys(n.text,o.text.slice(),0,n.length);if(a.length<=32)i.push(new ot(a,o.length+n.length));else{let l=a.length>>1;i.push(new ot(a.slice(0,l)),new ot(a.slice(l)))}}else i.push(n)}replace(t,e,i){if(!(i instanceof ot))return super.replace(t,e,i);[t,e]=Ji(this,t,e);let s=ys(this.text,ys(i.text,hh(this.text,0,t)),e),n=this.length+i.length-(e-t);return s.length<=32?new ot(s,n):Re.from(ot.split(s,[]),n)}sliceString(t,e=this.length,i=`
`){[t,e]=Ji(this,t,e);let s="";for(let n=0,o=0;n<=e&&o<this.text.length;o++){let a=this.text[o],l=n+a.length;n>t&&o&&(s+=i),t<l&&e>n&&(s+=a.slice(Math.max(0,t-n),e-n)),n=l+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let n of t)i.push(n),s+=n.length+1,i.length==32&&(e.push(new ot(i,s)),i=[],s=-1);return s>-1&&e.push(new ot(i,s)),e}}class Re extends G{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,s){for(let n=0;;n++){let o=this.children[n],a=s+o.length,l=i+o.lines-1;if((e?l:a)>=t)return o.lineInner(t,e,i,s);s=a+1,i=l+1}}decompose(t,e,i,s){for(let n=0,o=0;o<=e&&n<this.children.length;n++){let a=this.children[n],l=o+a.length;if(t<=l&&e>=o){let h=s&((o<=t?1:0)|(l>=e?2:0));o>=t&&l<=e&&!h?i.push(a):a.decompose(t-o,e-o,i,h)}o=l+1}}replace(t,e,i){if([t,e]=Ji(this,t,e),i.lines<this.lines)for(let s=0,n=0;s<this.children.length;s++){let o=this.children[s],a=n+o.length;if(t>=n&&e<=a){let l=o.replace(t-n,e-n,i),h=this.lines-o.lines+l.lines;if(l.lines<h>>4&&l.lines>h>>6){let c=this.children.slice();return c[s]=l,new Re(c,this.length-(e-t)+i.length)}return super.replace(n,a,l)}n=a+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){[t,e]=Ji(this,t,e);let s="";for(let n=0,o=0;n<this.children.length&&o<=e;n++){let a=this.children[n],l=o+a.length;o>t&&n&&(s+=i),t<l&&e>o&&(s+=a.sliceString(t-o,e-o,i)),o=l+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof Re))return 0;let i=0,[s,n,o,a]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,n+=e){if(s==o||n==a)return i;let l=this.children[s],h=t.children[n];if(l!=h)return i+l.scanIdentical(h,e);i+=l.length+1}}static from(t,e=t.reduce((i,s)=>i+s.length+1,-1)){let i=0;for(let f of t)i+=f.lines;if(i<32){let f=[];for(let p of t)p.flatten(f);return new ot(f,e)}let s=Math.max(32,i>>5),n=s<<1,o=s>>1,a=[],l=0,h=-1,c=[];function u(f){let p;if(f.lines>n&&f instanceof Re)for(let m of f.children)u(m);else f.lines>o&&(l>o||!l)?(d(),a.push(f)):f instanceof ot&&l&&(p=c[c.length-1])instanceof ot&&f.lines+p.lines<=32?(l+=f.lines,h+=f.length+1,c[c.length-1]=new ot(p.text.concat(f.text),p.length+1+f.length)):(l+f.lines>s&&d(),l+=f.lines,h+=f.length+1,c.push(f))}function d(){l!=0&&(a.push(c.length==1?c[0]:Re.from(c,h)),h=-1,l=c.length=0)}for(let f of t)u(f);return d(),a.length==1?a[0]:new Re(a,e)}}G.empty=new ot([""],0);function om(r){let t=-1;for(let e of r)t+=e.length+1;return t}function ys(r,t,e=0,i=1e9){for(let s=0,n=0,o=!0;n<r.length&&s<=i;n++){let a=r[n],l=s+a.length;l>=e&&(l>i&&(a=a.slice(0,i-s)),s<e&&(a=a.slice(e-s)),o?(t[t.length-1]+=a,o=!1):t.push(a)),s=l+1}return t}function hh(r,t,e){return ys(r,[""],t,e)}class kr{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof ot?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],o=n>>1,a=s instanceof ot?s.text.length:s.children.length;if(o==(e>0?a:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((n&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(s instanceof ot){let l=s.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,l.length>Math.max(0,t))return this.value=t==0?l:e>0?l.slice(t):l.slice(0,l.length-t),this;t-=l.length}else{let l=s.children[o+(e<0?-1:0)];t>l.length?(t-=l.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(l),this.offsets.push(e>0?1:(l instanceof ot?l.text.length:l.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class ch{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new kr(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class uh{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e&&this.afterBreak?(this.value="",this.afterBreak=!1):e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(G.prototype[Symbol.iterator]=function(){return this.iter()},kr.prototype[Symbol.iterator]=ch.prototype[Symbol.iterator]=uh.prototype[Symbol.iterator]=function(){return this});class am{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}function Ji(r,t,e){return t=Math.max(0,Math.min(r.length,t)),[t,Math.max(t,Math.min(r.length,e))]}function pt(r,t,e=!0,i=!0){return sm(r,t,e,i)}function lm(r){return r>=56320&&r<57344}function hm(r){return r>=55296&&r<56320}function Xt(r,t){let e=r.charCodeAt(t);if(!hm(e)||t+1==r.length)return e;let i=r.charCodeAt(t+1);return lm(i)?(e-55296<<10)+(i-56320)+65536:e}function po(r){return r<=65535?String.fromCharCode(r):(r-=65536,String.fromCharCode((r>>10)+55296,(r&1023)+56320))}function Ee(r){return r<65536?1:2}const mo=/\r\n?|\n/;var Wt=(function(r){return r[r.Simple=0]="Simple",r[r.TrackDel=1]="TrackDel",r[r.TrackBefore=2]="TrackBefore",r[r.TrackAfter=3]="TrackAfter",r})(Wt||(Wt={}));class Pe{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let n=this.sections[e++],o=this.sections[e++];o<0?(t(i,s,n),s+=n):s+=o,i+=n}}iterChangedRanges(t,e=!1){go(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new Pe(t)}composeDesc(t){return this.empty?t:t.empty?this:dh(this,t)}mapDesc(t,e=!1){return t.empty?this:vo(this,t,e)}mapPos(t,e=-1,i=Wt.Simple){let s=0,n=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],l=this.sections[o++],h=s+a;if(l<0){if(h>t)return n+(t-s);n+=a}else{if(i!=Wt.Simple&&h>=t&&(i==Wt.TrackDel&&s<t&&h>t||i==Wt.TrackBefore&&s<t||i==Wt.TrackAfter&&h>t))return null;if(h>t||h==t&&e<0&&!a)return t==s||e<0?n:n+l;n+=l}s=h}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return n}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let n=this.sections[i++],o=this.sections[i++],a=s+n;if(o>=0&&s<=e&&a>=t)return s<t&&a>e?"cover":!0;s=a}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Pe(t)}static create(t){return new Pe(t)}}class mt extends Pe{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return go(this,(e,i,s,n,o)=>t=t.replace(s,s+(i-e),o),!1),t}mapDesc(t,e=!1){return vo(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,n=0;s<e.length;s+=2){let o=e[s],a=e[s+1];if(a>=0){e[s]=a,e[s+1]=o;let l=s>>1;for(;i.length<l;)i.push(G.empty);i.push(o?t.slice(n,n+o):G.empty)}n+=o}return new mt(e,i)}compose(t){return this.empty?t:t.empty?this:dh(this,t,!0)}map(t,e=!1){return t.empty?this:vo(this,t,e,!0)}iterChanges(t,e=!1){go(this,t,e)}get desc(){return Pe.create(this.sections)}filter(t){let e=[],i=[],s=[],n=new Ar(this);t:for(let o=0,a=0;;){let l=o==t.length?1e9:t[o++];for(;a<l||a==l&&n.len==0;){if(n.done)break t;let c=Math.min(n.len,l-a);Rt(s,c,-1);let u=n.ins==-1?-1:n.off==0?n.ins:0;Rt(e,c,u),u>0&&oi(i,e,n.text),n.forward(c),a+=c}let h=t[o++];for(;a<h;){if(n.done)break t;let c=Math.min(n.len,h-a);Rt(e,c,-1),Rt(s,c,n.ins==-1?-1:n.off==0?n.ins:0),n.forward(c),a+=c}}return{changes:new mt(e,i),filtered:Pe.create(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):s==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],n=[],o=0,a=null;function l(c=!1){if(!c&&!s.length)return;o<e&&Rt(s,e-o,-1);let u=new mt(s,n);a=a?a.compose(u.map(a)):u,s=[],n=[],o=0}function h(c){if(Array.isArray(c))for(let u of c)h(u);else if(c instanceof mt){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);l(),a=a?a.compose(c.map(a)):c}else{let{from:u,to:d=u,insert:f}=c;if(u>d||u<0||d>e)throw new RangeError(`Invalid change range ${u} to ${d} (in doc of length ${e})`);let p=f?typeof f=="string"?G.of(f.split(i||mo)):f:G.empty,m=p.length;if(u==d&&m==0)return;u<o&&l(),u>o&&Rt(s,u-o,-1),Rt(s,d-u,m),oi(n,s,p),o=d}}return h(t),l(!a),a}static empty(t){return new mt(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let n=t[s];if(typeof n=="number")e.push(n,-1);else{if(!Array.isArray(n)||typeof n[0]!="number"||n.some((o,a)=>a&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(n.length==1)e.push(n[0],0);else{for(;i.length<s;)i.push(G.empty);i[s]=G.of(n.slice(1)),e.push(n[0],i[s].length)}}}return new mt(e,i)}static createSet(t,e){return new mt(t,e)}}function Rt(r,t,e,i=!1){if(t==0&&e<=0)return;let s=r.length-2;s>=0&&e<=0&&e==r[s+1]?r[s]+=t:s>=0&&t==0&&r[s]==0?r[s+1]+=e:i?(r[s]+=t,r[s+1]+=e):r.push(t,e)}function oi(r,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<r.length)r[r.length-1]=r[r.length-1].append(e);else{for(;r.length<i;)r.push(G.empty);r.push(e)}}function go(r,t,e){let i=r.inserted;for(let s=0,n=0,o=0;o<r.sections.length;){let a=r.sections[o++],l=r.sections[o++];if(l<0)s+=a,n+=a;else{let h=s,c=n,u=G.empty;for(;h+=a,c+=l,l&&i&&(u=u.append(i[o-2>>1])),!(e||o==r.sections.length||r.sections[o+1]<0);)a=r.sections[o++],l=r.sections[o++];t(s,h,n,c,u),s=h,n=c}}}function vo(r,t,e,i=!1){let s=[],n=i?[]:null,o=new Ar(r),a=new Ar(t);for(let l=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&a.ins==-1){let h=Math.min(o.len,a.len);Rt(s,h,-1),o.forward(h),a.forward(h)}else if(a.ins>=0&&(o.ins<0||l==o.i||o.off==0&&(a.len<o.len||a.len==o.len&&!e))){let h=a.len;for(Rt(s,a.ins,-1);h;){let c=Math.min(o.len,h);o.ins>=0&&l<o.i&&o.len<=c&&(Rt(s,0,o.ins),n&&oi(n,s,o.text),l=o.i),o.forward(c),h-=c}a.next()}else if(o.ins>=0){let h=0,c=o.len;for(;c;)if(a.ins==-1){let u=Math.min(c,a.len);h+=u,c-=u,a.forward(u)}else if(a.ins==0&&a.len<c)c-=a.len,a.next();else break;Rt(s,h,l<o.i?o.ins:0),n&&l<o.i&&oi(n,s,o.text),l=o.i,o.forward(o.len-c)}else{if(o.done&&a.done)return n?mt.createSet(s,n):Pe.create(s);throw new Error("Mismatched change set lengths")}}}function dh(r,t,e=!1){let i=[],s=e?[]:null,n=new Ar(r),o=new Ar(t);for(let a=!1;;){if(n.done&&o.done)return s?mt.createSet(i,s):Pe.create(i);if(n.ins==0)Rt(i,n.len,0,a),n.next();else if(o.len==0&&!o.done)Rt(i,0,o.ins,a),s&&oi(s,i,o.text),o.next();else{if(n.done||o.done)throw new Error("Mismatched change set lengths");{let l=Math.min(n.len2,o.len),h=i.length;if(n.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Rt(i,l,c,a),s&&c&&oi(s,i,o.text)}else o.ins==-1?(Rt(i,n.off?0:n.len,l,a),s&&oi(s,i,n.textBit(l))):(Rt(i,n.off?0:n.len,o.off?0:o.ins,a),s&&!o.off&&oi(s,i,o.text));a=(n.ins>l||o.ins>=0&&o.len>l)&&(a||i.length>h),n.forward2(l),o.forward(l)}}}}class Ar{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?G.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?G.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class Oi{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let t=this.flags&7;return t==7?null:t}get goalColumn(){let t=this.flags>>6;return t==16777215?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new Oi(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return b.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return b.range(this.anchor,i)}eq(t,e=!1){return this.anchor==t.anchor&&this.head==t.head&&this.goalColumn==t.goalColumn&&(!e||!this.empty||this.assoc==t.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return b.range(t.anchor,t.head)}static create(t,e,i){return new Oi(t,e,i)}}class b{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:b.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t,e=!1){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(t.ranges[i],e))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new b([this.main],0)}addRange(t,e=!0){return b.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,b.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new b(t.ranges.map(e=>Oi.fromJSON(e)),t.main)}static single(t,e=t){return new b([b.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let n=t[s];if(n.empty?n.from<=i:n.from<i)return b.normalized(t.slice(),e);i=n.to}return new b(t,e)}static cursor(t,e=0,i,s){return Oi.create(t,t,(e==0?0:e<0?8:16)|(i==null?7:Math.min(6,i))|(s??16777215)<<6)}static range(t,e,i,s){let n=(i??16777215)<<6|(s==null?7:Math.min(6,s));return e<t?Oi.create(e,t,48|n):Oi.create(t,e,(e>t?8:0)|n)}static normalized(t,e=0){let i=t[e];t.sort((s,n)=>s.from-n.from),e=t.indexOf(i);for(let s=1;s<t.length;s++){let n=t[s],o=t[s-1];if(n.empty?n.from<=o.to:n.from<o.to){let a=o.from,l=Math.max(n.to,o.to);s<=e&&e--,t.splice(--s,2,n.anchor>n.head?b.range(l,a):b.range(a,l))}}return new b(t,e)}}function fh(r,t){for(let e of r.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let yo=0;class O{constructor(t,e,i,s,n){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.id=yo++,this.default=t([]),this.extensions=typeof n=="function"?n(this):n}get reader(){return this}static define(t={}){return new O(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:wo),!!t.static,t.enables)}of(t){return new ws([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new ws(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new ws(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}}function wo(r,t){return r==t||r.length==t.length&&r.every((e,i)=>e===t[i])}class ws{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=yo++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,n=this.id,o=t[n]>>1,a=this.type==2,l=!1,h=!1,c=[];for(let u of this.dependencies)u=="doc"?l=!0:u=="selection"?h=!0:((e=t[u.id])!==null&&e!==void 0?e:1)&1||c.push(t[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,d){if(l&&d.docChanged||h&&(d.docChanged||d.selection)||xo(u,c)){let f=i(u);if(a?!ph(f,u.values[o],s):!s(f,u.values[o]))return u.values[o]=f,1}return 0},reconfigure:(u,d)=>{let f,p=d.config.address[n];if(p!=null){let m=ks(d,p);if(this.dependencies.every(g=>g instanceof O?d.facet(g)===u.facet(g):g instanceof gt?d.field(g,!1)==u.field(g,!1):!0)||(a?ph(f=i(u),m,s):s(f=i(u),m)))return u.values[o]=m,0}else f=i(u);return u.values[o]=f,1}}}}function ph(r,t,e){if(r.length!=t.length)return!1;for(let i=0;i<r.length;i++)if(!e(r[i],t[i]))return!1;return!0}function xo(r,t){let e=!1;for(let i of t)Ir(r,i)&1&&(e=!0);return e}function cm(r,t,e){let i=e.map(l=>r[l.id]),s=e.map(l=>l.type),n=i.filter(l=>!(l&1)),o=r[t.id]>>1;function a(l){let h=[];for(let c=0;c<i.length;c++){let u=ks(l,i[c]);if(s[c]==2)for(let d of u)h.push(d);else h.push(u)}return t.combine(h)}return{create(l){for(let h of i)Ir(l,h);return l.values[o]=a(l),1},update(l,h){if(!xo(l,n))return 0;let c=a(l);return t.compare(c,l.values[o])?0:(l.values[o]=c,1)},reconfigure(l,h){let c=xo(l,i),u=h.config.facets[t.id],d=h.facet(t);if(u&&!c&&wo(e,u))return l.values[o]=d,0;let f=a(l);return t.compare(f,d)?(l.values[o]=d,0):(l.values[o]=f,1)}}}const xs=O.define({static:!0});class gt{constructor(t,e,i,s,n){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(t){let e=new gt(yo++,t.create,t.update,t.compare||((i,s)=>i===s),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(xs).find(i=>i.field==this);return((e==null?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,s)=>{let n=i.values[e],o=this.updateF(n,s);return this.compareF(n,o)?0:(i.values[e]=o,1)},reconfigure:(i,s)=>{let n=i.facet(xs),o=s.facet(xs),a;return(a=n.find(l=>l.field==this))&&a!=o.find(l=>l.field==this)?(i.values[e]=a.create(i),1):s.config.address[this.id]!=null?(i.values[e]=s.field(this),0):(i.values[e]=this.create(i),1)}}}init(t){return[this,xs.of({field:this,create:t})]}get extension(){return this}}const Di={lowest:4,low:3,default:2,high:1,highest:0};function Cr(r){return t=>new mh(t,r)}const Ti={highest:Cr(Di.highest),high:Cr(Di.high),default:Cr(Di.default),low:Cr(Di.low),lowest:Cr(Di.lowest)};class mh{constructor(t,e){this.inner=t,this.prec=e}}class bs{of(t){return new bo(this,t)}reconfigure(t){return bs.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class bo{constructor(t,e){this.compartment=t,this.inner=e}}class Ss{constructor(t,e,i,s,n,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],n=Object.create(null),o=new Map;for(let d of um(t,e,o))d instanceof gt?s.push(d):(n[d.facet.id]||(n[d.facet.id]=[])).push(d);let a=Object.create(null),l=[],h=[];for(let d of s)a[d.id]=h.length<<1,h.push(f=>d.slot(f));let c=i==null?void 0:i.config.facets;for(let d in n){let f=n[d],p=f[0].facet,m=c&&c[d]||[];if(f.every(g=>g.type==0))if(a[p.id]=l.length<<1|1,wo(m,f))l.push(i.facet(p));else{let g=p.combine(f.map(v=>v.value));l.push(i&&p.compare(g,i.facet(p))?i.facet(p):g)}else{for(let g of f)g.type==0?(a[g.id]=l.length<<1|1,l.push(g.value)):(a[g.id]=h.length<<1,h.push(v=>g.dynamicSlot(v)));a[p.id]=h.length<<1,h.push(g=>cm(g,p,f))}}let u=h.map(d=>d(a));return new Ss(t,o,u,a,l,n)}}function um(r,t,e){let i=[[],[],[],[],[]],s=new Map;function n(o,a){let l=s.get(o);if(l!=null){if(l<=a)return;let h=i[l].indexOf(o);h>-1&&i[l].splice(h,1),o instanceof bo&&e.delete(o.compartment)}if(s.set(o,a),Array.isArray(o))for(let h of o)n(h,a);else if(o instanceof bo){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=t.get(o.compartment)||o.inner;e.set(o.compartment,h),n(h,a)}else if(o instanceof mh)n(o.inner,o.prec);else if(o instanceof gt)i[a].push(o),o.provides&&n(o.provides,a);else if(o instanceof ws)i[a].push(o),o.facet.extensions&&n(o.facet.extensions,Di.default);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);n(h,a)}}return n(r,Di.default),i.reduce((o,a)=>o.concat(a))}function Ir(r,t){if(t&1)return 2;let e=t>>1,i=r.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;r.status[e]=4;let s=r.computeSlot(r,r.config.dynamicSlots[e]);return r.status[e]=2|s}function ks(r,t){return t&1?r.config.staticValues[t>>1]:r.values[t>>1]}const gh=O.define(),So=O.define({combine:r=>r.some(t=>t),static:!0}),vh=O.define({combine:r=>r.length?r[0]:void 0,static:!0}),yh=O.define(),wh=O.define(),xh=O.define(),bh=O.define({combine:r=>r.length?r[0]:!1});class Ke{constructor(t,e){this.type=t,this.value=e}static define(){return new dm}}class dm{of(t){return new Ke(this,t)}}class fm{constructor(t){this.map=t}of(t){return new F(this,t)}}class F{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new F(this.type,e)}is(t){return this.type==t}static define(t={}){return new fm(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let n=s.map(e);n&&i.push(n)}return i}}F.reconfigure=F.define(),F.appendConfig=F.define();class vt{constructor(t,e,i,s,n,o){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=n,this.scrollIntoView=o,this._doc=null,this._state=null,i&&fh(i,e.newLength),n.some(a=>a.type==vt.time)||(this.annotations=n.concat(vt.time.of(Date.now())))}static create(t,e,i,s,n,o){return new vt(t,e,i,s,n,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(vt.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}}vt.time=Ke.define(),vt.userEvent=Ke.define(),vt.addToHistory=Ke.define(),vt.remote=Ke.define();function pm(r,t){let e=[];for(let i=0,s=0;;){let n,o;if(i<r.length&&(s==t.length||t[s]>=r[i]))n=r[i++],o=r[i++];else if(s<t.length)n=t[s++],o=t[s++];else return e;!e.length||e[e.length-1]<n?e.push(n,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function Sh(r,t,e){var i;let s,n,o;return e?(s=t.changes,n=mt.empty(t.changes.length),o=r.changes.compose(t.changes)):(s=t.changes.map(r.changes),n=r.changes.mapDesc(t.changes,!0),o=r.changes.compose(s)),{changes:o,selection:t.selection?t.selection.map(n):(i=r.selection)===null||i===void 0?void 0:i.map(s),effects:F.mapEffects(r.effects,s).concat(F.mapEffects(t.effects,n)),annotations:r.annotations.length?r.annotations.concat(t.annotations):t.annotations,scrollIntoView:r.scrollIntoView||t.scrollIntoView}}function ko(r,t,e){let i=t.selection,s=Qi(t.annotations);return t.userEvent&&(s=s.concat(vt.userEvent.of(t.userEvent))),{changes:t.changes instanceof mt?t.changes:mt.of(t.changes||[],e,r.facet(vh)),selection:i&&(i instanceof b?i:b.single(i.anchor,i.head)),effects:Qi(t.effects),annotations:s,scrollIntoView:!!t.scrollIntoView}}function kh(r,t,e){let i=ko(r,t.length?t[0]:{},r.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let n=1;n<t.length;n++){t[n].filter===!1&&(e=!1);let o=!!t[n].sequential;i=Sh(i,ko(r,t[n],o?i.changes.newLength:r.doc.length),o)}let s=vt.create(r,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return gm(e?mm(s):s)}function mm(r){let t=r.startState,e=!0;for(let s of t.facet(yh)){let n=s(r);if(n===!1){e=!1;break}Array.isArray(n)&&(e=e===!0?n:pm(e,n))}if(e!==!0){let s,n;if(e===!1)n=r.changes.invertedDesc,s=mt.empty(t.doc.length);else{let o=r.changes.filter(e);s=o.changes,n=o.filtered.mapDesc(o.changes).invertedDesc}r=vt.create(t,s,r.selection&&r.selection.map(n),F.mapEffects(r.effects,n),r.annotations,r.scrollIntoView)}let i=t.facet(wh);for(let s=i.length-1;s>=0;s--){let n=i[s](r);n instanceof vt?r=n:Array.isArray(n)&&n.length==1&&n[0]instanceof vt?r=n[0]:r=kh(t,Qi(n),!1)}return r}function gm(r){let t=r.startState,e=t.facet(xh),i=r;for(let s=e.length-1;s>=0;s--){let n=e[s](r);n&&Object.keys(n).length&&(i=Sh(i,ko(t,n,r.changes.newLength),!0))}return i==r?r:vt.create(t,r.changes,r.selection,i.effects,i.annotations,i.scrollIntoView)}const vm=[];function Qi(r){return r==null?vm:Array.isArray(r)?r:[r]}var tt=(function(r){return r[r.Word=0]="Word",r[r.Space=1]="Space",r[r.Other=2]="Other",r})(tt||(tt={}));const ym=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Ao;try{Ao=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function wm(r){if(Ao)return Ao.test(r);for(let t=0;t<r.length;t++){let e=r[t];if(/\w/.test(e)||e>"\x80"&&(e.toUpperCase()!=e.toLowerCase()||ym.test(e)))return!0}return!1}function xm(r){return t=>{if(!/\S/.test(t))return tt.Space;if(wm(t))return tt.Word;for(let e=0;e<r.length;e++)if(t.indexOf(r[e])>-1)return tt.Word;return tt.Other}}class ${constructor(t,e,i,s,n,o){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=n,o&&(o._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)Ir(this,a<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return Ir(this,i),ks(this,i)}update(...t){return kh(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:s}=e;for(let a of t.effects)a.is(bs.reconfigure)?(e&&(s=new Map,e.compartments.forEach((l,h)=>s.set(h,l)),e=null),s.set(a.value.compartment,a.value.extension)):a.is(F.reconfigure)?(e=null,i=a.value):a.is(F.appendConfig)&&(e=null,i=Qi(i).concat(a.value));let n;e?n=t.startState.values.slice():(e=Ss.resolve(i,s,this),n=new $(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(a,l)=>l.reconfigure(a,this),null).values);let o=t.startState.facet(So)?t.newSelection:t.newSelection.asSingle();new $(e,t.newDoc,o,n,(a,l)=>l.update(a,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:b.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),n=[i.range],o=Qi(i.effects);for(let a=1;a<e.ranges.length;a++){let l=t(e.ranges[a]),h=this.changes(l.changes),c=h.map(s);for(let d=0;d<a;d++)n[d]=n[d].map(c);let u=s.mapDesc(h,!0);n.push(l.range.map(u)),s=s.compose(c),o=F.mapEffects(o,c).concat(F.mapEffects(Qi(l.effects),u))}return{changes:s,selection:b.create(n,e.mainIndex),effects:o}}changes(t=[]){return t instanceof mt?t:mt.of(t,this.doc.length,this.facet($.lineSeparator))}toText(t){return G.of(t.split(this.facet($.lineSeparator)||mo))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(Ir(this,e),ks(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof gt&&this.config.address[s.id]!=null&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i){for(let n in i)if(Object.prototype.hasOwnProperty.call(t,n)){let o=i[n],a=t[n];s.push(o.init(l=>o.spec.fromJSON(a,l)))}}return $.create({doc:t.doc,selection:b.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let e=Ss.resolve(t.extensions||[],new Map),i=t.doc instanceof G?t.doc:G.of((t.doc||"").split(e.staticFacet($.lineSeparator)||mo)),s=t.selection?t.selection instanceof b?t.selection:b.single(t.selection.anchor,t.selection.head):b.single(0);return fh(s,i.length),e.staticFacet(So)||(s=s.asSingle()),new $(e,i,s,e.dynamicSlots.map(()=>null),(n,o)=>o.create(n),null)}get tabSize(){return this.facet($.tabSize)}get lineBreak(){return this.facet($.lineSeparator)||`
`}get readOnly(){return this.facet(bh)}phrase(t,...e){for(let i of this.facet($.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,s)=>{if(s=="$")return"$";let n=+(s||1);return!n||n>e.length?i:e[n-1]})),t}languageDataAt(t,e,i=-1){let s=[];for(let n of this.facet(gh))for(let o of n(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&s.push(o[t]);return s}charCategorizer(t){let e=this.languageDataAt("wordChars",t);return xm(e.length?e[0]:"")}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),n=this.charCategorizer(t),o=t-i,a=t-i;for(;o>0;){let l=pt(e,o,!1);if(n(e.slice(l,o))!=tt.Word)break;o=l}for(;a<s;){let l=pt(e,a);if(n(e.slice(a,l))!=tt.Word)break;a=l}return o==a?null:b.range(o+i,a+i)}}$.allowMultipleSelections=So,$.tabSize=O.define({combine:r=>r.length?r[0]:4}),$.lineSeparator=vh,$.readOnly=bh,$.phrases=O.define({compare(r,t){let e=Object.keys(r),i=Object.keys(t);return e.length==i.length&&e.every(s=>r[s]==t[s])}}),$.languageData=gh,$.changeFilter=yh,$.transactionFilter=wh,$.transactionExtender=xh,bs.reconfigure=F.define();function be(r,t,e={}){let i={};for(let s of r)for(let n of Object.keys(s)){let o=s[n],a=i[n];if(a===void 0)i[n]=o;else if(!(a===o||o===void 0))if(Object.hasOwnProperty.call(e,n))i[n]=e[n](a,o);else throw new Error("Config merge conflict for field "+n)}for(let s in t)i[s]===void 0&&(i[s]=t[s]);return i}class ai{eq(t){return this==t}range(t,e=t){return Io.create(t,e,this)}}ai.prototype.startSide=ai.prototype.endSide=0,ai.prototype.point=!1,ai.prototype.mapMode=Wt.TrackDel;function Co(r,t){return r==t||r.constructor==t.constructor&&r.eq(t)}let Io=class Fp{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new Fp(t,e,i)}};function Mo(r,t){return r.from-t.from||r.value.startSide-t.value.startSide}class Oo{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let n=i?this.to:this.from;for(let o=s,a=n.length;;){if(o==a)return o;let l=o+a>>1,h=n[l]-t||(i?this.value[l].endSide:this.value[l].startSide)-e;if(l==o)return h>=0?o:a;h>=0?a=l:o=l+1}}between(t,e,i,s){for(let n=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,n);n<o;n++)if(s(this.from[n]+t,this.to[n]+t,this.value[n])===!1)return!1}map(t,e){let i=[],s=[],n=[],o=-1,a=-1;for(let l=0;l<this.value.length;l++){let h=this.value[l],c=this.from[l]+t,u=this.to[l]+t,d,f;if(c==u){let p=e.mapPos(c,h.startSide,h.mapMode);if(p==null||(d=f=p,h.startSide!=h.endSide&&(f=e.mapPos(c,h.endSide),f<d)))continue}else if(d=e.mapPos(c,h.startSide),f=e.mapPos(u,h.endSide),d>f||d==f&&h.startSide>0&&h.endSide<=0)continue;(f-d||h.endSide-h.startSide)<0||(o<0&&(o=d),h.point&&(a=Math.max(a,f-d)),i.push(h),s.push(d-o),n.push(f-o))}return{mapped:i.length?new Oo(s,n,i,a):null,pos:o}}}class W{constructor(t,e,i,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}static create(t,e,i,s){return new W(t,e,i,s)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:n=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(Mo)),this.isEmpty)return e.length?W.of(e):this;let a=new Ch(this,null,-1).goto(0),l=0,h=[],c=new Ye;for(;a.value||l<e.length;)if(l<e.length&&(a.from-e[l].from||a.startSide-e[l].value.startSide)>=0){let u=e[l++];c.addInner(u.from,u.to,u.value)||h.push(u)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==e.length||this.chunkEnd(a.chunkIndex)<e[l].from)&&(!o||s>this.chunkEnd(a.chunkIndex)||n<this.chunkPos[a.chunkIndex])&&c.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||s>a.to||n<a.from||o(a.from,a.to,a.value))&&(c.addInner(a.from,a.to,a.value)||h.push(Io.create(a.from,a.to,a.value))),a.next());return c.finishInner(this.nextLayer.isEmpty&&!h.length?W.empty:this.nextLayer.update({add:h,filter:o,filterFrom:s,filterTo:n}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let o=0;o<this.chunk.length;o++){let a=this.chunkPos[o],l=this.chunk[o],h=t.touchesRange(a,a+l.length);if(h===!1)s=Math.max(s,l.maxPoint),e.push(l),i.push(t.mapPos(a));else if(h===!0){let{mapped:c,pos:u}=l.map(a,t);c&&(s=Math.max(s,c.maxPoint),e.push(c),i.push(u))}}let n=this.nextLayer.map(t);return e.length==0?n:new W(i,e,n||W.empty,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],o=this.chunk[s];if(e>=n&&t<=n+o.length&&o.between(n,t-n,e-n,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return Mr.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return Mr.from(t).goto(e)}static compare(t,e,i,s,n=-1){let o=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=n),a=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=n),l=Ah(o,a,i),h=new Or(o,l,n),c=new Or(a,l,n);i.iterGaps((u,d,f)=>Ih(h,u,c,d,f,s)),i.empty&&i.length==0&&Ih(h,0,c,0,0,s)}static eq(t,e,i=0,s){s==null&&(s=999999999);let n=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(n.length!=o.length)return!1;if(!n.length)return!0;let a=Ah(n,o),l=new Or(n,a,0).goto(i),h=new Or(o,a,0).goto(i);for(;;){if(l.to!=h.to||!To(l.active,h.active)||l.point&&(!h.point||!Co(l.point,h.point)))return!1;if(l.to>s)return!0;l.next(),h.next()}}static spans(t,e,i,s,n=-1){let o=new Or(t,null,n).goto(e),a=e,l=o.openStart;for(;;){let h=Math.min(o.to,i);if(o.point){let c=o.activeForPoint(o.to),u=o.pointFrom<e?c.length+1:o.point.startSide<0?c.length:Math.min(c.length,l);s.point(a,h,o.point,c,u,o.pointRank),l=Math.min(o.openEnd(h),c.length)}else h>a&&(s.span(a,h,o.active,l),l=o.openEnd(h));if(o.to>i)return l+(o.point&&o.to>i?1:0);a=o.to,o.next()}}static of(t,e=!1){let i=new Ye;for(let s of t instanceof Io?[t]:e?bm(t):t)i.add(s.from,s.to,s.value);return i.finish()}static join(t){if(!t.length)return W.empty;let e=t[t.length-1];for(let i=t.length-2;i>=0;i--)for(let s=t[i];s!=W.empty;s=s.nextLayer)e=new W(s.chunkPos,s.chunk,e,Math.max(s.maxPoint,e.maxPoint));return e}}W.empty=new W([],[],null,-1);function bm(r){if(r.length>1)for(let t=r[0],e=1;e<r.length;e++){let i=r[e];if(Mo(t,i)>0)return r.slice().sort(Mo);t=i}return r}W.empty.nextLayer=W.empty;class Ye{finishChunk(t){this.chunks.push(new Oo(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new Ye)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(W.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=W.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function Ah(r,t,e){let i=new Map;for(let n of r)for(let o=0;o<n.chunk.length;o++)n.chunk[o].maxPoint<=0&&i.set(n.chunk[o],n.chunkPos[o]);let s=new Set;for(let n of t)for(let o=0;o<n.chunk.length;o++){let a=i.get(n.chunk[o]);a!=null&&(e?e.mapPos(a):a)==n.chunkPos[o]&&!(e!=null&&e.touchesRange(a,a+n.chunk[o].length))&&s.add(n.chunk[o])}return s}class Ch{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<t||s.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class Mr{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let n=0;n<t.length;n++)for(let o=t[n];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&s.push(new Ch(o,e,i,n));return s.length==1?s[0]:new Mr(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)Do(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)Do(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Do(this.heap,0)}}}function Do(r,t){for(let e=r[t];;){let i=(t<<1)+1;if(i>=r.length)break;let s=r[i];if(i+1<r.length&&s.compare(r[i+1])>=0&&(s=r[i+1],i++),e.compare(s)<0)break;r[i]=e,r[t]=s,t=i}}class Or{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Mr.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){As(this.active,t),As(this.activeTo,t),As(this.activeRank,t),this.minActive=Mh(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:n}=this.cursor;for(;e<this.activeRank.length&&(n-this.activeRank[e]||s-this.activeTo[e])>0;)e++;Cs(this.active,e,i),Cs(this.activeTo,e,s),Cs(this.activeRank,e,n),t&&Cs(t,e,this.cursor.from),this.minActive=Mh(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>t){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&As(i,s)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let n=this.cursor.value;if(!n.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=n,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=n.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let s=i.length-1;s>=0&&i[s]<t;s--)this.openStart++}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function Ih(r,t,e,i,s,n){r.goto(t),e.goto(i);let o=i+s,a=i,l=i-t,h=!!n.boundChange;for(let c=!1;;){let u=r.to+l-e.to,d=u||r.endSide-e.endSide,f=d<0?r.to+l:e.to,p=Math.min(f,o);if(r.point||e.point?(r.point&&e.point&&Co(r.point,e.point)&&To(r.activeForPoint(r.to),e.activeForPoint(e.to))||n.comparePoint(a,p,r.point,e.point),c=!1):(c&&n.boundChange(a),p>a&&!To(r.active,e.active)&&n.compareRange(a,p,r.active,e.active),h&&p<o&&(u||r.openEnd(f)!=e.openEnd(f))&&(c=!0)),f>o)break;a=f,d<=0&&r.next(),d>=0&&e.next()}}function To(r,t){if(r.length!=t.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!=t[e]&&!Co(r[e],t[e]))return!1;return!0}function As(r,t){for(let e=t,i=r.length-1;e<i;e++)r[e]=r[e+1];r.pop()}function Cs(r,t,e){for(let i=r.length-1;i>=t;i--)r[i+1]=r[i];r[t]=e}function Mh(r,t){let e=-1,i=1e9;for(let s=0;s<t.length;s++)(t[s]-i||r[s].endSide-r[e].endSide)<0&&(e=s,i=t[s]);return e}function Zi(r,t,e=r.length){let i=0;for(let s=0;s<e&&s<r.length;)r.charCodeAt(s)==9?(i+=t-i%t,s++):(i++,s=pt(r,s));return i}function Ro(r,t,e,i){for(let s=0,n=0;;){if(n>=t)return s;if(s==r.length)break;n+=r.charCodeAt(s)==9?e-n%e:1,s=pt(r,s)}return i===!0?-1:r.length}const Eo="\u037C",Oh=typeof Symbol>"u"?"__"+Eo:Symbol.for(Eo),Po=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Dh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class li{constructor(t,e){this.rules=[];let{finish:i}=e||{};function s(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function n(o,a,l,h){let c=[],u=/^@(\w+)\b/.exec(o[0]),d=u&&u[1]=="keyframes";if(u&&a==null)return l.push(o[0]+";");for(let f in a){let p=a[f];if(/&/.test(f))n(f.split(/,\s*/).map(m=>o.map(g=>m.replace(/&/,g))).reduce((m,g)=>m.concat(g)),p,l);else if(p&&typeof p=="object"){if(!u)throw new RangeError("The value of a property ("+f+") should be a primitive value.");n(s(f),p,c,d)}else p!=null&&c.push(f.replace(/_.*/,"").replace(/[A-Z]/g,m=>"-"+m.toLowerCase())+": "+p+";")}(c.length||d)&&l.push((i&&!u&&!h?o.map(i):o).join(", ")+" {"+c.join(" ")+"}")}for(let o in t)n(s(o),t[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let t=Dh[Oh]||1;return Dh[Oh]=t+1,Eo+t.toString(36)}static mount(t,e,i){let s=t[Po],n=i&&i.nonce;s?n&&s.setNonce(n):s=new Sm(t,n),s.mount(Array.isArray(e)?e:[e],t)}}let Th=new Map;class Sm{constructor(t,e){let i=t.ownerDocument||t,s=i.defaultView;if(!t.head&&t.adoptedStyleSheets&&s.CSSStyleSheet){let n=Th.get(i);if(n)return t[Po]=n;this.sheet=new s.CSSStyleSheet,Th.set(i,this)}else this.styleTag=i.createElement("style"),e&&this.styleTag.setAttribute("nonce",e);this.modules=[],t[Po]=this}mount(t,e){let i=this.sheet,s=0,n=0;for(let o=0;o<t.length;o++){let a=t[o],l=this.modules.indexOf(a);if(l<n&&l>-1&&(this.modules.splice(l,1),n--,l=-1),l==-1){if(this.modules.splice(n++,0,a),i)for(let h=0;h<a.rules.length;h++)i.insertRule(a.rules[h],s++)}else{for(;n<l;)s+=this.modules[n++].rules.length;s+=a.rules.length,n++}}if(i)e.adoptedStyleSheets.indexOf(this.sheet)<0&&(e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=e.head||e;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(t){this.styleTag&&this.styleTag.getAttribute("nonce")!=t&&this.styleTag.setAttribute("nonce",t)}}for(var hi={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Dr={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},km=typeof navigator<"u"&&/Mac/.test(navigator.platform),Am=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),At=0;At<10;At++)hi[48+At]=hi[96+At]=String(At);for(var At=1;At<=24;At++)hi[At+111]="F"+At;for(var At=65;At<=90;At++)hi[At]=String.fromCharCode(At+32),Dr[At]=String.fromCharCode(At);for(var Lo in hi)Dr.hasOwnProperty(Lo)||(Dr[Lo]=hi[Lo]);function Cm(r){var t=km&&r.metaKey&&r.shiftKey&&!r.ctrlKey&&!r.altKey||Am&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",e=!t&&r.key||(r.shiftKey?Dr:hi)[r.keyCode]||r.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}function Y(){var r=arguments[0];typeof r=="string"&&(r=document.createElement(r));var t=1,e=arguments[1];if(e&&typeof e=="object"&&e.nodeType==null&&!Array.isArray(e)){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];typeof s=="string"?r.setAttribute(i,s):s!=null&&(r[i]=s)}t++}for(;t<arguments.length;t++)Rh(r,arguments[t]);return r}function Rh(r,t){if(typeof t=="string")r.appendChild(document.createTextNode(t));else if(t!=null)if(t.nodeType!=null)r.appendChild(t);else if(Array.isArray(t))for(var e=0;e<t.length;e++)Rh(r,t[e]);else throw new RangeError("Unsupported child node: "+t)}let _t=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},No=typeof document<"u"?document:{documentElement:{style:{}}};const Bo=/Edge\/(\d+)/.exec(_t.userAgent),Eh=/MSIE \d/.test(_t.userAgent),Fo=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(_t.userAgent),Is=!!(Eh||Fo||Bo),Ph=!Is&&/gecko\/(\d+)/i.test(_t.userAgent),Vo=!Is&&/Chrome\/(\d+)/.exec(_t.userAgent),Lh="webkitFontSmoothing"in No.documentElement.style,qo=!Is&&/Apple Computer/.test(_t.vendor),Nh=qo&&(/Mobile\/\w+/.test(_t.userAgent)||_t.maxTouchPoints>2);var D={mac:Nh||/Mac/.test(_t.platform),windows:/Win/.test(_t.platform),linux:/Linux|X11/.test(_t.platform),ie:Is,ie_version:Eh?No.documentMode||6:Fo?+Fo[1]:Bo?+Bo[1]:0,gecko:Ph,gecko_version:Ph?+(/Firefox\/(\d+)/.exec(_t.userAgent)||[0,0])[1]:0,chrome:!!Vo,chrome_version:Vo?+Vo[1]:0,ios:Nh,android:/Android\b/.test(_t.userAgent),webkit:Lh,webkit_version:Lh?+(/\bAppleWebKit\/(\d+)/.exec(_t.userAgent)||[0,0])[1]:0,safari:qo,safari_version:qo?+(/\bVersion\/(\d+(\.\d+)?)/.exec(_t.userAgent)||[0,0])[1]:0,tabSize:No.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function Wo(r,t){for(let e in r)e=="class"&&t.class?t.class+=" "+r.class:e=="style"&&t.style?t.style+=";"+r.style:t[e]=r[e];return t}const Ms=Object.create(null);function _o(r,t,e){if(r==t)return!0;r||(r=Ms),t||(t=Ms);let i=Object.keys(r),s=Object.keys(t);if(i.length-0!=s.length-0)return!1;for(let n of i)if(n!=e&&(s.indexOf(n)==-1||r[n]!==t[n]))return!1;return!0}function Im(r,t){for(let e=r.attributes.length-1;e>=0;e--){let i=r.attributes[e].name;t[i]==null&&r.removeAttribute(i)}for(let e in t){let i=t[e];e=="style"?r.style.cssText=i:r.getAttribute(e)!=i&&r.setAttribute(e,i)}}function Bh(r,t,e){let i=!1;if(t)for(let s in t)e&&s in e||(i=!0,s=="style"?r.style.cssText="":r.removeAttribute(s));if(e)for(let s in e)t&&t[s]==e[s]||(i=!0,s=="style"?r.style.cssText=e[s]:r.setAttribute(s,e[s]));return i}function Mm(r){let t=Object.create(null);for(let e=0;e<r.attributes.length;e++){let i=r.attributes[e];t[i.name]=i.value}return t}class Xe{eq(t){return!1}updateDOM(t,e){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(t){return!0}coordsAt(t,e,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(t){}}var Ct=(function(r){return r[r.Text=0]="Text",r[r.WidgetBefore=1]="WidgetBefore",r[r.WidgetAfter=2]="WidgetAfter",r[r.WidgetRange=3]="WidgetRange",r})(Ct||(Ct={}));class L extends ai{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new Tr(t)}static widget(t){let e=Math.max(-1e4,Math.min(1e4,t.side||0)),i=!!t.block;return e+=i&&!t.inlineOrder?e>0?3e8:-4e8:e>0?1e8:-1e8,new Ri(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,s;if(t.isBlockGap)i=-5e8,s=4e8;else{let{start:n,end:o}=Fh(t,e);i=(n?e?-3e8:-1:5e8)-1,s=(o?e?2e8:1:-6e8)+1}return new Ri(t,i,s,e,t.widget||null,!0)}static line(t){return new Rr(t)}static set(t,e=!1){return W.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}L.none=W.empty;class Tr extends L{constructor(t){let{start:e,end:i}=Fh(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.attrs=t.class&&t.attributes?Wo(t.attributes,{class:t.class}):t.class?{class:t.class}:t.attributes||Ms}eq(t){return this==t||t instanceof Tr&&this.tagName==t.tagName&&_o(this.attrs,t.attrs)}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}Tr.prototype.point=!1;class Rr extends L{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Rr&&this.spec.class==t.spec.class&&_o(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Rr.prototype.mapMode=Wt.TrackBefore,Rr.prototype.point=!0;class Ri extends L{constructor(t,e,i,s,n,o){super(e,i,n,t),this.block=s,this.isReplace=o,this.mapMode=s?e<=0?Wt.TrackBefore:Wt.TrackAfter:Wt.TrackDel}get type(){return this.startSide!=this.endSide?Ct.WidgetRange:this.startSide<=0?Ct.WidgetBefore:Ct.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(t){return t instanceof Ri&&Om(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}Ri.prototype.point=!0;function Fh(r,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=r;return e==null&&(e=r.inclusive),i==null&&(i=r.inclusive),{start:e??t,end:i??t}}function Om(r,t){return r==t||!!(r&&t&&r.compare(t))}function tr(r,t,e,i=0){let s=e.length-1;s>=0&&e[s]+i>=r?e[s]=Math.max(e[s],t):e.push(r,t)}class Er extends ai{constructor(t,e){super(),this.tagName=t,this.attributes=e}eq(t){return t==this||t instanceof Er&&this.tagName==t.tagName&&_o(this.attributes,t.attributes)}static create(t){return new Er(t.tagName,t.attributes||Ms)}static set(t,e=!1){return W.of(t,e)}}Er.prototype.startSide=Er.prototype.endSide=-1;function er(r){let t;return r.nodeType==11?t=r.getSelection?r:r.ownerDocument:t=r,t.getSelection()}function Ho(r,t){return t?r==t||r.contains(t.nodeType!=1?t.parentNode:t):!1}function Pr(r,t){if(!t.anchorNode)return!1;try{return Ho(r,t.anchorNode)}catch{return!1}}function Os(r){return r.nodeType==3?Nr(r,0,r.nodeValue.length).getClientRects():r.nodeType==1?r.getClientRects():[]}function Lr(r,t,e,i){return e?Vh(r,t,e,i,-1)||Vh(r,t,e,i,1):!1}function ci(r){for(var t=0;;t++)if(r=r.previousSibling,!r)return t}function Ds(r){return r.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(r.nodeName)}function Vh(r,t,e,i,s){for(;;){if(r==e&&t==i)return!0;if(t==(s<0?0:Je(r))){if(r.nodeName=="DIV")return!1;let n=r.parentNode;if(!n||n.nodeType!=1)return!1;t=ci(r)+(s<0?0:1),r=n}else if(r.nodeType==1){if(r=r.childNodes[t+(s<0?-1:0)],r.nodeType==1&&r.contentEditable=="false")return!1;t=s<0?Je(r):0}else return!1}}function Je(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function Ts(r,t){let e=t?r.left:r.right;return{left:e,right:e,top:r.top,bottom:r.bottom}}function Dm(r){let t=r.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:r.innerWidth,top:0,bottom:r.innerHeight}}function qh(r,t){let e=t.width/r.offsetWidth,i=t.height/r.offsetHeight;return(e>.995&&e<1.005||!isFinite(e)||Math.abs(t.width-r.offsetWidth)<1)&&(e=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.height-r.offsetHeight)<1)&&(i=1),{scaleX:e,scaleY:i}}function Tm(r,t,e,i,s,n,o,a){let l=r.ownerDocument,h=l.defaultView||window;for(let c=r,u=!1;c&&!u;)if(c.nodeType==1){let d,f=c==l.body,p=1,m=1;if(f)d=Dm(h);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(u=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let S=c.getBoundingClientRect();({scaleX:p,scaleY:m}=qh(c,S)),d={left:S.left,right:S.left+c.clientWidth*p,top:S.top,bottom:S.top+c.clientHeight*m}}let g=0,v=0;if(s=="nearest")t.top<d.top?(v=t.top-(d.top+o),e>0&&t.bottom>d.bottom+v&&(v=t.bottom-d.bottom+o)):t.bottom>d.bottom&&(v=t.bottom-d.bottom+o,e<0&&t.top-v<d.top&&(v=t.top-(d.top+o)));else{let S=t.bottom-t.top,w=d.bottom-d.top;v=(s=="center"&&S<=w?t.top+S/2-w/2:s=="start"||s=="center"&&e<0?t.top-o:t.bottom-w+o)-d.top}if(i=="nearest"?t.left<d.left?(g=t.left-(d.left+n),e>0&&t.right>d.right+g&&(g=t.right-d.right+n)):t.right>d.right&&(g=t.right-d.right+n,e<0&&t.left<d.left+g&&(g=t.left-(d.left+n))):g=(i=="center"?t.left+(t.right-t.left)/2-(d.right-d.left)/2:i=="start"==a?t.left-n:t.right-(d.right-d.left)+n)-d.left,g||v)if(f)h.scrollBy(g,v);else{let S=0,w=0;if(v){let C=c.scrollTop;c.scrollTop+=v/m,w=(c.scrollTop-C)*m}if(g){let C=c.scrollLeft;c.scrollLeft+=g/p,S=(c.scrollLeft-C)*p}t={left:t.left-S,top:t.top-w,right:t.right-S,bottom:t.bottom-w},S&&Math.abs(S-g)<1&&(i="nearest"),w&&Math.abs(w-v)<1&&(s="nearest")}if(f)break;(t.top<d.top||t.bottom>d.bottom||t.left<d.left||t.right>d.right)&&(t={left:Math.max(t.left,d.left),right:Math.min(t.right,d.right),top:Math.max(t.top,d.top),bottom:Math.min(t.bottom,d.bottom)}),c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function Rm(r){let t=r.ownerDocument,e,i;for(let s=r.parentNode;s&&!(s==t.body||e&&i);)if(s.nodeType==1)!i&&s.scrollHeight>s.clientHeight&&(i=s),!e&&s.scrollWidth>s.clientWidth&&(e=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:e,y:i}}class Em{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){let{anchorNode:e,focusNode:i}=t;this.set(e,Math.min(t.anchorOffset,e?Je(e):0),i,Math.min(t.focusOffset,i?Je(i):0))}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let Ei=null;D.safari&&D.safari_version>=26&&(Ei=!1);function Wh(r){if(r.setActive)return r.setActive();if(Ei)return r.focus(Ei);let t=[];for(let e=r;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(r.focus(Ei==null?{get preventScroll(){return Ei={preventScroll:!0},!0}}:void 0),!Ei){Ei=!1;for(let e=0;e<t.length;){let i=t[e++],s=t[e++],n=t[e++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}let _h;function Nr(r,t,e=t){let i=_h||(_h=document.createRange());return i.setEnd(r,e),i.setStart(r,t),i}function ir(r,t,e,i){let s={key:t,code:t,keyCode:e,which:e,cancelable:!0};i&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=i);let n=new KeyboardEvent("keydown",s);n.synthetic=!0,r.dispatchEvent(n);let o=new KeyboardEvent("keyup",s);return o.synthetic=!0,r.dispatchEvent(o),n.defaultPrevented||o.defaultPrevented}function Pm(r){for(;r;){if(r&&(r.nodeType==9||r.nodeType==11&&r.host))return r;r=r.assignedSlot||r.parentNode}return null}function Lm(r,t){let e=t.focusNode,i=t.focusOffset;if(!e||t.anchorNode!=e||t.anchorOffset!=i)return!1;for(i=Math.min(i,Je(e));;)if(i){if(e.nodeType!=1)return!1;let s=e.childNodes[i-1];s.contentEditable=="false"?i--:(e=s,i=Je(e))}else{if(e==r)return!0;i=ci(e),e=e.parentNode}}function Hh(r){return r.scrollTop>Math.max(1,r.scrollHeight-r.clientHeight-4)}function zh(r,t){for(let e=r,i=t;;){if(e.nodeType==3&&i>0)return{node:e,offset:i};if(e.nodeType==1&&i>0){if(e.contentEditable=="false")return null;e=e.childNodes[i-1],i=Je(e)}else if(e.parentNode&&!Ds(e))i=ci(e),e=e.parentNode;else return null}}function jh(r,t){for(let e=r,i=t;;){if(e.nodeType==3&&i<e.nodeValue.length)return{node:e,offset:i};if(e.nodeType==1&&i<e.childNodes.length){if(e.contentEditable=="false")return null;e=e.childNodes[i],i=0}else if(e.parentNode&&!Ds(e))i=ci(e)+1,e=e.parentNode;else return null}}class Se{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new Se(t.parentNode,ci(t),e)}static after(t,e){return new Se(t.parentNode,ci(t)+1,e)}}var X=(function(r){return r[r.LTR=0]="LTR",r[r.RTL=1]="RTL",r})(X||(X={}));const Pi=X.LTR,zo=X.RTL;function $h(r){let t=[];for(let e=0;e<r.length;e++)t.push(1<<+r[e]);return t}const Nm=$h("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Bm=$h("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),jo=Object.create(null),Le=[];for(let r of["()","[]","{}"]){let t=r.charCodeAt(0),e=r.charCodeAt(1);jo[t]=e,jo[e]=-t}function Gh(r){return r<=247?Nm[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Bm[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8204?256:64336<=r&&r<=65023?4:1}const Fm=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Qe{get dir(){return this.level%2?zo:Pi}constructor(t,e,i){this.from=t,this.to=e,this.level=i}side(t,e){return this.dir==e==t?this.to:this.from}forward(t,e){return t==(this.dir==e)}static find(t,e,i,s){let n=-1;for(let o=0;o<t.length;o++){let a=t[o];if(a.from<=e&&a.to>=e){if(a.level==i)return o;(n<0||(s!=0?s<0?a.from<e:a.to>e:t[n].level>a.level))&&(n=o)}}if(n<0)throw new RangeError("Index out of range");return n}}function Uh(r,t){if(r.length!=t.length)return!1;for(let e=0;e<r.length;e++){let i=r[e],s=t[e];if(i.from!=s.from||i.to!=s.to||i.direction!=s.direction||!Uh(i.inner,s.inner))return!1}return!0}const J=[];function Vm(r,t,e,i,s){for(let n=0;n<=i.length;n++){let o=n?i[n-1].to:t,a=n<i.length?i[n].from:e,l=n?256:s;for(let h=o,c=l,u=l;h<a;h++){let d=Gh(r.charCodeAt(h));d==512?d=c:d==8&&u==4&&(d=16),J[h]=d==4?2:d,d&7&&(u=d),c=d}for(let h=o,c=l,u=l;h<a;h++){let d=J[h];if(d==128)h<a-1&&c==J[h+1]&&c&24?d=J[h]=c:J[h]=256;else if(d==64){let f=h+1;for(;f<a&&J[f]==64;)f++;let p=h&&c==8||f<e&&J[f]==8?u==1?1:8:256;for(let m=h;m<f;m++)J[m]=p;h=f-1}else d==8&&u==1&&(J[h]=1);c=d,d&7&&(u=d)}}}function qm(r,t,e,i,s){let n=s==1?2:1;for(let o=0,a=0,l=0;o<=i.length;o++){let h=o?i[o-1].to:t,c=o<i.length?i[o].from:e;for(let u=h,d,f,p;u<c;u++)if(f=jo[d=r.charCodeAt(u)])if(f<0){for(let m=a-3;m>=0;m-=3)if(Le[m+1]==-f){let g=Le[m+2],v=g&2?s:g&4?g&1?n:s:0;v&&(J[u]=J[Le[m]]=v),a=m;break}}else{if(Le.length==189)break;Le[a++]=u,Le[a++]=d,Le[a++]=l}else if((p=J[u])==2||p==1){let m=p==s;l=m?0:1;for(let g=a-3;g>=0;g-=3){let v=Le[g+2];if(v&2)break;if(m)Le[g+2]|=2;else{if(v&4)break;Le[g+2]|=4}}}}}function Wm(r,t,e,i){for(let s=0,n=i;s<=e.length;s++){let o=s?e[s-1].to:r,a=s<e.length?e[s].from:t;for(let l=o;l<a;){let h=J[l];if(h==256){let c=l+1;for(;;)if(c==a){if(s==e.length)break;c=e[s++].to,a=s<e.length?e[s].from:t}else if(J[c]==256)c++;else break;let u=n==1,d=(c<t?J[c]:i)==1,f=u==d?u?1:2:i;for(let p=c,m=s,g=m?e[m-1].to:r;p>l;)p==g&&(p=e[--m].from,g=m?e[m-1].to:r),J[--p]=f;l=c}else n=h,l++}}}function $o(r,t,e,i,s,n,o){let a=i%2?2:1;if(i%2==s%2)for(let l=t,h=0;l<e;){let c=!0,u=!1;if(h==n.length||l<n[h].from){let m=J[l];m!=a&&(c=!1,u=m==16)}let d=!c&&a==1?[]:null,f=c?i:i+1,p=l;t:for(;;)if(h<n.length&&p==n[h].from){if(u)break t;let m=n[h];if(!c)for(let g=m.to,v=h+1;;){if(g==e)break t;if(v<n.length&&n[v].from==g)g=n[v++].to;else{if(J[g]==a)break t;break}}if(h++,d)d.push(m);else{m.from>l&&o.push(new Qe(l,m.from,f));let g=m.direction==Pi!=!(f%2);Go(r,g?i+1:i,s,m.inner,m.from,m.to,o),l=m.to}p=m.to}else{if(p==e||(c?J[p]!=a:J[p]==a))break;p++}d?$o(r,l,p,i+1,s,d,o):l<p&&o.push(new Qe(l,p,f)),l=p}else for(let l=e,h=n.length;l>t;){let c=!0,u=!1;if(!h||l>n[h-1].to){let m=J[l-1];m!=a&&(c=!1,u=m==16)}let d=!c&&a==1?[]:null,f=c?i:i+1,p=l;t:for(;;)if(h&&p==n[h-1].to){if(u)break t;let m=n[--h];if(!c)for(let g=m.from,v=h;;){if(g==t)break t;if(v&&n[v-1].to==g)g=n[--v].from;else{if(J[g-1]==a)break t;break}}if(d)d.push(m);else{m.to<l&&o.push(new Qe(m.to,l,f));let g=m.direction==Pi!=!(f%2);Go(r,g?i+1:i,s,m.inner,m.from,m.to,o),l=m.from}p=m.from}else{if(p==t||(c?J[p-1]!=a:J[p-1]==a))break;p--}d?$o(r,p,l,i+1,s,d,o):p<l&&o.push(new Qe(p,l,f)),l=p}}function Go(r,t,e,i,s,n,o){let a=t%2?2:1;Vm(r,s,n,i,a),qm(r,s,n,i,a),Wm(s,n,i,a),$o(r,s,n,t,e,i,o)}function _m(r,t,e){if(!r)return[new Qe(0,0,t==zo?1:0)];if(t==Pi&&!e.length&&!Fm.test(r))return Kh(r.length);if(e.length)for(;r.length>J.length;)J[J.length]=256;let i=[],s=t==Pi?0:1;return Go(r,s,s,e,0,r.length,i),i}function Kh(r){return[new Qe(0,r,0)]}let Yh="";function Hm(r,t,e,i,s){var n;let o=i.head-r.from,a=Qe.find(t,o,(n=i.bidiLevel)!==null&&n!==void 0?n:-1,i.assoc),l=t[a],h=l.side(s,e);if(o==h){let d=a+=s?1:-1;if(d<0||d>=t.length)return null;l=t[a=d],o=l.side(!s,e),h=l.side(s,e)}let c=pt(r.text,o,l.forward(s,e));(c<l.from||c>l.to)&&(c=h),Yh=r.text.slice(Math.min(o,c),Math.max(o,c));let u=a==(s?t.length-1:0)?null:t[a+(s?1:-1)];return u&&c==h&&u.level+(s?0:1)<l.level?b.cursor(u.side(!s,e)+r.from,u.forward(s,e)?1:-1,u.level):b.cursor(c+r.from,l.forward(s,e)?-1:1,l.level)}function zm(r,t,e){for(let i=t;i<e;i++){let s=Gh(r.charCodeAt(i));if(s==1)return Pi;if(s==2||s==4)return zo}return Pi}const Xh=O.define(),Jh=O.define(),Qh=O.define(),Zh=O.define(),Uo=O.define(),tc=O.define(),ec=O.define(),Ko=O.define(),Yo=O.define(),ic=O.define({combine:r=>r.some(t=>t)}),rc=O.define({combine:r=>r.some(t=>t)}),sc=O.define();class rr{constructor(t,e="nearest",i="nearest",s=5,n=5,o=!1){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n,this.isSnapshot=o}map(t){return t.empty?this:new rr(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(t){return this.range.to<=t.doc.length?this:new rr(b.cursor(t.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Rs=F.define({map:(r,t)=>r.map(t)}),nc=F.define();function Jt(r,t,e){let i=r.facet(Zh);i.length?i[0](t):window.onerror&&window.onerror(String(t),e,void 0,void 0,t)||(e?console.error(e+":",t):console.error(t))}const Ze=O.define({combine:r=>r.length?r[0]:!0});let jm=0;const sr=O.define({combine(r){return r.filter((t,e)=>{for(let i=0;i<e;i++)if(r[i].plugin==t.plugin)return!1;return!0})}});class ut{constructor(t,e,i,s,n){this.id=t,this.create=e,this.domEventHandlers=i,this.domEventObservers=s,this.baseExtensions=n(this),this.extension=this.baseExtensions.concat(sr.of({plugin:this,arg:void 0}))}of(t){return this.baseExtensions.concat(sr.of({plugin:this,arg:t}))}static define(t,e){const{eventHandlers:i,eventObservers:s,provide:n,decorations:o}=e||{};return new ut(jm++,t,i,s,a=>{let l=[];return o&&l.push(Es.of(h=>{let c=h.plugin(a);return c?o(c):L.none})),n&&l.push(n(a)),l})}static fromClass(t,e){return ut.define((i,s)=>new t(i,s),e)}}class Xo{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(Jt(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(t,this.spec.arg)}catch(e){Jt(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){Jt(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const oc=O.define(),Jo=O.define(),Es=O.define(),ac=O.define(),Qo=O.define(),Br=O.define(),lc=O.define();function hc(r,t){let e=r.state.facet(lc);if(!e.length)return e;let i=e.map(n=>n instanceof Function?n(r):n),s=[];return W.spans(i,t.from,t.to,{point(){},span(n,o,a,l){let h=n-t.from,c=o-t.from,u=s;for(let d=a.length-1;d>=0;d--,l--){let f=a[d].spec.bidiIsolate,p;if(f==null&&(f=zm(t.text,h,c)),l>0&&u.length&&(p=u[u.length-1]).to==h&&p.direction==f)p.to=c,u=p.inner;else{let m={from:h,to:c,direction:f,inner:[]};u.push(m),u=m.inner}}}}),s}const cc=O.define();function Zo(r){let t=0,e=0,i=0,s=0;for(let n of r.state.facet(cc)){let o=n(r);o&&(o.left!=null&&(t=Math.max(t,o.left)),o.right!=null&&(e=Math.max(e,o.right)),o.top!=null&&(i=Math.max(i,o.top)),o.bottom!=null&&(s=Math.max(s,o.bottom)))}return{left:t,right:e,top:i,bottom:s}}const Fr=O.define();class ce{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new ce(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let s=0,n=0,o=0;;){let a=s<t.length?t[s].fromB:1e9,l=n<e.length?e[n]:1e9,h=Math.min(a,l);if(h==1e9)break;let c=h+o,u=h,d=c;for(;;)if(n<e.length&&e[n]<=u){let f=e[n+1];n+=2,u=Math.max(u,f);for(let p=s;p<t.length&&t[p].fromB<=u;p++)o=t[p].toA-t[p].toB;d=Math.max(d,f+o)}else if(s<t.length&&t[s].fromB<=u){let f=t[s++];u=Math.max(u,f.toB),d=Math.max(d,f.toA),o=f.toA-f.toB}else break;i.push(new ce(c,d,h,u))}return i}}class Ps{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=mt.empty(this.startState.doc.length);for(let n of i)this.changes=this.changes.compose(n.changes);let s=[];this.changes.iterChangedRanges((n,o,a,l)=>s.push(new ce(n,o,a,l))),this.changedRanges=s}static create(t,e,i){return new Ps(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}const $m=[];class dt{constructor(t,e,i=0){this.dom=t,this.length=e,this.flags=i,this.parent=null,t.cmTile=this}get breakAfter(){return this.flags&1}get children(){return $m}isWidget(){return!1}get isHidden(){return!1}isComposite(){return!1}isLine(){return!1}isText(){return!1}isBlock(){return!1}get domAttrs(){return null}sync(t){if(this.flags|=2,this.flags&4){this.flags&=-5;let e=this.domAttrs;e&&Im(this.dom,e)}}toString(){return this.constructor.name+(this.children.length?`(${this.children})`:"")+(this.breakAfter?"#":"")}destroy(){this.parent=null}setDOM(t){this.dom=t,t.cmTile=this}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t,e=this.posAtStart){let i=e;for(let s of this.children){if(s==t)return i;i+=s.length+s.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}covers(t){return!0}coordsIn(t,e){return null}domPosFor(t,e){let i=ci(this.dom),s=this.length?t>0:e>0;return new Se(this.parent.dom,i+(s?1:0),t==0||t==this.length)}markDirty(t){this.flags&=-3,t&&(this.flags|=4),this.parent&&this.parent.flags&2&&this.parent.markDirty(!1)}get overrideDOMText(){return null}get root(){for(let t=this;t;t=t.parent)if(t instanceof Ns)return t;return null}static get(t){return t.cmTile}}class Ls extends dt{constructor(t){super(t,0),this._children=[]}isComposite(){return!0}get children(){return this._children}get lastChild(){return this.children.length?this.children[this.children.length-1]:null}append(t){this.children.push(t),t.parent=this}sync(t){if(this.flags&2)return;super.sync(t);let e=this.dom,i=null,s,n=(t==null?void 0:t.node)==e?t:null,o=0;for(let a of this.children){if(a.sync(t),o+=a.length+a.breakAfter,s=i?i.nextSibling:e.firstChild,n&&s!=a.dom&&(n.written=!0),a.dom.parentNode==e)for(;s&&s!=a.dom;)s=uc(s);else e.insertBefore(a.dom,s);i=a.dom}for(s=i?i.nextSibling:e.firstChild,n&&s&&(n.written=!0);s;)s=uc(s);this.length=o}}function uc(r){let t=r.nextSibling;return r.parentNode.removeChild(r),t}class Ns extends Ls{constructor(t,e){super(e),this.view=t}owns(t){for(;t;t=t.parent)if(t==this)return!0;return!1}isBlock(){return!0}nearest(t){for(;;){if(!t)return null;let e=dt.get(t);if(e&&this.owns(e))return e;t=t.parentNode}}blockTiles(t){for(let e=[],i=this,s=0,n=0;;)if(s==i.children.length){if(!e.length)return;i=i.parent,i.breakAfter&&n++,s=e.pop()}else{let o=i.children[s++];if(o instanceof ui)e.push(s),i=o,s=0;else{let a=n+o.length,l=t(o,n);if(l!==void 0)return l;n=a+o.breakAfter}}}resolveBlock(t,e){let i,s=-1,n,o=-1;if(this.blockTiles((a,l)=>{let h=l+a.length;if(t>=l&&t<=h){if(a.isWidget()&&e>=-1&&e<=1){if(a.flags&32)return!0;a.flags&16&&(i=void 0)}(l<t||t==h&&(e<-1?a.length:a.covers(1)))&&(!i||!a.isWidget()&&i.isWidget())&&(i=a,s=t-l),(h>t||t==l&&(e>1?a.length:a.covers(-1)))&&(!n||!a.isWidget()&&n.isWidget())&&(n=a,o=t-l)}}),!i&&!n)throw new Error("No tile at position "+t);return i&&e<0||!n?{tile:i,offset:s}:{tile:n,offset:o}}}class ui extends Ls{constructor(t,e){super(t),this.wrapper=e}isBlock(){return!0}covers(t){return this.children.length?t<0?this.children[0].covers(-1):this.lastChild.covers(1):!1}get domAttrs(){return this.wrapper.attributes}static of(t,e){let i=new ui(e||document.createElement(t.tagName),t);return e||(i.flags|=4),i}}class nr extends Ls{constructor(t,e){super(t),this.attrs=e}isLine(){return!0}static start(t,e,i){let s=new nr(e||document.createElement("div"),t);return(!e||!i)&&(s.flags|=4),s}get domAttrs(){return this.attrs}resolveInline(t,e,i){let s=null,n=-1,o=null,a=-1;function l(c,u){for(let d=0,f=0;d<c.children.length&&f<=u;d++){let p=c.children[d],m=f+p.length;m>=u&&(p.isComposite()?l(p,u-f):(!o||o.isHidden&&(e>0||i&&Um(o,p)))&&(m>u||p.flags&32)?(o=p,a=u-f):(f<u||p.flags&16&&!p.isHidden)&&(s=p,n=u-f)),f=m}}l(this,t);let h=(e<0?s:o)||s||o;return h?{tile:h,offset:h==s?n:a}:null}coordsIn(t,e){let i=this.resolveInline(t,e,!0);return i?i.tile.coordsIn(Math.max(0,i.offset),e):Gm(this)}domIn(t,e){let i=this.resolveInline(t,e);if(i){let{tile:s,offset:n}=i;if(this.dom.contains(s.dom))return s.isText()?new Se(s.dom,Math.min(s.dom.nodeValue.length,n)):s.domPosFor(n,s.flags&16?1:s.flags&32?-1:e);let o=i.tile.parent,a=!1;for(let l of o.children){if(a)return new Se(l.dom,0);l==i.tile&&(a=!0)}}return new Se(this.dom,0)}}function Gm(r){let t=r.dom.lastChild;if(!t)return r.dom.getBoundingClientRect();let e=Os(t);return e[e.length-1]||null}function Um(r,t){let e=r.coordsIn(0,1),i=t.coordsIn(0,1);return e&&i&&i.top<e.bottom}class Qt extends Ls{constructor(t,e){super(t),this.mark=e}get domAttrs(){return this.mark.attrs}static of(t,e){let i=new Qt(e||document.createElement(t.tagName),t);return e||(i.flags|=4),i}}class Li extends dt{constructor(t,e){super(t,e.length),this.text=e}sync(t){this.flags&2||(super.sync(t),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text))}isText(){return!0}toString(){return JSON.stringify(this.text)}coordsIn(t,e){let i=this.dom.nodeValue.length;t>i&&(t=i);let s=t,n=t,o=0;t==0&&e<0||t==i&&e>=0?D.chrome||D.gecko||(t?(s--,o=1):n<i&&(n++,o=-1)):e<0?s--:n<i&&n++;let a=Nr(this.dom,s,n).getClientRects();if(!a.length)return null;let l=a[(o?o<0:e>=0)?0:a.length-1];return D.safari&&!o&&l.width==0&&(l=Array.prototype.find.call(a,h=>h.width)||l),o?Ts(l,o<0):l||null}static of(t,e){let i=new Li(e||document.createTextNode(t),t);return e||(i.flags|=2),i}}class Ni extends dt{constructor(t,e,i,s){super(t,e,s),this.widget=i}isWidget(){return!0}get isHidden(){return this.widget.isHidden}covers(t){return this.flags&48?!1:(this.flags&(t<0?64:128))>0}coordsIn(t,e){return this.coordsInWidget(t,e,!1)}coordsInWidget(t,e,i){let s=this.widget.coordsAt(this.dom,t,e);if(s)return s;if(i)return Ts(this.dom.getBoundingClientRect(),this.length?t==0:e<=0);{let n=this.dom.getClientRects(),o=null;if(!n.length)return null;let a=this.flags&16?!0:this.flags&32?!1:t>0;for(let l=a?n.length-1:0;o=n[l],!(t>0?l==0:l==n.length-1||o.top<o.bottom);l+=a?-1:1);return Ts(o,!a)}}get overrideDOMText(){if(!this.length)return G.empty;let{root:t}=this;if(!t)return G.empty;let e=this.posAtStart;return t.view.state.doc.slice(e,e+this.length)}destroy(){super.destroy(),this.widget.destroy(this.dom)}static of(t,e,i,s,n){return n||(n=t.toDOM(e),t.editable||(n.contentEditable="false")),new Ni(n,i,t,s)}}class Bs extends dt{constructor(t){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),super(e,0,t)}get isHidden(){return!0}get overrideDOMText(){return G.empty}coordsIn(t){return this.dom.getBoundingClientRect()}}class Km{constructor(t){this.index=0,this.beforeBreak=!1,this.parents=[],this.tile=t}advance(t,e,i){let{tile:s,index:n,beforeBreak:o,parents:a}=this;for(;t||e>0;)if(s.isComposite())if(o){if(!t)break;i&&i.break(),t--,o=!1}else if(n==s.children.length){if(!t&&!a.length)break;i&&i.leave(s),o=!!s.breakAfter,{tile:s,index:n}=a.pop(),n++}else{let l=s.children[n],h=l.breakAfter;(e>0?l.length<=t:l.length<t)&&(!i||i.skip(l,0,l.length)!==!1||!l.isComposite)?(o=!!h,n++,t-=l.length):(a.push({tile:s,index:n}),s=l,n=0,i&&l.isComposite()&&i.enter(l))}else if(n==s.length)o=!!s.breakAfter,{tile:s,index:n}=a.pop(),n++;else if(t){let l=Math.min(t,s.length-n);i&&i.skip(s,n,n+l),t-=l,n+=l}else break;return this.tile=s,this.index=n,this.beforeBreak=o,this}get root(){return this.parents.length?this.parents[0].tile:this.tile}}class Ym{constructor(t,e,i,s){this.from=t,this.to=e,this.wrapper=i,this.rank=s}}class Xm{constructor(t,e,i){this.cache=t,this.root=e,this.blockWrappers=i,this.curLine=null,this.lastBlock=null,this.afterWidget=null,this.pos=0,this.wrappers=[],this.wrapperPos=0}addText(t,e,i,s){var n;this.flushBuffer();let o=this.ensureMarks(e,i),a=o.lastChild;if(a&&a.isText()&&!(a.flags&8)&&a.length+t.length<512){this.cache.reused.set(a,2);let l=o.children[o.children.length-1]=new Li(a.dom,a.text+t);l.parent=o}else o.append(s||Li.of(t,(n=this.cache.find(Li))===null||n===void 0?void 0:n.dom));this.pos+=t.length,this.afterWidget=null}addComposition(t,e){let i=this.curLine;i.dom!=e.line.dom&&(i.setDOM(this.cache.reused.has(e.line)?ta(e.line.dom):e.line.dom),this.cache.reused.set(e.line,2));let s=i;for(let a=e.marks.length-1;a>=0;a--){let l=e.marks[a],h=s.lastChild;if(h instanceof Qt&&h.mark.eq(l.mark))h.dom!=l.dom&&h.setDOM(ta(l.dom)),s=h;else{if(this.cache.reused.get(l)){let u=dt.get(l.dom);u&&u.setDOM(ta(l.dom))}let c=Qt.of(l.mark,l.dom);s.append(c),s=c}this.cache.reused.set(l,2)}let n=dt.get(t.text);n&&this.cache.reused.set(n,2);let o=new Li(t.text,t.text.nodeValue);o.flags|=8,s.append(o)}addInlineWidget(t,e,i){let s=this.afterWidget&&t.flags&48&&(this.afterWidget.flags&48)==(t.flags&48);s||this.flushBuffer();let n=this.ensureMarks(e,i);!s&&!(t.flags&16)&&n.append(this.getBuffer(1)),n.append(t),this.pos+=t.length,this.afterWidget=t}addMark(t,e,i){this.flushBuffer(),this.ensureMarks(e,i).append(t),this.pos+=t.length,this.afterWidget=null}addBlockWidget(t){this.getBlockPos().append(t),this.pos+=t.length,this.lastBlock=t,this.endLine()}continueWidget(t){let e=this.afterWidget||this.lastBlock;e.length+=t,this.pos+=t}addLineStart(t,e){var i;t||(t=fc);let s=nr.start(t,e||((i=this.cache.find(nr))===null||i===void 0?void 0:i.dom),!!e);this.getBlockPos().append(this.lastBlock=this.curLine=s)}addLine(t){this.getBlockPos().append(t),this.pos+=t.length,this.lastBlock=t,this.endLine()}addBreak(){this.lastBlock.flags|=1,this.endLine(),this.pos++}addLineStartIfNotCovered(t){this.blockPosCovered()||this.addLineStart(t)}ensureLine(t){this.curLine||this.addLineStart(t)}ensureMarks(t,e){var i;let s=this.curLine;for(let n=t.length-1;n>=0;n--){let o=t[n],a;if(e>0&&(a=s.lastChild)&&a instanceof Qt&&a.mark.eq(o))s=a,e--;else{let l=Qt.of(o,(i=this.cache.find(Qt,h=>h.mark.eq(o)))===null||i===void 0?void 0:i.dom);s.append(l),s=l,e=0}}return s}endLine(){if(this.curLine){this.flushBuffer();let t=this.curLine.lastChild;(!t||!dc(this.curLine,!1)||t.dom.nodeName!="BR"&&t.isWidget()&&!(D.ios&&dc(this.curLine,!0)))&&this.curLine.append(this.cache.findWidget(ea,0,32)||new Ni(ea.toDOM(),0,ea,32)),this.curLine=this.afterWidget=null}}updateBlockWrappers(){this.wrapperPos>this.pos+1e4&&(this.blockWrappers.goto(this.pos),this.wrappers.length=0);for(let t=this.wrappers.length-1;t>=0;t--)this.wrappers[t].to<this.pos&&this.wrappers.splice(t,1);for(let t=this.blockWrappers;t.value&&t.from<=this.pos;t.next())if(t.to>=this.pos){let e=new Ym(t.from,t.to,t.value,t.rank),i=this.wrappers.length;for(;i>0&&(this.wrappers[i-1].rank-e.rank||this.wrappers[i-1].to-e.to)<0;)i--;this.wrappers.splice(i,0,e)}this.wrapperPos=this.pos}getBlockPos(){var t;this.updateBlockWrappers();let e=this.root;for(let i of this.wrappers){let s=e.lastChild;if(i.from<this.pos&&s instanceof ui&&s.wrapper.eq(i.wrapper))e=s;else{let n=ui.of(i.wrapper,(t=this.cache.find(ui,o=>o.wrapper.eq(i.wrapper)))===null||t===void 0?void 0:t.dom);e.append(n),e=n}}return e}blockPosCovered(){let t=this.lastBlock;return t!=null&&!t.breakAfter&&(!t.isWidget()||(t.flags&160)>0)}getBuffer(t){let e=2|(t<0?16:32),i=this.cache.find(Bs,void 0,1);return i&&(i.flags=e),i||new Bs(e)}flushBuffer(){this.afterWidget&&!(this.afterWidget.flags&32)&&(this.afterWidget.parent.append(this.getBuffer(-1)),this.afterWidget=null)}}class Jm{constructor(t){this.skipCount=0,this.text="",this.textOff=0,this.cursor=t.iter()}skip(t){this.textOff+t<=this.text.length?this.textOff+=t:(this.skipCount+=t-(this.text.length-this.textOff),this.text="",this.textOff=0)}next(t){if(this.textOff==this.text.length){let{value:s,lineBreak:n,done:o}=this.cursor.next(this.skipCount);if(this.skipCount=0,o)throw new Error("Ran out of text content when drawing inline views");this.text=s;let a=this.textOff=Math.min(t,s.length);return n?null:s.slice(0,a)}let e=Math.min(this.text.length,this.textOff+t),i=this.text.slice(this.textOff,e);return this.textOff=e,i}}const Fs=[Ni,nr,Li,Qt,Bs,ui,Ns];for(let r=0;r<Fs.length;r++)Fs[r].bucket=r;class Qm{constructor(t){this.view=t,this.buckets=Fs.map(()=>[]),this.index=Fs.map(()=>0),this.reused=new Map}add(t){let e=t.constructor.bucket,i=this.buckets[e];i.length<6?i.push(t):i[this.index[e]=(this.index[e]+1)%6]=t}find(t,e,i=2){let s=t.bucket,n=this.buckets[s],o=this.index[s];for(let a=n.length-1;a>=0;a--){let l=(a+o)%n.length,h=n[l];if((!e||e(h))&&!this.reused.has(h))return n.splice(l,1),l<o&&this.index[s]--,this.reused.set(h,i),h}return null}findWidget(t,e,i){let s=this.buckets[0];if(s.length)for(let n=0,o=0;;n++){if(n==s.length){if(o)return null;o=1,n=0}let a=s[n];if(!this.reused.has(a)&&(o==0?a.widget.compare(t):a.widget.constructor==t.constructor&&t.updateDOM(a.dom,this.view)))return s.splice(n,1),n<this.index[0]&&this.index[0]--,a.widget==t&&a.length==e&&(a.flags&497)==i?(this.reused.set(a,1),a):(this.reused.set(a,2),new Ni(a.dom,e,t,a.flags&-498|i))}}reuse(t){return this.reused.set(t,1),t}maybeReuse(t,e=2){if(!this.reused.has(t))return this.reused.set(t,e),t.dom}clear(){for(let t=0;t<this.buckets.length;t++)this.buckets[t].length=this.index[t]=0}}class Zm{constructor(t,e,i,s,n){this.view=t,this.decorations=s,this.disallowBlockEffectsFor=n,this.openWidget=!1,this.openMarks=0,this.cache=new Qm(t),this.text=new Jm(t.state.doc),this.builder=new Xm(this.cache,new Ns(t,t.contentDOM),W.iter(i)),this.cache.reused.set(e,2),this.old=new Km(e),this.reuseWalker={skip:(o,a,l)=>{if(this.cache.add(o),o.isComposite())return!1},enter:o=>this.cache.add(o),leave:()=>{},break:()=>{}}}run(t,e){let i=e&&this.getCompositionContext(e.text);for(let s=0,n=0,o=0;;){let a=o<t.length?t[o++]:null,l=a?a.fromA:this.old.root.length;if(l>s){let h=l-s;this.preserve(h,!o,!a),s=l,n+=h}if(!a)break;e&&a.fromA<=e.range.fromA&&a.toA>=e.range.toA?(this.forward(a.fromA,e.range.fromA,e.range.fromA<e.range.toA?1:-1),this.emit(n,e.range.fromB),this.cache.clear(),this.builder.addComposition(e,i),this.text.skip(e.range.toB-e.range.fromB),this.forward(e.range.fromA,a.toA),this.emit(e.range.toB,a.toB)):(this.forward(a.fromA,a.toA),this.emit(n,a.toB)),n=a.toB,s=a.toA}return this.builder.curLine&&this.builder.endLine(),this.builder.root}preserve(t,e,i){let s=ig(this.old),n=this.openMarks;this.old.advance(t,i?1:-1,{skip:(o,a,l)=>{if(o.isWidget())if(this.openWidget)this.builder.continueWidget(l-a);else{let h=l>0||a<o.length?Ni.of(o.widget,this.view,l-a,o.flags&496,this.cache.maybeReuse(o)):this.cache.reuse(o);h.flags&256?(h.flags&=-2,this.builder.addBlockWidget(h)):(this.builder.ensureLine(null),this.builder.addInlineWidget(h,s,n),n=s.length)}else if(o.isText())this.builder.ensureLine(null),!a&&l==o.length?this.builder.addText(o.text,s,n,this.cache.reuse(o)):(this.cache.add(o),this.builder.addText(o.text.slice(a,l),s,n)),n=s.length;else if(o.isLine())o.flags&=-2,this.cache.reused.set(o,1),this.builder.addLine(o);else if(o instanceof Bs)this.cache.add(o);else if(o instanceof Qt)this.builder.ensureLine(null),this.builder.addMark(o,s,n),this.cache.reused.set(o,1),n=s.length;else return!1;this.openWidget=!1},enter:o=>{o.isLine()?this.builder.addLineStart(o.attrs,this.cache.maybeReuse(o)):(this.cache.add(o),o instanceof Qt&&s.unshift(o.mark)),this.openWidget=!1},leave:o=>{o.isLine()?s.length&&(s.length=n=0):o instanceof Qt&&(s.shift(),n=Math.min(n,s.length))},break:()=>{this.builder.addBreak(),this.openWidget=!1}}),this.text.skip(t)}emit(t,e){let i=null,s=this.builder,n=0,o=W.spans(this.decorations,t,e,{point:(a,l,h,c,u,d)=>{if(h instanceof Ri){if(this.disallowBlockEffectsFor[d]){if(h.block)throw new RangeError("Block decorations may not be specified via plugins");if(l>this.view.state.doc.lineAt(a).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}if(n=c.length,u>c.length)s.continueWidget(l-a);else{let f=h.widget||(h.block?or.block:or.inline),p=tg(h),m=this.cache.findWidget(f,l-a,p)||Ni.of(f,this.view,l-a,p);h.block?(h.startSide>0&&s.addLineStartIfNotCovered(i),s.addBlockWidget(m)):(s.ensureLine(i),s.addInlineWidget(m,c,u))}i=null}else i=eg(i,h);l>a&&this.text.skip(l-a)},span:(a,l,h,c)=>{for(let u=a;u<l;){let d=this.text.next(Math.min(512,l-u));d==null?(s.addLineStartIfNotCovered(i),s.addBreak(),u++):(s.ensureLine(i),s.addText(d,h,u==a?c:h.length),u+=d.length),i=null}}});s.addLineStartIfNotCovered(i),this.openWidget=o>n,this.openMarks=o}forward(t,e,i=1){e-t<=10?this.old.advance(e-t,i,this.reuseWalker):(this.old.advance(5,-1,this.reuseWalker),this.old.advance(e-t-10,-1),this.old.advance(5,i,this.reuseWalker))}getCompositionContext(t){let e=[],i=null;for(let s=t.parentNode;;s=s.parentNode){let n=dt.get(s);if(s==this.view.contentDOM)break;n instanceof Qt?e.push(n):n!=null&&n.isLine()?i=n:s.nodeName=="DIV"&&!i&&s!=this.view.contentDOM?i=new nr(s,fc):e.push(Qt.of(new Tr({tagName:s.nodeName.toLowerCase(),attributes:Mm(s)}),s))}return{line:i,marks:e}}}function dc(r,t){let e=i=>{for(let s of i.children)if((t?s.isText():s.length)||e(s))return!0;return!1};return e(r)}function tg(r){let t=r.isReplace?(r.startSide<0?64:0)|(r.endSide>0?128:0):r.startSide>0?32:16;return r.block&&(t|=256),t}const fc={class:"cm-line"};function eg(r,t){let e=t.spec.attributes,i=t.spec.class;return!e&&!i||(r||(r={class:"cm-line"}),e&&Wo(e,r),i&&(r.class+=" "+i)),r}function ig(r){let t=[];for(let e=r.parents.length;e>1;e--){let i=e==r.parents.length?r.tile:r.parents[e].tile;i instanceof Qt&&t.push(i.mark)}return t}function ta(r){let t=dt.get(r);return t&&t.setDOM(r.cloneNode()),r}class or extends Xe{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}or.inline=new or("span"),or.block=new or("div");const ea=new class extends Xe{toDOM(){return document.createElement("br")}get isHidden(){return!0}get editable(){return!0}};class pc{constructor(t){this.view=t,this.decorations=[],this.blockWrappers=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.editContextFormatting=L.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.updateDeco(),this.tile=new Ns(t,t.contentDOM),this.updateInner([new ce(0,0,0,t.state.doc.length)],null)}update(t){var e;let i=t.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:c,toA:u})=>u<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(t);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((e=this.domChanged)===null||e===void 0)&&e.newSel?s=this.domChanged.newSel.head:!ug(t.changes,this.hasComposition)&&!t.selectionSet&&(s=t.state.selection.main.head));let n=s>-1?sg(this.view,t.changes,s):null;if(this.domChanged=null,this.hasComposition){let{from:c,to:u}=this.hasComposition;i=new ce(c,u,t.changes.mapPos(c,-1),t.changes.mapPos(u,1)).addToSet(i.slice())}this.hasComposition=n?{from:n.range.fromB,to:n.range.toB}:null,(D.ie||D.chrome)&&!n&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,a=this.blockWrappers;this.updateDeco();let l=ag(o,this.decorations,t.changes);l.length&&(i=ce.extendWithRanges(i,l));let h=hg(a,this.blockWrappers,t.changes);return h.length&&(i=ce.extendWithRanges(i,h)),n&&!i.some(c=>c.fromA<=n.range.fromA&&c.toA>=n.range.toA)&&(i=n.range.addToSet(i.slice())),this.tile.flags&2&&i.length==0?!1:(this.updateInner(i,n),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e){this.view.viewState.mustMeasureContent=!0;let{observer:i}=this.view;i.ignore(()=>{if(e||t.length){let o=this.tile,a=new Zm(this.view,o,this.blockWrappers,this.decorations,this.dynamicDecorationMap);this.tile=a.run(t,e),ia(o,a.cache.reused)}this.tile.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.tile.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let n=D.chrome||D.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.tile.sync(n),n&&(n.written||i.selectionRange.focusNode!=n.node||!this.tile.dom.contains(n.node))&&(this.forceSelection=!0),this.tile.dom.style.height=""});let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let n of this.tile.children)n.isWidget()&&n.widget instanceof ra&&s.push(n.dom);i.updateGaps(s)}updateEditContextFormatting(t){this.editContextFormatting=this.editContextFormatting.map(t.changes);for(let e of t.transactions)for(let i of e.effects)i.is(nc)&&(this.editContextFormatting=i.value)}updateSelection(t=!1,e=!1){(t||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let{dom:i}=this.tile,s=this.view.root.activeElement,n=s==i,o=!n&&!(this.view.state.facet(Ze)||i.tabIndex>-1)&&Pr(i,this.view.observer.selectionRange)&&!(s&&i.contains(s));if(!(n||e||o))return;let a=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,h,c;if(l.empty?c=h=this.inlineDOMNearPos(l.anchor,l.assoc||1):(c=this.inlineDOMNearPos(l.head,l.head==l.from?1:-1),h=this.inlineDOMNearPos(l.anchor,l.anchor==l.from?1:-1)),D.gecko&&l.empty&&!this.hasComposition&&rg(h)){let d=document.createTextNode("");this.view.observer.ignore(()=>h.node.insertBefore(d,h.node.childNodes[h.offset]||null)),h=c=new Se(d,0),a=!0}let u=this.view.observer.selectionRange;(a||!u.focusNode||(!Lr(h.node,h.offset,u.anchorNode,u.anchorOffset)||!Lr(c.node,c.offset,u.focusNode,u.focusOffset))&&!this.suppressWidgetCursorChange(u,l))&&(this.view.observer.ignore(()=>{D.android&&D.chrome&&i.contains(u.focusNode)&&cg(u.focusNode,i)&&(i.blur(),i.focus({preventScroll:!0}));let d=er(this.view.root);if(d)if(l.empty){if(D.gecko){let f=ng(h.node,h.offset);if(f&&f!=3){let p=(f==1?zh:jh)(h.node,h.offset);p&&(h=new Se(p.node,p.offset))}}d.collapse(h.node,h.offset),l.bidiLevel!=null&&d.caretBidiLevel!==void 0&&(d.caretBidiLevel=l.bidiLevel)}else if(d.extend){d.collapse(h.node,h.offset);try{d.extend(c.node,c.offset)}catch{}}else{let f=document.createRange();l.anchor>l.head&&([h,c]=[c,h]),f.setEnd(c.node,c.offset),f.setStart(h.node,h.offset),d.removeAllRanges(),d.addRange(f)}o&&this.view.root.activeElement==i&&(i.blur(),s&&s.focus())}),this.view.observer.setSelectionRange(h,c)),this.impreciseAnchor=h.precise?null:new Se(u.anchorNode,u.anchorOffset),this.impreciseHead=c.precise?null:new Se(u.focusNode,u.focusOffset)}suppressWidgetCursorChange(t,e){return this.hasComposition&&e.empty&&Lr(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)&&this.posFromDOM(t.focusNode,t.focusOffset)==e.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:t}=this,e=t.state.selection.main,i=er(t.root),{anchorNode:s,anchorOffset:n}=t.observer.selectionRange;if(!i||!e.empty||!e.assoc||!i.modify)return;let o=this.lineAt(e.head,e.assoc);if(!o)return;let a=o.posAtStart;if(e.head==a||e.head==a+o.length)return;let l=this.coordsAt(e.head,-1),h=this.coordsAt(e.head,1);if(!l||!h||l.bottom>h.top)return;let c=this.domAtPos(e.head+e.assoc,e.assoc);i.collapse(c.node,c.offset),i.modify("move",e.assoc<0?"forward":"backward","lineboundary"),t.observer.readSelectionRange();let u=t.observer.selectionRange;t.docView.posFromDOM(u.anchorNode,u.anchorOffset)!=e.from&&i.collapse(s,n)}posFromDOM(t,e){let i=this.tile.nearest(t);if(!i)return this.tile.dom.compareDocumentPosition(t)&2?0:this.view.state.doc.length;let s=i.posAtStart;if(i.isComposite()){let n;if(t==i.dom)n=i.dom.childNodes[e];else{let o=Je(t)==0?0:e==0?-1:1;for(;;){let a=t.parentNode;if(a==i.dom)break;o==0&&a.firstChild!=a.lastChild&&(t==a.firstChild?o=-1:o=1),t=a}o<0?n=t:n=t.nextSibling}if(n==i.dom.firstChild)return s;for(;n&&!dt.get(n);)n=n.nextSibling;if(!n)return s+i.length;for(let o=0,a=s;;o++){let l=i.children[o];if(l.dom==n)return a;a+=l.length+l.breakAfter}}else return i.isText()?t==i.dom?s+e:s+(e?i.length:0):s}domAtPos(t,e){let{tile:i,offset:s}=this.tile.resolveBlock(t,e);return i.isWidget()?i.domPosFor(t,e):i.domIn(s,e)}inlineDOMNearPos(t,e){let i,s=-1,n=!1,o,a=-1,l=!1;return this.tile.blockTiles((h,c)=>{if(h.isWidget()){if(h.flags&32&&c>=t)return!0;h.flags&16&&(n=!0)}else{let u=c+h.length;if(c<=t&&(i=h,s=t-c,n=u<t),u>=t&&!o&&(o=h,a=t-c,l=c>t),c>t&&o)return!0}}),!i&&!o?this.domAtPos(t,e):(n&&o?i=null:l&&i&&(o=null),i&&e<0||!o?i.domIn(s,e):o.domIn(a,e))}coordsAt(t,e){let{tile:i,offset:s}=this.tile.resolveBlock(t,e);return i.isWidget()?i.widget instanceof ra?null:i.coordsInWidget(s,e,!0):i.coordsIn(s,e)}lineAt(t,e){let{tile:i}=this.tile.resolveBlock(t,e);return i.isLine()?i:null}coordsForChar(t){let{tile:e,offset:i}=this.tile.resolveBlock(t,1);if(!e.isLine())return null;function s(n,o){if(n.isComposite())for(let a of n.children){if(a.length>=o){let l=s(a,o);if(l)return l}if(o-=a.length,o<0)break}else if(n.isText()&&o<n.length){let a=pt(n.text,o);if(a==o)return null;let l=Nr(n.dom,o,a).getClientRects();for(let h=0;h<l.length;h++){let c=l[h];if(h==l.length-1||c.top<c.bottom&&c.left<c.right)return c}}return null}return s(e,i)}measureVisibleLineHeights(t){let e=[],{from:i,to:s}=t,n=this.view.contentDOM.clientWidth,o=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==X.LTR,h=0,c=(u,d,f)=>{for(let p=0;p<u.children.length&&!(d>s);p++){let m=u.children[p],g=d+m.length,v=m.dom.getBoundingClientRect(),{height:S}=v;if(f&&!p&&(h+=v.top-f.top),m instanceof ui)g>i&&c(m,d,v);else if(d>=i&&(h>0&&e.push(-h),e.push(S+h),h=0,o)){let w=m.dom.lastChild,C=w?Os(w):[];if(C.length){let x=C[C.length-1],k=l?x.right-v.left:v.right-x.left;k>a&&(a=k,this.minWidth=n,this.minWidthFrom=d,this.minWidthTo=g)}}f&&p==u.children.length-1&&(h+=f.bottom-v.bottom),d=g+m.breakAfter}};return c(this.tile,0,null),e}textDirectionAt(t){let{tile:e}=this.tile.resolveBlock(t,1);return getComputedStyle(e.dom).direction=="rtl"?X.RTL:X.LTR}measureTextSize(){let t=this.tile.blockTiles(o=>{if(o.isLine()&&o.children.length&&o.length<=20){let a=0,l;for(let h of o.children){if(!h.isText()||/[^ -~]/.test(h.text))return;let c=Os(h.dom);if(c.length!=1)return;a+=c[0].width,l=c[0].height}if(a)return{lineHeight:o.dom.getBoundingClientRect().height,charWidth:a/o.length,textHeight:l}}});if(t)return t;let e=document.createElement("div"),i,s,n;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.tile.dom.appendChild(e);let o=Os(e.firstChild)[0];i=e.getBoundingClientRect().height,s=o&&o.width?o.width/27:7,n=o&&o.height?o.height:i,e.remove()}),{lineHeight:i,charWidth:s,textHeight:n}}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],o=n?n.from-1:this.view.state.doc.length;if(o>i){let a=(e.lineBlockAt(o).bottom-e.lineBlockAt(i).top)/this.view.scaleY;t.push(L.replace({widget:new ra(a),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!n)break;i=n.to+1}return L.set(t)}updateDeco(){let t=1,e=this.view.state.facet(Es).map(n=>(this.dynamicDecorationMap[t++]=typeof n=="function")?n(this.view):n),i=!1,s=this.view.state.facet(Qo).map((n,o)=>{let a=typeof n=="function";return a&&(i=!0),a?n(this.view):n});for(s.length&&(this.dynamicDecorationMap[t++]=i,e.push(W.join(s))),this.decorations=[this.editContextFormatting,...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];t<this.decorations.length;)this.dynamicDecorationMap[t++]=!1;this.blockWrappers=this.view.state.facet(ac).map(n=>typeof n=="function"?n(this.view):n)}scrollIntoView(t){if(t.isSnapshot){let h=this.view.viewState.lineBlockAt(t.range.head);this.view.scrollDOM.scrollTop=h.top-t.yMargin,this.view.scrollDOM.scrollLeft=t.xMargin;return}for(let h of this.view.state.facet(sc))try{if(h(this.view,t.range,t))return!0}catch(c){Jt(this.view.state,c,"scroll handler")}let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),s;if(!i)return;!e.empty&&(s=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,s.left),top:Math.min(i.top,s.top),right:Math.max(i.right,s.right),bottom:Math.max(i.bottom,s.bottom)});let n=Zo(this.view),o={left:i.left-n.left,top:i.top-n.top,right:i.right+n.right,bottom:i.bottom+n.bottom},{offsetWidth:a,offsetHeight:l}=this.view.scrollDOM;Tm(this.view.scrollDOM,o,e.head<e.anchor?-1:1,t.x,t.y,Math.max(Math.min(t.xMargin,a),-a),Math.max(Math.min(t.yMargin,l),-l),this.view.textDirection==X.LTR)}lineHasWidget(t){let e=i=>i.isWidget()||i.children.some(e);return e(this.tile.resolveBlock(t,1).tile)}destroy(){ia(this.tile)}}function ia(r,t){let e=t==null?void 0:t.get(r);if(e!=1){e==null&&r.destroy();for(let i of r.children)ia(i,t)}}function rg(r){return r.node.nodeType==1&&r.node.firstChild&&(r.offset==0||r.node.childNodes[r.offset-1].contentEditable=="false")&&(r.offset==r.node.childNodes.length||r.node.childNodes[r.offset].contentEditable=="false")}function mc(r,t){let e=r.observer.selectionRange;if(!e.focusNode)return null;let i=zh(e.focusNode,e.focusOffset),s=jh(e.focusNode,e.focusOffset),n=i||s;if(s&&i&&s.node!=i.node){let a=dt.get(s.node);if(!a||a.isText()&&a.text!=s.node.nodeValue)n=s;else if(r.docView.lastCompositionAfterCursor){let l=dt.get(i.node);!l||l.isText()&&l.text!=i.node.nodeValue||(n=s)}}if(r.docView.lastCompositionAfterCursor=n!=i,!n)return null;let o=t-n.offset;return{from:o,to:o+n.node.nodeValue.length,node:n.node}}function sg(r,t,e){let i=mc(r,e);if(!i)return null;let{node:s,from:n,to:o}=i,a=s.nodeValue;if(/[\n\r]/.test(a)||r.state.doc.sliceString(i.from,i.to)!=a)return null;let l=t.invertedDesc;return{range:new ce(l.mapPos(n),l.mapPos(o),n,o),text:s}}function ng(r,t){return r.nodeType!=1?0:(t&&r.childNodes[t-1].contentEditable=="false"?1:0)|(t<r.childNodes.length&&r.childNodes[t].contentEditable=="false"?2:0)}let og=class{constructor(){this.changes=[]}compareRange(r,t){tr(r,t,this.changes)}comparePoint(r,t){tr(r,t,this.changes)}boundChange(r){tr(r,r,this.changes)}};function ag(r,t,e){let i=new og;return W.compare(r,t,e,i),i.changes}class lg{constructor(){this.changes=[]}compareRange(t,e){tr(t,e,this.changes)}comparePoint(){}boundChange(t){tr(t,t,this.changes)}}function hg(r,t,e){let i=new lg;return W.compare(r,t,e,i),i.changes}function cg(r,t){for(let e=r;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function ug(r,t){let e=!1;return t&&r.iterChangedRanges((i,s)=>{i<t.to&&s>t.from&&(e=!0)}),e}class ra extends Xe{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return t.className="cm-gap",this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function dg(r,t,e=1){let i=r.charCategorizer(t),s=r.doc.lineAt(t),n=t-s.from;if(s.length==0)return b.cursor(t);n==0?e=1:n==s.length&&(e=-1);let o=n,a=n;e<0?o=pt(s.text,n,!1):a=pt(s.text,n);let l=i(s.text.slice(o,a));for(;o>0;){let h=pt(s.text,o,!1);if(i(s.text.slice(h,o))!=l)break;o=h}for(;a<s.length;){let h=pt(s.text,a);if(i(s.text.slice(a,h))!=l)break;a=h}return b.range(o+s.from,a+s.from)}function fg(r,t,e,i,s){let n=Math.round((i-t.left)*r.defaultCharacterWidth);if(r.lineWrapping&&e.height>r.defaultLineHeight*1.5){let a=r.viewState.heightOracle.textHeight,l=Math.floor((s-e.top-(r.defaultLineHeight-a)*.5)/a);n+=l*r.viewState.heightOracle.lineLength}let o=r.state.sliceDoc(e.from,e.to);return e.from+Ro(o,n,r.state.tabSize)}function sa(r,t,e){let i=r.lineBlockAt(t);if(Array.isArray(i.type)){let s;for(let n of i.type){if(n.from>t)break;if(!(n.to<t)){if(n.from<t&&n.to>t)return n;(!s||n.type==Ct.Text&&(s.type!=n.type||(e<0?n.from<t:n.to>t)))&&(s=n)}}return s||i}return i}function pg(r,t,e,i){let s=sa(r,t.head,t.assoc||-1),n=!i||s.type!=Ct.Text||!(r.lineWrapping||s.widgetLineBreaks)?null:r.coordsAtPos(t.assoc<0&&t.head>s.from?t.head-1:t.head);if(n){let o=r.dom.getBoundingClientRect(),a=r.textDirectionAt(s.from),l=r.posAtCoords({x:e==(a==X.LTR)?o.right-1:o.left+1,y:(n.top+n.bottom)/2});if(l!=null)return b.cursor(l,e?-1:1)}return b.cursor(e?s.to:s.from,e?-1:1)}function gc(r,t,e,i){let s=r.state.doc.lineAt(t.head),n=r.bidiSpans(s),o=r.textDirectionAt(s.from);for(let a=t,l=null;;){let h=Hm(s,n,o,a,e),c=Yh;if(!h){if(s.number==(e?r.state.doc.lines:1))return a;c=`
`,s=r.state.doc.line(s.number+(e?1:-1)),n=r.bidiSpans(s),h=r.visualLineSide(s,!e)}if(l){if(!l(c))return a}else{if(!i)return h;l=i(c)}a=h}}function mg(r,t,e){let i=r.state.charCategorizer(t),s=i(e);return n=>{let o=i(n);return s==tt.Space&&(s=o),s==o}}function gg(r,t,e,i){let s=t.head,n=e?1:-1;if(s==(e?r.state.doc.length:0))return b.cursor(s,t.assoc);let o=t.goalColumn,a,l=r.contentDOM.getBoundingClientRect(),h=r.coordsAtPos(s,(t.empty?t.assoc:0)||(e?1:-1)),c=r.documentTop;if(h)o==null&&(o=h.left-l.left),a=n<0?h.top:h.bottom;else{let p=r.viewState.lineBlockAt(s);o==null&&(o=Math.min(l.right-l.left,r.defaultCharacterWidth*(s-p.from))),a=(n<0?p.top:p.bottom)+c}let u=l.left+o,d=i??r.viewState.heightOracle.textHeight>>1,f=oa(r,{x:u,y:a+d*n},!1,n);return b.cursor(f.pos,f.assoc,void 0,o)}function Vr(r,t,e){for(;;){let i=0;for(let s of r)s.between(t-1,t+1,(n,o,a)=>{if(t>n&&t<o){let l=i||e||(t-n<o-t?-1:1);t=l<0?n:o,i=l}});if(!i)return t}}function vc(r,t){let e=null;for(let i=0;i<t.ranges.length;i++){let s=t.ranges[i],n=null;if(s.empty){let o=Vr(r,s.from,0);o!=s.from&&(n=b.cursor(o,-1))}else{let o=Vr(r,s.from,-1),a=Vr(r,s.to,1);(o!=s.from||a!=s.to)&&(n=b.range(s.from==s.anchor?o:a,s.from==s.head?o:a))}n&&(e||(e=t.ranges.slice()),e[i]=n)}return e?b.create(e,t.mainIndex):t}function na(r,t,e){let i=Vr(r.state.facet(Br).map(s=>s(r)),e.from,t.head>e.from?-1:1);return i==e.from?e:b.cursor(i,i<e.from?1:-1)}class Ne{constructor(t,e){this.pos=t,this.assoc=e}}function oa(r,t,e,i){let s=r.contentDOM.getBoundingClientRect(),n=s.top+r.viewState.paddingTop,{x:o,y:a}=t,l=a-n,h;for(;;){if(l<0)return new Ne(0,1);if(l>r.viewState.docHeight)return new Ne(r.state.doc.length,-1);if(h=r.elementAtHeight(l),i==null)break;if(h.type==Ct.Text){if(i<0?h.to<r.viewport.from:h.from>r.viewport.to)break;let d=r.docView.coordsAt(i<0?h.from:h.to,i>0?-1:1);if(d&&(i<0?d.top<=l+n:d.bottom>=l+n))break}let u=r.viewState.heightOracle.textHeight/2;l=i>0?h.bottom+u:h.top-u}if(r.viewport.from>=h.to||r.viewport.to<=h.from){if(e)return null;if(h.type==Ct.Text){let u=fg(r,s,h,o,a);return new Ne(u,u==h.from?1:-1)}}if(h.type!=Ct.Text)return l<(h.top+h.bottom)/2?new Ne(h.from,1):new Ne(h.to,-1);let c=r.docView.lineAt(h.from,2);return(!c||c.length!=h.length)&&(c=r.docView.lineAt(h.from,-2)),yc(r,c,h.from,o,a)}function yc(r,t,e,i,s){let n=-1,o=null,a=1e9,l=1e9,h=s,c=s,u=(d,f)=>{for(let p=0;p<d.length;p++){let m=d[p];if(m.top==m.bottom)continue;let g=m.left>i?m.left-i:m.right<i?i-m.right:0,v=m.top>s?m.top-s:m.bottom<s?s-m.bottom:0;m.top<=c&&m.bottom>=h&&(h=Math.min(m.top,h),c=Math.max(m.bottom,c),v=0),(n<0||(v-l||g-a)<0)&&(n>=0&&l&&a<g&&o.top<=c-2&&o.bottom>=h+2?l=0:(n=f,a=g,l=v,o=m))}};if(t.isText()){for(let d=0;d<t.length;){let f=pt(t.text,d);if(u(Nr(t.dom,d,f).getClientRects(),d),!a&&!l)break;d=f}return i>(o.left+o.right)/2==(wc(r,n+e)==X.LTR)?new Ne(e+pt(t.text,n),-1):new Ne(e+n,1)}else{if(!t.length)return new Ne(e,1);for(let p=0;p<t.children.length;p++){let m=t.children[p];if(m.flags&48)continue;let g=(m.dom.nodeType==1?m.dom:Nr(m.dom,0,m.length)).getClientRects();if(u(g,p),!a&&!l)break}let d=t.children[n],f=t.posBefore(d,e);return d.isComposite()||d.isText()?yc(r,d,f,Math.max(o.left,Math.min(o.right,i)),s):i>(o.left+o.right)/2==(wc(r,n+e)==X.LTR)?new Ne(f+d.length,-1):new Ne(f,1)}}function wc(r,t){let e=r.state.doc.lineAt(t);return r.bidiSpans(e)[Qe.find(r.bidiSpans(e),t-e.from,-1,1)].dir}const qr="\uFFFF";class vg{constructor(t,e){this.points=t,this.view=e,this.text="",this.lineSeparator=e.state.facet($.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=qr}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s);let n=this.text.length;this.readNode(s);let o=dt.get(s),a=s.nextSibling;if(a==e){o!=null&&o.breakAfter&&!a&&i!=this.view.contentDOM&&this.lineBreak();break}let l=dt.get(a);(o&&l?o.breakAfter:(o?o.breakAfter:Ds(s))||Ds(a)&&(s.nodeName!="BR"||o!=null&&o.isWidget())&&this.text.length>n)&&!wg(a,e)&&this.lineBreak(),s=a}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n=-1,o=1,a;if(this.lineSeparator?(n=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(a=s.exec(e))&&(n=a.index,o=a[0].length),this.append(e.slice(i,n<0?e.length:n)),n<0)break;if(this.lineBreak(),o>1)for(let l of this.points)l.node==t&&l.pos>this.text.length&&(l.pos-=o-1);i=n+o}}readNode(t){let e=dt.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let s=i.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+(yg(t,i.node,i.offset)?e:0))}}function yg(r,t,e){for(;;){if(!t||e<Je(t))return!1;if(t==r)return!0;e=ci(t)+1,t=t.parentNode}}function wg(r,t){let e;for(;!(r==t||!r);r=r.nextSibling){let i=dt.get(r);if(!(i!=null&&i.isWidget()))return!1;i&&(e||(e=[])).push(i)}if(e)for(let i of e){let s=i.overrideDOMText;if(s!=null&&s.length)return!1}return!0}class xc{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class xg{constructor(t,e,i,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=e>-1;let{impreciseHead:n,impreciseAnchor:o}=t.docView;if(t.state.readOnly&&e>-1)this.newSel=null;else if(e>-1&&(this.bounds=bc(t.docView.tile,e,i,0))){let a=n||o?[]:Sg(t),l=new vg(a,t);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=kg(a,this.bounds.from)}else{let a=t.observer.selectionRange,l=n&&n.node==a.focusNode&&n.offset==a.focusOffset||!Ho(t.contentDOM,a.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(a.focusNode,a.focusOffset),h=o&&o.node==a.anchorNode&&o.offset==a.anchorOffset||!Ho(t.contentDOM,a.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(a.anchorNode,a.anchorOffset),c=t.viewport;if((D.ios||D.chrome)&&t.state.selection.main.empty&&l!=h&&(c.from>0||c.to<t.state.doc.length)){let u=Math.min(l,h),d=Math.max(l,h),f=c.from-u,p=c.to-d;(f==0||f==1||u==0)&&(p==0||p==-1||d==t.state.doc.length)&&(l=0,h=t.state.doc.length)}t.inputState.composing>-1&&t.state.selection.ranges.length>1?this.newSel=t.state.selection.replaceRange(b.range(h,l)):this.newSel=b.single(h,l)}}}function bc(r,t,e,i){if(r.isComposite()){let s=-1,n=-1,o=-1,a=-1;for(let l=0,h=i,c=i;l<r.children.length;l++){let u=r.children[l],d=h+u.length;if(h<t&&d>e)return bc(u,t,e,h);if(d>=t&&s==-1&&(s=l,n=h),h>e&&u.dom.parentNode==r.dom){o=l,a=c;break}c=d,h=d+u.breakAfter}return{from:n,to:a<0?i+r.length:a,startDOM:(s?r.children[s-1].dom.nextSibling:null)||r.dom.firstChild,endDOM:o<r.children.length&&o>=0?r.children[o].dom:null}}else return r.isText()?{from:i,to:i+r.length,startDOM:r.dom,endDOM:r.dom.nextSibling}:null}function Sc(r,t){let e,{newSel:i}=t,s=r.state.selection.main,n=r.inputState.lastKeyTime>Date.now()-100?r.inputState.lastKeyCode:-1;if(t.bounds){let{from:o,to:a}=t.bounds,l=s.from,h=null;(n===8||D.android&&t.text.length<a-o)&&(l=s.to,h="end");let c=kc(r.state.doc.sliceString(o,a,qr),t.text,l-o,h);c&&(D.chrome&&n==13&&c.toB==c.from+2&&t.text.slice(c.from,c.toB)==qr+qr&&c.toB--,e={from:o+c.from,to:o+c.toA,insert:G.of(t.text.slice(c.from,c.toB).split(qr))})}else i&&(!r.hasFocus&&r.state.facet(Ze)||Vs(i,s))&&(i=null);if(!e&&!i)return!1;if(!e&&t.typeOver&&!s.empty&&i&&i.main.empty?e={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,s.to)}:(D.mac||D.android)&&e&&e.from==e.to&&e.from==s.head-1&&/^\. ?$/.test(e.insert.toString())&&r.contentDOM.getAttribute("autocorrect")=="off"?(i&&e.insert.length==2&&(i=b.single(i.main.anchor-1,i.main.head-1)),e={from:e.from,to:e.to,insert:G.of([e.insert.toString().replace("."," ")])}):e&&e.from>=s.from&&e.to<=s.to&&(e.from!=s.from||e.to!=s.to)&&s.to-s.from-(e.to-e.from)<=4?e={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,e.from).append(e.insert).append(r.state.doc.slice(e.to,s.to))}:r.state.doc.lineAt(s.from).to<s.to&&r.docView.lineHasWidget(s.to)&&r.inputState.insertingTextAt>Date.now()-50?e={from:s.from,to:s.to,insert:r.state.toText(r.inputState.insertingText)}:D.chrome&&e&&e.from==e.to&&e.from==s.head&&e.insert.toString()==`
 `&&r.lineWrapping&&(i&&(i=b.single(i.main.anchor-1,i.main.head-1)),e={from:s.from,to:s.to,insert:G.of([" "])}),e)return aa(r,e,i,n);if(i&&!Vs(i,s)){let o=!1,a="select";return r.inputState.lastSelectionTime>Date.now()-50&&(r.inputState.lastSelectionOrigin=="select"&&(o=!0),a=r.inputState.lastSelectionOrigin,a=="select.pointer"&&(i=vc(r.state.facet(Br).map(l=>l(r)),i))),r.dispatch({selection:i,scrollIntoView:o,userEvent:a}),!0}else return!1}function aa(r,t,e,i=-1){if(D.ios&&r.inputState.flushIOSKey(t))return!0;let s=r.state.selection.main;if(D.android&&(t.to==s.to&&(t.from==s.from||t.from==s.from-1&&r.state.sliceDoc(t.from,s.from)==" ")&&t.insert.length==1&&t.insert.lines==2&&ir(r.contentDOM,"Enter",13)||(t.from==s.from-1&&t.to==s.to&&t.insert.length==0||i==8&&t.insert.length<t.to-t.from&&t.to>s.head)&&ir(r.contentDOM,"Backspace",8)||t.from==s.from&&t.to==s.to+1&&t.insert.length==0&&ir(r.contentDOM,"Delete",46)))return!0;let n=t.insert.toString();r.inputState.composing>=0&&r.inputState.composing++;let o,a=()=>o||(o=bg(r,t,e));return r.state.facet(tc).some(l=>l(r,t.from,t.to,n,a))||r.dispatch(a()),!0}function bg(r,t,e){let i,s=r.state,n=s.selection.main,o=-1;if(t.from==t.to&&t.from<n.from||t.from>n.to){let l=t.from<n.from?-1:1,h=l<0?n.from:n.to,c=Vr(s.facet(Br).map(u=>u(r)),h,l);t.from==c&&(o=c)}if(o>-1)i={changes:t,selection:b.cursor(t.from+t.insert.length,-1)};else if(t.from>=n.from&&t.to<=n.to&&t.to-t.from>=(n.to-n.from)/3&&(!e||e.main.empty&&e.main.from==t.from+t.insert.length)&&r.inputState.composing<0){let l=n.from<t.from?s.sliceDoc(n.from,t.from):"",h=n.to>t.to?s.sliceDoc(t.to,n.to):"";i=s.replaceSelection(r.state.toText(l+t.insert.sliceString(0,void 0,r.state.lineBreak)+h))}else{let l=s.changes(t),h=e&&e.main.to<=l.newLength?e.main:void 0;if(s.selection.ranges.length>1&&(r.inputState.composing>=0||r.inputState.compositionPendingChange)&&t.to<=n.to+10&&t.to>=n.to-10){let c=r.state.sliceDoc(t.from,t.to),u,d=e&&mc(r,e.main.head);if(d){let p=t.insert.length-(t.to-t.from);u={from:d.from,to:d.to-p}}else u=r.state.doc.lineAt(n.head);let f=n.to-t.to;i=s.changeByRange(p=>{if(p.from==n.from&&p.to==n.to)return{changes:l,range:h||p.map(l)};let m=p.to-f,g=m-c.length;if(r.state.sliceDoc(g,m)!=c||m>=u.from&&g<=u.to)return{range:p};let v=s.changes({from:g,to:m,insert:t.insert}),S=p.to-n.to;return{changes:v,range:h?b.range(Math.max(0,h.anchor+S),Math.max(0,h.head+S)):p.map(v)}})}else i={changes:l,selection:h&&s.selection.replaceRange(h)}}let a="input.type";return(r.composing||r.inputState.compositionPendingChange&&r.inputState.compositionEndedAt>Date.now()-50)&&(r.inputState.compositionPendingChange=!1,a+=".compose",r.inputState.compositionFirstChange&&(a+=".start",r.inputState.compositionFirstChange=!1)),s.update(i,{userEvent:a,scrollIntoView:!0})}function kc(r,t,e,i){let s=Math.min(r.length,t.length),n=0;for(;n<s&&r.charCodeAt(n)==t.charCodeAt(n);)n++;if(n==s&&r.length==t.length)return null;let o=r.length,a=t.length;for(;o>0&&a>0&&r.charCodeAt(o-1)==t.charCodeAt(a-1);)o--,a--;if(i=="end"){let l=Math.max(0,n-Math.min(o,a));e-=o+l-n}if(o<n&&r.length<t.length){let l=e<=n&&e>=o?n-e:0;n-=l,a=n+(a-o),o=n}else if(a<n){let l=e<=n&&e>=a?n-e:0;n-=l,o=n+(o-a),a=n}return{from:n,toA:o,toB:a}}function Sg(r){let t=[];if(r.root.activeElement!=r.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:n}=r.observer.selectionRange;return e&&(t.push(new xc(e,i)),(s!=e||n!=i)&&t.push(new xc(s,n))),t}function kg(r,t){if(r.length==0)return null;let e=r[0].pos,i=r.length==2?r[1].pos:e;return e>-1&&i>-1?b.single(e+t,i+t):null}function Vs(r,t){return t.head==r.main.head&&t.anchor==r.main.anchor}class Ag{setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}constructor(t){this.view=t,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=t.hasFocus,D.safari&&t.contentDOM.addEventListener("input",()=>null),D.gecko&&qg(t.contentDOM.ownerDocument)}handleEvent(t){!Eg(this.view,t)||this.ignoreDuringComposition(t)||t.type=="keydown"&&this.keydown(t)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(t.type,t)):this.runHandlers(t.type,t))}runHandlers(t,e){let i=this.handlers[t];if(i){for(let s of i.observers)s(this.view,e);for(let s of i.handlers){if(e.defaultPrevented)break;if(s(this.view,e)){e.preventDefault();break}}}}ensureHandlers(t){let e=Cg(t),i=this.handlers,s=this.view.contentDOM;for(let n in e)if(n!="scroll"){let o=!e[n].handlers.length,a=i[n];a&&o!=!a.handlers.length&&(s.removeEventListener(n,this.handleEvent),a=null),a||s.addEventListener(n,this.handleEvent,{passive:o})}for(let n in i)n!="scroll"&&!e[n]&&s.removeEventListener(n,this.handleEvent);this.handlers=e}keydown(t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&t.keyCode!=27&&Ic.indexOf(t.keyCode)<0&&(this.tabFocusMode=-1),D.android&&D.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return this.view.observer.delayAndroidKey(t.key,t.keyCode),!0;let e;return D.ios&&!t.synthetic&&!t.altKey&&!t.metaKey&&((e=Cc.find(i=>i.keyCode==t.keyCode))&&!t.ctrlKey||Ig.indexOf(t.key)>-1&&t.ctrlKey&&!t.shiftKey)?(this.pendingIOSKey=e||t,setTimeout(()=>this.flushIOSKey(),250),!0):(t.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(t){let e=this.pendingIOSKey;return!e||e.key=="Enter"&&t&&t.from<t.to&&/^\S+$/.test(t.insert.toString())?!1:(this.pendingIOSKey=void 0,ir(this.view.contentDOM,e.key,e.keyCode,e instanceof KeyboardEvent?e:void 0))}ignoreDuringComposition(t){return!/^key/.test(t.type)||t.synthetic?!1:this.composing>0?!0:D.safari&&!D.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.view.observer.update(t),this.mouseSelection&&this.mouseSelection.update(t),this.draggedContent&&t.docChanged&&(this.draggedContent=this.draggedContent.map(t.changes)),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function Ac(r,t){return(e,i)=>{try{return t.call(r,i,e)}catch(s){Jt(e.state,s)}}}function Cg(r){let t=Object.create(null);function e(i){return t[i]||(t[i]={observers:[],handlers:[]})}for(let i of r){let s=i.spec,n=s&&s.plugin.domEventHandlers,o=s&&s.plugin.domEventObservers;if(n)for(let a in n){let l=n[a];l&&e(a).handlers.push(Ac(i.value,l))}if(o)for(let a in o){let l=o[a];l&&e(a).observers.push(Ac(i.value,l))}}for(let i in ke)e(i).handlers.push(ke[i]);for(let i in ue)e(i).observers.push(ue[i]);return t}const Cc=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Ig="dthko",Ic=[16,17,18,20,91,92,224,225],qs=6;function Ws(r){return Math.max(0,r)*.7+8}function Mg(r,t){return Math.max(Math.abs(r.clientX-t.clientX),Math.abs(r.clientY-t.clientY))}class Og{constructor(t,e,i,s){this.view=t,this.startEvent=e,this.style=i,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=e,this.scrollParents=Rm(t.contentDOM),this.atoms=t.state.facet(Br).map(o=>o(t));let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet($.allowMultipleSelections)&&Dg(t,e),this.dragging=Rg(t,e)&&Pc(e)==1?null:!1}start(t){this.dragging===!1&&this.select(t)}move(t){if(t.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&Mg(this.startEvent,t)<10)return;this.select(this.lastEvent=t);let e=0,i=0,s=0,n=0,o=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:n,bottom:a}=this.scrollParents.y.getBoundingClientRect());let l=Zo(this.view);t.clientX-l.left<=s+qs?e=-Ws(s-t.clientX):t.clientX+l.right>=o-qs&&(e=Ws(t.clientX-o)),t.clientY-l.top<=n+qs?i=-Ws(n-t.clientY):t.clientY+l.bottom>=a-qs&&(i=Ws(t.clientY-a)),this.setScrollSpeed(e,i)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(t,e){this.scrollSpeed={x:t,y:e},t||e?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:t,y:e}=this.scrollSpeed;t&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=t,t=0),e&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=e,e=0),(t||e)&&this.view.win.scrollBy(t,e),this.dragging===!1&&this.select(this.lastEvent)}select(t){let{view:e}=this,i=vc(this.atoms,this.style.get(t,this.extend,this.multiple));(this.mustSelect||!i.eq(e.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(t){t.transactions.some(e=>e.isUserEvent("input.type"))?this.destroy():this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Dg(r,t){let e=r.state.facet(Xh);return e.length?e[0](t):D.mac?t.metaKey:t.ctrlKey}function Tg(r,t){let e=r.state.facet(Jh);return e.length?e[0](t):D.mac?!t.altKey:!t.ctrlKey}function Rg(r,t){let{main:e}=r.state.selection;if(e.empty)return!1;let i=er(r.root);if(!i||i.rangeCount==0)return!0;let s=i.getRangeAt(0).getClientRects();for(let n=0;n<s.length;n++){let o=s[n];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function Eg(r,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=r.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=dt.get(e))&&i.isWidget()&&!i.isHidden&&i.widget.ignoreEvent(t))return!1;return!0}const ke=Object.create(null),ue=Object.create(null),Mc=D.ie&&D.ie_version<15||D.ios&&D.webkit_version<604;function Pg(r){let t=r.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{r.focus(),e.remove(),Oc(r,e.value)},50)}function _s(r,t,e){for(let i of r.facet(t))e=i(e,r);return e}function Oc(r,t){t=_s(r.state,Ko,t);let{state:e}=r,i,s=1,n=e.toText(t),o=n.lines==e.selection.ranges.length;if(la!=null&&e.selection.ranges.every(a=>a.empty)&&la==n.toString()){let a=-1;i=e.changeByRange(l=>{let h=e.doc.lineAt(l.from);if(h.from==a)return{range:l};a=h.from;let c=e.toText((o?n.line(s++).text:t)+e.lineBreak);return{changes:{from:h.from,insert:c},range:b.cursor(l.from+c.length)}})}else o?i=e.changeByRange(a=>{let l=n.line(s++);return{changes:{from:a.from,to:a.to,insert:l.text},range:b.cursor(a.from+l.length)}}):i=e.replaceSelection(n);r.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}ue.scroll=r=>{r.inputState.lastScrollTop=r.scrollDOM.scrollTop,r.inputState.lastScrollLeft=r.scrollDOM.scrollLeft},ke.keydown=(r,t)=>(r.inputState.setSelectionOrigin("select"),t.keyCode==27&&r.inputState.tabFocusMode!=0&&(r.inputState.tabFocusMode=Date.now()+2e3),!1),ue.touchstart=(r,t)=>{r.inputState.lastTouchTime=Date.now(),r.inputState.setSelectionOrigin("select.pointer")},ue.touchmove=r=>{r.inputState.setSelectionOrigin("select.pointer")},ke.mousedown=(r,t)=>{if(r.observer.flush(),r.inputState.lastTouchTime>Date.now()-2e3)return!1;let e=null;for(let i of r.state.facet(Qh))if(e=i(r,t),e)break;if(!e&&t.button==0&&(e=Ng(r,t)),e){let i=!r.hasFocus;r.inputState.startMouseSelection(new Og(r,t,e,i)),i&&r.observer.ignore(()=>{Wh(r.contentDOM);let n=r.root.activeElement;n&&!n.contains(r.contentDOM)&&n.blur()});let s=r.inputState.mouseSelection;if(s)return s.start(t),s.dragging===!1}else r.inputState.setSelectionOrigin("select.pointer");return!1};function Dc(r,t,e,i){if(i==1)return b.cursor(t,e);if(i==2)return dg(r.state,t,e);{let s=r.docView.lineAt(t,e),n=r.state.doc.lineAt(s?s.posAtEnd:t),o=s?s.posAtStart:n.from,a=s?s.posAtEnd:n.to;return a<r.state.doc.length&&a==n.to&&a++,b.range(o,a)}}const Lg=D.ie&&D.ie_version<=11;let Tc=null,Rc=0,Ec=0;function Pc(r){if(!Lg)return r.detail;let t=Tc,e=Ec;return Tc=r,Ec=Date.now(),Rc=!t||e>Date.now()-400&&Math.abs(t.clientX-r.clientX)<2&&Math.abs(t.clientY-r.clientY)<2?(Rc+1)%3:1}function Ng(r,t){let e=r.posAndSideAtCoords({x:t.clientX,y:t.clientY},!1),i=Pc(t),s=r.state.selection;return{update(n){n.docChanged&&(e.pos=n.changes.mapPos(e.pos),s=s.map(n.changes))},get(n,o,a){let l=r.posAndSideAtCoords({x:n.clientX,y:n.clientY},!1),h,c=Dc(r,l.pos,l.assoc,i);if(e.pos!=l.pos&&!o){let u=Dc(r,e.pos,e.assoc,i),d=Math.min(u.from,c.from),f=Math.max(u.to,c.to);c=d<c.from?b.range(d,f):b.range(f,d)}return o?s.replaceRange(s.main.extend(c.from,c.to)):a&&i==1&&s.ranges.length>1&&(h=Bg(s,l.pos))?h:a?s.addRange(c):b.create([c])}}}function Bg(r,t){for(let e=0;e<r.ranges.length;e++){let{from:i,to:s}=r.ranges[e];if(i<=t&&s>=t)return b.create(r.ranges.slice(0,e).concat(r.ranges.slice(e+1)),r.mainIndex==e?0:r.mainIndex-(r.mainIndex>e?1:0))}return null}ke.dragstart=(r,t)=>{let{selection:{main:e}}=r.state;if(t.target.draggable){let s=r.docView.tile.nearest(t.target);if(s&&s.isWidget()){let n=s.posAtStart,o=n+s.length;(n>=e.to||o<=e.from)&&(e=b.range(n,o))}}let{inputState:i}=r;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=e,t.dataTransfer&&(t.dataTransfer.setData("Text",_s(r.state,Yo,r.state.sliceDoc(e.from,e.to))),t.dataTransfer.effectAllowed="copyMove"),!1},ke.dragend=r=>(r.inputState.draggedContent=null,!1);function Lc(r,t,e,i){if(e=_s(r.state,Ko,e),!e)return;let s=r.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:n}=r.inputState,o=i&&n&&Tg(r,t)?{from:n.from,to:n.to}:null,a={from:s,insert:e},l=r.state.changes(o?[o,a]:a);r.focus(),r.dispatch({changes:l,selection:{anchor:l.mapPos(s,-1),head:l.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"}),r.inputState.draggedContent=null}ke.drop=(r,t)=>{if(!t.dataTransfer)return!1;if(r.state.readOnly)return!0;let e=t.dataTransfer.files;if(e&&e.length){let i=Array(e.length),s=0,n=()=>{++s==e.length&&Lc(r,t,i.filter(o=>o!=null).join(r.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let a=new FileReader;a.onerror=n,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(i[o]=a.result),n()},a.readAsText(e[o])}return!0}else{let i=t.dataTransfer.getData("Text");if(i)return Lc(r,t,i,!0),!0}return!1},ke.paste=(r,t)=>{if(r.state.readOnly)return!0;r.observer.flush();let e=Mc?null:t.clipboardData;return e?(Oc(r,e.getData("text/plain")||e.getData("text/uri-list")),!0):(Pg(r),!1)};function Fg(r,t){let e=r.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),r.focus()},50)}function Vg(r){let t=[],e=[],i=!1;for(let s of r.selection.ranges)s.empty||(t.push(r.sliceDoc(s.from,s.to)),e.push(s));if(!t.length){let s=-1;for(let{from:n}of r.selection.ranges){let o=r.doc.lineAt(n);o.number>s&&(t.push(o.text),e.push({from:o.from,to:Math.min(r.doc.length,o.to+1)})),s=o.number}i=!0}return{text:_s(r,Yo,t.join(r.lineBreak)),ranges:e,linewise:i}}let la=null;ke.copy=ke.cut=(r,t)=>{let e=er(r.root);if(e&&!Pr(r.contentDOM,e))return!1;let{text:i,ranges:s,linewise:n}=Vg(r.state);if(!i&&!n)return!1;la=n?i:null,t.type=="cut"&&!r.state.readOnly&&r.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"});let o=Mc?null:t.clipboardData;return o?(o.clearData(),o.setData("text/plain",i),!0):(Fg(r,i),!1)};const Nc=Ke.define();function Bc(r,t){let e=[];for(let i of r.facet(ec)){let s=i(r,t);s&&e.push(s)}return e.length?r.update({effects:e,annotations:Nc.of(!0)}):null}function Fc(r){setTimeout(()=>{let t=r.hasFocus;if(t!=r.inputState.notifiedFocused){let e=Bc(r.state,t);e?r.dispatch(e):r.update([])}},10)}ue.focus=r=>{r.inputState.lastFocusTime=Date.now(),!r.scrollDOM.scrollTop&&(r.inputState.lastScrollTop||r.inputState.lastScrollLeft)&&(r.scrollDOM.scrollTop=r.inputState.lastScrollTop,r.scrollDOM.scrollLeft=r.inputState.lastScrollLeft),Fc(r)},ue.blur=r=>{r.observer.clearSelectionRange(),Fc(r)},ue.compositionstart=ue.compositionupdate=r=>{r.observer.editContext||(r.inputState.compositionFirstChange==null&&(r.inputState.compositionFirstChange=!0),r.inputState.composing<0&&(r.inputState.composing=0))},ue.compositionend=r=>{r.observer.editContext||(r.inputState.composing=-1,r.inputState.compositionEndedAt=Date.now(),r.inputState.compositionPendingKey=!0,r.inputState.compositionPendingChange=r.observer.pendingRecords().length>0,r.inputState.compositionFirstChange=null,D.chrome&&D.android?r.observer.flushSoon():r.inputState.compositionPendingChange?Promise.resolve().then(()=>r.observer.flush()):setTimeout(()=>{r.inputState.composing<0&&r.docView.hasComposition&&r.update([])},50))},ue.contextmenu=r=>{r.inputState.lastContextMenu=Date.now()},ke.beforeinput=(r,t)=>{var e,i;if((t.inputType=="insertText"||t.inputType=="insertCompositionText")&&(r.inputState.insertingText=t.data,r.inputState.insertingTextAt=Date.now()),t.inputType=="insertReplacementText"&&r.observer.editContext){let n=(e=t.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain"),o=t.getTargetRanges();if(n&&o.length){let a=o[0],l=r.posAtDOM(a.startContainer,a.startOffset),h=r.posAtDOM(a.endContainer,a.endOffset);return aa(r,{from:l,to:h,insert:r.state.toText(n)},null),!0}}let s;if(D.chrome&&D.android&&(s=Cc.find(n=>n.inputType==t.inputType))&&(r.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let n=((i=window.visualViewport)===null||i===void 0?void 0:i.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>n+10&&r.hasFocus&&(r.contentDOM.blur(),r.focus())},100)}return D.ios&&t.inputType=="deleteContentForward"&&r.observer.flushSoon(),D.safari&&t.inputType=="insertText"&&r.inputState.composing>=0&&setTimeout(()=>ue.compositionend(r,t),20),!1};const Vc=new Set;function qg(r){Vc.has(r)||(Vc.add(r),r.addEventListener("copy",()=>{}),r.addEventListener("cut",()=>{}))}const qc=["pre-wrap","normal","pre-line","break-spaces"];let ar=!1;function Wc(){ar=!1}class Wg{constructor(t){this.lineWrapping=t,this.doc=G.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return qc.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(s*10)]||(e=!0,this.heightSamples[Math.floor(s*10)]=!0)}return e}refresh(t,e,i,s,n,o){let a=qc.indexOf(t)>-1,l=Math.abs(e-this.lineHeight)>.3||this.lineWrapping!=a||Math.abs(i-this.charWidth)>.1;if(this.lineWrapping=a,this.lineHeight=e,this.charWidth=i,this.textHeight=s,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<o.length;h++){let c=o[h];c<0?h++:this.heightSamples[Math.floor(c*10)]=!0}}return l}}class _g{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Ae{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this._content=n}get type(){return typeof this._content=="number"?Ct.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Ri?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(t){let e=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(t._content)?t._content:[t]);return new Ae(this.from,this.length+t.length,this.top,this.height+t.height,e)}}var Q=(function(r){return r[r.ByPos=0]="ByPos",r[r.ByHeight=1]="ByHeight",r[r.ByPosNoHeight=2]="ByPosNoHeight",r})(Q||(Q={}));const Hs=.001;class Ht{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t){this.height!=t&&(Math.abs(this.height-t)>Hs&&(ar=!0),this.height=t)}replace(t,e,i){return Ht.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this,o=i.doc;for(let a=s.length-1;a>=0;a--){let{fromA:l,toA:h,fromB:c,toB:u}=s[a],d=n.lineAt(l,Q.ByPosNoHeight,i.setDoc(e),0,0),f=d.to>=h?d:n.lineAt(h,Q.ByPosNoHeight,i,0,0);for(u+=f.to-h,h=f.to;a>0&&d.from<=s[a-1].toA;)l=s[a-1].fromA,c=s[a-1].fromB,a--,l<d.from&&(d=n.lineAt(l,Q.ByPosNoHeight,i,0,0));c+=d.from-l,l=d.from;let p=ha.build(i.setDoc(o),t,c,u);n=zs(n,n.replace(l,h,p))}return n.updateHeight(i,0)}static empty(){return new oe(0,0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>n*2){let a=t[e-1];a.break?t.splice(--e,1,a.left,null,a.right):t.splice(--e,1,a.left,a.right),i+=1+a.break,s-=a.size}else if(n>s*2){let a=t[i];a.break?t.splice(i,1,a.left,null,a.right):t.splice(i,1,a.left,a.right),i+=2+a.break,n-=a.size}else break;else if(s<n){let a=t[e++];a&&(s+=a.size)}else{let a=t[--i];a&&(n+=a.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new zg(Ht.of(t.slice(0,e)),o,Ht.of(t.slice(i)))}}function zs(r,t){return r==t?r:(r.constructor!=t.constructor&&(ar=!0),t)}Ht.prototype.size=1;const Hg=L.replace({});class _c extends Ht{constructor(t,e,i){super(t,e),this.deco=i,this.spaceAbove=0}mainBlock(t,e){return new Ae(e,this.length,t+this.spaceAbove,this.height-this.spaceAbove,this.deco||0)}blockAt(t,e,i,s){return this.spaceAbove&&t<i+this.spaceAbove?new Ae(s,0,i,this.spaceAbove,Hg):this.mainBlock(i,s)}lineAt(t,e,i,s,n){let o=this.mainBlock(s,n);return this.spaceAbove?this.blockAt(0,i,s,n).join(o):o}forEachLine(t,e,i,s,n,o){t<=n+this.length&&e>=n&&o(this.lineAt(0,Q.ByPos,i,s,n))}setMeasuredHeight(t){let e=t.heights[t.index++];e<0?(this.spaceAbove=-e,e=t.heights[t.index++]):this.spaceAbove=0,this.setHeight(e)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setMeasuredHeight(s),this.outdated=!1,this}toString(){return`block(${this.length})`}}class oe extends _c{constructor(t,e,i){super(t,e,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0,this.spaceAbove=i}mainBlock(t,e){return new Ae(e,this.length,t+this.spaceAbove,this.height-this.spaceAbove,this.breaks)}replace(t,e,i){let s=i[0];return i.length==1&&(s instanceof oe||s instanceof It&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof It?s=new oe(s.length,this.height,this.spaceAbove):s.height=this.height,this.outdated||(s.outdated=!1),s):Ht.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setMeasuredHeight(s):(i||this.outdated)&&(this.spaceAbove=0,this.setHeight(Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))+this.breaks*t.lineHeight)),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class It extends Ht{constructor(t){super(t,0)}heightMetrics(t,e){let i=t.doc.lineAt(e).number,s=t.doc.lineAt(e+this.length).number,n=s-i+1,o,a=0;if(t.lineWrapping){let l=Math.min(this.height,t.lineHeight*n);o=l/n,this.length>n+1&&(a=(this.height-l)/(this.length-n-1))}else o=this.height/n;return{firstLine:i,lastLine:s,perLine:o,perChar:a}}blockAt(t,e,i,s){let{firstLine:n,lastLine:o,perLine:a,perChar:l}=this.heightMetrics(e,s);if(e.lineWrapping){let h=s+(t<e.lineHeight?0:Math.round(Math.max(0,Math.min(1,(t-i)/this.height))*this.length)),c=e.doc.lineAt(h),u=a+c.length*l,d=Math.max(i,t-u/2);return new Ae(c.from,c.length,d,u,0)}else{let h=Math.max(0,Math.min(o-n,Math.floor((t-i)/a))),{from:c,length:u}=e.doc.line(n+h);return new Ae(c,u,i+a*h,a,0)}}lineAt(t,e,i,s,n){if(e==Q.ByHeight)return this.blockAt(t,i,s,n);if(e==Q.ByPosNoHeight){let{from:f,to:p}=i.doc.lineAt(t);return new Ae(f,p-f,0,0,0)}let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(i,n),h=i.doc.lineAt(t),c=a+h.length*l,u=h.number-o,d=s+a*u+l*(h.from-n-u);return new Ae(h.from,h.length,Math.max(s,Math.min(d,s+this.height-c)),c,0)}forEachLine(t,e,i,s,n,o){t=Math.max(t,n),e=Math.min(e,n+this.length);let{firstLine:a,perLine:l,perChar:h}=this.heightMetrics(i,n);for(let c=t,u=s;c<=e;){let d=i.doc.lineAt(c);if(c==t){let p=d.number-a;u+=l*p+h*(t-n-p)}let f=l+h*d.length;o(new Ae(d.from,d.length,u,f,0)),u+=f,c=d.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let n=i[i.length-1];n instanceof It?i[i.length-1]=new It(n.length+s):i.push(null,new It(s-1))}if(t>0){let n=i[0];n instanceof It?i[0]=new It(t+n.length):i.unshift(new It(t-1),null)}return Ht.of(i)}decomposeLeft(t,e){e.push(new It(t-1),null)}decomposeRight(t,e){e.push(null,new It(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let o=[],a=Math.max(e,s.from),l=-1;for(s.from>e&&o.push(new It(s.from-e-1).updateHeight(t,e));a<=n&&s.more;){let c=t.doc.lineAt(a).length;o.length&&o.push(null);let u=s.heights[s.index++],d=0;u<0&&(d=-u,u=s.heights[s.index++]),l==-1?l=u:Math.abs(u-l)>=Hs&&(l=-2);let f=new oe(c,u,d);f.outdated=!1,o.push(f),a+=c+1}a<=n&&o.push(null,new It(n-a).updateHeight(t,a));let h=Ht.of(o);return(l<0||Math.abs(h.height-this.height)>=Hs||Math.abs(l-this.heightMetrics(t,e).perLine)>=Hs)&&(ar=!0),zs(this,h)}else(i||this.outdated)&&(this.setHeight(t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class zg extends Ht{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let o=s+this.left.height,a=n+this.left.length+this.break,l=e==Q.ByHeight?t<o:t<a,h=l?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,o,a);if(this.break||(l?h.to<a:h.from>a))return h;let c=e==Q.ByPosNoHeight?Q.ByPosNoHeight:Q.ByPos;return l?h.join(this.right.lineAt(a,c,i,o,a)):this.left.lineAt(a,c,i,s,n).join(h)}forEachLine(t,e,i,s,n,o){let a=s+this.left.height,l=n+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,s,n,o),e>=l&&this.right.forEachLine(t,e,i,a,l,o);else{let h=this.lineAt(l,Q.ByPos,i,s,n);t<h.from&&this.left.forEachLine(t,h.from-1,i,s,n,o),h.to>=t&&h.from<=e&&o(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,a,l,o)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let o=n.length;for(let a of i)n.push(a);if(t>0&&Hc(n,o-1),e<this.length){let a=n.length;this.decomposeRight(e,n),Hc(n,a)}return Ht.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Ht.of(this.break?[t,null,e]:[t,e]):(this.left=zs(this.left,t),this.right=zs(this.right,e),this.setHeight(t.height+e.height),this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:o}=this,a=e+n.length+this.break,l=null;return s&&s.from<=e+n.length&&s.more?l=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=a+o.length&&s.more?l=o=o.updateHeight(t,a,i,s):o.updateHeight(t,a,i),l?this.balanced(n,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Hc(r,t){let e,i;r[t]==null&&(e=r[t-1])instanceof It&&(i=r[t+1])instanceof It&&r.splice(t-1,3,new It(e.length+1+i.length))}const jg=5;class ha{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof oe?s.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new oe(i-this.pos,-1,0)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0,n=i.widget?i.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let o=e-t;i.block?this.addBlock(new _c(o,s,i)):(o||n||s>=jg)&&this.addLineDeco(s,n,o)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new oe(this.pos-t,-1,0)),this.writtenTo=this.pos}blankContent(t,e){let i=new It(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof oe)return t;let e=new oe(0,-1,0);return this.nodes.push(e),e}addBlock(t){this.enterLine();let e=t.deco;e&&e.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,e&&e.endSide>0&&(this.covering=t)}addLineDeco(t,e,i){let s=this.ensureLine();s.length+=i,s.collapsed+=i,s.widgetHeight=Math.max(s.widgetHeight,t),s.breaks+=e,this.writtenTo=this.pos=this.pos+i}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof oe)&&!this.isCovered?this.nodes.push(new oe(0,-1,0)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let s of this.nodes)s instanceof oe&&s.updateHeight(this.oracle,i),i+=s?s.length:1;return this.nodes}static build(t,e,i,s){let n=new ha(i,t);return W.spans(e,i,s,n,0),n.finish(i)}}function $g(r,t,e){let i=new Gg;return W.compare(r,t,e,i,0),i.changes}class Gg{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&tr(t,e,this.changes,5)}}function Ug(r,t){let e=r.getBoundingClientRect(),i=r.ownerDocument,s=i.defaultView||window,n=Math.max(0,e.left),o=Math.min(s.innerWidth,e.right),a=Math.max(0,e.top),l=Math.min(s.innerHeight,e.bottom);for(let h=r.parentNode;h&&h!=i.body;)if(h.nodeType==1){let c=h,u=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&u.overflow!="visible"){let d=c.getBoundingClientRect();n=Math.max(n,d.left),o=Math.min(o,d.right),a=Math.max(a,d.top),l=Math.min(h==r.parentNode?s.innerHeight:l,d.bottom)}h=u.position=="absolute"||u.position=="fixed"?c.offsetParent:c.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:n-e.left,right:Math.max(n,o)-e.left,top:a-(e.top+t),bottom:Math.max(a,l)-(e.top+t)}}function Kg(r){let t=r.getBoundingClientRect(),e=r.ownerDocument.defaultView||window;return t.left<e.innerWidth&&t.right>0&&t.top<e.innerHeight&&t.bottom>0}function Yg(r,t){let e=r.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}class ca{constructor(t,e,i,s){this.from=t,this.to=e,this.size=i,this.displaySize=s}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t,e){return L.replace({widget:new Xg(this.displaySize*(e?t.scaleY:t.scaleX),e)}).range(this.from,this.to)}}class Xg extends Xe{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class zc{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=jc,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=X.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let e=t.facet(Jo).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new Wg(e),this.stateDeco=$c(t),this.heightMap=Ht.empty().applyChanges(this.stateDeco,G.empty,this.heightOracle.setDoc(t.doc),[new ce(0,0,0,t.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=L.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some(({from:n,to:o})=>s>=n&&s<=o)){let{from:n,to:o}=this.lineBlockAt(s);t.push(new js(n,o))}}return this.viewports=t.sort((i,s)=>i.from-s.from),this.updateScaler()}updateScaler(){let t=this.scaler;return this.scaler=this.heightMap.height<=7e6?jc:new ua(this.heightOracle,this.heightMap,this.viewports),t.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,t=>{this.viewportLines.push(Wr(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=$c(this.state);let s=t.changedRanges,n=ce.extendWithRanges(s,$g(i,this.stateDeco,t?t.changes:mt.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);Wc(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),n),(this.heightMap.height!=o||ar)&&(t.flags|=2),a?(this.scrollAnchorPos=t.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=o);let l=n.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,t.flags|=this.updateForViewport(),(h||!t.changes.empty||t.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(t.changes),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&(t.selectionSet||t.focusChanged)&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&!t.state.facet(rc)&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?X.RTL:X.LTR;let o=this.heightOracle.mustRefreshForWrapping(n)||this.mustMeasureContent,a=e.getBoundingClientRect(),l=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let h=0,c=0;if(a.width&&a.height){let{scaleX:C,scaleY:x}=qh(e,a);(C>.005&&Math.abs(this.scaleX-C)>.005||x>.005&&Math.abs(this.scaleY-x)>.005)&&(this.scaleX=C,this.scaleY=x,h|=16,o=l=!0)}let u=(parseInt(i.paddingTop)||0)*this.scaleY,d=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=u||this.paddingBottom!=d)&&(this.paddingTop=u,this.paddingBottom=d,h|=18),this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=16);let f=t.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=f&&(this.scrollAnchorHeight=-1,this.scrollTop=f),this.scrolledToBottom=Hh(t.scrollDOM);let p=(this.printing?Yg:Ug)(e,this.paddingTop),m=p.top-this.pixelViewport.top,g=p.bottom-this.pixelViewport.bottom;this.pixelViewport=p;let v=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(v!=this.inView&&(this.inView=v,v&&(l=!0)),!this.inView&&!this.scrollTarget&&!Kg(t.dom))return 0;let S=a.width;if((this.contentDOMWidth!=S||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=t.scrollDOM.clientHeight,h|=16),l){let C=t.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(C)&&(o=!0),o||s.lineWrapping&&Math.abs(S-this.contentDOMWidth)>s.charWidth){let{lineHeight:x,charWidth:k,textHeight:A}=t.docView.measureTextSize();o=x>0&&s.refresh(n,x,k,A,Math.max(5,S/k),C),o&&(t.docView.minWidth=0,h|=16)}m>0&&g>0?c=Math.max(m,g):m<0&&g<0&&(c=Math.min(m,g)),Wc();for(let x of this.viewports){let k=x.from==this.viewport.from?C:t.docView.measureVisibleLineHeights(x);this.heightMap=(o?Ht.empty().applyChanges(this.stateDeco,G.empty,this.heightOracle,[new ce(0,0,0,t.state.doc.length)]):this.heightMap).updateHeight(s,0,o,new _g(x.from,k))}ar&&(h|=2)}let w=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return w&&(h&2&&(h|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),h|=this.updateForViewport()),(h&2||w)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,t)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,l=new js(s.lineAt(o-i*1e3,Q.ByHeight,n,0,0).from,s.lineAt(a+(1-i)*1e3,Q.ByHeight,n,0,0).to);if(e){let{head:h}=e.range;if(h<l.from||h>l.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=s.lineAt(h,Q.ByPos,n,0,0),d;e.y=="center"?d=(u.top+u.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&h<l.from?d=u.top:d=u.bottom-c,l=new js(s.lineAt(d-1e3/2,Q.ByHeight,n,0,0).from,s.lineAt(d+c+1e3/2,Q.ByHeight,n,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new js(this.heightMap.lineAt(i,Q.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,Q.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,Q.ByPos,this.heightOracle,0,0),{bottom:n}=this.heightMap.lineAt(e,Q.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(t==0||s<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=a+Math.max(10,Math.min(i,250)))&&s>o-2*1e3&&n<a+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new ca(e.mapPos(s.from),e.mapPos(s.to),s.size,s.displaySize));return i}ensureLineGaps(t,e){let i=this.heightOracle.lineWrapping,s=i?1e4:2e3,n=s>>1,o=s<<1;if(this.defaultTextDirection!=X.LTR&&!i)return[];let a=[],l=(c,u,d,f)=>{if(u-c<n)return;let p=this.state.selection.main,m=[p.from];p.empty||m.push(p.to);for(let v of m)if(v>c&&v<u){l(c,v-10,d,f),l(v+10,u,d,f);return}let g=Qg(t,v=>v.from>=d.from&&v.to<=d.to&&Math.abs(v.from-c)<n&&Math.abs(v.to-u)<n&&!m.some(S=>v.from<S&&v.to>S));if(!g){if(u<d.to&&e&&i&&e.visibleRanges.some(w=>w.from<=u&&w.to>=u)){let w=e.moveToLineBoundary(b.cursor(u),!1,!0).head;w>c&&(u=w)}let v=this.gapSize(d,c,u,f),S=i||v<2e6?v:2e6;g=new ca(c,u,v,S)}a.push(g)},h=c=>{if(c.length<o||c.type!=Ct.Text)return;let u=Jg(c.from,c.to,this.stateDeco);if(u.total<o)return;let d=this.scrollTarget?this.scrollTarget.range.head:null,f,p;if(i){let m=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,g,v;if(d!=null){let S=Gs(u,d),w=((this.visibleBottom-this.visibleTop)/2+m)/c.height;g=S-w,v=S+w}else g=(this.visibleTop-c.top-m)/c.height,v=(this.visibleBottom-c.top+m)/c.height;f=$s(u,g),p=$s(u,v)}else{let m=u.total*this.heightOracle.charWidth,g=s*this.heightOracle.charWidth,v=0;if(m>2e6)for(let k of t)k.from>=c.from&&k.from<c.to&&k.size!=k.displaySize&&k.from*this.heightOracle.charWidth+v<this.pixelViewport.left&&(v=k.size-k.displaySize);let S=this.pixelViewport.left+v,w=this.pixelViewport.right+v,C,x;if(d!=null){let k=Gs(u,d),A=((w-S)/2+g)/m;C=k-A,x=k+A}else C=(S-g)/m,x=(w+g)/m;f=$s(u,C),p=$s(u,x)}f>c.from&&l(c.from,f,c,u),p<c.to&&l(p,c.to,c,u)};for(let c of this.viewportLines)Array.isArray(c.type)?c.type.forEach(h):h(c);return a}gapSize(t,e,i,s){let n=Gs(s,i)-Gs(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){ca.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=L.set(t.map(e=>e.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(t){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let i=[];W.spans(e,this.viewport.from,this.viewport.to,{span(n,o){i.push({from:n,to:o})},point(){}},20);let s=0;if(i.length!=this.visibleRanges.length)s=12;else for(let n=0;n<i.length&&!(s&8);n++){let o=this.visibleRanges[n],a=i[n];(o.from!=a.from||o.to!=a.to)&&(s|=4,t&&t.mapPos(o.from,-1)==a.from&&t.mapPos(o.to,1)==a.to||(s|=8))}return this.visibleRanges=i,s}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||Wr(this.heightMap.lineAt(t,Q.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(t){return t>=this.viewportLines[0].top&&t<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(e=>e.top<=t&&e.bottom>=t)||Wr(this.heightMap.lineAt(this.scaler.fromDOM(t),Q.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(t){let e=this.lineBlockAtHeight(t+8);return e.from>=this.viewport.from||this.viewportLines[0].top-t>200?e:this.viewportLines[0]}elementAtHeight(t){return Wr(this.heightMap.blockAt(this.scaler.fromDOM(t),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class js{constructor(t,e){this.from=t,this.to=e}}function Jg(r,t,e){let i=[],s=r,n=0;return W.spans(e,r,t,{span(){},point(o,a){o>s&&(i.push({from:s,to:o}),n+=o-s),s=a}},20),s<t&&(i.push({from:s,to:t}),n+=t-s),{total:n,ranges:i}}function $s({total:r,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(r*e);for(let s=0;;s++){let{from:n,to:o}=t[s],a=o-n;if(i<=a)return n+i;i-=a}}function Gs(r,t){let e=0;for(let{from:i,to:s}of r.ranges){if(t<=s){e+=t-i;break}e+=s-i}return e/r.total}function Qg(r,t){for(let e of r)if(t(e))return e}const jc={toDOM(r){return r},fromDOM(r){return r},scale:1,eq(r){return r==this}};function $c(r){let t=r.facet(Es).filter(i=>typeof i!="function"),e=r.facet(Qo).filter(i=>typeof i!="function");return e.length&&t.push(W.join(e)),t}class ua{constructor(t,e,i){let s=0,n=0,o=0;this.viewports=i.map(({from:a,to:l})=>{let h=e.lineAt(a,Q.ByPos,t,0,0).top,c=e.lineAt(l,Q.ByPos,t,0,0).bottom;return s+=c-h,{from:a,to:l,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(e.height-s);for(let a of this.viewports)a.domTop=o+(a.top-n)*this.scale,o=a.domBottom=a.domTop+(a.bottom-a.top),n=a.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}eq(t){return t instanceof ua?this.scale==t.scale&&this.viewports.length==t.viewports.length&&this.viewports.every((e,i)=>e.from==t.viewports[i].from&&e.to==t.viewports[i].to):!1}}function Wr(r,t){if(t.scale==1)return r;let e=t.toDOM(r.top),i=t.toDOM(r.bottom);return new Ae(r.from,r.length,e,i-e,Array.isArray(r._content)?r._content.map(s=>Wr(s,t)):r._content)}const Us=O.define({combine:r=>r.join(" ")}),da=O.define({combine:r=>r.indexOf(!0)>-1}),fa=li.newName(),Gc=li.newName(),Uc=li.newName(),Kc={"&light":"."+Gc,"&dark":"."+Uc};function pa(r,t,e){return new li(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,s=>{if(s=="&")return r;if(!e||!e[s])throw new RangeError(`Unsupported selector: ${s}`);return e[s]}):r+" "+i}})}const Zg=pa("."+fa,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Kc),t0={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},ma=D.ie&&D.ie_version<=11;class e0{constructor(t){this.view=t,this.active=!1,this.editContext=null,this.selectionRange=new Em,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(e=>{for(let i of e)this.queue.push(i);(D.ie&&D.ie_version<=11||D.ios&&t.composing)&&e.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&D.android&&t.constructor.EDIT_CONTEXT!==!1&&!(D.chrome&&D.chrome_version<126)&&(this.editContext=new r0(t),t.state.facet(Ze)&&(t.contentDOM.editContext=this.editContext.editContext)),ma&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var e;((e=this.view.docView)===null||e===void 0?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(t.scrollDOM)),this.addWindowListeners(this.win=t.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(t){this.view.inputState.runHandlers("scroll",t),this.intersecting&&this.view.measure()}onScroll(t){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(t){(t.type=="change"||!t.type)&&!t.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){let e=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,s=this.selectionRange;if(i.state.facet(Ze)?i.root.activeElement!=this.dom:!Pr(this.dom,s))return;let n=s.anchorNode&&i.docView.tile.nearest(s.anchorNode);if(n&&n.isWidget()&&n.widget.ignoreEvent(t)){e||(this.selectionChanged=!1);return}(D.ie&&D.ie_version<=11||D.android&&D.chrome)&&!i.state.selection.main.empty&&s.focusNode&&Lr(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:t}=this,e=er(t.root);if(!e)return!1;let i=D.safari&&t.root.nodeType==11&&t.root.activeElement==this.dom&&i0(this.view,e)||e;if(!i||this.selectionRange.eq(i))return!1;let s=Pr(this.dom,i);return s&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&Lm(this.dom,i)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),!1):(this.selectionRange.setRange(i),s&&(this.selectionChanged=!0),!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,t0),ma&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),ma&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){var i;if(!this.delayedAndroidKey){let s=()=>{let n=this.delayedAndroidKey;n&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=n.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&n.force&&ir(this.dom,n.key,n.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}processRecords(){let t=this.pendingRecords();t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let o=this.readMutation(n);o&&(o.typeOver&&(s=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:s}}readChange(){let{from:t,to:e,typeOver:i}=this.processRecords(),s=this.selectionChanged&&Pr(this.dom,this.selectionRange);if(t<0&&!s)return null;t>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let n=new xg(this.view,t,e,i);return this.view.docView.domChanged={newSel:n.newSel?n.newSel.main:null},n}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();let e=this.readChange();if(!e)return this.view.requestMeasure(),!1;let i=this.view.state,s=Sc(this.view,e);return this.view.state==i&&(e.domChanged||e.newSel&&!Vs(this.view.state.selection,e.newSel.main))&&this.view.update([]),s}readMutation(t){let e=this.view.docView.tile.nearest(t.target);if(!e||e.isWidget())return null;if(e.markDirty(t.type=="attributes"),t.type=="childList"){let i=Yc(e,t.previousSibling||t.target.previousSibling,-1),s=Yc(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}update(t){this.editContext&&(this.editContext.update(t),t.startState.facet(Ze)!=t.state.facet(Ze)&&(t.view.contentDOM.editContext=t.state.facet(Ze)?this.editContext.editContext:null))}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Yc(r,t,e){for(;t;){let i=dt.get(t);if(i&&i.parent==r)return i;let s=t.parentNode;t=s!=r.dom?s:e>0?t.nextSibling:t.previousSibling}return null}function Xc(r,t){let e=t.startContainer,i=t.startOffset,s=t.endContainer,n=t.endOffset,o=r.docView.domAtPos(r.state.selection.main.anchor,1);return Lr(o.node,o.offset,s,n)&&([e,i,s,n]=[s,n,e,i]),{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:n}}function i0(r,t){if(t.getComposedRanges){let s=t.getComposedRanges(r.root)[0];if(s)return Xc(r,s)}let e=null;function i(s){s.preventDefault(),s.stopImmediatePropagation(),e=s.getTargetRanges()[0]}return r.contentDOM.addEventListener("beforeinput",i,!0),r.dom.ownerDocument.execCommand("indent"),r.contentDOM.removeEventListener("beforeinput",i,!0),e?Xc(r,e):null}class r0{constructor(t){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(t.state);let e=this.editContext=new window.EditContext({text:t.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,t.state.selection.main.anchor))),selectionEnd:this.toContextPos(t.state.selection.main.head)});this.handlers.textupdate=i=>{let s=t.state.selection.main,{anchor:n,head:o}=s,a=this.toEditorPos(i.updateRangeStart),l=this.toEditorPos(i.updateRangeEnd);t.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:i.updateRangeStart,editorBase:a,drifted:!1});let h=l-a>i.text.length;a==this.from&&n<this.from?a=n:l==this.to&&n>this.to&&(l=n);let c=kc(t.state.sliceDoc(a,l),i.text,(h?s.from:s.to)-a,h?"end":null);if(!c){let d=b.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd));Vs(d,s)||t.dispatch({selection:d,userEvent:"select"});return}let u={from:c.from+a,to:c.toA+a,insert:G.of(i.text.slice(c.from,c.toB).split(`
`))};if((D.mac||D.android)&&u.from==o-1&&/^\. ?$/.test(i.text)&&t.contentDOM.getAttribute("autocorrect")=="off"&&(u={from:a,to:l,insert:G.of([i.text.replace("."," ")])}),this.pendingContextChange=u,!t.state.readOnly){let d=this.to-this.from+(u.to-u.from+u.insert.length);aa(t,u,b.single(this.toEditorPos(i.selectionStart,d),this.toEditorPos(i.selectionEnd,d)))}this.pendingContextChange&&(this.revertPending(t.state),this.setSelection(t.state)),u.from<u.to&&!u.insert.length&&t.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(e.text.slice(Math.max(0,i.updateRangeStart-1),Math.min(e.text.length,i.updateRangeStart+1)))&&this.handlers.compositionend(i)},this.handlers.characterboundsupdate=i=>{let s=[],n=null;for(let o=this.toEditorPos(i.rangeStart),a=this.toEditorPos(i.rangeEnd);o<a;o++){let l=t.coordsForChar(o);n=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||n||new DOMRect,s.push(n)}e.updateCharacterBounds(i.rangeStart,s)},this.handlers.textformatupdate=i=>{let s=[];for(let n of i.getTextFormats()){let o=n.underlineStyle,a=n.underlineThickness;if(!/none/i.test(o)&&!/none/i.test(a)){let l=this.toEditorPos(n.rangeStart),h=this.toEditorPos(n.rangeEnd);if(l<h){let c=`text-decoration: underline ${/^[a-z]/.test(o)?o+" ":o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${/thin/i.test(a)?1:2}px`;s.push(L.mark({attributes:{style:c}}).range(l,h))}}}t.dispatch({effects:nc.of(L.set(s))})},this.handlers.compositionstart=()=>{t.inputState.composing<0&&(t.inputState.composing=0,t.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(t.inputState.composing=-1,t.inputState.compositionFirstChange=null,this.composing){let{drifted:i}=this.composing;this.composing=null,i&&this.reset(t.state)}};for(let i in this.handlers)e.addEventListener(i,this.handlers[i]);this.measureReq={read:i=>{this.editContext.updateControlBounds(i.contentDOM.getBoundingClientRect());let s=er(i.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(t){let e=0,i=!1,s=this.pendingContextChange;return t.changes.iterChanges((n,o,a,l,h)=>{if(i)return;let c=h.length-(o-n);if(s&&o>=s.to)if(s.from==n&&s.to==o&&s.insert.eq(h)){s=this.pendingContextChange=null,e+=c,this.to+=c;return}else s=null,this.revertPending(t.state);if(n+=e,o+=e,o<=this.from)this.from+=c,this.to+=c;else if(n<this.to){if(n<this.from||o>this.to||this.to-this.from+h.length>3e4){i=!0;return}this.editContext.updateText(this.toContextPos(n),this.toContextPos(o),h.toString()),this.to+=c}e+=c}),s&&!i&&this.revertPending(t.state),!i}update(t){let e=this.pendingContextChange,i=t.startState.selection.main;this.composing&&(this.composing.drifted||!t.changes.touchesRange(i.from,i.to)&&t.transactions.some(s=>!s.isUserEvent("input.type")&&s.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=t.changes.mapPos(this.composing.editorBase)):!this.applyEdits(t)||!this.rangeIsValid(t.state)?(this.pendingContextChange=null,this.reset(t.state)):(t.docChanged||t.selectionSet||e)&&this.setSelection(t.state),(t.geometryChanged||t.docChanged||t.selectionSet)&&t.view.requestMeasure(this.measureReq)}resetRange(t){let{head:e}=t.selection.main;this.from=Math.max(0,e-1e4),this.to=Math.min(t.doc.length,e+1e4)}reset(t){this.resetRange(t),this.editContext.updateText(0,this.editContext.text.length,t.doc.sliceString(this.from,this.to)),this.setSelection(t)}revertPending(t){let e=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(e.from),this.toContextPos(e.from+e.insert.length),t.doc.sliceString(e.from,e.to))}setSelection(t){let{main:e}=t.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,e.anchor))),s=this.toContextPos(e.head);(this.editContext.selectionStart!=i||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(i,s)}rangeIsValid(t){let{head:e}=t.selection.main;return!(this.from>0&&e-this.from<500||this.to<t.doc.length&&this.to-e<500||this.to-this.from>1e4*3)}toEditorPos(t,e=this.to-this.from){t=Math.min(t,e);let i=this.composing;return i&&i.drifted?i.editorBase+(t-i.contextBase):t+this.from}toContextPos(t){let e=this.composing;return e&&e.drifted?e.contextBase+(t-e.editorBase):t-this.from}destroy(){for(let t in this.handlers)this.editContext.removeEventListener(t,this.handlers[t])}}class T{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(t={}){var e;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),t.parent&&t.parent.appendChild(this.dom);let{dispatch:i}=t;this.dispatchTransactions=t.dispatchTransactions||i&&(s=>s.forEach(n=>i(n,this)))||(s=>this.update(s)),this.dispatch=this.dispatch.bind(this),this._root=t.root||Pm(t.parent)||document,this.viewState=new zc(t.state||$.create(t)),t.scrollTo&&t.scrollTo.is(Rs)&&(this.viewState.scrollTarget=t.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(sr).map(s=>new Xo(s));for(let s of this.plugins)s.update(this);this.observer=new e0(this),this.inputState=new Ag(this),this.inputState.ensureHandlers(this.plugins),this.docView=new pc(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((e=document.fonts)===null||e===void 0)&&e.ready&&document.fonts.ready.then(()=>{this.viewState.mustMeasureContent=!0,this.requestMeasure()})}dispatch(...t){let e=t.length==1&&t[0]instanceof vt?t:t.length==1&&Array.isArray(t[0])?t[0]:[this.state.update(...t)];this.dispatchTransactions(e,this)}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,s,n=this.state;for(let d of t){if(d.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=d.state}if(this.destroyed){this.viewState.state=n;return}let o=this.hasFocus,a=0,l=null;t.some(d=>d.annotation(Nc))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,l=Bc(n,o),l||(a=1));let h=this.observer.delayedAndroidKey,c=null;if(h?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(n.doc)||!this.state.selection.eq(n.selection))&&(c=null)):this.observer.clear(),n.facet($.phrases)!=this.state.facet($.phrases))return this.setState(n);s=Ps.create(this,n,t),s.flags|=a;let u=this.viewState.scrollTarget;try{this.updateState=2;for(let d of t){if(u&&(u=u.map(d.changes)),d.scrollIntoView){let{main:f}=d.state.selection;u=new rr(f.empty?f:b.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of d.effects)f.is(Rs)&&(u=f.value.clip(this.state))}this.viewState.update(s,u),this.bidiCache=Ks.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),e=this.docView.update(s),this.state.facet(Fr)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(d=>d.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(Us)!=s.state.facet(Us)&&(this.viewState.mustMeasureContent=!0),(e||i||u||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),e&&this.docViewUpdate(),!s.empty)for(let d of this.state.facet(Uo))try{d(s)}catch(f){Jt(this.state,f,"update listener")}(l||c)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),c&&!Sc(this,c)&&h.force&&ir(this.contentDOM,h.key,h.keyCode)})}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new zc(t),this.plugins=t.facet(sr).map(i=>new Xo(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new pc(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(sr),i=t.state.facet(sr);if(e!=i){let s=[];for(let n of i){let o=e.indexOf(n);if(o<0)s.push(new Xo(n));else{let a=this.plugins[o];a.mustUpdate=t,s.push(a)}}for(let n of this.plugins)n.mustUpdate!=t&&n.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=t;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);e!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let t of this.plugins){let e=t.value;if(e&&e.docViewUpdate)try{e.docViewUpdate(this)}catch(i){Jt(this.state,i,"doc view update listener")}}}measure(t=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,t&&this.observer.forceFlush();let e=null,i=this.scrollDOM,s=i.scrollTop*this.scaleY,{scrollAnchorPos:n,scrollAnchorHeight:o}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(o<0)if(Hh(i))n=-1,o=this.viewState.heightMap.height;else{let f=this.viewState.scrollAnchorAt(s);n=f.from,o=f.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let h=[];l&4||([this.measureRequests,h]=[h,this.measureRequests]);let c=h.map(f=>{try{return f.read(this)}catch(p){return Jt(this.state,p),Jc}}),u=Ps.create(this,this.state,[]),d=!1;u.flags|=l,e?e.flags|=l:e=u,this.updateState=2,u.empty||(this.updatePlugins(u),this.inputState.update(u),this.updateAttrs(),d=this.docView.update(u),d&&this.docViewUpdate());for(let f=0;f<h.length;f++)if(c[f]!=Jc)try{let p=h[f];p.write&&p.write(c[f],this)}catch(p){Jt(this.state,p)}if(d&&this.docView.updateSelection(!0),!u.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let f=(n<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(n).top)-o;if(f>1||f<-1){s=s+f,i.scrollTop=s/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let a of this.state.facet(Uo))a(e)}get themeClasses(){return fa+" "+(this.state.facet(da)?Uc:Gc)+" "+this.state.facet(Us)}updateAttrs(){let t=Qc(this,oc,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(Ze)?"true":"false",class:"cm-content",style:`${D.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Qc(this,Jo,e);let i=this.observer.ignore(()=>{let s=Bh(this.contentDOM,this.contentAttrs,e),n=Bh(this.dom,this.editorAttrs,t);return s||n});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let s of i.effects)if(s.is(T.announce)){e&&(this.announceDOM.textContent=""),e=!1;let n=this.announceDOM.appendChild(document.createElement("div"));n.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(Fr);let t=this.state.facet(T.cspNonce);li.mount(this.root,this.styleModules.concat(Zg).reverse(),t?{nonce:t}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),t){if(this.measureRequests.indexOf(t)>-1)return;if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.plugin!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.plugin==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return na(this,t,gc(this,t,e,i))}moveByGroup(t,e){return na(this,t,gc(this,t,e,i=>mg(this,t.head,i)))}visualLineSide(t,e){let i=this.bidiSpans(t),s=this.textDirectionAt(t.from),n=i[e?i.length-1:0];return b.cursor(n.side(e,s)+t.from,n.forward(!e,s)?1:-1)}moveToLineBoundary(t,e,i=!0){return pg(this,t,e,i)}moveVertically(t,e,i){return na(this,t,gg(this,t,e,i))}domAtPos(t,e=1){return this.docView.domAtPos(t,e)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){this.readMeasured();let i=oa(this,t,e);return i&&i.pos}posAndSideAtCoords(t,e=!0){return this.readMeasured(),oa(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s),o=n[Qe.find(n,t-s.from,-1,e)];return Ts(i,o.dir==X.LTR==e>0)}coordsForChar(t){return this.readMeasured(),this.docView.coordsForChar(t)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(ic)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>s0)return Kh(t.length);let e=this.textDirectionAt(t.from),i;for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e&&(n.fresh||Uh(n.isolates,i=hc(this,t))))return n.order;i||(i=hc(this,t));let s=_m(t.text,e,i);return this.bidiCache.push(new Ks(t.from,t.to,e,i,!0,s)),s}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||D.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Wh(this.contentDOM),this.docView.updateSelection()})}setRoot(t){this._root!=t&&(this._root=t,this.observer.setWindow((t.nodeType==9?t:t.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Rs.of(new rr(typeof t=="number"?b.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}scrollSnapshot(){let{scrollTop:t,scrollLeft:e}=this.scrollDOM,i=this.viewState.scrollAnchorAt(t);return Rs.of(new rr(b.cursor(i.from),"start","start",i.top-t,e,!0))}setTabFocusMode(t){t==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof t=="boolean"?this.inputState.tabFocusMode=t?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+t)}static domEventHandlers(t){return ut.define(()=>({}),{eventHandlers:t})}static domEventObservers(t){return ut.define(()=>({}),{eventObservers:t})}static theme(t,e){let i=li.newName(),s=[Us.of(i),Fr.of(pa(`.${i}`,t))];return e&&e.dark&&s.push(da.of(!0)),s}static baseTheme(t){return Ti.lowest(Fr.of(pa("."+fa,t,Kc)))}static findFromDOM(t){var e;let i=t.querySelector(".cm-content"),s=i&&dt.get(i)||dt.get(t);return((e=s==null?void 0:s.root)===null||e===void 0?void 0:e.view)||null}}T.styleModule=Fr,T.inputHandler=tc,T.clipboardInputFilter=Ko,T.clipboardOutputFilter=Yo,T.scrollHandler=sc,T.focusChangeEffect=ec,T.perLineTextDirection=ic,T.exceptionSink=Zh,T.updateListener=Uo,T.editable=Ze,T.mouseSelectionStyle=Qh,T.dragMovesSelection=Jh,T.clickAddsSelectionRange=Xh,T.decorations=Es,T.blockWrappers=ac,T.outerDecorations=Qo,T.atomicRanges=Br,T.bidiIsolatedRanges=lc,T.scrollMargins=cc,T.darkTheme=da,T.cspNonce=O.define({combine:r=>r.length?r[0]:""}),T.contentAttributes=Jo,T.editorAttributes=oc,T.lineWrapping=T.contentAttributes.of({class:"cm-lineWrapping"}),T.announce=F.define();const s0=4096,Jc={};class Ks{constructor(t,e,i,s,n,o){this.from=t,this.to=e,this.dir=i,this.isolates=s,this.fresh=n,this.order=o}static update(t,e){if(e.empty&&!t.some(n=>n.fresh))return t;let i=[],s=t.length?t[t.length-1].dir:X.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let o=t[n];o.dir==s&&!e.touchesRange(o.from,o.to)&&i.push(new Ks(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return i}}function Qc(r,t,e){for(let i=r.state.facet(t),s=i.length-1;s>=0;s--){let n=i[s],o=typeof n=="function"?n(r):n;o&&Wo(o,e)}return e}const n0=D.mac?"mac":D.windows?"win":D.linux?"linux":"key";function o0(r,t){const e=r.split(/-(?!$)/);let i=e[e.length-1];i=="Space"&&(i=" ");let s,n,o,a;for(let l=0;l<e.length-1;++l){const h=e[l];if(/^(cmd|meta|m)$/i.test(h))a=!0;else if(/^a(lt)?$/i.test(h))s=!0;else if(/^(c|ctrl|control)$/i.test(h))n=!0;else if(/^s(hift)?$/i.test(h))o=!0;else if(/^mod$/i.test(h))t=="mac"?a=!0:n=!0;else throw new Error("Unrecognized modifier name: "+h)}return s&&(i="Alt-"+i),n&&(i="Ctrl-"+i),a&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Ys(r,t,e){return t.altKey&&(r="Alt-"+r),t.ctrlKey&&(r="Ctrl-"+r),t.metaKey&&(r="Meta-"+r),e!==!1&&t.shiftKey&&(r="Shift-"+r),r}const a0=Ti.default(T.domEventHandlers({keydown(r,t){return eu(tu(t.state),r,t,"editor")}})),Xs=O.define({enables:a0}),Zc=new WeakMap;function tu(r){let t=r.facet(Xs),e=Zc.get(t);return e||Zc.set(t,e=c0(t.reduce((i,s)=>i.concat(s),[]))),e}function l0(r,t,e){return eu(tu(r.state),t,r,e)}let di=null;const h0=4e3;function c0(r,t=n0){let e=Object.create(null),i=Object.create(null),s=(o,a)=>{let l=i[o];if(l==null)i[o]=a;else if(l!=a)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},n=(o,a,l,h,c)=>{var u,d;let f=e[o]||(e[o]=Object.create(null)),p=a.split(/ (?!$)/).map(v=>o0(v,t));for(let v=1;v<p.length;v++){let S=p.slice(0,v).join(" ");s(S,!0),f[S]||(f[S]={preventDefault:!0,stopPropagation:!1,run:[w=>{let C=di={view:w,prefix:S,scope:o};return setTimeout(()=>{di==C&&(di=null)},h0),!0}]})}let m=p.join(" ");s(m,!1);let g=f[m]||(f[m]={preventDefault:!1,stopPropagation:!1,run:((d=(u=f._any)===null||u===void 0?void 0:u.run)===null||d===void 0?void 0:d.slice())||[]});l&&g.run.push(l),h&&(g.preventDefault=!0),c&&(g.stopPropagation=!0)};for(let o of r){let a=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let h of a){let c=e[h]||(e[h]=Object.create(null));c._any||(c._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:u}=o;for(let d in c)c[d].run.push(f=>u(f,ga))}let l=o[t]||o.key;if(l)for(let h of a)n(h,l,o.run,o.preventDefault,o.stopPropagation),o.shift&&n(h,"Shift-"+l,o.shift,o.preventDefault,o.stopPropagation)}return e}let ga=null;function eu(r,t,e,i){ga=t;let s=Cm(t),n=Xt(s,0),o=Ee(n)==s.length&&s!=" ",a="",l=!1,h=!1,c=!1;di&&di.view==e&&di.scope==i&&(a=di.prefix+" ",Ic.indexOf(t.keyCode)<0&&(h=!0,di=null));let u=new Set,d=g=>{if(g){for(let v of g.run)if(!u.has(v)&&(u.add(v),v(e)))return g.stopPropagation&&(c=!0),!0;g.preventDefault&&(g.stopPropagation&&(c=!0),h=!0)}return!1},f=r[i],p,m;return f&&(d(f[a+Ys(s,t,!o)])?l=!0:o&&(t.altKey||t.metaKey||t.ctrlKey)&&!(D.windows&&t.ctrlKey&&t.altKey)&&!(D.mac&&t.altKey&&!(t.ctrlKey||t.metaKey))&&(p=hi[t.keyCode])&&p!=s?(d(f[a+Ys(p,t,!0)])||t.shiftKey&&(m=Dr[t.keyCode])!=s&&m!=p&&d(f[a+Ys(m,t,!1)]))&&(l=!0):o&&t.shiftKey&&d(f[a+Ys(s,t,!0)])&&(l=!0),!l&&d(f._any)&&(l=!0)),h&&(l=!0),l&&c&&t.stopPropagation(),ga=null,l}class _r{constructor(t,e,i,s,n){this.className=t,this.left=e,this.top=i,this.width=s,this.height=n}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}update(t,e){return e.className!=this.className?!1:(this.adjust(t),!0)}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width!=null&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}static forRange(t,e,i){if(i.empty){let s=t.coordsAtPos(i.head,i.assoc||1);if(!s)return[];let n=iu(t);return[new _r(e,s.left-n.left,s.top-n.top,null,s.bottom-s.top)]}else return u0(t,e,i)}}function iu(r){let t=r.scrollDOM.getBoundingClientRect();return{left:(r.textDirection==X.LTR?t.left:t.right-r.scrollDOM.clientWidth*r.scaleX)-r.scrollDOM.scrollLeft*r.scaleX,top:t.top-r.scrollDOM.scrollTop*r.scaleY}}function ru(r,t,e,i){let s=r.coordsAtPos(t,e*2);if(!s)return i;let n=r.dom.getBoundingClientRect(),o=(s.top+s.bottom)/2,a=r.posAtCoords({x:n.left+1,y:o}),l=r.posAtCoords({x:n.right-1,y:o});return a==null||l==null?i:{from:Math.max(i.from,Math.min(a,l)),to:Math.min(i.to,Math.max(a,l))}}function u0(r,t,e){if(e.to<=r.viewport.from||e.from>=r.viewport.to)return[];let i=Math.max(e.from,r.viewport.from),s=Math.min(e.to,r.viewport.to),n=r.textDirection==X.LTR,o=r.contentDOM,a=o.getBoundingClientRect(),l=iu(r),h=o.querySelector(".cm-line"),c=h&&window.getComputedStyle(h),u=a.left+(c?parseInt(c.paddingLeft)+Math.min(0,parseInt(c.textIndent)):0),d=a.right-(c?parseInt(c.paddingRight):0),f=sa(r,i,1),p=sa(r,s,-1),m=f.type==Ct.Text?f:null,g=p.type==Ct.Text?p:null;if(m&&(r.lineWrapping||f.widgetLineBreaks)&&(m=ru(r,i,1,m)),g&&(r.lineWrapping||p.widgetLineBreaks)&&(g=ru(r,s,-1,g)),m&&g&&m.from==g.from&&m.to==g.to)return S(w(e.from,e.to,m));{let x=m?w(e.from,null,m):C(f,!1),k=g?w(null,e.to,g):C(p,!0),A=[];return(m||f).to<(g||p).from-(m&&g?1:0)||f.widgetLineBreaks>1&&x.bottom+r.defaultLineHeight/2<k.top?A.push(v(u,x.bottom,d,k.top)):x.bottom<k.top&&r.elementAtHeight((x.bottom+k.top)/2).type==Ct.Text&&(x.bottom=k.top=(x.bottom+k.top)/2),S(x).concat(A).concat(S(k))}function v(x,k,A,B){return new _r(t,x-l.left,k-l.top,Math.max(0,A-x),B-k)}function S({top:x,bottom:k,horizontal:A}){let B=[];for(let q=0;q<A.length;q+=2)B.push(v(A[q],x,A[q+1],k));return B}function w(x,k,A){let B=1e9,q=-1e9,_=[];function N(z,U,nt,xt,Yt){let lt=r.coordsAtPos(z,z==A.to?-2:2),se=r.coordsAtPos(nt,nt==A.from?2:-2);!lt||!se||(B=Math.min(lt.top,se.top,B),q=Math.max(lt.bottom,se.bottom,q),Yt==X.LTR?_.push(n&&U?u:lt.left,n&&xt?d:se.right):_.push(!n&&xt?u:se.left,!n&&U?d:lt.right))}let E=x??A.from,H=k??A.to;for(let z of r.visibleRanges)if(z.to>E&&z.from<H)for(let U=Math.max(z.from,E),nt=Math.min(z.to,H);;){let xt=r.state.doc.lineAt(U);for(let Yt of r.bidiSpans(xt)){let lt=Yt.from+xt.from,se=Yt.to+xt.from;if(lt>=nt)break;se>U&&N(Math.max(lt,U),x==null&&lt<=E,Math.min(se,nt),k==null&&se>=H,Yt.dir)}if(U=xt.to+1,U>=nt)break}return _.length==0&&N(E,x==null,H,k==null,r.textDirection),{top:B,bottom:q,horizontal:_}}function C(x,k){let A=a.top+(k?x.top:x.bottom);return{top:A,bottom:A,horizontal:[]}}}function d0(r,t){return r.constructor==t.constructor&&r.eq(t)}class f0{constructor(t,e){this.view=t,this.layer=e,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=t.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),e.above&&this.dom.classList.add("cm-layer-above"),e.class&&this.dom.classList.add(e.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(t.state),t.requestMeasure(this.measureReq),e.mount&&e.mount(this.dom,t)}update(t){t.startState.facet(Js)!=t.state.facet(Js)&&this.setOrder(t.state),(this.layer.update(t,this.dom)||t.geometryChanged)&&(this.scale(),t.view.requestMeasure(this.measureReq))}docViewUpdate(t){this.layer.updateOnDocViewUpdate!==!1&&t.requestMeasure(this.measureReq)}setOrder(t){let e=0,i=t.facet(Js);for(;e<i.length&&i[e]!=this.layer;)e++;this.dom.style.zIndex=String((this.layer.above?150:-1)-e)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:t,scaleY:e}=this.view;(t!=this.scaleX||e!=this.scaleY)&&(this.scaleX=t,this.scaleY=e,this.dom.style.transform=`scale(${1/t}, ${1/e})`)}draw(t){if(t.length!=this.drawn.length||t.some((e,i)=>!d0(e,this.drawn[i]))){let e=this.dom.firstChild,i=0;for(let s of t)s.update&&e&&s.constructor&&this.drawn[i].constructor&&s.update(e,this.drawn[i])?(e=e.nextSibling,i++):this.dom.insertBefore(s.draw(),e);for(;e;){let s=e.nextSibling;e.remove(),e=s}this.drawn=t,D.safari&&D.safari_version>=26&&(this.dom.style.display=this.dom.firstChild?"":"none")}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const Js=O.define();function su(r){return[ut.define(t=>new f0(t,r)),Js.of(r)]}const Hr=O.define({combine(r){return be(r,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})}});function p0(r={}){return[Hr.of(r),m0,g0,v0,rc.of(!0)]}function nu(r){return r.startState.facet(Hr)!=r.state.facet(Hr)}const m0=su({above:!0,markers(r){let{state:t}=r,e=t.facet(Hr),i=[];for(let s of t.selection.ranges){let n=s==t.selection.main;if(s.empty||e.drawRangeCursor){let o=n?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",a=s.empty?s:b.cursor(s.head,s.head>s.anchor?-1:1);for(let l of _r.forRange(r,o,a))i.push(l)}}return i},update(r,t){r.transactions.some(i=>i.selection)&&(t.style.animationName=t.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let e=nu(r);return e&&ou(r.state,t),r.docChanged||r.selectionSet||e},mount(r,t){ou(t.state,r)},class:"cm-cursorLayer"});function ou(r,t){t.style.animationDuration=r.facet(Hr).cursorBlinkRate+"ms"}const g0=su({above:!1,markers(r){return r.state.selection.ranges.map(t=>t.empty?[]:_r.forRange(r,"cm-selectionBackground",t)).reduce((t,e)=>t.concat(e))},update(r,t){return r.docChanged||r.selectionSet||r.viewportChanged||nu(r)},class:"cm-selectionLayer"}),v0=Ti.highest(T.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}})),au=F.define({map(r,t){return r==null?null:t.mapPos(r)}}),zr=gt.define({create(){return null},update(r,t){return r!=null&&(r=t.changes.mapPos(r)),t.effects.reduce((e,i)=>i.is(au)?i.value:e,r)}}),y0=ut.fromClass(class{constructor(r){this.view=r,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(r){var t;let e=r.state.field(zr);e==null?this.cursor!=null&&((t=this.cursor)===null||t===void 0||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(r.startState.field(zr)!=e||r.docChanged||r.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:r}=this,t=r.state.field(zr),e=t!=null&&r.coordsAtPos(t);if(!e)return null;let i=r.scrollDOM.getBoundingClientRect();return{left:e.left-i.left+r.scrollDOM.scrollLeft*r.scaleX,top:e.top-i.top+r.scrollDOM.scrollTop*r.scaleY,height:e.bottom-e.top}}drawCursor(r){if(this.cursor){let{scaleX:t,scaleY:e}=this.view;r?(this.cursor.style.left=r.left/t+"px",this.cursor.style.top=r.top/e+"px",this.cursor.style.height=r.height/e+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(r){this.view.state.field(zr)!=r&&this.view.dispatch({effects:au.of(r)})}},{eventObservers:{dragover(r){this.setDropPos(this.view.posAtCoords({x:r.clientX,y:r.clientY}))},dragleave(r){(r.target==this.view.contentDOM||!this.view.contentDOM.contains(r.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function w0(){return[zr,y0]}function lu(r,t,e,i,s){t.lastIndex=0;for(let n=r.iterRange(e,i),o=e,a;!n.next().done;o+=n.value.length)if(!n.lineBreak)for(;a=t.exec(n.value);)s(o+a.index,a)}function x0(r,t){let e=r.visibleRanges;if(e.length==1&&e[0].from==r.viewport.from&&e[0].to==r.viewport.to)return e;let i=[];for(let{from:s,to:n}of e)s=Math.max(r.state.doc.lineAt(s).from,s-t),n=Math.min(r.state.doc.lineAt(n).to,n+t),i.length&&i[i.length-1].to>=s?i[i.length-1].to=n:i.push({from:s,to:n});return i}class b0{constructor(t){const{regexp:e,decoration:i,decorate:s,boundary:n,maxLength:o=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=e,s)this.addMatch=(a,l,h,c)=>s(c,h,h+a[0].length,a,l);else if(typeof i=="function")this.addMatch=(a,l,h,c)=>{let u=i(a,l,h);u&&c(h,h+a[0].length,u)};else if(i)this.addMatch=(a,l,h,c)=>c(h,h+a[0].length,i);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=n,this.maxLength=o}createDeco(t){let e=new Ye,i=e.add.bind(e);for(let{from:s,to:n}of x0(t,this.maxLength))lu(t.state.doc,this.regexp,s,n,(o,a)=>this.addMatch(a,t,o,i));return e.finish()}updateDeco(t,e){let i=1e9,s=-1;return t.docChanged&&t.changes.iterChanges((n,o,a,l)=>{l>=t.view.viewport.from&&a<=t.view.viewport.to&&(i=Math.min(a,i),s=Math.max(l,s))}),t.viewportMoved||s-i>1e3?this.createDeco(t.view):s>-1?this.updateRange(t.view,e.map(t.changes),i,s):e}updateRange(t,e,i,s){for(let n of t.visibleRanges){let o=Math.max(n.from,i),a=Math.min(n.to,s);if(a>=o){let l=t.state.doc.lineAt(o),h=l.to<a?t.state.doc.lineAt(a):l,c=Math.max(n.from,l.from),u=Math.min(n.to,h.to);if(this.boundary){for(;o>l.from;o--)if(this.boundary.test(l.text[o-1-l.from])){c=o;break}for(;a<h.to;a++)if(this.boundary.test(h.text[a-h.from])){u=a;break}}let d=[],f,p=(m,g,v)=>d.push(v.range(m,g));if(l==h)for(this.regexp.lastIndex=c-l.from;(f=this.regexp.exec(l.text))&&f.index<u-l.from;)this.addMatch(f,t,f.index+l.from,p);else lu(t.state.doc,this.regexp,c,u,(m,g)=>this.addMatch(g,t,m,p));e=e.update({filterFrom:c,filterTo:u,filter:(m,g)=>m<c||g>u,add:d})}}return e}}const va=/x/.unicode!=null?"gu":"g",S0=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\u2066\u2067\u2069\uFEFF\uFFF9-\uFFFC]`,va),k0={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let ya=null;function A0(){var r;if(ya==null&&typeof document<"u"&&document.body){let t=document.body.style;ya=((r=t.tabSize)!==null&&r!==void 0?r:t.MozTabSize)!=null}return ya||!1}const Qs=O.define({combine(r){let t=be(r,{render:null,specialChars:S0,addSpecialChars:null});return(t.replaceTabs=!A0())&&(t.specialChars=new RegExp("	|"+t.specialChars.source,va)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,va)),t}});function C0(r={}){return[Qs.of(r),I0()]}let hu=null;function I0(){return hu||(hu=ut.fromClass(class{constructor(r){this.view=r,this.decorations=L.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(r.state.facet(Qs)),this.decorations=this.decorator.createDeco(r)}makeDecorator(r){return new b0({regexp:r.specialChars,decoration:(t,e,i)=>{let{doc:s}=e.state,n=Xt(t[0],0);if(n==9){let o=s.lineAt(i),a=e.state.tabSize,l=Zi(o.text,a,i-o.from);return L.replace({widget:new T0((a-l%a)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[n]||(this.decorationCache[n]=L.replace({widget:new D0(r,n)}))},boundary:r.replaceTabs?void 0:/[^]/})}update(r){let t=r.state.facet(Qs);r.startState.facet(Qs)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(r.view)):this.decorations=this.decorator.updateDeco(r,this.decorations)}},{decorations:r=>r.decorations}))}const M0="\u2022";function O0(r){return r>=32?M0:r==10?"\u2424":String.fromCharCode(9216+r)}class D0 extends Xe{constructor(t,e){super(),this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){let e=O0(this.code),i=t.state.phrase("Control character")+" "+(k0[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,i,e);if(s)return s;let n=document.createElement("span");return n.textContent=e,n.title=i,n.setAttribute("aria-label",i),n.className="cm-specialChar",n}ignoreEvent(){return!1}}class T0 extends Xe{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="	",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}function R0(){return P0}const E0=L.line({class:"cm-activeLine"}),P0=ut.fromClass(class{constructor(r){this.decorations=this.getDeco(r)}update(r){(r.docChanged||r.selectionSet)&&(this.decorations=this.getDeco(r.view))}getDeco(r){let t=-1,e=[];for(let i of r.state.selection.ranges){let s=r.lineBlockAt(i.head);s.from>t&&(e.push(E0.range(s.from)),t=s.from)}return L.set(e)}},{decorations:r=>r.decorations}),wa=2e3;function L0(r,t,e){let i=Math.min(t.line,e.line),s=Math.max(t.line,e.line),n=[];if(t.off>wa||e.off>wa||t.col<0||e.col<0){let o=Math.min(t.off,e.off),a=Math.max(t.off,e.off);for(let l=i;l<=s;l++){let h=r.doc.line(l);h.length<=a&&n.push(b.range(h.from+o,h.to+a))}}else{let o=Math.min(t.col,e.col),a=Math.max(t.col,e.col);for(let l=i;l<=s;l++){let h=r.doc.line(l),c=Ro(h.text,o,r.tabSize,!0);if(c<0)n.push(b.cursor(h.to));else{let u=Ro(h.text,a,r.tabSize);n.push(b.range(h.from+c,h.from+u))}}}return n}function N0(r,t){let e=r.coordsAtPos(r.viewport.from);return e?Math.round(Math.abs((e.left-t)/r.defaultCharacterWidth)):-1}function cu(r,t){let e=r.posAtCoords({x:t.clientX,y:t.clientY},!1),i=r.state.doc.lineAt(e),s=e-i.from,n=s>wa?-1:s==i.length?N0(r,t.clientX):Zi(i.text,r.state.tabSize,e-i.from);return{line:i.number,col:n,off:s}}function B0(r,t){let e=cu(r,t),i=r.state.selection;return e?{update(s){if(s.docChanged){let n=s.changes.mapPos(s.startState.doc.line(e.line).from),o=s.state.doc.lineAt(n);e={line:o.number,col:e.col,off:Math.min(e.off,o.length)},i=i.map(s.changes)}},get(s,n,o){let a=cu(r,s);if(!a)return i;let l=L0(r.state,e,a);return l.length?o?b.create(l.concat(i.ranges)):b.create(l):i}}:null}function F0(r){let t=e=>e.altKey&&e.button==0;return T.mouseSelectionStyle.of((e,i)=>t(i)?B0(e,i):null)}const V0={Alt:[18,r=>!!r.altKey],Control:[17,r=>!!r.ctrlKey],Shift:[16,r=>!!r.shiftKey],Meta:[91,r=>!!r.metaKey]},q0={style:"cursor: crosshair"};function W0(r={}){let[t,e]=V0[r.key||"Alt"],i=ut.fromClass(class{constructor(s){this.view=s,this.isDown=!1}set(s){this.isDown!=s&&(this.isDown=s,this.view.update([]))}},{eventObservers:{keydown(s){this.set(s.keyCode==t||e(s))},keyup(s){(s.keyCode==t||!e(s))&&this.set(!1)},mousemove(s){this.set(e(s))}}});return[i,T.contentAttributes.of(s=>{var n;return!((n=s.plugin(i))===null||n===void 0)&&n.isDown?q0:null})]}const Zs="-10000px";class uu{constructor(t,e,i,s){this.facet=e,this.createTooltipView=i,this.removeTooltipView=s,this.input=t.state.facet(e),this.tooltips=this.input.filter(o=>o);let n=null;this.tooltipViews=this.tooltips.map(o=>n=i(o,n))}update(t,e){var i;let s=t.state.facet(this.facet),n=s.filter(l=>l);if(s===this.input){for(let l of this.tooltipViews)l.update&&l.update(t);return!1}let o=[],a=e?[]:null;for(let l=0;l<n.length;l++){let h=n[l],c=-1;if(h){for(let u=0;u<this.tooltips.length;u++){let d=this.tooltips[u];d&&d.create==h.create&&(c=u)}if(c<0)o[l]=this.createTooltipView(h,l?o[l-1]:null),a&&(a[l]=!!h.above);else{let u=o[l]=this.tooltipViews[c];a&&(a[l]=e[c]),u.update&&u.update(t)}}}for(let l of this.tooltipViews)o.indexOf(l)<0&&(this.removeTooltipView(l),(i=l.destroy)===null||i===void 0||i.call(l));return e&&(a.forEach((l,h)=>e[h]=l),e.length=a.length),this.input=s,this.tooltips=n,this.tooltipViews=o,!0}}function _0(r){let t=r.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:t.clientHeight,right:t.clientWidth}}const xa=O.define({combine:r=>{var t,e,i;return{position:D.ios?"absolute":((t=r.find(s=>s.position))===null||t===void 0?void 0:t.position)||"fixed",parent:((e=r.find(s=>s.parent))===null||e===void 0?void 0:e.parent)||null,tooltipSpace:((i=r.find(s=>s.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||_0}}}),du=new WeakMap,ba=ut.fromClass(class{constructor(r){this.view=r,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=r.state.facet(xa);this.position=t.position,this.parent=t.parent,this.classes=r.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new uu(r,tn,(e,i)=>this.createTooltip(e,i),e=>{this.resizeObserver&&this.resizeObserver.unobserve(e.dom),e.dom.remove()}),this.above=this.manager.tooltips.map(e=>!!e.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),r.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let r of this.manager.tooltipViews)this.intersectionObserver.observe(r.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(r){r.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(r,this.above);t&&this.observeIntersection();let e=t||r.geometryChanged,i=r.state.facet(xa);if(i.position!=this.position&&!this.madeAbsolute){this.position=i.position;for(let s of this.manager.tooltipViews)s.dom.style.position=this.position;e=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let s of this.manager.tooltipViews)this.container.appendChild(s.dom);e=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);e&&this.maybeMeasure()}createTooltip(r,t){let e=r.create(this.view),i=t?t.dom:null;if(e.dom.classList.add("cm-tooltip"),r.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let s=document.createElement("div");s.className="cm-tooltip-arrow",e.dom.appendChild(s)}return e.dom.style.position=this.position,e.dom.style.top=Zs,e.dom.style.left="0px",this.container.insertBefore(e.dom,i),e.mount&&e.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(e.dom),e}destroy(){var r,t,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let i of this.manager.tooltipViews)i.dom.remove(),(r=i.destroy)===null||r===void 0||r.call(i);this.parent&&this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let r=1,t=1,e=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:n}=this.manager.tooltipViews[0];if(D.safari){let o=n.getBoundingClientRect();e=Math.abs(o.top+1e4)>1||Math.abs(o.left)>1}else e=!!n.offsetParent&&n.offsetParent!=this.container.ownerDocument.body}if(e||this.position=="absolute")if(this.parent){let n=this.parent.getBoundingClientRect();n.width&&n.height&&(r=n.width/this.parent.offsetWidth,t=n.height/this.parent.offsetHeight)}else({scaleX:r,scaleY:t}=this.view.viewState);let i=this.view.scrollDOM.getBoundingClientRect(),s=Zo(this.view);return{visible:{left:i.left+s.left,top:i.top+s.top,right:i.right-s.right,bottom:i.bottom-s.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((n,o)=>{let a=this.manager.tooltipViews[o];return a.getCoords?a.getCoords(n.pos):this.view.coordsAtPos(n.pos)}),size:this.manager.tooltipViews.map(({dom:n})=>n.getBoundingClientRect()),space:this.view.state.facet(xa).tooltipSpace(this.view),scaleX:r,scaleY:t,makeAbsolute:e}}writeMeasure(r){var t;if(r.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let a of this.manager.tooltipViews)a.dom.style.position="absolute"}let{visible:e,space:i,scaleX:s,scaleY:n}=r,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],h=this.manager.tooltipViews[a],{dom:c}=h,u=r.pos[a],d=r.size[a];if(!u||l.clip!==!1&&(u.bottom<=Math.max(e.top,i.top)||u.top>=Math.min(e.bottom,i.bottom)||u.right<Math.max(e.left,i.left)-.1||u.left>Math.min(e.right,i.right)+.1)){c.style.top=Zs;continue}let f=l.arrow?h.dom.querySelector(".cm-tooltip-arrow"):null,p=f?7:0,m=d.right-d.left,g=(t=du.get(h))!==null&&t!==void 0?t:d.bottom-d.top,v=h.offset||z0,S=this.view.textDirection==X.LTR,w=d.width>i.right-i.left?S?i.left:i.right-d.width:S?Math.max(i.left,Math.min(u.left-(f?14:0)+v.x,i.right-m)):Math.min(Math.max(i.left,u.left-m+(f?14:0)-v.x),i.right-m),C=this.above[a];!l.strictSide&&(C?u.top-g-p-v.y<i.top:u.bottom+g+p+v.y>i.bottom)&&C==i.bottom-u.bottom>u.top-i.top&&(C=this.above[a]=!C);let x=(C?u.top-i.top:i.bottom-u.bottom)-p;if(x<g&&h.resize!==!1){if(x<this.view.defaultLineHeight){c.style.top=Zs;continue}du.set(h,g),c.style.height=(g=x)/n+"px"}else c.style.height&&(c.style.height="");let k=C?u.top-g-p-v.y:u.bottom+p+v.y,A=w+m;if(h.overlap!==!0)for(let B of o)B.left<A&&B.right>w&&B.top<k+g&&B.bottom>k&&(k=C?B.top-g-2-p:B.bottom+p+2);if(this.position=="absolute"?(c.style.top=(k-r.parent.top)/n+"px",fu(c,(w-r.parent.left)/s)):(c.style.top=k/n+"px",fu(c,w/s)),f){let B=u.left+(S?v.x:-v.x)-(w+14-7);f.style.left=B/s+"px"}h.overlap!==!0&&o.push({left:w,top:k,right:A,bottom:k+g}),c.classList.toggle("cm-tooltip-above",C),c.classList.toggle("cm-tooltip-below",!C),h.positioned&&h.positioned(r.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let r of this.manager.tooltipViews)r.dom.style.top=Zs}},{eventObservers:{scroll(){this.maybeMeasure()}}});function fu(r,t){let e=parseInt(r.style.left,10);(isNaN(e)||Math.abs(t-e)>1)&&(r.style.left=t+"px")}const H0=T.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),z0={x:0,y:0},tn=O.define({enables:[ba,H0]}),en=O.define({combine:r=>r.reduce((t,e)=>t.concat(e),[])});class rn{static create(t){return new rn(t)}constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new uu(t,en,(e,i)=>this.createHostedView(e,i),e=>e.dom.remove())}createHostedView(t,e){let i=t.create(this.view);return i.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(i.dom,e?e.dom.nextSibling:this.dom.firstChild),this.mounted&&i.mount&&i.mount(this.view),i}mount(t){for(let e of this.manager.tooltipViews)e.mount&&e.mount(t);this.mounted=!0}positioned(t){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned(t)}update(t){this.manager.update(t)}destroy(){var t;for(let e of this.manager.tooltipViews)(t=e.destroy)===null||t===void 0||t.call(e)}passProp(t){let e;for(let i of this.manager.tooltipViews){let s=i[t];if(s!==void 0){if(e===void 0)e=s;else if(e!==s)return}}return e}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const j0=tn.compute([en],r=>{let t=r.facet(en);return t.length===0?null:{pos:Math.min(...t.map(e=>e.pos)),end:Math.max(...t.map(e=>{var i;return(i=e.end)!==null&&i!==void 0?i:e.pos})),create:rn.create,above:t[0].above,arrow:t.some(e=>e.arrow)}});class $0{constructor(t,e,i,s,n){this.view=t,this.source=e,this.field=i,this.setHover=s,this.hoverTime=n,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:t,lastMove:e}=this,i=t.docView.tile.nearest(e.target);if(!i)return;let s,n=1;if(i.isWidget())s=i.posAtStart;else{if(s=t.posAtCoords(e),s==null)return;let a=t.coordsAtPos(s);if(!a||e.y<a.top||e.y>a.bottom||e.x<a.left-t.defaultCharacterWidth||e.x>a.right+t.defaultCharacterWidth)return;let l=t.bidiSpans(t.state.doc.lineAt(s)).find(c=>c.from<=s&&c.to>=s),h=l&&l.dir==X.RTL?-1:1;n=e.x<a.left?-h:h}let o=this.source(t,s,n);if(o!=null&&o.then){let a=this.pending={pos:s};o.then(l=>{this.pending==a&&(this.pending=null,l&&!(Array.isArray(l)&&!l.length)&&t.dispatch({effects:this.setHover.of(Array.isArray(l)?l:[l])}))},l=>Jt(t.state,l,"hover tooltip"))}else o&&!(Array.isArray(o)&&!o.length)&&t.dispatch({effects:this.setHover.of(Array.isArray(o)?o:[o])})}get tooltip(){let t=this.view.plugin(ba),e=t?t.manager.tooltips.findIndex(i=>i.create==rn.create):-1;return e>-1?t.manager.tooltipViews[e]:null}mousemove(t){var e,i;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:s,tooltip:n}=this;if(s.length&&n&&!G0(n.dom,t)||this.pending){let{pos:o}=s[0]||this.pending,a=(i=(e=s[0])===null||e===void 0?void 0:e.end)!==null&&i!==void 0?i:o;(o==a?this.view.posAtCoords(this.lastMove)!=o:!U0(this.view,o,a,t.clientX,t.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(t){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:e}=this;if(e.length){let{tooltip:i}=this;i&&i.dom.contains(t.relatedTarget)?this.watchTooltipLeave(i.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(t){let e=i=>{t.removeEventListener("mouseleave",e),this.active.length&&!this.view.dom.contains(i.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};t.addEventListener("mouseleave",e)}destroy(){clearTimeout(this.hoverTimeout),clearTimeout(this.restartTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const sn=4;function G0(r,t){let{left:e,right:i,top:s,bottom:n}=r.getBoundingClientRect(),o;if(o=r.querySelector(".cm-tooltip-arrow")){let a=o.getBoundingClientRect();s=Math.min(a.top,s),n=Math.max(a.bottom,n)}return t.clientX>=e-sn&&t.clientX<=i+sn&&t.clientY>=s-sn&&t.clientY<=n+sn}function U0(r,t,e,i,s,n){let o=r.scrollDOM.getBoundingClientRect(),a=r.documentTop+r.documentPadding.top+r.contentHeight;if(o.left>i||o.right<i||o.top>s||Math.min(o.bottom,a)<s)return!1;let l=r.posAtCoords({x:i,y:s},!1);return l>=t&&l<=e}function pu(r,t={}){let e=F.define(),i=gt.define({create(){return[]},update(s,n){if(s.length&&(t.hideOnChange&&(n.docChanged||n.selection)?s=[]:t.hideOn&&(s=s.filter(o=>!t.hideOn(n,o))),n.docChanged)){let o=[];for(let a of s){let l=n.changes.mapPos(a.pos,-1,Wt.TrackDel);if(l!=null){let h=Object.assign(Object.create(null),a);h.pos=l,h.end!=null&&(h.end=n.changes.mapPos(h.end)),o.push(h)}}s=o}for(let o of n.effects)o.is(e)&&(s=o.value),o.is(K0)&&(s=[]);return s},provide:s=>en.from(s)});return{active:i,extension:[i,ut.define(s=>new $0(s,r,i,e,t.hoverTime||300)),j0]}}function mu(r,t){let e=r.plugin(ba);if(!e)return null;let i=e.manager.tooltips.indexOf(t);return i<0?null:e.manager.tooltipViews[i]}const K0=F.define(),gu=O.define({combine(r){let t,e;for(let i of r)t=t||i.topContainer,e=e||i.bottomContainer;return{topContainer:t,bottomContainer:e}}});function Sa(r,t){let e=r.plugin(vu),i=e?e.specs.indexOf(t):-1;return i>-1?e.panels[i]:null}const vu=ut.fromClass(class{constructor(r){this.input=r.state.facet(jr),this.specs=this.input.filter(e=>e),this.panels=this.specs.map(e=>e(r));let t=r.state.facet(gu);this.top=new nn(r,!0,t.topContainer),this.bottom=new nn(r,!1,t.bottomContainer),this.top.sync(this.panels.filter(e=>e.top)),this.bottom.sync(this.panels.filter(e=>!e.top));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(r){let t=r.state.facet(gu);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new nn(r.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new nn(r.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let e=r.state.facet(jr);if(e!=this.input){let i=e.filter(l=>l),s=[],n=[],o=[],a=[];for(let l of i){let h=this.specs.indexOf(l),c;h<0?(c=l(r.view),a.push(c)):(c=this.panels[h],c.update&&c.update(r)),s.push(c),(c.top?n:o).push(c)}this.specs=i,this.panels=s,this.top.sync(n),this.bottom.sync(o);for(let l of a)l.dom.classList.add("cm-panel"),l.mount&&l.mount()}else for(let i of this.panels)i.update&&i.update(r)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:r=>T.scrollMargins.of(t=>{let e=t.plugin(r);return e&&{top:e.top.scrollMargin(),bottom:e.bottom.scrollMargin()}})});class nn{constructor(t,e,i){this.view=t,this.top=e,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let t=this.dom.firstChild;for(let e of this.panels)if(e.dom.parentNode==this.dom){for(;t!=e.dom;)t=yu(t);t=t.nextSibling}else this.dom.insertBefore(e.dom,t);for(;t;)t=yu(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function yu(r){let t=r.nextSibling;return r.remove(),t}const jr=O.define({enables:vu});function Y0(r,t){let e,i=new Promise(o=>e=o),s=o=>X0(o,t,e);r.state.field(ka,!1)?r.dispatch({effects:wu.of(s)}):r.dispatch({effects:F.appendConfig.of(ka.init(()=>[s]))});let n=xu.of(s);return{close:n,result:i.then(o=>((r.win.queueMicrotask||(a=>r.win.setTimeout(a,10)))(()=>{r.state.field(ka).indexOf(s)>-1&&r.dispatch({effects:n})}),o))}}const ka=gt.define({create(){return[]},update(r,t){for(let e of t.effects)e.is(wu)?r=[e.value].concat(r):e.is(xu)&&(r=r.filter(i=>i!=e.value));return r},provide:r=>jr.computeN([r],t=>t.field(r))}),wu=F.define(),xu=F.define();function X0(r,t,e){let i=t.content?t.content(r,()=>o(null)):null;if(!i){if(i=Y("form"),t.input){let a=Y("input",t.input);/^(text|password|number|email|tel|url)$/.test(a.type)&&a.classList.add("cm-textfield"),a.name||(a.name="input"),i.appendChild(Y("label",(t.label||"")+": ",a))}else i.appendChild(document.createTextNode(t.label||""));i.appendChild(document.createTextNode(" ")),i.appendChild(Y("button",{class:"cm-button",type:"submit"},t.submitLabel||"OK"))}let s=i.nodeName=="FORM"?[i]:i.querySelectorAll("form");for(let a=0;a<s.length;a++){let l=s[a];l.addEventListener("keydown",h=>{h.keyCode==27?(h.preventDefault(),o(null)):h.keyCode==13&&(h.preventDefault(),o(l))}),l.addEventListener("submit",h=>{h.preventDefault(),o(l)})}let n=Y("div",i,Y("button",{onclick:()=>o(null),"aria-label":r.state.phrase("close"),class:"cm-dialog-close",type:"button"},["\xD7"]));t.class&&(n.className=t.class),n.classList.add("cm-dialog");function o(a){n.contains(n.ownerDocument.activeElement)&&r.focus(),e(a)}return{dom:n,top:t.top,mount:()=>{if(t.focus){let a;typeof t.focus=="string"?a=i.querySelector(t.focus):a=i.querySelector("input")||i.querySelector("button"),a&&"select"in a?a.select():a&&"focus"in a&&a.focus()}}}}class Be extends ai{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}Be.prototype.elementClass="",Be.prototype.toDOM=void 0,Be.prototype.mapMode=Wt.TrackBefore,Be.prototype.startSide=Be.prototype.endSide=-1,Be.prototype.point=!0;const on=O.define(),J0=O.define(),Q0={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>W.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},$r=O.define();function bu(r){return[ku(),$r.of({...Q0,...r})]}const Su=O.define({combine:r=>r.some(t=>t)});function ku(r){return[Z0]}const Z0=ut.fromClass(class{constructor(r){this.view=r,this.domAfter=null,this.prevViewport=r.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=r.state.facet($r).map(t=>new Cu(r,t)),this.fixed=!r.state.facet(Su);for(let t of this.gutters)t.config.side=="after"?this.getDOMAfter().appendChild(t.dom):this.dom.appendChild(t.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),r.scrollDOM.insertBefore(this.dom,r.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(r){if(this.updateGutters(r)){let t=this.prevViewport,e=r.view.viewport,i=Math.min(t.to,e.to)-Math.max(t.from,e.from);this.syncGutters(i<(e.to-e.from)*.8)}if(r.geometryChanged){let t=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=t,this.domAfter&&(this.domAfter.style.minHeight=t)}this.view.state.facet(Su)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=r.view.viewport}syncGutters(r){let t=this.dom.nextSibling;r&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let e=W.iter(this.view.state.facet(on),this.view.viewport.from),i=[],s=this.gutters.map(n=>new t1(n,this.view.viewport,-this.view.documentPadding.top));for(let n of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(n.type)){let o=!0;for(let a of n.type)if(a.type==Ct.Text&&o){Aa(e,i,a.from);for(let l of s)l.line(this.view,a,i);o=!1}else if(a.widget)for(let l of s)l.widget(this.view,a)}else if(n.type==Ct.Text){Aa(e,i,n.from);for(let o of s)o.line(this.view,n,i)}else if(n.widget)for(let o of s)o.widget(this.view,n);for(let n of s)n.finish();r&&(this.view.scrollDOM.insertBefore(this.dom,t),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(r){let t=r.startState.facet($r),e=r.state.facet($r),i=r.docChanged||r.heightChanged||r.viewportChanged||!W.eq(r.startState.facet(on),r.state.facet(on),r.view.viewport.from,r.view.viewport.to);if(t==e)for(let s of this.gutters)s.update(r)&&(i=!0);else{i=!0;let s=[];for(let n of e){let o=t.indexOf(n);o<0?s.push(new Cu(this.view,n)):(this.gutters[o].update(r),s.push(this.gutters[o]))}for(let n of this.gutters)n.dom.remove(),s.indexOf(n)<0&&n.destroy();for(let n of s)n.config.side=="after"?this.getDOMAfter().appendChild(n.dom):this.dom.appendChild(n.dom);this.gutters=s}return i}destroy(){for(let r of this.gutters)r.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:r=>T.scrollMargins.of(t=>{let e=t.plugin(r);if(!e||e.gutters.length==0||!e.fixed)return null;let i=e.dom.offsetWidth*t.scaleX,s=e.domAfter?e.domAfter.offsetWidth*t.scaleX:0;return t.textDirection==X.LTR?{left:i,right:s}:{right:i,left:s}})});function Au(r){return Array.isArray(r)?r:[r]}function Aa(r,t,e){for(;r.value&&r.from<=e;)r.from==e&&t.push(r.value),r.next()}class t1{constructor(t,e,i){this.gutter=t,this.height=i,this.i=0,this.cursor=W.iter(t.markers,e.from)}addElement(t,e,i){let{gutter:s}=this,n=(e.top-this.height)/t.scaleY,o=e.height/t.scaleY;if(this.i==s.elements.length){let a=new Iu(t,o,n,i);s.elements.push(a),s.dom.appendChild(a.dom)}else s.elements[this.i].update(t,o,n,i);this.height=e.bottom,this.i++}line(t,e,i){let s=[];Aa(this.cursor,s,e.from),i.length&&(s=s.concat(i));let n=this.gutter.config.lineMarker(t,e,s);n&&s.unshift(n);let o=this.gutter;s.length==0&&!o.config.renderEmptyElements||this.addElement(t,e,s)}widget(t,e){let i=this.gutter.config.widgetMarker(t,e.widget,e),s=i?[i]:null;for(let n of t.state.facet(J0)){let o=n(t,e.widget,e);o&&(s||(s=[])).push(o)}s&&this.addElement(t,e,s)}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class Cu{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in e.domEventHandlers)this.dom.addEventListener(i,s=>{let n=s.target,o;if(n!=this.dom&&this.dom.contains(n)){for(;n.parentNode!=this.dom;)n=n.parentNode;let l=n.getBoundingClientRect();o=(l.top+l.bottom)/2}else o=s.clientY;let a=t.lineBlockAtHeight(o-t.documentTop);e.domEventHandlers[i](t,a,s)&&s.preventDefault()});this.markers=Au(e.markers(t)),e.initialSpacer&&(this.spacer=new Iu(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=Au(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],t);s!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[s])}let i=t.view.viewport;return!W.eq(this.markers,e,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):!1)}destroy(){for(let t of this.elements)t.destroy()}}class Iu{constructor(t,e,i,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,e,i,s)}update(t,e,i,s){this.height!=e&&(this.height=e,this.dom.style.height=e+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),e1(this.markers,s)||this.setMarkers(t,s)}setMarkers(t,e){let i="cm-gutterElement",s=this.dom.firstChild;for(let n=0,o=0;;){let a=o,l=n<e.length?e[n++]:null,h=!1;if(l){let c=l.elementClass;c&&(i+=" "+c);for(let u=o;u<this.markers.length;u++)if(this.markers[u].compare(l)){a=u,h=!0;break}}else a=this.markers.length;for(;o<a;){let c=this.markers[o++];if(c.toDOM){c.destroy(s);let u=s.nextSibling;s.remove(),s=u}}if(!l)break;l.toDOM&&(h?s=s.nextSibling:this.dom.insertBefore(l.toDOM(t),s)),h&&o++}this.dom.className=i,this.markers=e}destroy(){this.setMarkers(null,[])}}function e1(r,t){if(r.length!=t.length)return!1;for(let e=0;e<r.length;e++)if(!r[e].compare(t[e]))return!1;return!0}const i1=O.define(),r1=O.define(),lr=O.define({combine(r){return be(r,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){let i=Object.assign({},t);for(let s in e){let n=i[s],o=e[s];i[s]=n?(a,l,h)=>n(a,l,h)||o(a,l,h):o}return i}})}});class Ca extends Be{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function Ia(r,t){return r.state.facet(lr).formatNumber(t,r.state)}const s1=$r.compute([lr],r=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(t){return t.state.facet(i1)},lineMarker(t,e,i){return i.some(s=>s.toDOM)?null:new Ca(Ia(t,t.state.doc.lineAt(e.from).number))},widgetMarker:(t,e,i)=>{for(let s of t.state.facet(r1)){let n=s(t,e,i);if(n)return n}return null},lineMarkerChange:t=>t.startState.facet(lr)!=t.state.facet(lr),initialSpacer(t){return new Ca(Ia(t,Mu(t.state.doc.lines)))},updateSpacer(t,e){let i=Ia(e.view,Mu(e.view.state.doc.lines));return i==t.number?t:new Ca(i)},domEventHandlers:r.facet(lr).domEventHandlers,side:"before"}));function n1(r={}){return[lr.of(r),ku(),s1]}function Mu(r){let t=9;for(;t<r;)t=t*10+9;return t}const o1=new class extends Be{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},a1=on.compute(["selection"],r=>{let t=[],e=-1;for(let i of r.selection.ranges){let s=r.doc.lineAt(i.head).from;s>e&&(e=s,t.push(o1.range(s)))}return W.of(t)});function l1(){return a1}const h1=1024;let c1=0,Ma=class{constructor(r,t){this.from=r,this.to=t}};class j{constructor(t={}){this.id=c1++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=t.combine||null}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=de.match(t)),e=>{let i=t(e);return i===void 0?null:[this,i]}}}j.closedBy=new j({deserialize:r=>r.split(" ")}),j.openedBy=new j({deserialize:r=>r.split(" ")}),j.group=new j({deserialize:r=>r.split(" ")}),j.isolate=new j({deserialize:r=>{if(r&&r!="rtl"&&r!="ltr"&&r!="auto")throw new RangeError("Invalid value for isolate: "+r);return r||"auto"}}),j.contextHash=new j({perNode:!0}),j.lookAhead=new j({perNode:!0}),j.mounted=new j({perNode:!0});class Gr{constructor(t,e,i,s=!1){this.tree=t,this.overlay=e,this.parser=i,this.bracketed=s}static get(t){return t&&t.props&&t.props[j.mounted.id]}}const u1=Object.create(null);class de{constructor(t,e,i,s=0){this.name=t,this.props=e,this.id=i,this.flags=s}static define(t){let e=t.props&&t.props.length?Object.create(null):u1,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),s=new de(t.name||"",e,t.id,i);if(t.props){for(let n of t.props)if(Array.isArray(n)||(n=n(s)),n){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[n[0].id]=n[1]}}return s}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let e=this.prop(j.group);return e?e.indexOf(t)>-1:!1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let s of i.split(" "))e[s]=t[i];return i=>{for(let s=i.prop(j.group),n=-1;n<(s?s.length:0);n++){let o=e[n<0?i.name:s[n]];if(o)return o}}}}de.none=new de("",Object.create(null),0,8);const an=new WeakMap,Ou=new WeakMap;var at;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays",r[r.EnterBracketed=16]="EnterBracketed"})(at||(at={}));class Mt{constructor(t,e,i,s,n){if(this.type=t,this.children=e,this.positions=i,this.length=s,this.props=null,n&&n.length){this.props=Object.create(null);for(let[o,a]of n)this.props[typeof o=="number"?o:o.id]=a}}toString(){let t=Gr.get(this);if(t&&!t.overlay)return t.tree.toString();let e="";for(let i of this.children){let s=i.toString();s&&(e&&(e+=","),e+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new Ta(this.topNode,t)}cursorAt(t,e=0,i=0){let s=an.get(this)||this.topNode,n=new Ta(s);return n.moveTo(t,e),an.set(this,n._tree),n}get topNode(){return new fe(this,0,0,null)}resolve(t,e=0){let i=Ur(an.get(this)||this.topNode,t,e,!1);return an.set(this,i),i}resolveInner(t,e=0){let i=Ur(Ou.get(this)||this.topNode,t,e,!0);return Ou.set(this,i),i}resolveStack(t,e=0){return p1(this,t,e)}iterate(t){let{enter:e,leave:i,from:s=0,to:n=this.length}=t,o=t.mode||0,a=(o&at.IncludeAnonymous)>0;for(let l=this.cursor(o|at.IncludeAnonymous);;){let h=!1;if(l.from<=n&&l.to>=s&&(!a&&l.type.isAnonymous||e(l)!==!1)){if(l.firstChild())continue;h=!0}for(;h&&i&&(a||!l.type.isAnonymous)&&i(l),!l.nextSibling();){if(!l.parent())return;h=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Ea(de.none,this.children,this.positions,0,this.children.length,0,this.length,(e,i,s)=>new Mt(this.type,e,i,s,this.propValues),t.makeTree||((e,i,s)=>new Mt(de.none,e,i,s)))}static build(t){return m1(t)}}Mt.empty=new Mt(de.none,[],[],0);class Oa{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Oa(this.buffer,this.index)}}class fi{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return de.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],s=this.set.types[e],n=s.name;if(/\W/.test(n)&&!s.isError&&(n=JSON.stringify(n)),t+=4,i==t)return n;let o=[];for(;t<i;)o.push(this.childString(t)),t=this.buffer[t+3];return n+"("+o.join(",")+")"}findChild(t,e,i,s,n){let{buffer:o}=this,a=-1;for(let l=t;l!=e&&!(Du(n,s,o[l+1],o[l+2])&&(a=l,i>0));l=o[l+3]);return a}slice(t,e,i){let s=this.buffer,n=new Uint16Array(e-t),o=0;for(let a=t,l=0;a<e;){n[l++]=s[a++],n[l++]=s[a++]-i;let h=n[l++]=s[a++]-i;n[l++]=s[a++]-t,o=Math.max(o,h)}return new fi(n,o,this.set)}}function Du(r,t,e,i){switch(r){case-2:return e<t;case-1:return i>=t&&e<t;case 0:return e<t&&i>t;case 1:return e<=t&&i>t;case 2:return i>t;case 4:return!0}}function Ur(r,t,e,i){for(var s;r.from==r.to||(e<1?r.from>=t:r.from>t)||(e>-1?r.to<=t:r.to<t);){let o=!i&&r instanceof fe&&r.index<0?null:r.parent;if(!o)return r;r=o}let n=i?0:at.IgnoreOverlays;if(i)for(let o=r,a=o.parent;a;o=a,a=o.parent)o instanceof fe&&o.index<0&&((s=a.enter(t,e,n))===null||s===void 0?void 0:s.from)!=o.from&&(r=a);for(;;){let o=r.enter(t,e,n);if(!o)return r;r=o}}class Tu{cursor(t=0){return new Ta(this,t)}getChild(t,e=null,i=null){let s=Ru(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return Ru(this,t,e,i)}resolve(t,e=0){return Ur(this,t,e,!1)}resolveInner(t,e=0){return Ur(this,t,e,!0)}matchContext(t){return Da(this.parent,t)}enterUnfinishedNodesBefore(t){let e=this.childBefore(t),i=this;for(;e;){let s=e.lastChild;if(!s||s.to!=e.to)break;s.type.isError&&s.from==s.to?(i=e,e=s.prevSibling):e=s}return i}get node(){return this}get next(){return this.parent}}class fe extends Tu{constructor(t,e,i,s){super(),this._tree=t,this.from=e,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,s,n=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,h=e>0?a.length:-1;t!=h;t+=e){let c=a[t],u=l[t]+o.from,d;if(!(!(n&at.EnterBracketed&&c instanceof Mt&&(d=Gr.get(c))&&!d.overlay&&d.bracketed&&i>=u&&i<=u+c.length)&&!Du(s,i,u,u+c.length))){if(c instanceof fi){if(n&at.ExcludeBuffers)continue;let f=c.findChild(0,c.buffer.length,e,i-u,s);if(f>-1)return new pi(new d1(o,c,t,u),null,f)}else if(n&at.IncludeAnonymous||!c.type.isAnonymous||Ra(c)){let f;if(!(n&at.IgnoreMounts)&&(f=Gr.get(c))&&!f.overlay)return new fe(f.tree,u,t,o);let p=new fe(c,u,t,o);return n&at.IncludeAnonymous||!p.type.isAnonymous?p:p.nextChild(e<0?c.children.length-1:0,e,i,s,n)}}}if(n&at.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+e:t=e<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}prop(t){return this._tree.prop(t)}enter(t,e,i=0){let s;if(!(i&at.IgnoreOverlays)&&(s=Gr.get(this._tree))&&s.overlay){let n=t-this.from,o=i&at.EnterBracketed&&s.bracketed;for(let{from:a,to:l}of s.overlay)if((e>0||o?a<=n:a<n)&&(e<0||o?l>=n:l>n))return new fe(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Ru(r,t,e,i){let s=r.cursor(),n=[];if(!s.firstChild())return n;if(e!=null){for(let o=!1;!o;)if(o=s.type.is(e),!s.nextSibling())return n}for(;;){if(i!=null&&s.type.is(i))return n;if(s.type.is(t)&&n.push(s.node),!s.nextSibling())return i==null?n:[]}}function Da(r,t,e=t.length-1){for(let i=r;e>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(t[e]&&t[e]!=i.name)return!1;e--}}return!0}class d1{constructor(t,e,i,s){this.parent=t,this.buffer=e,this.index=i,this.start=s}}class pi extends Tu{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(t,e,i){super(),this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}child(t,e,i){let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.context.start,i);return n<0?null:new pi(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}prop(t){return this.type.prop(t)}enter(t,e,i=0){if(i&at.ExcludeBuffers)return null;let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return n<0?null:new pi(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new pi(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new pi(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,s=this.index+4,n=i.buffer[this.index+3];if(n>s){let o=i.buffer[this.index+1];t.push(i.slice(s,n,o)),e.push(0)}return new Mt(this.type,t,e,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function Eu(r){if(!r.length)return null;let t=0,e=r[0];for(let n=1;n<r.length;n++){let o=r[n];(o.from>e.from||o.to<e.to)&&(e=o,t=n)}let i=e instanceof fe&&e.index<0?null:e.parent,s=r.slice();return i?s[t]=i:s.splice(t,1),new f1(s,e)}class f1{constructor(t,e){this.heads=t,this.node=e}get next(){return Eu(this.heads)}}function p1(r,t,e){let i=r.resolveInner(t,e),s=null;for(let n=i instanceof fe?i:i.context.parent;n;n=n.parent)if(n.index<0){let o=n.parent;(s||(s=[i])).push(o.resolve(t,e)),n=o}else{let o=Gr.get(n.tree);if(o&&o.overlay&&o.overlay[0].from<=t&&o.overlay[o.overlay.length-1].to>=t){let a=new fe(o.tree,o.overlay[0].from+n.from,-1,n);(s||(s=[i])).push(Ur(a,t,e,!1))}}return s?Eu(s):i}class Ta{get name(){return this.type.name}constructor(t,e=0){if(this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,this.mode=e&~at.EnterBracketed,t instanceof fe)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let i=t._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=t,this.yieldBuf(t.index)}}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,e){this.index=t;let{start:i,buffer:s}=this.buffer;return this.type=e||s.set.types[s.buffer[t]],this.from=i+s.buffer[t+1],this.to=i+s.buffer[t+2],!0}yield(t){return t?t instanceof fe?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:s}=this.buffer,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.buffer.start,i);return n<0?!1:(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?i&at.ExcludeBuffers?!1:this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&at.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&at.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let s=i<0?0:this.stack[i]+4;if(this.index!=s)return this.yieldBuf(e.findChild(s,this.index,-1,0,4))}else{let s=e.buffer[this.index+3];if(s<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(s)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:s}=this;if(s){if(t>0){if(this.index<s.buffer.buffer.length)return!1}else for(let n=0;n<this.index;n++)if(s.buffer.buffer[n+3]<this.index)return!1;({index:e,parent:i}=s)}else({index:e,_parent:i}=this._tree);for(;i;{index:e,_parent:i}=i)if(e>-1)for(let n=e+t,o=t<0?-1:i._tree.children.length;n!=o;n+=t){let a=i._tree.children[n];if(this.mode&at.IncludeAnonymous||a instanceof fi||!a.type.isAnonymous||Ra(a))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let s=this.index,n=this.stack.length;n>=0;){for(let o=t;o;o=o._parent)if(o.index==s){if(s==this.index)return o;e=o,i=n+1;break t}s=this.stack[--n]}for(let s=i;s<this.stack.length;s++)e=new pi(this.buffer,e,this.stack[s]);return this.bufferNode=new pi(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let s=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;;){if(s&&e&&e(this),s=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,s=!0}}}matchContext(t){if(!this.buffer)return Da(this.node.parent,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let s=t.length-1,n=this.stack.length-1;s>=0;n--){if(n<0)return Da(this._tree,t,s);let o=i[e.buffer[this.stack[n]]];if(!o.isAnonymous){if(t[s]&&t[s]!=o.name)return!1;s--}}return!0}}function Ra(r){return r.children.some(t=>t instanceof fi||!t.type.isAnonymous||Ra(t))}function m1(r){var t;let{buffer:e,nodeSet:i,maxBufferLength:s=h1,reused:n=[],minRepeatType:o=i.types.length}=r,a=Array.isArray(e)?new Oa(e,e.length):e,l=i.types,h=0,c=0;function u(x,k,A,B,q,_){let{id:N,start:E,end:H,size:z}=a,U=c,nt=h;if(z<0)if(a.next(),z==-1){let Oe=n[N];A.push(Oe),B.push(E-x);return}else if(z==-3){h=N;return}else if(z==-4){c=N;return}else throw new RangeError(`Unrecognized record size: ${z}`);let xt=l[N],Yt,lt,se=E-x;if(H-E<=s&&(lt=g(a.pos-k,q))){let Oe=new Uint16Array(lt.size-lt.skip),ne=a.pos-lt.size,we=Oe.length;for(;a.pos>ne;)we=v(lt.start,Oe,we);Yt=new fi(Oe,H-lt.start,i),se=lt.start-x}else{let Oe=a.pos-z;a.next();let ne=[],we=[],si=N>=o?N:-1,ki=0,wr=H;for(;a.pos>Oe;)si>=0&&a.id==si&&a.size>=0?(a.end<=wr-s&&(p(ne,we,E,ki,a.end,wr,si,U,nt),ki=ne.length,wr=a.end),a.next()):_>2500?d(E,Oe,ne,we):u(E,Oe,ne,we,si,_+1);if(si>=0&&ki>0&&ki<ne.length&&p(ne,we,E,ki,E,wr,si,U,nt),ne.reverse(),we.reverse(),si>-1&&ki>0){let Zn=f(xt,nt);Yt=Ea(xt,ne,we,0,ne.length,0,H-E,Zn,Zn)}else Yt=m(xt,ne,we,H-E,U-H,nt)}A.push(Yt),B.push(se)}function d(x,k,A,B){let q=[],_=0,N=-1;for(;a.pos>k;){let{id:E,start:H,end:z,size:U}=a;if(U>4)a.next();else{if(N>-1&&H<N)break;N<0&&(N=z-s),q.push(E,H,z),_++,a.next()}}if(_){let E=new Uint16Array(_*4),H=q[q.length-2];for(let z=q.length-3,U=0;z>=0;z-=3)E[U++]=q[z],E[U++]=q[z+1]-H,E[U++]=q[z+2]-H,E[U++]=U;A.push(new fi(E,q[2]-H,i)),B.push(H-x)}}function f(x,k){return(A,B,q)=>{let _=0,N=A.length-1,E,H;if(N>=0&&(E=A[N])instanceof Mt){if(!N&&E.type==x&&E.length==q)return E;(H=E.prop(j.lookAhead))&&(_=B[N]+E.length+H)}return m(x,A,B,q,_,k)}}function p(x,k,A,B,q,_,N,E,H){let z=[],U=[];for(;x.length>B;)z.push(x.pop()),U.push(k.pop()+A-q);x.push(m(i.types[N],z,U,_-q,E-_,H)),k.push(q-A)}function m(x,k,A,B,q,_,N){if(_){let E=[j.contextHash,_];N=N?[E].concat(N):[E]}if(q>25){let E=[j.lookAhead,q];N=N?[E].concat(N):[E]}return new Mt(x,k,A,B,N)}function g(x,k){let A=a.fork(),B=0,q=0,_=0,N=A.end-s,E={size:0,start:0,skip:0};t:for(let H=A.pos-x;A.pos>H;){let z=A.size;if(A.id==k&&z>=0){E.size=B,E.start=q,E.skip=_,_+=4,B+=4,A.next();continue}let U=A.pos-z;if(z<0||U<H||A.start<N)break;let nt=A.id>=o?4:0,xt=A.start;for(A.next();A.pos>U;){if(A.size<0)if(A.size==-3||A.size==-4)nt+=4;else break t;else A.id>=o&&(nt+=4);A.next()}q=xt,B+=z,_+=nt}return(k<0||B==x)&&(E.size=B,E.start=q,E.skip=_),E.size>4?E:void 0}function v(x,k,A){let{id:B,start:q,end:_,size:N}=a;if(a.next(),N>=0&&B<o){let E=A;if(N>4){let H=a.pos-(N-4);for(;a.pos>H;)A=v(x,k,A)}k[--A]=E,k[--A]=_-x,k[--A]=q-x,k[--A]=B}else N==-3?h=B:N==-4&&(c=B);return A}let S=[],w=[];for(;a.pos>0;)u(r.start||0,r.bufferStart||0,S,w,-1,0);let C=(t=r.length)!==null&&t!==void 0?t:S.length?w[0]+S[0].length:0;return new Mt(l[r.topID],S.reverse(),w.reverse(),C)}const Pu=new WeakMap;function ln(r,t){if(!r.isAnonymous||t instanceof fi||t.type!=r)return 1;let e=Pu.get(t);if(e==null){e=1;for(let i of t.children){if(i.type!=r||!(i instanceof Mt)){e=1;break}e+=ln(r,i)}Pu.set(t,e)}return e}function Ea(r,t,e,i,s,n,o,a,l){let h=0;for(let p=i;p<s;p++)h+=ln(r,t[p]);let c=Math.ceil(h*1.5/8),u=[],d=[];function f(p,m,g,v,S){for(let w=g;w<v;){let C=w,x=m[w],k=ln(r,p[w]);for(w++;w<v;w++){let A=ln(r,p[w]);if(k+A>=c)break;k+=A}if(w==C+1){if(k>c){let A=p[C];f(A.children,A.positions,0,A.children.length,m[C]+S);continue}u.push(p[C])}else{let A=m[w-1]+p[w-1].length-x;u.push(Ea(r,p,m,C,w,x,A,null,l))}d.push(x+S-n)}}return f(t,e,i,s,0),(a||l)(u,d,o)}class Bi{constructor(t,e,i,s,n=!1,o=!1){this.from=t,this.to=e,this.tree=i,this.offset=s,this.open=(n?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(t,e=[],i=!1){let s=[new Bi(0,t.length,t,0,!1,i)];for(let n of e)n.to>t.length&&s.push(n);return s}static applyChanges(t,e,i=128){if(!e.length)return t;let s=[],n=1,o=t.length?t[0]:null;for(let a=0,l=0,h=0;;a++){let c=a<e.length?e[a]:null,u=c?c.fromA:1e9;if(u-l>=i)for(;o&&o.from<u;){let d=o;if(l>=d.from||u<=d.to||h){let f=Math.max(d.from,l)-h,p=Math.min(d.to,u)-h;d=f>=p?null:new Bi(f,p,d.tree,d.offset+h,a>0,!!c)}if(d&&s.push(d),o.to>u)break;o=n<t.length?t[n++]:null}if(!c)break;l=c.toA,h=c.toA-c.toB}return s}}class g1{startParse(t,e,i){return typeof t=="string"&&(t=new v1(t)),i=i?i.length?i.map(s=>new Ma(s.from,s.to)):[new Ma(0,0)]:[new Ma(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let s=this.startParse(t,e,i);for(;;){let n=s.advance();if(n)return n}}}class v1{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new j({perNode:!0});let y1=0;class pe{constructor(t,e,i,s){this.name=t,this.set=e,this.base=i,this.modified=s,this.id=y1++}toString(){let{name:t}=this;for(let e of this.modified)e.name&&(t=`${e.name}(${t})`);return t}static define(t,e){let i=typeof t=="string"?t:"?";if(t instanceof pe&&(e=t),e==null?void 0:e.base)throw new Error("Can not derive from a modified tag");let s=new pe(i,[],null,[]);if(s.set.push(s),e)for(let n of e.set)s.set.push(n);return s}static defineModifier(t){let e=new hn(t);return i=>i.modified.indexOf(e)>-1?i:hn.get(i.base||i,i.modified.concat(e).sort((s,n)=>s.id-n.id))}}let w1=0;class hn{constructor(t){this.name=t,this.instances=[],this.id=w1++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find(a=>a.base==t&&x1(e,a.modified));if(i)return i;let s=[],n=new pe(t.name,s,t,e);for(let a of e)a.instances.push(n);let o=b1(e);for(let a of t.set)if(!a.modified.length)for(let l of o)s.push(hn.get(a,l));return n}}function x1(r,t){return r.length==t.length&&r.every((e,i)=>e==t[i])}function b1(r){let t=[[]];for(let e=0;e<r.length;e++)for(let i=0,s=t.length;i<s;i++)t.push(t[i].concat(r[e]));return t.sort((e,i)=>i.length-e.length)}function S1(r){let t=Object.create(null);for(let e in r){let i=r[e];Array.isArray(i)||(i=[i]);for(let s of e.split(" "))if(s){let n=[],o=2,a=s;for(let u=0;;){if(a=="..."&&u>0&&u+3==s.length){o=1;break}let d=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!d)throw new RangeError("Invalid path: "+s);if(n.push(d[0]=="*"?"":d[0][0]=='"'?JSON.parse(d[0]):d[0]),u+=d[0].length,u==s.length)break;let f=s[u++];if(u==s.length&&f=="!"){o=0;break}if(f!="/")throw new RangeError("Invalid path: "+s);a=s.slice(u)}let l=n.length-1,h=n[l];if(!h)throw new RangeError("Invalid path: "+s);let c=new Kr(i,o,l>0?n.slice(0,l):null);t[h]=c.sort(t[h])}}return Lu.add(t)}const Lu=new j({combine(r,t){let e,i,s;for(;r||t;){if(!r||t&&r.depth>=t.depth?(s=t,t=t.next):(s=r,r=r.next),e&&e.mode==s.mode&&!s.context&&!e.context)continue;let n=new Kr(s.tags,s.mode,s.context);e?e.next=n:i=n,e=n}return i}});class Kr{constructor(t,e,i,s){this.tags=t,this.mode=e,this.context=i,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}Kr.empty=new Kr([],2,null);function Nu(r,t){let e=Object.create(null);for(let n of r)if(!Array.isArray(n.tag))e[n.tag.id]=n.class;else for(let o of n.tag)e[o.id]=n.class;let{scope:i,all:s=null}=t||{};return{style:n=>{let o=s;for(let a of n)for(let l of a.set){let h=e[l.id];if(h){o=o?o+" "+h:h;break}}return o},scope:i}}function k1(r,t){let e=null;for(let i of r){let s=i.style(t);s&&(e=e?e+" "+s:s)}return e}function A1(r,t,e,i=0,s=r.length){let n=new C1(i,Array.isArray(t)?t:[t],e);n.highlightRange(r.cursor(),i,s,"",n.highlighters),n.flush(s)}class C1{constructor(t,e,i){this.at=t,this.highlighters=e,this.span=i,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,e,i,s,n){let{type:o,from:a,to:l}=t;if(a>=i||l<=e)return;o.isTop&&(n=this.highlighters.filter(f=>!f.scope||f.scope(o)));let h=s,c=I1(t)||Kr.empty,u=k1(n,c.tags);if(u&&(h&&(h+=" "),h+=u,c.mode==1&&(s+=(s?" ":"")+u)),this.startSpan(Math.max(e,a),h),c.opaque)return;let d=t.tree&&t.tree.prop(j.mounted);if(d&&d.overlay){let f=t.node.enter(d.overlay[0].from+a,1),p=this.highlighters.filter(g=>!g.scope||g.scope(d.tree.type)),m=t.firstChild();for(let g=0,v=a;;g++){let S=g<d.overlay.length?d.overlay[g]:null,w=S?S.from+a:l,C=Math.max(e,v),x=Math.min(i,w);if(C<x&&m)for(;t.from<x&&(this.highlightRange(t,C,x,s,n),this.startSpan(Math.min(x,t.to),h),!(t.to>=w||!t.nextSibling())););if(!S||w>i)break;v=S.to+a,v>e&&(this.highlightRange(f.cursor(),Math.max(e,S.from+a),Math.min(i,v),"",p),this.startSpan(Math.min(i,v),h))}m&&t.parent()}else if(t.firstChild()){d&&(s="");do if(!(t.to<=e)){if(t.from>=i)break;this.highlightRange(t,e,i,s,n),this.startSpan(Math.min(i,t.to),h)}while(t.nextSibling());t.parent()}}}function I1(r){let t=r.type.prop(Lu);for(;t&&t.context&&!r.matchContext(t.context);)t=t.next;return t||null}const I=pe.define,cn=I(),mi=I(),Bu=I(mi),Fu=I(mi),gi=I(),un=I(gi),Pa=I(gi),Fe=I(),Fi=I(Fe),Ve=I(),qe=I(),La=I(),Yr=I(La),dn=I(),M={comment:cn,lineComment:I(cn),blockComment:I(cn),docComment:I(cn),name:mi,variableName:I(mi),typeName:Bu,tagName:I(Bu),propertyName:Fu,attributeName:I(Fu),className:I(mi),labelName:I(mi),namespace:I(mi),macroName:I(mi),literal:gi,string:un,docString:I(un),character:I(un),attributeValue:I(un),number:Pa,integer:I(Pa),float:I(Pa),bool:I(gi),regexp:I(gi),escape:I(gi),color:I(gi),url:I(gi),keyword:Ve,self:I(Ve),null:I(Ve),atom:I(Ve),unit:I(Ve),modifier:I(Ve),operatorKeyword:I(Ve),controlKeyword:I(Ve),definitionKeyword:I(Ve),moduleKeyword:I(Ve),operator:qe,derefOperator:I(qe),arithmeticOperator:I(qe),logicOperator:I(qe),bitwiseOperator:I(qe),compareOperator:I(qe),updateOperator:I(qe),definitionOperator:I(qe),typeOperator:I(qe),controlOperator:I(qe),punctuation:La,separator:I(La),bracket:Yr,angleBracket:I(Yr),squareBracket:I(Yr),paren:I(Yr),brace:I(Yr),content:Fe,heading:Fi,heading1:I(Fi),heading2:I(Fi),heading3:I(Fi),heading4:I(Fi),heading5:I(Fi),heading6:I(Fi),contentSeparator:I(Fe),list:I(Fe),quote:I(Fe),emphasis:I(Fe),strong:I(Fe),link:I(Fe),monospace:I(Fe),strikethrough:I(Fe),inserted:I(),deleted:I(),changed:I(),invalid:I(),meta:dn,documentMeta:I(dn),annotation:I(dn),processingInstruction:I(dn),definition:pe.defineModifier("definition"),constant:pe.defineModifier("constant"),function:pe.defineModifier("function"),standard:pe.defineModifier("standard"),local:pe.defineModifier("local"),special:pe.defineModifier("special")};for(let r in M){let t=M[r];t instanceof pe&&(t.name=r)}Nu([{tag:M.link,class:"tok-link"},{tag:M.heading,class:"tok-heading"},{tag:M.emphasis,class:"tok-emphasis"},{tag:M.strong,class:"tok-strong"},{tag:M.keyword,class:"tok-keyword"},{tag:M.atom,class:"tok-atom"},{tag:M.bool,class:"tok-bool"},{tag:M.url,class:"tok-url"},{tag:M.labelName,class:"tok-labelName"},{tag:M.inserted,class:"tok-inserted"},{tag:M.deleted,class:"tok-deleted"},{tag:M.literal,class:"tok-literal"},{tag:M.string,class:"tok-string"},{tag:M.number,class:"tok-number"},{tag:[M.regexp,M.escape,M.special(M.string)],class:"tok-string2"},{tag:M.variableName,class:"tok-variableName"},{tag:M.local(M.variableName),class:"tok-variableName tok-local"},{tag:M.definition(M.variableName),class:"tok-variableName tok-definition"},{tag:M.special(M.variableName),class:"tok-variableName2"},{tag:M.definition(M.propertyName),class:"tok-propertyName tok-definition"},{tag:M.typeName,class:"tok-typeName"},{tag:M.namespace,class:"tok-namespace"},{tag:M.className,class:"tok-className"},{tag:M.macroName,class:"tok-macroName"},{tag:M.propertyName,class:"tok-propertyName"},{tag:M.operator,class:"tok-operator"},{tag:M.comment,class:"tok-comment"},{tag:M.meta,class:"tok-meta"},{tag:M.invalid,class:"tok-invalid"},{tag:M.punctuation,class:"tok-punctuation"}]);var Na;const Xr=new j,M1=new j;class We{constructor(t,e,i=[],s=""){this.data=t,this.name=s,$.prototype.hasOwnProperty("tree")||Object.defineProperty($.prototype,"tree",{get(){return Et(this)}}),this.parser=e,this.extension=[vi.of(this),$.languageData.of((n,o,a)=>{let l=Vu(n,o,a),h=l.type.prop(Xr);if(!h)return[];let c=n.facet(h),u=l.type.prop(M1);if(u){let d=l.resolve(o-l.from,a);for(let f of u)if(f.test(d,n)){let p=n.facet(f.facet);return f.type=="replace"?p:p.concat(c)}}return c})].concat(i)}isActiveAt(t,e,i=-1){return Vu(t,e,i).type.prop(Xr)==this.data}findRegions(t){let e=t.facet(vi);if((e==null?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],s=(n,o)=>{if(n.prop(Xr)==this.data){i.push({from:o,to:o+n.length});return}let a=n.prop(j.mounted);if(a){if(a.tree.prop(Xr)==this.data){if(a.overlay)for(let l of a.overlay)i.push({from:l.from+o,to:l.to+o});else i.push({from:o,to:o+n.length});return}else if(a.overlay){let l=i.length;if(s(a.tree,a.overlay[0].from+o),i.length>l)return}}for(let l=0;l<n.children.length;l++){let h=n.children[l];h instanceof Mt&&s(h,n.positions[l]+o)}};return s(Et(t),0),i}get allowsNesting(){return!0}}We.setState=F.define();function Vu(r,t,e){let i=r.facet(vi),s=Et(r).topNode;if(!i||i.allowsNesting)for(let n=s;n;n=n.enter(t,e,at.ExcludeBuffers|at.EnterBracketed))n.type.isTop&&(s=n);return s}function Et(r){let t=r.field(We.state,!1);return t?t.tree:Mt.empty}class O1{constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let Jr=null;class fn{constructor(t,e,i=[],s,n,o,a,l){this.parser=t,this.state=e,this.fragments=i,this.tree=s,this.treeLen=n,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(t,e,i){return new fn(t,e,[],Mt.empty,0,i,[],null)}startParse(){return this.parser.startParse(new O1(this.state.doc),this.fragments)}work(t,e){return e!=null&&e>=this.state.doc.length&&(e=void 0),this.tree!=Mt.empty&&this.isDone(e??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof t=="number"){let s=Date.now()+t;t=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),e!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(Bi.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(e??this.state.doc.length))this.parse=this.startParse();else return!0;if(t())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(Bi.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=Jr;Jr=this;try{return t()}finally{Jr=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=qu(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:s,treeLen:n,viewport:o,skipped:a}=this;if(this.takeTree(),!t.empty){let l=[];if(t.iterChangedRanges((h,c,u,d)=>l.push({fromA:h,toA:c,fromB:u,toB:d})),i=Bi.applyChanges(i,l),s=Mt.empty,n=0,o={from:t.mapPos(o.from,-1),to:t.mapPos(o.to,1)},this.skipped.length){a=[];for(let h of this.skipped){let c=t.mapPos(h.from,1),u=t.mapPos(h.to,-1);c<u&&a.push({from:c,to:u})}}}return new fn(this.parser,e,i,s,n,o,a,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:s,to:n}=this.skipped[i];s<t.to&&n>t.from&&(this.fragments=qu(this.fragments,s,n),this.skipped.splice(i--,1))}return this.skipped.length>=e?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends g1{createParse(e,i,s){let n=s[0].from,o=s[s.length-1].to;return{parsedPos:n,advance(){let a=Jr;if(a){for(let l of s)a.tempSkipped.push(l);t&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,t]):t)}return this.parsedPos=o,new Mt(de.none,[],[],o-n)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&e[0].from==0&&e[0].to>=t}static get(){return Jr}}function qu(r,t,e){return Bi.applyChanges(r,[{fromA:t,toA:e,fromB:t,toB:e}])}class hr{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new hr(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=fn.create(t.facet(vi).parser,t,{from:0,to:e});return i.work(20,e)||i.takeTree(),new hr(i)}}We.state=gt.define({create:hr.init,update(r,t){for(let e of t.effects)if(e.is(We.setState))return e.value;return t.startState.facet(vi)!=t.state.facet(vi)?hr.init(t.state):r.apply(t)}});let Wu=r=>{let t=setTimeout(()=>r(),500);return()=>clearTimeout(t)};typeof requestIdleCallback<"u"&&(Wu=r=>{let t=-1,e=setTimeout(()=>{t=requestIdleCallback(r,{timeout:400})},100);return()=>t<0?clearTimeout(e):cancelIdleCallback(t)});const Ba=typeof navigator<"u"&&!((Na=navigator.scheduling)===null||Na===void 0)&&Na.isInputPending?()=>navigator.scheduling.isInputPending():null,D1=ut.fromClass(class{constructor(r){this.view=r,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(r){let t=this.view.state.field(We.state).context;(t.updateViewport(r.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(r.docChanged||r.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:r}=this.view,t=r.field(We.state);(t.tree!=t.context.tree||!t.context.isDone(r.doc.length))&&(this.working=Wu(this.work))}work(r){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:e,viewport:{to:i}}=this.view,s=e.field(We.state);if(s.tree==s.context.tree&&s.context.isDone(i+1e5))return;let n=Date.now()+Math.min(this.chunkBudget,100,r&&!Ba?Math.max(25,r.timeRemaining()-5):1e9),o=s.context.treeLen<i&&e.doc.length>i+1e3,a=s.context.work(()=>Ba&&Ba()||Date.now()>n,i+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:We.setState.of(new hr(s.context))})),this.chunkBudget>0&&!(a&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(r){r.scheduleOn&&(this.workScheduled++,r.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Jt(this.view.state,t)).then(()=>this.workScheduled--),r.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),vi=O.define({combine(r){return r.length?r[0]:null},enables:r=>[We.state,D1,T.contentAttributes.compute([r],t=>{let e=t.facet(r);return e&&e.name?{"data-language":e.name}:{}})]}),T1=O.define(),Fa=O.define({combine:r=>{if(!r.length)return"  ";let t=r[0];if(!t||/\S/.test(t)||Array.from(t).some(e=>e!=t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(r[0]));return t}});function pn(r){let t=r.facet(Fa);return t.charCodeAt(0)==9?r.tabSize*t.length:t.length}function Qr(r,t){let e="",i=r.tabSize,s=r.facet(Fa)[0];if(s=="	"){for(;t>=i;)e+="	",t-=i;s=" "}for(let n=0;n<t;n++)e+=s;return e}function Va(r,t){r instanceof $&&(r=new mn(r));for(let i of r.state.facet(T1)){let s=i(r,t);if(s!==void 0)return s}let e=Et(r.state);return e.length>=t?E1(r,e,t):null}class mn{constructor(t,e={}){this.state=t,this.options=e,this.unit=pn(t)}lineAt(t,e=1){let i=this.state.doc.lineAt(t),{simulateBreak:s,simulateDoubleBreak:n}=this.options;return s!=null&&s>=i.from&&s<=i.to?n&&s==t?{text:"",from:t}:(e<0?s<t:s<=t)?{text:i.text.slice(s-i.from),from:s}:{text:i.text.slice(0,s-i.from),from:i.from}:i}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:i,from:s}=this.lineAt(t,e);return i.slice(t-s,Math.min(i.length,t+100-s))}column(t,e=1){let{text:i,from:s}=this.lineAt(t,e),n=this.countColumn(i,t-s),o=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return o>-1&&(n+=o-this.countColumn(i,i.search(/\S|$/))),n}countColumn(t,e=t.length){return Zi(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:i,from:s}=this.lineAt(t,e),n=this.options.overrideIndentation;if(n){let o=n(s);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const R1=new j;function E1(r,t,e){let i=t.resolveStack(e),s=t.resolveInner(e,-1).resolve(e,0).enterUnfinishedNodesBefore(e);if(s!=i.node){let n=[];for(let o=s;o&&!(o.from<i.node.from||o.to>i.node.to||o.from==i.node.from&&o.type==i.node.type);o=o.parent)n.push(o);for(let o=n.length-1;o>=0;o--)i={node:n[o],next:i}}return _u(i,r,e)}function _u(r,t,e){for(let i=r;i;i=i.next){let s=L1(i.node);if(s)return s(qa.create(t,e,i))}return 0}function P1(r){return r.pos==r.options.simulateBreak&&r.options.simulateDoubleBreak}function L1(r){let t=r.type.prop(R1);if(t)return t;let e=r.firstChild,i;if(e&&(i=e.type.prop(j.closedBy))){let s=r.lastChild,n=s&&i.indexOf(s.name)>-1;return o=>V1(o,!0,1,void 0,n&&!P1(o)?s.from:void 0)}return r.parent==null?N1:null}function N1(){return 0}class qa extends mn{constructor(t,e,i){super(t.state,t.options),this.base=t,this.pos=e,this.context=i}get node(){return this.context.node}static create(t,e,i){return new qa(t,e,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(t){let e=this.state.doc.lineAt(t.from);for(;;){let i=t.resolve(e.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(B1(i,t))break;e=this.state.doc.lineAt(i.from)}return this.lineIndent(e.from)}continue(){return _u(this.context.next,this.base,this.pos)}}function B1(r,t){for(let e=t;e;e=e.parent)if(r==e)return!0;return!1}function F1(r){let t=r.node,e=t.childAfter(t.from),i=t.lastChild;if(!e)return null;let s=r.options.simulateBreak,n=r.state.doc.lineAt(e.from),o=s==null||s<=n.from?n.to:Math.min(n.to,s);for(let a=e.to;;){let l=t.childAfter(a);if(!l||l==i)return null;if(!l.type.isSkipped){if(l.from>=o)return null;let h=/^ */.exec(n.text.slice(e.to-n.from))[0].length;return{from:e.from,to:e.to+h}}a=l.to}}function V1(r,t,e,i,s){let n=r.textAfter,o=n.match(/^\s*/)[0].length,a=s==r.pos+o,l=F1(r);return l?a?r.column(l.from):r.column(l.to):r.baseIndent+(a?0:r.unit*e)}const q1=200;function Hu(){return $.transactionFilter.of(r=>{if(!r.docChanged||!r.isUserEvent("input.type")&&!r.isUserEvent("input.complete"))return r;let t=r.startState.languageDataAt("indentOnInput",r.startState.selection.main.head);if(!t.length)return r;let e=r.newDoc,{head:i}=r.newSelection.main,s=e.lineAt(i);if(i>s.from+q1)return r;let n=e.sliceString(s.from,i);if(!t.some(h=>h.test(n)))return r;let{state:o}=r,a=-1,l=[];for(let{head:h}of o.selection.ranges){let c=o.doc.lineAt(h);if(c.from==a)continue;a=c.from;let u=Va(o,c.from);if(u==null)continue;let d=/^\s*/.exec(c.text)[0],f=Qr(o,u);d!=f&&l.push({from:c.from,to:c.from+d.length,insert:f})}return l.length?[r,{changes:l,sequential:!0}]:r})}const W1=O.define(),_1=new j;function H1(r,t,e){let i=Et(r);if(i.length<e)return null;let s=i.resolveStack(e,1),n=null;for(let o=s;o;o=o.next){let a=o.node;if(a.to<=e||a.from>e)continue;if(n&&a.from<t)break;let l=a.type.prop(_1);if(l&&(a.to<i.length-50||i.length==r.doc.length||!z1(a))){let h=l(a,r);h&&h.from<=e&&h.from>=t&&h.to>e&&(n=h)}}return n}function z1(r){let t=r.lastChild;return t&&t.to==r.to&&t.type.isError}function gn(r,t,e){for(let i of r.facet(W1)){let s=i(r,t,e);if(s)return s}return H1(r,t,e)}function zu(r,t){let e=t.mapPos(r.from,1),i=t.mapPos(r.to,-1);return e>=i?void 0:{from:e,to:i}}const vn=F.define({map:zu}),Zr=F.define({map:zu});function ju(r){let t=[];for(let{head:e}of r.state.selection.ranges)t.some(i=>i.from<=e&&i.to>=e)||t.push(r.lineBlockAt(e));return t}const Vi=gt.define({create(){return L.none},update(r,t){t.isUserEvent("delete")&&t.changes.iterChangedRanges((e,i)=>r=$u(r,e,i)),r=r.map(t.changes);for(let e of t.effects)if(e.is(vn)&&!j1(r,e.value.from,e.value.to)){let{preparePlaceholder:i}=t.state.facet(Ku),s=i?L.replace({widget:new J1(i(t.state,e.value))}):Ju;r=r.update({add:[s.range(e.value.from,e.value.to)]})}else e.is(Zr)&&(r=r.update({filter:(i,s)=>e.value.from!=i||e.value.to!=s,filterFrom:e.value.from,filterTo:e.value.to}));return t.selection&&(r=$u(r,t.selection.main.head)),r},provide:r=>T.decorations.from(r),toJSON(r,t){let e=[];return r.between(0,t.doc.length,(i,s)=>{e.push(i,s)}),e},fromJSON(r){if(!Array.isArray(r)||r.length%2)throw new RangeError("Invalid JSON for fold state");let t=[];for(let e=0;e<r.length;){let i=r[e++],s=r[e++];if(typeof i!="number"||typeof s!="number")throw new RangeError("Invalid JSON for fold state");t.push(Ju.range(i,s))}return L.set(t,!0)}});function $u(r,t,e=t){let i=!1;return r.between(t,e,(s,n)=>{s<e&&n>t&&(i=!0)}),i?r.update({filterFrom:t,filterTo:e,filter:(s,n)=>s>=e||n<=t}):r}function yn(r,t,e){var i;let s=null;return(i=r.field(Vi,!1))===null||i===void 0||i.between(t,e,(n,o)=>{(!s||s.from>n)&&(s={from:n,to:o})}),s}function j1(r,t,e){let i=!1;return r.between(t,t,(s,n)=>{s==t&&n==e&&(i=!0)}),i}function Gu(r,t){return r.field(Vi,!1)?t:t.concat(F.appendConfig.of(Yu()))}const $1=r=>{for(let t of ju(r)){let e=gn(r.state,t.from,t.to);if(e)return r.dispatch({effects:Gu(r.state,[vn.of(e),Uu(r,e)])}),!0}return!1},G1=r=>{if(!r.state.field(Vi,!1))return!1;let t=[];for(let e of ju(r)){let i=yn(r.state,e.from,e.to);i&&t.push(Zr.of(i),Uu(r,i,!1))}return t.length&&r.dispatch({effects:t}),t.length>0};function Uu(r,t,e=!0){let i=r.state.doc.lineAt(t.from).number,s=r.state.doc.lineAt(t.to).number;return T.announce.of(`${r.state.phrase(e?"Folded lines":"Unfolded lines")} ${i} ${r.state.phrase("to")} ${s}.`)}const U1=r=>{let{state:t}=r,e=[];for(let i=0;i<t.doc.length;){let s=r.lineBlockAt(i),n=gn(t,s.from,s.to);n&&e.push(vn.of(n)),i=(n?r.lineBlockAt(n.to):s).to+1}return e.length&&r.dispatch({effects:Gu(r.state,e)}),!!e.length},K1=r=>{let t=r.state.field(Vi,!1);if(!t||!t.size)return!1;let e=[];return t.between(0,r.state.doc.length,(i,s)=>{e.push(Zr.of({from:i,to:s}))}),r.dispatch({effects:e}),!0},Y1=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:$1},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:G1},{key:"Ctrl-Alt-[",run:U1},{key:"Ctrl-Alt-]",run:K1}],X1={placeholderDOM:null,preparePlaceholder:null,placeholderText:"\u2026"},Ku=O.define({combine(r){return be(r,X1)}});function Yu(r){return[Vi,tv]}function Xu(r,t){let{state:e}=r,i=e.facet(Ku),s=o=>{let a=r.lineBlockAt(r.posAtDOM(o.target)),l=yn(r.state,a.from,a.to);l&&r.dispatch({effects:Zr.of(l)}),o.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(r,s,t);let n=document.createElement("span");return n.textContent=i.placeholderText,n.setAttribute("aria-label",e.phrase("folded code")),n.title=e.phrase("unfold"),n.className="cm-foldPlaceholder",n.onclick=s,n}const Ju=L.replace({widget:new class extends Xe{toDOM(r){return Xu(r,null)}}});class J1 extends Xe{constructor(t){super(),this.value=t}eq(t){return this.value==t.value}toDOM(t){return Xu(t,this.value)}}const Q1={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class Wa extends Be{constructor(t,e){super(),this.config=t,this.open=e}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);let e=document.createElement("span");return e.textContent=this.open?this.config.openText:this.config.closedText,e.title=t.state.phrase(this.open?"Fold line":"Unfold line"),e}}function Z1(r={}){let t={...Q1,...r},e=new Wa(t,!0),i=new Wa(t,!1),s=ut.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(vi)!=o.state.facet(vi)||o.startState.field(Vi,!1)!=o.state.field(Vi,!1)||Et(o.startState)!=Et(o.state)||t.foldingChanged(o))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let a=new Ye;for(let l of o.viewportLineBlocks){let h=yn(o.state,l.from,l.to)?i:gn(o.state,l.from,l.to)?e:null;h&&a.add(l.from,l.from,h)}return a.finish()}}),{domEventHandlers:n}=t;return[s,bu({class:"cm-foldGutter",markers(o){var a;return((a=o.plugin(s))===null||a===void 0?void 0:a.markers)||W.empty},initialSpacer(){return new Wa(t,!1)},domEventHandlers:{...n,click:(o,a,l)=>{if(n.click&&n.click(o,a,l))return!0;let h=yn(o.state,a.from,a.to);if(h)return o.dispatch({effects:Zr.of(h)}),!0;let c=gn(o.state,a.from,a.to);return c?(o.dispatch({effects:vn.of(c)}),!0):!1}}}),Yu()]}const tv=T.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class wn{constructor(t,e){this.specs=t;let i;function s(a){let l=li.newName();return(i||(i=Object.create(null)))["."+l]=a,l}const n=typeof e.all=="string"?e.all:e.all?s(e.all):void 0,o=e.scope;this.scope=o instanceof We?a=>a.prop(Xr)==o.data:o?a=>a==o:void 0,this.style=Nu(t.map(a=>({tag:a.tag,class:a.class||s(Object.assign({},a,{tag:null}))})),{all:n}).style,this.module=i?new li(i):null,this.themeType=e.themeType}static define(t,e){return new wn(t,e||{})}}const _a=O.define(),Qu=O.define({combine(r){return r.length?[r[0]]:null}});function Ha(r){let t=r.facet(_a);return t.length?t:r.facet(Qu)}function ev(r,t){let e=[rv],i;return r instanceof wn&&(r.module&&e.push(T.styleModule.of(r.module)),i=r.themeType),t!=null&&t.fallback?e.push(Qu.of(r)):i?e.push(_a.computeN([T.darkTheme],s=>s.facet(T.darkTheme)==(i=="dark")?[r]:[])):e.push(_a.of(r)),e}class iv{constructor(t){this.markCache=Object.create(null),this.tree=Et(t.state),this.decorations=this.buildDeco(t,Ha(t.state)),this.decoratedTo=t.viewport.to}update(t){let e=Et(t.state),i=Ha(t.state),s=i!=Ha(t.startState),{viewport:n}=t.view,o=t.changes.mapPos(this.decoratedTo,1);e.length<n.to&&!s&&e.type==this.tree.type&&o>=n.to?(this.decorations=this.decorations.map(t.changes),this.decoratedTo=o):(e!=this.tree||t.viewportChanged||s)&&(this.tree=e,this.decorations=this.buildDeco(t.view,i),this.decoratedTo=n.to)}buildDeco(t,e){if(!e||!this.tree.length)return L.none;let i=new Ye;for(let{from:s,to:n}of t.visibleRanges)A1(this.tree,e,(o,a,l)=>{i.add(o,a,this.markCache[l]||(this.markCache[l]=L.mark({class:l})))},s,n);return i.finish()}}const rv=Ti.high(ut.fromClass(iv,{decorations:r=>r.decorations})),sv=wn.define([{tag:M.meta,color:"#404740"},{tag:M.link,textDecoration:"underline"},{tag:M.heading,textDecoration:"underline",fontWeight:"bold"},{tag:M.emphasis,fontStyle:"italic"},{tag:M.strong,fontWeight:"bold"},{tag:M.strikethrough,textDecoration:"line-through"},{tag:M.keyword,color:"#708"},{tag:[M.atom,M.bool,M.url,M.contentSeparator,M.labelName],color:"#219"},{tag:[M.literal,M.inserted],color:"#164"},{tag:[M.string,M.deleted],color:"#a11"},{tag:[M.regexp,M.escape,M.special(M.string)],color:"#e40"},{tag:M.definition(M.variableName),color:"#00f"},{tag:M.local(M.variableName),color:"#30a"},{tag:[M.typeName,M.namespace],color:"#085"},{tag:M.className,color:"#167"},{tag:[M.special(M.variableName),M.macroName],color:"#256"},{tag:M.definition(M.propertyName),color:"#00c"},{tag:M.comment,color:"#940"},{tag:M.invalid,color:"#f00"}]),nv=T.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),Zu=1e4,td="()[]{}",ed=O.define({combine(r){return be(r,{afterCursor:!0,brackets:td,maxScanDistance:Zu,renderMatch:lv})}}),ov=L.mark({class:"cm-matchingBracket"}),av=L.mark({class:"cm-nonmatchingBracket"});function lv(r){let t=[],e=r.matched?ov:av;return t.push(e.range(r.start.from,r.start.to)),r.end&&t.push(e.range(r.end.from,r.end.to)),t}const hv=gt.define({create(){return L.none},update(r,t){if(!t.docChanged&&!t.selection)return r;let e=[],i=t.state.facet(ed);for(let s of t.state.selection.ranges){if(!s.empty)continue;let n=_e(t.state,s.head,-1,i)||s.head>0&&_e(t.state,s.head-1,1,i)||i.afterCursor&&(_e(t.state,s.head,1,i)||s.head<t.state.doc.length&&_e(t.state,s.head+1,-1,i));n&&(e=e.concat(i.renderMatch(n,t.state)))}return L.set(e,!0)},provide:r=>T.decorations.from(r)}),cv=[hv,nv];function id(r={}){return[ed.of(r),cv]}const uv=new j;function za(r,t,e){let i=r.prop(t<0?j.openedBy:j.closedBy);if(i)return i;if(r.name.length==1){let s=e.indexOf(r.name);if(s>-1&&s%2==(t<0?1:0))return[e[s+t]]}return null}function ja(r){let t=r.type.prop(uv);return t?t(r.node):r}function _e(r,t,e,i={}){let s=i.maxScanDistance||Zu,n=i.brackets||td,o=Et(r),a=o.resolveInner(t,e);for(let l=a;l;l=l.parent){let h=za(l.type,e,n);if(h&&l.from<l.to){let c=ja(l);if(c&&(e>0?t>=c.from&&t<c.to:t>c.from&&t<=c.to))return dv(r,t,e,l,c,h,n)}}return fv(r,t,e,o,a.type,s,n)}function dv(r,t,e,i,s,n,o){let a=i.parent,l={from:s.from,to:s.to},h=0,c=a==null?void 0:a.cursor();if(c&&(e<0?c.childBefore(i.from):c.childAfter(i.to)))do if(e<0?c.to<=i.from:c.from>=i.to){if(h==0&&n.indexOf(c.type.name)>-1&&c.from<c.to){let u=ja(c);return{start:l,end:u?{from:u.from,to:u.to}:void 0,matched:!0}}else if(za(c.type,e,o))h++;else if(za(c.type,-e,o)){if(h==0){let u=ja(c);return{start:l,end:u&&u.from<u.to?{from:u.from,to:u.to}:void 0,matched:!1}}h--}}while(e<0?c.prevSibling():c.nextSibling());return{start:l,matched:!1}}function fv(r,t,e,i,s,n,o){let a=e<0?r.sliceDoc(t-1,t):r.sliceDoc(t,t+1),l=o.indexOf(a);if(l<0||l%2==0!=e>0)return null;let h={from:e<0?t-1:t,to:e>0?t+1:t},c=r.doc.iterRange(t,e>0?r.doc.length:0),u=0;for(let d=0;!c.next().done&&d<=n;){let f=c.value;e<0&&(d+=f.length);let p=t+d*e;for(let m=e>0?0:f.length-1,g=e>0?f.length:-1;m!=g;m+=e){let v=o.indexOf(f[m]);if(!(v<0||i.resolveInner(p+m,1).type!=s))if(v%2==0==e>0)u++;else{if(u==1)return{start:h,end:{from:p+m,to:p+m+1},matched:v>>1==l>>1};u--}}e>0&&(d+=f.length)}return c.done?{start:h,matched:!1}:null}const pv=Object.create(null),rd=[de.none],sd=[],nd=Object.create(null),mv=Object.create(null);for(let[r,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])mv[r]=gv(pv,t);function $a(r,t){sd.indexOf(r)>-1||(sd.push(r),console.warn(t))}function gv(r,t){let e=[];for(let a of t.split(" ")){let l=[];for(let h of a.split(".")){let c=r[h]||M[h];c?typeof c=="function"?l.length?l=l.map(c):$a(h,`Modifier ${h} used at start of tag`):l.length?$a(h,`Tag ${h} used as modifier`):l=Array.isArray(c)?c:[c]:$a(h,`Unknown highlighting tag ${h}`)}for(let h of l)e.push(h)}if(!e.length)return 0;let i=t.replace(/ /g,"_"),s=i+" "+e.map(a=>a.id),n=nd[s];if(n)return n.id;let o=nd[s]=de.define({id:rd.length,name:i,props:[S1({[i]:e})]});return rd.push(o),o.id}X.RTL,X.LTR;const vv=r=>{let{state:t}=r,e=t.doc.lineAt(t.selection.main.from),i=Ua(r.state,e.from);return i.line?yv(r):i.block?xv(r):!1};function Ga(r,t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let s=r(t,e);return s?(i(e.update(s)),!0):!1}}const yv=Ga(kv,0),wv=Ga(od,0),xv=Ga((r,t)=>od(r,t,Sv(t)),0);function Ua(r,t){let e=r.languageDataAt("commentTokens",t,1);return e.length?e[0]:{}}const ts=50;function bv(r,{open:t,close:e},i,s){let n=r.sliceDoc(i-ts,i),o=r.sliceDoc(s,s+ts),a=/\s*$/.exec(n)[0].length,l=/^\s*/.exec(o)[0].length,h=n.length-a;if(n.slice(h-t.length,h)==t&&o.slice(l,l+e.length)==e)return{open:{pos:i-a,margin:a&&1},close:{pos:s+l,margin:l&&1}};let c,u;s-i<=2*ts?c=u=r.sliceDoc(i,s):(c=r.sliceDoc(i,i+ts),u=r.sliceDoc(s-ts,s));let d=/^\s*/.exec(c)[0].length,f=/\s*$/.exec(u)[0].length,p=u.length-f-e.length;return c.slice(d,d+t.length)==t&&u.slice(p,p+e.length)==e?{open:{pos:i+d+t.length,margin:/\s/.test(c.charAt(d+t.length))?1:0},close:{pos:s-f-e.length,margin:/\s/.test(u.charAt(p-1))?1:0}}:null}function Sv(r){let t=[];for(let e of r.selection.ranges){let i=r.doc.lineAt(e.from),s=e.to<=i.to?i:r.doc.lineAt(e.to);s.from>i.from&&s.from==e.to&&(s=e.to==i.to+1?i:r.doc.lineAt(e.to-1));let n=t.length-1;n>=0&&t[n].to>i.from?t[n].to=s.to:t.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:s.to})}return t}function od(r,t,e=t.selection.ranges){let i=e.map(n=>Ua(t,n.from).block);if(!i.every(n=>n))return null;let s=e.map((n,o)=>bv(t,i[o],n.from,n.to));if(r!=2&&!s.every(n=>n))return{changes:t.changes(e.map((n,o)=>s[o]?[]:[{from:n.from,insert:i[o].open+" "},{from:n.to,insert:" "+i[o].close}]))};if(r!=1&&s.some(n=>n)){let n=[];for(let o=0,a;o<s.length;o++)if(a=s[o]){let l=i[o],{open:h,close:c}=a;n.push({from:h.pos-l.open.length,to:h.pos+h.margin},{from:c.pos-c.margin,to:c.pos+l.close.length})}return{changes:n}}return null}function kv(r,t,e=t.selection.ranges){let i=[],s=-1;t:for(let{from:n,to:o}of e){let a=i.length,l=1e9,h;for(let c=n;c<=o;){let u=t.doc.lineAt(c);if(h==null&&(h=Ua(t,u.from).line,!h))continue t;if(u.from>s&&(n==o||o>u.from)){s=u.from;let d=/^\s*/.exec(u.text)[0].length,f=d==u.length,p=u.text.slice(d,d+h.length)==h?d:-1;d<u.text.length&&d<l&&(l=d),i.push({line:u,comment:p,token:h,indent:d,empty:f,single:!1})}c=u.to+1}if(l<1e9)for(let c=a;c<i.length;c++)i[c].indent<i[c].line.text.length&&(i[c].indent=l);i.length==a+1&&(i[a].single=!0)}if(r!=2&&i.some(n=>n.comment<0&&(!n.empty||n.single))){let n=[];for(let{line:a,token:l,indent:h,empty:c,single:u}of i)(u||!c)&&n.push({from:a.from+h,insert:l+" "});let o=t.changes(n);return{changes:o,selection:t.selection.map(o,1)}}else if(r!=1&&i.some(n=>n.comment>=0)){let n=[];for(let{line:o,comment:a,token:l}of i)if(a>=0){let h=o.from+a,c=h+l.length;o.text[c-o.from]==" "&&c++,n.push({from:h,to:c})}return{changes:n}}return null}const Ka=Ke.define(),Av=Ke.define(),Cv=O.define(),ad=O.define({combine(r){return be(r,{minDepth:100,newGroupDelay:500,joinToEvent:(t,e)=>e},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(t,e)=>(i,s)=>t(i,s)||e(i,s)})}}),ld=gt.define({create(){return He.empty},update(r,t){let e=t.state.facet(ad),i=t.annotation(Ka);if(i){let l=Zt.fromTransaction(t,i.selection),h=i.side,c=h==0?r.undone:r.done;return l?c=bn(c,c.length,e.minDepth,l):c=ud(c,t.startState.selection),new He(h==0?i.rest:c,h==0?c:i.rest)}let s=t.annotation(Av);if((s=="full"||s=="before")&&(r=r.isolate()),t.annotation(vt.addToHistory)===!1)return t.changes.empty?r:r.addMapping(t.changes.desc);let n=Zt.fromTransaction(t),o=t.annotation(vt.time),a=t.annotation(vt.userEvent);return n?r=r.addChanges(n,o,a,e,t):t.selection&&(r=r.addSelection(t.startState.selection,o,a,e.newGroupDelay)),(s=="full"||s=="after")&&(r=r.isolate()),r},toJSON(r){return{done:r.done.map(t=>t.toJSON()),undone:r.undone.map(t=>t.toJSON())}},fromJSON(r){return new He(r.done.map(Zt.fromJSON),r.undone.map(Zt.fromJSON))}});function Iv(r={}){return[ld,ad.of(r),T.domEventHandlers({beforeinput(t,e){let i=t.inputType=="historyUndo"?hd:t.inputType=="historyRedo"?Ya:null;return i?(t.preventDefault(),i(e)):!1}})]}function xn(r,t){return function({state:e,dispatch:i}){if(!t&&e.readOnly)return!1;let s=e.field(ld,!1);if(!s)return!1;let n=s.pop(r,e,t);return n?(i(n),!0):!1}}const hd=xn(0,!1),Ya=xn(1,!1),Mv=xn(0,!0),Ov=xn(1,!0);class Zt{constructor(t,e,i,s,n){this.changes=t,this.effects=e,this.mapped=i,this.startSelection=s,this.selectionsAfter=n}setSelAfter(t){return new Zt(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,e,i;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(e=this.mapped)===null||e===void 0?void 0:e.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(s=>s.toJSON())}}static fromJSON(t){return new Zt(t.changes&&mt.fromJSON(t.changes),[],t.mapped&&Pe.fromJSON(t.mapped),t.startSelection&&b.fromJSON(t.startSelection),t.selectionsAfter.map(b.fromJSON))}static fromTransaction(t,e){let i=me;for(let s of t.startState.facet(Cv)){let n=s(t);n.length&&(i=i.concat(n))}return!i.length&&t.changes.empty?null:new Zt(t.changes.invert(t.startState.doc),i,void 0,e||t.startState.selection,me)}static selection(t){return new Zt(void 0,me,void 0,void 0,t)}}function bn(r,t,e,i){let s=t+1>e+20?t-e-1:0,n=r.slice(s,t);return n.push(i),n}function Dv(r,t){let e=[],i=!1;return r.iterChangedRanges((s,n)=>e.push(s,n)),t.iterChangedRanges((s,n,o,a)=>{for(let l=0;l<e.length;){let h=e[l++],c=e[l++];a>=h&&o<=c&&(i=!0)}}),i}function Tv(r,t){return r.ranges.length==t.ranges.length&&r.ranges.filter((e,i)=>e.empty!=t.ranges[i].empty).length===0}function cd(r,t){return r.length?t.length?r.concat(t):r:t}const me=[],Rv=200;function ud(r,t){if(r.length){let e=r[r.length-1],i=e.selectionsAfter.slice(Math.max(0,e.selectionsAfter.length-Rv));return i.length&&i[i.length-1].eq(t)?r:(i.push(t),bn(r,r.length-1,1e9,e.setSelAfter(i)))}else return[Zt.selection([t])]}function Ev(r){let t=r[r.length-1],e=r.slice();return e[r.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),e}function Xa(r,t){if(!r.length)return r;let e=r.length,i=me;for(;e;){let s=Pv(r[e-1],t,i);if(s.changes&&!s.changes.empty||s.effects.length){let n=r.slice(0,e);return n[e-1]=s,n}else t=s.mapped,e--,i=s.selectionsAfter}return i.length?[Zt.selection(i)]:me}function Pv(r,t,e){let i=cd(r.selectionsAfter.length?r.selectionsAfter.map(a=>a.map(t)):me,e);if(!r.changes)return Zt.selection(i);let s=r.changes.map(t),n=t.mapDesc(r.changes,!0),o=r.mapped?r.mapped.composeDesc(n):n;return new Zt(s,F.mapEffects(r.effects,t),o,r.startSelection.map(n),i)}const Lv=/^(input\.type|delete)($|\.)/;class He{constructor(t,e,i=0,s=void 0){this.done=t,this.undone=e,this.prevTime=i,this.prevUserEvent=s}isolate(){return this.prevTime?new He(this.done,this.undone):this}addChanges(t,e,i,s,n){let o=this.done,a=o[o.length-1];return a&&a.changes&&!a.changes.empty&&t.changes&&(!i||Lv.test(i))&&(!a.selectionsAfter.length&&e-this.prevTime<s.newGroupDelay&&s.joinToEvent(n,Dv(a.changes,t.changes))||i=="input.type.compose")?o=bn(o,o.length-1,s.minDepth,new Zt(t.changes.compose(a.changes),cd(F.mapEffects(t.effects,a.changes),a.effects),a.mapped,a.startSelection,me)):o=bn(o,o.length,s.minDepth,t),new He(o,me,e,i)}addSelection(t,e,i,s){let n=this.done.length?this.done[this.done.length-1].selectionsAfter:me;return n.length>0&&e-this.prevTime<s&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&Tv(n[n.length-1],t)?this:new He(ud(this.done,t),this.undone,e,i)}addMapping(t){return new He(Xa(this.done,t),Xa(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,e,i){let s=t==0?this.done:this.undone;if(s.length==0)return null;let n=s[s.length-1],o=n.selectionsAfter[0]||(n.startSelection?n.startSelection.map(n.changes.invertedDesc,1):e.selection);if(i&&n.selectionsAfter.length)return e.update({selection:n.selectionsAfter[n.selectionsAfter.length-1],annotations:Ka.of({side:t,rest:Ev(s),selection:o}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(n.changes){let a=s.length==1?me:s.slice(0,s.length-1);return n.mapped&&(a=Xa(a,n.mapped)),e.update({changes:n.changes,selection:n.startSelection,effects:n.effects,annotations:Ka.of({side:t,rest:a,selection:o}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}}He.empty=new He(me,me);const dd=[{key:"Mod-z",run:hd,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Ya,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Ya,preventDefault:!0},{key:"Mod-u",run:Mv,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Ov,preventDefault:!0}];function cr(r,t){return b.create(r.ranges.map(t),r.mainIndex)}function Ce(r,t){return r.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function Ie({state:r,dispatch:t},e){let i=cr(r.selection,e);return i.eq(r.selection,!0)?!1:(t(Ce(r,i)),!0)}function Sn(r,t){return b.cursor(t?r.to:r.from)}function fd(r,t){return Ie(r,e=>e.empty?r.moveByChar(e,t):Sn(e,t))}function Pt(r){return r.textDirectionAt(r.state.selection.main.head)==X.LTR}const pd=r=>fd(r,!Pt(r)),md=r=>fd(r,Pt(r));function gd(r,t){return Ie(r,e=>e.empty?r.moveByGroup(e,t):Sn(e,t))}const Nv=r=>gd(r,!Pt(r)),Bv=r=>gd(r,Pt(r));function Fv(r,t,e){if(t.type.prop(e))return!0;let i=t.to-t.from;return i&&(i>2||/[^\s,.;:]/.test(r.sliceDoc(t.from,t.to)))||t.firstChild}function kn(r,t,e){let i=Et(r).resolveInner(t.head),s=e?j.closedBy:j.openedBy;for(let l=t.head;;){let h=e?i.childAfter(l):i.childBefore(l);if(!h)break;Fv(r,h,s)?i=h:l=e?h.to:h.from}let n=i.type.prop(s),o,a;return n&&(o=e?_e(r,i.from,1):_e(r,i.to,-1))&&o.matched?a=e?o.end.to:o.end.from:a=e?i.to:i.from,b.cursor(a,e?-1:1)}const Vv=r=>Ie(r,t=>kn(r.state,t,!Pt(r))),qv=r=>Ie(r,t=>kn(r.state,t,Pt(r)));function vd(r,t){return Ie(r,e=>{if(!e.empty)return Sn(e,t);let i=r.moveVertically(e,t);return i.head!=e.head?i:r.moveToLineBoundary(e,t)})}const yd=r=>vd(r,!1),wd=r=>vd(r,!0);function xd(r){let t=r.scrollDOM.clientHeight<r.scrollDOM.scrollHeight-2,e=0,i=0,s;if(t){for(let n of r.state.facet(T.scrollMargins)){let o=n(r);o!=null&&o.top&&(e=Math.max(o==null?void 0:o.top,e)),o!=null&&o.bottom&&(i=Math.max(o==null?void 0:o.bottom,i))}s=r.scrollDOM.clientHeight-e-i}else s=(r.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:e,marginBottom:i,selfScroll:t,height:Math.max(r.defaultLineHeight,s-5)}}function bd(r,t){let e=xd(r),{state:i}=r,s=cr(i.selection,o=>o.empty?r.moveVertically(o,t,e.height):Sn(o,t));if(s.eq(i.selection))return!1;let n;if(e.selfScroll){let o=r.coordsAtPos(i.selection.main.head),a=r.scrollDOM.getBoundingClientRect(),l=a.top+e.marginTop,h=a.bottom-e.marginBottom;o&&o.top>l&&o.bottom<h&&(n=T.scrollIntoView(s.main.head,{y:"start",yMargin:o.top-l}))}return r.dispatch(Ce(i,s),{effects:n}),!0}const Sd=r=>bd(r,!1),Ja=r=>bd(r,!0);function yi(r,t,e){let i=r.lineBlockAt(t.head),s=r.moveToLineBoundary(t,e);if(s.head==t.head&&s.head!=(e?i.to:i.from)&&(s=r.moveToLineBoundary(t,e,!1)),!e&&s.head==i.from&&i.length){let n=/^\s*/.exec(r.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;n&&t.head!=i.from+n&&(s=b.cursor(i.from+n))}return s}const Wv=r=>Ie(r,t=>yi(r,t,!0)),_v=r=>Ie(r,t=>yi(r,t,!1)),Hv=r=>Ie(r,t=>yi(r,t,!Pt(r))),zv=r=>Ie(r,t=>yi(r,t,Pt(r))),jv=r=>Ie(r,t=>b.cursor(r.lineBlockAt(t.head).from,1)),$v=r=>Ie(r,t=>b.cursor(r.lineBlockAt(t.head).to,-1));function Gv(r,t,e){let i=!1,s=cr(r.selection,n=>{let o=_e(r,n.head,-1)||_e(r,n.head,1)||n.head>0&&_e(r,n.head-1,1)||n.head<r.doc.length&&_e(r,n.head+1,-1);if(!o||!o.end)return n;i=!0;let a=o.start.from==n.head?o.end.to:o.end.from;return b.cursor(a)});return i?(t(Ce(r,s)),!0):!1}const Uv=({state:r,dispatch:t})=>Gv(r,t);function ge(r,t){let e=cr(r.state.selection,i=>{let s=t(i);return b.range(i.anchor,s.head,s.goalColumn,s.bidiLevel||void 0)});return e.eq(r.state.selection)?!1:(r.dispatch(Ce(r.state,e)),!0)}function kd(r,t){return ge(r,e=>r.moveByChar(e,t))}const Ad=r=>kd(r,!Pt(r)),Cd=r=>kd(r,Pt(r));function Id(r,t){return ge(r,e=>r.moveByGroup(e,t))}const Kv=r=>Id(r,!Pt(r)),Yv=r=>Id(r,Pt(r)),Xv=r=>ge(r,t=>kn(r.state,t,!Pt(r))),Jv=r=>ge(r,t=>kn(r.state,t,Pt(r)));function Md(r,t){return ge(r,e=>r.moveVertically(e,t))}const Od=r=>Md(r,!1),Dd=r=>Md(r,!0);function Td(r,t){return ge(r,e=>r.moveVertically(e,t,xd(r).height))}const Rd=r=>Td(r,!1),Ed=r=>Td(r,!0),Qv=r=>ge(r,t=>yi(r,t,!0)),Zv=r=>ge(r,t=>yi(r,t,!1)),ty=r=>ge(r,t=>yi(r,t,!Pt(r))),ey=r=>ge(r,t=>yi(r,t,Pt(r))),iy=r=>ge(r,t=>b.cursor(r.lineBlockAt(t.head).from)),ry=r=>ge(r,t=>b.cursor(r.lineBlockAt(t.head).to)),Pd=({state:r,dispatch:t})=>(t(Ce(r,{anchor:0})),!0),Ld=({state:r,dispatch:t})=>(t(Ce(r,{anchor:r.doc.length})),!0),Nd=({state:r,dispatch:t})=>(t(Ce(r,{anchor:r.selection.main.anchor,head:0})),!0),Bd=({state:r,dispatch:t})=>(t(Ce(r,{anchor:r.selection.main.anchor,head:r.doc.length})),!0),sy=({state:r,dispatch:t})=>(t(r.update({selection:{anchor:0,head:r.doc.length},userEvent:"select"})),!0),ny=({state:r,dispatch:t})=>{let e=Cn(r).map(({from:i,to:s})=>b.range(i,Math.min(s+1,r.doc.length)));return t(r.update({selection:b.create(e),userEvent:"select"})),!0},oy=({state:r,dispatch:t})=>{let e=cr(r.selection,i=>{let s=Et(r),n=s.resolveStack(i.from,1);if(i.empty){let o=s.resolveStack(i.from,-1);o.node.from>=n.node.from&&o.node.to<=n.node.to&&(n=o)}for(let o=n;o;o=o.next){let{node:a}=o;if((a.from<i.from&&a.to>=i.to||a.to>i.to&&a.from<=i.from)&&o.next)return b.range(a.to,a.from)}return i});return e.eq(r.selection)?!1:(t(Ce(r,e)),!0)};function Fd(r,t){let{state:e}=r,i=e.selection,s=e.selection.ranges.slice();for(let n of e.selection.ranges){let o=e.doc.lineAt(n.head);if(t?o.to<r.state.doc.length:o.from>0)for(let a=n;;){let l=r.moveVertically(a,t);if(l.head<o.from||l.head>o.to){s.some(h=>h.head==l.head)||s.push(l);break}else{if(l.head==a.head)break;a=l}}}return s.length==i.ranges.length?!1:(r.dispatch(Ce(e,b.create(s,s.length-1))),!0)}const ay=r=>Fd(r,!1),ly=r=>Fd(r,!0),hy=({state:r,dispatch:t})=>{let e=r.selection,i=null;return e.ranges.length>1?i=b.create([e.main]):e.main.empty||(i=b.create([b.cursor(e.main.head)])),i?(t(Ce(r,i)),!0):!1};function es(r,t){if(r.state.readOnly)return!1;let e="delete.selection",{state:i}=r,s=i.changeByRange(n=>{let{from:o,to:a}=n;if(o==a){let l=t(n);l<o?(e="delete.backward",l=An(r,l,!1)):l>o&&(e="delete.forward",l=An(r,l,!0)),o=Math.min(o,l),a=Math.max(a,l)}else o=An(r,o,!1),a=An(r,a,!0);return o==a?{range:n}:{changes:{from:o,to:a},range:b.cursor(o,o<n.head?-1:1)}});return s.changes.empty?!1:(r.dispatch(i.update(s,{scrollIntoView:!0,userEvent:e,effects:e=="delete.selection"?T.announce.of(i.phrase("Selection deleted")):void 0})),!0)}function An(r,t,e){if(r instanceof T)for(let i of r.state.facet(T.atomicRanges).map(s=>s(r)))i.between(t,t,(s,n)=>{s<t&&n>t&&(t=e?n:s)});return t}const Vd=(r,t,e)=>es(r,i=>{let s=i.from,{state:n}=r,o=n.doc.lineAt(s),a,l;if(e&&!t&&s>o.from&&s<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,s-o.from))){if(a[a.length-1]=="	")return s-1;let h=Zi(a,n.tabSize),c=h%pn(n)||pn(n);for(let u=0;u<c&&a[a.length-1-u]==" ";u++)s--;l=s}else l=pt(o.text,s-o.from,t,t)+o.from,l==s&&o.number!=(t?n.doc.lines:1)?l+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(o.text.slice(l-o.from,s-o.from))&&(l=pt(o.text,l-o.from,!1,!1)+o.from);return l}),Qa=r=>Vd(r,!1,!0),qd=r=>Vd(r,!0,!1),Wd=(r,t)=>es(r,e=>{let i=e.head,{state:s}=r,n=s.doc.lineAt(i),o=s.charCategorizer(i);for(let a=null;;){if(i==(t?n.to:n.from)){i==e.head&&n.number!=(t?s.doc.lines:1)&&(i+=t?1:-1);break}let l=pt(n.text,i-n.from,t)+n.from,h=n.text.slice(Math.min(i,l)-n.from,Math.max(i,l)-n.from),c=o(h);if(a!=null&&c!=a)break;(h!=" "||i!=e.head)&&(a=c),i=l}return i}),_d=r=>Wd(r,!1),cy=r=>Wd(r,!0),uy=r=>es(r,t=>{let e=r.lineBlockAt(t.head).to;return t.head<e?e:Math.min(r.state.doc.length,t.head+1)}),dy=r=>es(r,t=>{let e=r.moveToLineBoundary(t,!1).head;return t.head>e?e:Math.max(0,t.head-1)}),fy=r=>es(r,t=>{let e=r.moveToLineBoundary(t,!0).head;return t.head<e?e:Math.min(r.state.doc.length,t.head+1)}),py=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let e=r.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:G.of(["",""])},range:b.cursor(i.from)}));return t(r.update(e,{scrollIntoView:!0,userEvent:"input"})),!0},my=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let e=r.changeByRange(i=>{if(!i.empty||i.from==0||i.from==r.doc.length)return{range:i};let s=i.from,n=r.doc.lineAt(s),o=s==n.from?s-1:pt(n.text,s-n.from,!1)+n.from,a=s==n.to?s+1:pt(n.text,s-n.from,!0)+n.from;return{changes:{from:o,to:a,insert:r.doc.slice(s,a).append(r.doc.slice(o,s))},range:b.cursor(a)}});return e.changes.empty?!1:(t(r.update(e,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Cn(r){let t=[],e=-1;for(let i of r.selection.ranges){let s=r.doc.lineAt(i.from),n=r.doc.lineAt(i.to);if(!i.empty&&i.to==n.from&&(n=r.doc.lineAt(i.to-1)),e>=s.number){let o=t[t.length-1];o.to=n.to,o.ranges.push(i)}else t.push({from:s.from,to:n.to,ranges:[i]});e=n.number+1}return t}function Hd(r,t,e){if(r.readOnly)return!1;let i=[],s=[];for(let n of Cn(r)){if(e?n.to==r.doc.length:n.from==0)continue;let o=r.doc.lineAt(e?n.to+1:n.from-1),a=o.length+1;if(e){i.push({from:n.to,to:o.to},{from:n.from,insert:o.text+r.lineBreak});for(let l of n.ranges)s.push(b.range(Math.min(r.doc.length,l.anchor+a),Math.min(r.doc.length,l.head+a)))}else{i.push({from:o.from,to:n.from},{from:n.to,insert:r.lineBreak+o.text});for(let l of n.ranges)s.push(b.range(l.anchor-a,l.head-a))}}return i.length?(t(r.update({changes:i,scrollIntoView:!0,selection:b.create(s,r.selection.mainIndex),userEvent:"move.line"})),!0):!1}const gy=({state:r,dispatch:t})=>Hd(r,t,!1),vy=({state:r,dispatch:t})=>Hd(r,t,!0);function zd(r,t,e){if(r.readOnly)return!1;let i=[];for(let n of Cn(r))e?i.push({from:n.from,insert:r.doc.slice(n.from,n.to)+r.lineBreak}):i.push({from:n.to,insert:r.lineBreak+r.doc.slice(n.from,n.to)});let s=r.changes(i);return t(r.update({changes:s,selection:r.selection.map(s,e?1:-1),scrollIntoView:!0,userEvent:"input.copyline"})),!0}const yy=({state:r,dispatch:t})=>zd(r,t,!1),wy=({state:r,dispatch:t})=>zd(r,t,!0),xy=r=>{if(r.state.readOnly)return!1;let{state:t}=r,e=t.changes(Cn(t).map(({from:s,to:n})=>(s>0?s--:n<t.doc.length&&n++,{from:s,to:n}))),i=cr(t.selection,s=>{let n;if(r.lineWrapping){let o=r.lineBlockAt(s.head),a=r.coordsAtPos(s.head,s.assoc||1);a&&(n=o.bottom+r.documentTop-a.bottom+r.defaultLineHeight/2)}return r.moveVertically(s,!0,n)}).map(e);return r.dispatch({changes:e,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function by(r,t){if(/\(\)|\[\]|\{\}/.test(r.sliceDoc(t-1,t+1)))return{from:t,to:t};let e=Et(r).resolveInner(t),i=e.childBefore(t),s=e.childAfter(t),n;return i&&s&&i.to<=t&&s.from>=t&&(n=i.type.prop(j.closedBy))&&n.indexOf(s.name)>-1&&r.doc.lineAt(i.to).from==r.doc.lineAt(s.from).from&&!/\S/.test(r.sliceDoc(i.to,s.from))?{from:i.to,to:s.from}:null}const jd=$d(!1),Sy=$d(!0);function $d(r){return({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(s=>{let{from:n,to:o}=s,a=t.doc.lineAt(n),l=!r&&n==o&&by(t,n);r&&(n=o=(o<=a.to?a:t.doc.lineAt(o)).to);let h=new mn(t,{simulateBreak:n,simulateDoubleBreak:!!l}),c=Va(h,n);for(c==null&&(c=Zi(/^\s*/.exec(t.doc.lineAt(n).text)[0],t.tabSize));o<a.to&&/\s/.test(a.text[o-a.from]);)o++;l?{from:n,to:o}=l:n>a.from&&n<a.from+100&&!/\S/.test(a.text.slice(0,n))&&(n=a.from);let u=["",Qr(t,c)];return l&&u.push(Qr(t,h.lineIndent(a.from,-1))),{changes:{from:n,to:o,insert:G.of(u)},range:b.cursor(n+1+u[1].length)}});return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function Za(r,t){let e=-1;return r.changeByRange(i=>{let s=[];for(let o=i.from;o<=i.to;){let a=r.doc.lineAt(o);a.number>e&&(i.empty||i.to>a.from)&&(t(a,s,i),e=a.number),o=a.to+1}let n=r.changes(s);return{changes:s,range:b.range(n.mapPos(i.anchor,1),n.mapPos(i.head,1))}})}const ky=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let e=Object.create(null),i=new mn(r,{overrideIndentation:n=>e[n]??-1}),s=Za(r,(n,o,a)=>{let l=Va(i,n.from);if(l==null)return;/\S/.test(n.text)||(l=0);let h=/^\s*/.exec(n.text)[0],c=Qr(r,l);(h!=c||a.from<n.from+h.length)&&(e[n.from]=l,o.push({from:n.from,to:n.from+h.length,insert:c}))});return s.changes.empty||t(r.update(s,{userEvent:"indent"})),!0},Ay=({state:r,dispatch:t})=>r.readOnly?!1:(t(r.update(Za(r,(e,i)=>{i.push({from:e.from,insert:r.facet(Fa)})}),{userEvent:"input.indent"})),!0),Cy=({state:r,dispatch:t})=>r.readOnly?!1:(t(r.update(Za(r,(e,i)=>{let s=/^\s*/.exec(e.text)[0];if(!s)return;let n=Zi(s,r.tabSize),o=0,a=Qr(r,Math.max(0,n-pn(r)));for(;o<s.length&&o<a.length&&s.charCodeAt(o)==a.charCodeAt(o);)o++;i.push({from:e.from+o,to:e.from+s.length,insert:a.slice(o)})}),{userEvent:"delete.dedent"})),!0),Iy=r=>(r.setTabFocusMode(),!0),My=[{key:"Ctrl-b",run:pd,shift:Ad,preventDefault:!0},{key:"Ctrl-f",run:md,shift:Cd},{key:"Ctrl-p",run:yd,shift:Od},{key:"Ctrl-n",run:wd,shift:Dd},{key:"Ctrl-a",run:jv,shift:iy},{key:"Ctrl-e",run:$v,shift:ry},{key:"Ctrl-d",run:qd},{key:"Ctrl-h",run:Qa},{key:"Ctrl-k",run:uy},{key:"Ctrl-Alt-h",run:_d},{key:"Ctrl-o",run:py},{key:"Ctrl-t",run:my},{key:"Ctrl-v",run:Ja}],Oy=[{key:"ArrowLeft",run:pd,shift:Ad,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Nv,shift:Kv,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:Hv,shift:ty,preventDefault:!0},{key:"ArrowRight",run:md,shift:Cd,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Bv,shift:Yv,preventDefault:!0},{mac:"Cmd-ArrowRight",run:zv,shift:ey,preventDefault:!0},{key:"ArrowUp",run:yd,shift:Od,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Pd,shift:Nd},{mac:"Ctrl-ArrowUp",run:Sd,shift:Rd},{key:"ArrowDown",run:wd,shift:Dd,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Ld,shift:Bd},{mac:"Ctrl-ArrowDown",run:Ja,shift:Ed},{key:"PageUp",run:Sd,shift:Rd},{key:"PageDown",run:Ja,shift:Ed},{key:"Home",run:_v,shift:Zv,preventDefault:!0},{key:"Mod-Home",run:Pd,shift:Nd},{key:"End",run:Wv,shift:Qv,preventDefault:!0},{key:"Mod-End",run:Ld,shift:Bd},{key:"Enter",run:jd,shift:jd},{key:"Mod-a",run:sy},{key:"Backspace",run:Qa,shift:Qa,preventDefault:!0},{key:"Delete",run:qd,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:_d,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:cy,preventDefault:!0},{mac:"Mod-Backspace",run:dy,preventDefault:!0},{mac:"Mod-Delete",run:fy,preventDefault:!0}].concat(My.map(r=>({mac:r.key,run:r.run,shift:r.shift}))),Gd=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Vv,shift:Xv},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:qv,shift:Jv},{key:"Alt-ArrowUp",run:gy},{key:"Shift-Alt-ArrowUp",run:yy},{key:"Alt-ArrowDown",run:vy},{key:"Shift-Alt-ArrowDown",run:wy},{key:"Mod-Alt-ArrowUp",run:ay},{key:"Mod-Alt-ArrowDown",run:ly},{key:"Escape",run:hy},{key:"Mod-Enter",run:Sy},{key:"Alt-l",mac:"Ctrl-l",run:ny},{key:"Mod-i",run:oy,preventDefault:!0},{key:"Mod-[",run:Cy},{key:"Mod-]",run:Ay},{key:"Mod-Alt-\\",run:ky},{key:"Shift-Mod-k",run:xy},{key:"Shift-Mod-\\",run:Uv},{key:"Mod-/",run:vv},{key:"Alt-A",run:wv},{key:"Ctrl-m",mac:"Shift-Alt-m",run:Iy}].concat(Oy),Ud=typeof String.prototype.normalize=="function"?r=>r.normalize("NFKD"):r=>r;class ur{constructor(t,e,i=0,s=t.length,n,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(i,s),this.bufferStart=i,this.normalize=n?a=>n(Ud(a)):Ud,this.query=this.normalize(e)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Xt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let t=this.peek();if(t<0)return this.done=!0,this;let e=po(t),i=this.bufferStart+this.bufferPos;this.bufferPos+=Ee(t);let s=this.normalize(e);if(s.length)for(let n=0,o=i;;n++){let a=s.charCodeAt(n),l=this.match(a,o,this.bufferPos+this.bufferStart);if(n==s.length-1){if(l)return this.value=l,this;break}o==i&&n<e.length&&e.charCodeAt(n)==a&&o++}}}match(t,e,i){let s=null;for(let n=0;n<this.matches.length;n+=2){let o=this.matches[n],a=!1;this.query.charCodeAt(o)==t&&(o==this.query.length-1?s={from:this.matches[n+1],to:i}:(this.matches[n]++,a=!0)),a||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==t&&(this.query.length==1?s={from:e,to:i}:this.matches.push(1,e)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferStart)&&(s=null),s}}typeof Symbol<"u"&&(ur.prototype[Symbol.iterator]=function(){return this});const Kd={from:-1,to:-1,match:/.*/.exec("")},tl="gm"+(/x/.unicode==null?"":"u");class Yd{constructor(t,e,i,s=0,n=t.length){if(this.text=t,this.to=n,this.curLine="",this.done=!1,this.value=Kd,/\\[sWDnr]|\n|\r|\[\^/.test(e))return new Xd(t,e,i,s,n);this.re=new RegExp(e,tl+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.iter=t.iter();let o=t.lineAt(s);this.curLineStart=o.from,this.matchPos=In(t,s),this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;let e=this.matchPos<=this.to&&this.re.exec(this.curLine);if(e){let i=this.curLineStart+e.index,s=i+e[0].length;if(this.matchPos=In(this.text,s+(i==s?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<s||i>this.value.to)&&(!this.test||this.test(i,s,e)))return this.value={from:i,to:s,match:e},this;t=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),t=0;else return this.done=!0,this}}}const el=new WeakMap;class dr{constructor(t,e){this.from=t,this.text=e}get to(){return this.from+this.text.length}static get(t,e,i){let s=el.get(t);if(!s||s.from>=i||s.to<=e){let a=new dr(e,t.sliceString(e,i));return el.set(t,a),a}if(s.from==e&&s.to==i)return s;let{text:n,from:o}=s;return o>e&&(n=t.sliceString(e,o)+n,o=e),s.to<i&&(n+=t.sliceString(s.to,i)),el.set(t,new dr(o,n)),new dr(e,n.slice(e-o,i-o))}}class Xd{constructor(t,e,i,s,n){this.text=t,this.to=n,this.done=!1,this.value=Kd,this.matchPos=In(t,s),this.re=new RegExp(e,tl+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.flat=dr.get(t,s,this.chunkEnd(s+5e3))}chunkEnd(t){return t>=this.to?this.to:this.text.lineAt(t).to}next(){for(;;){let t=this.re.lastIndex=this.matchPos-this.flat.from,e=this.re.exec(this.flat.text);if(e&&!e[0]&&e.index==t&&(this.re.lastIndex=t+1,e=this.re.exec(this.flat.text)),e){let i=this.flat.from+e.index,s=i+e[0].length;if((this.flat.to>=this.to||e.index+e[0].length<=this.flat.text.length-10)&&(!this.test||this.test(i,s,e)))return this.value={from:i,to:s,match:e},this.matchPos=In(this.text,s+(i==s?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=dr.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(Yd.prototype[Symbol.iterator]=Xd.prototype[Symbol.iterator]=function(){return this});function Dy(r){try{return new RegExp(r,tl),!0}catch{return!1}}function In(r,t){if(t>=r.length)return t;let e=r.lineAt(t),i;for(;t<e.to&&(i=e.text.charCodeAt(t-e.from))>=56320&&i<57344;)t++;return t}const Ty=r=>{let{state:t}=r,e=String(t.doc.lineAt(r.state.selection.main.head).number),{close:i,result:s}=Y0(r,{label:t.phrase("Go to line"),input:{type:"text",name:"line",value:e},focus:!0,submitLabel:t.phrase("go")});return s.then(n=>{let o=n&&/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(n.elements.line.value);if(!o){r.dispatch({effects:i});return}let a=t.doc.lineAt(t.selection.main.head),[,l,h,c,u]=o,d=c?+c.slice(1):0,f=h?+h:a.number;if(h&&u){let g=f/100;l&&(g=g*(l=="-"?-1:1)+a.number/t.doc.lines),f=Math.round(t.doc.lines*g)}else h&&l&&(f=f*(l=="-"?-1:1)+a.number);let p=t.doc.line(Math.max(1,Math.min(t.doc.lines,f))),m=b.cursor(p.from+Math.max(0,Math.min(d,p.length)));r.dispatch({effects:[i,T.scrollIntoView(m.from,{y:"center"})],selection:m})}),!0},Ry={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Ey=O.define({combine(r){return be(r,Ry,{highlightWordAroundCursor:(t,e)=>t||e,minSelectionLength:Math.min,maxMatches:Math.min})}});function Py(r){return[Vy,Fy]}const Ly=L.mark({class:"cm-selectionMatch"}),Ny=L.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Jd(r,t,e,i){return(e==0||r(t.sliceDoc(e-1,e))!=tt.Word)&&(i==t.doc.length||r(t.sliceDoc(i,i+1))!=tt.Word)}function By(r,t,e,i){return r(t.sliceDoc(e,e+1))==tt.Word&&r(t.sliceDoc(i-1,i))==tt.Word}const Fy=ut.fromClass(class{constructor(r){this.decorations=this.getDeco(r)}update(r){(r.selectionSet||r.docChanged||r.viewportChanged)&&(this.decorations=this.getDeco(r.view))}getDeco(r){let t=r.state.facet(Ey),{state:e}=r,i=e.selection;if(i.ranges.length>1)return L.none;let s=i.main,n,o=null;if(s.empty){if(!t.highlightWordAroundCursor)return L.none;let l=e.wordAt(s.head);if(!l)return L.none;o=e.charCategorizer(s.head),n=e.sliceDoc(l.from,l.to)}else{let l=s.to-s.from;if(l<t.minSelectionLength||l>200)return L.none;if(t.wholeWords){if(n=e.sliceDoc(s.from,s.to),o=e.charCategorizer(s.head),!(Jd(o,e,s.from,s.to)&&By(o,e,s.from,s.to)))return L.none}else if(n=e.sliceDoc(s.from,s.to),!n)return L.none}let a=[];for(let l of r.visibleRanges){let h=new ur(e.doc,n,l.from,l.to);for(;!h.next().done;){let{from:c,to:u}=h.value;if((!o||Jd(o,e,c,u))&&(s.empty&&c<=s.from&&u>=s.to?a.push(Ny.range(c,u)):(c>=s.to||u<=s.from)&&a.push(Ly.range(c,u)),a.length>t.maxMatches))return L.none}}return L.set(a)}},{decorations:r=>r.decorations}),Vy=T.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),qy=({state:r,dispatch:t})=>{let{selection:e}=r,i=b.create(e.ranges.map(s=>r.wordAt(s.head)||b.cursor(s.head)),e.mainIndex);return i.eq(e)?!1:(t(r.update({selection:i})),!0)};function Wy(r,t){let{main:e,ranges:i}=r.selection,s=r.wordAt(e.head),n=s&&s.from==e.from&&s.to==e.to;for(let o=!1,a=new ur(r.doc,t,i[i.length-1].to);;)if(a.next(),a.done){if(o)return null;a=new ur(r.doc,t,0,Math.max(0,i[i.length-1].from-1)),o=!0}else{if(o&&i.some(l=>l.from==a.value.from))continue;if(n){let l=r.wordAt(a.value.from);if(!l||l.from!=a.value.from||l.to!=a.value.to)continue}return a.value}}const _y=({state:r,dispatch:t})=>{let{ranges:e}=r.selection;if(e.some(n=>n.from===n.to))return qy({state:r,dispatch:t});let i=r.sliceDoc(e[0].from,e[0].to);if(r.selection.ranges.some(n=>r.sliceDoc(n.from,n.to)!=i))return!1;let s=Wy(r,i);return s?(t(r.update({selection:r.selection.addRange(b.range(s.from,s.to),!1),effects:T.scrollIntoView(s.to)})),!0):!1},qi=O.define({combine(r){return be(r,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:t=>new ew(t),scrollToMatch:t=>T.scrollIntoView(t)})}});function Hy(r){return r?[qi.of(r),al]:al}class Qd{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.literal=!!t.literal,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||Dy(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!t.wholeWord,this.test=t.test}unquote(t){return this.literal?t:t.replace(/\\([nrt\\])/g,(e,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp&&this.wholeWord==t.wholeWord&&this.test==t.test}create(){return this.regexp?new Ky(this):new $y(this)}getCursor(t,e=0,i){let s=t.doc?t:$.create({doc:t});return i==null&&(i=s.doc.length),this.regexp?pr(this,s,e,i):fr(this,s,e,i)}}class Zd{constructor(t){this.spec=t}}function zy(r,t,e){return(i,s,n,o)=>{if(e&&!e(i,s,n,o))return!1;let a=i>=o&&s<=o+n.length?n.slice(i-o,s-o):t.doc.sliceString(i,s);return r(a,t,i,s)}}function fr(r,t,e,i){let s;return r.wholeWord&&(s=jy(t.doc,t.charCategorizer(t.selection.main.head))),r.test&&(s=zy(r.test,t,s)),new ur(t.doc,r.unquoted,e,i,r.caseSensitive?void 0:n=>n.toLowerCase(),s)}function jy(r,t){return(e,i,s,n)=>((n>e||n+s.length<i)&&(n=Math.max(0,e-2),s=r.sliceString(n,Math.min(r.length,i+2))),(t(Mn(s,e-n))!=tt.Word||t(On(s,e-n))!=tt.Word)&&(t(On(s,i-n))!=tt.Word||t(Mn(s,i-n))!=tt.Word))}class $y extends Zd{constructor(t){super(t)}nextMatch(t,e,i){let s=fr(this.spec,t,i,t.doc.length).nextOverlapping();if(s.done){let n=Math.min(t.doc.length,e+this.spec.unquoted.length);s=fr(this.spec,t,0,n).nextOverlapping()}return s.done||s.value.from==e&&s.value.to==i?null:s.value}prevMatchInRange(t,e,i){for(let s=i;;){let n=Math.max(e,s-1e4-this.spec.unquoted.length),o=fr(this.spec,t,n,s),a=null;for(;!o.nextOverlapping().done;)a=o.value;if(a)return a;if(n==e)return null;s-=1e4}}prevMatch(t,e,i){let s=this.prevMatchInRange(t,0,e);return s||(s=this.prevMatchInRange(t,Math.max(0,i-this.spec.unquoted.length),t.doc.length)),s&&(s.from!=e||s.to!=i)?s:null}getReplacement(t){return this.spec.unquote(this.spec.replace)}matchAll(t,e){let i=fr(this.spec,t,0,t.doc.length),s=[];for(;!i.next().done;){if(s.length>=e)return null;s.push(i.value)}return s}highlight(t,e,i,s){let n=fr(this.spec,t,Math.max(0,e-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,t.doc.length));for(;!n.next().done;)s(n.value.from,n.value.to)}}function Gy(r,t,e){return(i,s,n)=>(!e||e(i,s,n))&&r(n[0],t,i,s)}function pr(r,t,e,i){let s;return r.wholeWord&&(s=Uy(t.charCategorizer(t.selection.main.head))),r.test&&(s=Gy(r.test,t,s)),new Yd(t.doc,r.search,{ignoreCase:!r.caseSensitive,test:s},e,i)}function Mn(r,t){return r.slice(pt(r,t,!1),t)}function On(r,t){return r.slice(t,pt(r,t))}function Uy(r){return(t,e,i)=>!i[0].length||(r(Mn(i.input,i.index))!=tt.Word||r(On(i.input,i.index))!=tt.Word)&&(r(On(i.input,i.index+i[0].length))!=tt.Word||r(Mn(i.input,i.index+i[0].length))!=tt.Word)}class Ky extends Zd{nextMatch(t,e,i){let s=pr(this.spec,t,i,t.doc.length).next();return s.done&&(s=pr(this.spec,t,0,e).next()),s.done?null:s.value}prevMatchInRange(t,e,i){for(let s=1;;s++){let n=Math.max(e,i-s*1e4),o=pr(this.spec,t,n,i),a=null;for(;!o.next().done;)a=o.value;if(a&&(n==e||a.from>n+10))return a;if(n==e)return null}}prevMatch(t,e,i){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,i,t.doc.length)}getReplacement(t){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(e,i)=>{if(i=="&")return t.match[0];if(i=="$")return"$";for(let s=i.length;s>0;s--){let n=+i.slice(0,s);if(n>0&&n<t.match.length)return t.match[n]+i.slice(s)}return e})}matchAll(t,e){let i=pr(this.spec,t,0,t.doc.length),s=[];for(;!i.next().done;){if(s.length>=e)return null;s.push(i.value)}return s}highlight(t,e,i,s){let n=pr(this.spec,t,Math.max(0,e-250),Math.min(i+250,t.doc.length));for(;!n.next().done;)s(n.value.from,n.value.to)}}const is=F.define(),il=F.define(),wi=gt.define({create(r){return new rl(nl(r).create(),null)},update(r,t){for(let e of t.effects)e.is(is)?r=new rl(e.value.create(),r.panel):e.is(il)&&(r=new rl(r.query,e.value?sl:null));return r},provide:r=>jr.from(r,t=>t.panel)});class rl{constructor(t,e){this.query=t,this.panel=e}}const Yy=L.mark({class:"cm-searchMatch"}),Xy=L.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Jy=ut.fromClass(class{constructor(r){this.view=r,this.decorations=this.highlight(r.state.field(wi))}update(r){let t=r.state.field(wi);(t!=r.startState.field(wi)||r.docChanged||r.selectionSet||r.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:r,panel:t}){if(!t||!r.spec.valid)return L.none;let{view:e}=this,i=new Ye;for(let s=0,n=e.visibleRanges,o=n.length;s<o;s++){let{from:a,to:l}=n[s];for(;s<o-1&&l>n[s+1].from-500;)l=n[++s].to;r.highlight(e.state,a,l,(h,c)=>{let u=e.state.selection.ranges.some(d=>d.from==h&&d.to==c);i.add(h,c,u?Xy:Yy)})}return i.finish()}},{decorations:r=>r.decorations});function rs(r){return t=>{let e=t.state.field(wi,!1);return e&&e.query.spec.valid?r(t,e):sf(t)}}const Dn=rs((r,{query:t})=>{let{to:e}=r.state.selection.main,i=t.nextMatch(r.state,e,e);if(!i)return!1;let s=b.single(i.from,i.to),n=r.state.facet(qi);return r.dispatch({selection:s,effects:[ol(r,i),n.scrollToMatch(s.main,r)],userEvent:"select.search"}),rf(r),!0}),Tn=rs((r,{query:t})=>{let{state:e}=r,{from:i}=e.selection.main,s=t.prevMatch(e,i,i);if(!s)return!1;let n=b.single(s.from,s.to),o=r.state.facet(qi);return r.dispatch({selection:n,effects:[ol(r,s),o.scrollToMatch(n.main,r)],userEvent:"select.search"}),rf(r),!0}),Qy=rs((r,{query:t})=>{let e=t.matchAll(r.state,1e3);return!e||!e.length?!1:(r.dispatch({selection:b.create(e.map(i=>b.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),Zy=({state:r,dispatch:t})=>{let e=r.selection;if(e.ranges.length>1||e.main.empty)return!1;let{from:i,to:s}=e.main,n=[],o=0;for(let a=new ur(r.doc,r.sliceDoc(i,s));!a.next().done;){if(n.length>1e3)return!1;a.value.from==i&&(o=n.length),n.push(b.range(a.value.from,a.value.to))}return t(r.update({selection:b.create(n,o),userEvent:"select.search.matches"})),!0},tf=rs((r,{query:t})=>{let{state:e}=r,{from:i,to:s}=e.selection.main;if(e.readOnly)return!1;let n=t.nextMatch(e,i,i);if(!n)return!1;let o=n,a=[],l,h,c=[];o.from==i&&o.to==s&&(h=e.toText(t.getReplacement(o)),a.push({from:o.from,to:o.to,insert:h}),o=t.nextMatch(e,o.from,o.to),c.push(T.announce.of(e.phrase("replaced match on line $",e.doc.lineAt(i).number)+".")));let u=r.state.changes(a);return o&&(l=b.single(o.from,o.to).map(u),c.push(ol(r,o)),c.push(e.facet(qi).scrollToMatch(l.main,r))),r.dispatch({changes:u,selection:l,effects:c,userEvent:"input.replace"}),!0}),tw=rs((r,{query:t})=>{if(r.state.readOnly)return!1;let e=t.matchAll(r.state,1e9).map(s=>{let{from:n,to:o}=s;return{from:n,to:o,insert:t.getReplacement(s)}});if(!e.length)return!1;let i=r.state.phrase("replaced $ matches",e.length)+".";return r.dispatch({changes:e,effects:T.announce.of(i),userEvent:"input.replace.all"}),!0});function sl(r){return r.state.facet(qi).createPanel(r)}function nl(r,t){var e,i,s,n,o;let a=r.selection.main,l=a.empty||a.to>a.from+100?"":r.sliceDoc(a.from,a.to);if(t&&!l)return t;let h=r.facet(qi);return new Qd({search:((e=t==null?void 0:t.literal)!==null&&e!==void 0?e:h.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(i=t==null?void 0:t.caseSensitive)!==null&&i!==void 0?i:h.caseSensitive,literal:(s=t==null?void 0:t.literal)!==null&&s!==void 0?s:h.literal,regexp:(n=t==null?void 0:t.regexp)!==null&&n!==void 0?n:h.regexp,wholeWord:(o=t==null?void 0:t.wholeWord)!==null&&o!==void 0?o:h.wholeWord})}function ef(r){let t=Sa(r,sl);return t&&t.dom.querySelector("[main-field]")}function rf(r){let t=ef(r);t&&t==r.root.activeElement&&t.select()}const sf=r=>{let t=r.state.field(wi,!1);if(t&&t.panel){let e=ef(r);if(e&&e!=r.root.activeElement){let i=nl(r.state,t.query.spec);i.valid&&r.dispatch({effects:is.of(i)}),e.focus(),e.select()}}else r.dispatch({effects:[il.of(!0),t?is.of(nl(r.state,t.query.spec)):F.appendConfig.of(al)]});return!0},nf=r=>{let t=r.state.field(wi,!1);if(!t||!t.panel)return!1;let e=Sa(r,sl);return e&&e.dom.contains(r.root.activeElement)&&r.focus(),r.dispatch({effects:il.of(!1)}),!0},of=[{key:"Mod-f",run:sf,scope:"editor search-panel"},{key:"F3",run:Dn,shift:Tn,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Dn,shift:Tn,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:nf,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Zy},{key:"Mod-Alt-g",run:Ty},{key:"Mod-d",run:_y,preventDefault:!0}];class ew{constructor(t){this.view=t;let e=this.query=t.state.field(wi).query.spec;this.commit=this.commit.bind(this),this.searchField=Y("input",{value:e.search,placeholder:ae(t,"Find"),"aria-label":ae(t,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Y("input",{value:e.replace,placeholder:ae(t,"Replace"),"aria-label":ae(t,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Y("input",{type:"checkbox",name:"case",form:"",checked:e.caseSensitive,onchange:this.commit}),this.reField=Y("input",{type:"checkbox",name:"re",form:"",checked:e.regexp,onchange:this.commit}),this.wordField=Y("input",{type:"checkbox",name:"word",form:"",checked:e.wholeWord,onchange:this.commit});function i(s,n,o){return Y("button",{class:"cm-button",name:s,onclick:n,type:"button"},o)}this.dom=Y("div",{onkeydown:s=>this.keydown(s),class:"cm-search"},[this.searchField,i("next",()=>Dn(t),[ae(t,"next")]),i("prev",()=>Tn(t),[ae(t,"previous")]),i("select",()=>Qy(t),[ae(t,"all")]),Y("label",null,[this.caseField,ae(t,"match case")]),Y("label",null,[this.reField,ae(t,"regexp")]),Y("label",null,[this.wordField,ae(t,"by word")]),...t.state.readOnly?[]:[Y("br"),this.replaceField,i("replace",()=>tf(t),[ae(t,"replace")]),i("replaceAll",()=>tw(t),[ae(t,"replace all")])],Y("button",{name:"close",onclick:()=>nf(t),"aria-label":ae(t,"close"),type:"button"},["\xD7"])])}commit(){let t=new Qd({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});t.eq(this.query)||(this.query=t,this.view.dispatch({effects:is.of(t)}))}keydown(t){l0(this.view,t,"search-panel")?t.preventDefault():t.keyCode==13&&t.target==this.searchField?(t.preventDefault(),(t.shiftKey?Tn:Dn)(this.view)):t.keyCode==13&&t.target==this.replaceField&&(t.preventDefault(),tf(this.view))}update(t){for(let e of t.transactions)for(let i of e.effects)i.is(is)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(t){this.query=t,this.searchField.value=t.search,this.replaceField.value=t.replace,this.caseField.checked=t.caseSensitive,this.reField.checked=t.regexp,this.wordField.checked=t.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(qi).top}}function ae(r,t){return r.state.phrase(t)}const Rn=30,En=/[\s\.,:;?!]/;function ol(r,{from:t,to:e}){let i=r.state.doc.lineAt(t),s=r.state.doc.lineAt(e).to,n=Math.max(i.from,t-Rn),o=Math.min(s,e+Rn),a=r.state.sliceDoc(n,o);if(n!=i.from){for(let l=0;l<Rn;l++)if(!En.test(a[l+1])&&En.test(a[l])){a=a.slice(l);break}}if(o!=s){for(let l=a.length-1;l>a.length-Rn;l--)if(!En.test(a[l-1])&&En.test(a[l])){a=a.slice(0,l);break}}return T.announce.of(`${r.state.phrase("current match")}. ${a} ${r.state.phrase("on line")} ${i.number}.`)}const iw=T.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),al=[wi,Ti.low(Jy),iw];class af{constructor(t,e,i,s){this.state=t,this.pos=e,this.explicit=i,this.view=s,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(t){let e=Et(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),i=Math.max(e.from,this.pos-250),s=e.text.slice(i-e.from,this.pos-e.from),n=s.search(cf(t,!1));return n<0?null:{from:i+n,to:this.pos,text:s.slice(n)}}get aborted(){return this.abortListeners==null}addEventListener(t,e,i){t=="abort"&&this.abortListeners&&(this.abortListeners.push(e),i&&i.onDocChange&&(this.abortOnDocChange=!0))}}function lf(r){let t=Object.keys(r).join(""),e=/\w/.test(t);return e&&(t=t.replace(/\w/g,"")),`[${e?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function rw(r){let t=Object.create(null),e=Object.create(null);for(let{label:s}of r){t[s[0]]=!0;for(let n=1;n<s.length;n++)e[s[n]]=!0}let i=lf(t)+lf(e)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function sw(r){let t=r.map(s=>typeof s=="string"?{label:s}:s),[e,i]=t.every(s=>/^\w+$/.test(s.label))?[/\w*$/,/\w+$/]:rw(t);return s=>{let n=s.matchBefore(i);return n||s.explicit?{from:n?n.from:s.pos,options:t,validFor:e}:null}}class hf{constructor(t,e,i,s){this.completion=t,this.source=e,this.match=i,this.score=s}}function Wi(r){return r.selection.main.from}function cf(r,t){var e;let{source:i}=r,s=t&&i[0]!="^",n=i[i.length-1]!="$";return!s&&!n?r:new RegExp(`${s?"^":""}(?:${i})${n?"$":""}`,(e=r.flags)!==null&&e!==void 0?e:r.ignoreCase?"i":"")}const uf=Ke.define();function nw(r,t,e,i){let{main:s}=r.selection,n=e-s.from,o=i-s.from;return{...r.changeByRange(a=>{if(a!=s&&e!=i&&r.sliceDoc(a.from+n,a.from+o)!=r.sliceDoc(e,i))return{range:a};let l=r.toText(t);return{changes:{from:a.from+n,to:i==s.from?a.to:a.from+o,insert:l},range:b.cursor(a.from+n+l.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const df=new WeakMap;function ow(r){if(!Array.isArray(r))return r;let t=df.get(r);return t||df.set(r,t=sw(r)),t}const Pn=F.define(),ss=F.define();class aw{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let e=0;e<t.length;){let i=Xt(t,e),s=Ee(i);this.chars.push(i);let n=t.slice(e,e+s),o=n.toUpperCase();this.folded.push(Xt(o==n?n.toLowerCase():o,0)),e+=s}this.astral=t.length!=this.chars.length}ret(t,e){return this.score=t,this.matched=e,this}match(t){if(this.pattern.length==0)return this.ret(-100,[]);if(t.length<this.pattern.length)return null;let{chars:e,folded:i,any:s,precise:n,byWord:o}=this;if(e.length==1){let S=Xt(t,0),w=Ee(S),C=w==t.length?0:-100;if(S!=e[0])if(S==i[0])C+=-200;else return null;return this.ret(C,[0,w])}let a=t.indexOf(this.pattern);if(a==0)return this.ret(t.length==this.pattern.length?0:-100,[0,this.pattern.length]);let l=e.length,h=0;if(a<0){for(let S=0,w=Math.min(t.length,200);S<w&&h<l;){let C=Xt(t,S);(C==e[h]||C==i[h])&&(s[h++]=S),S+=Ee(C)}if(h<l)return null}let c=0,u=0,d=!1,f=0,p=-1,m=-1,g=/[a-z]/.test(t),v=!0;for(let S=0,w=Math.min(t.length,200),C=0;S<w&&u<l;){let x=Xt(t,S);a<0&&(c<l&&x==e[c]&&(n[c++]=S),f<l&&(x==e[f]||x==i[f]?(f==0&&(p=S),m=S+1,f++):f=0));let k,A=x<255?x>=48&&x<=57||x>=97&&x<=122?2:x>=65&&x<=90?1:0:(k=po(x))!=k.toLowerCase()?1:k!=k.toUpperCase()?2:0;(!S||A==1&&g||C==0&&A!=0)&&(e[u]==x||i[u]==x&&(d=!0)?o[u++]=S:o.length&&(v=!1)),C=A,S+=Ee(x)}return u==l&&o[0]==0&&v?this.result(-100+(d?-200:0),o,t):f==l&&p==0?this.ret(-200-t.length+(m==t.length?0:-100),[0,m]):a>-1?this.ret(-700-t.length,[a,a+this.pattern.length]):f==l?this.ret(-900-t.length,[p,m]):u==l?this.result(-100+(d?-200:0)+-700+(v?0:-1100),o,t):e.length==2?null:this.result((s[0]?-700:0)+-200+-1100,s,t)}result(t,e,i){let s=[],n=0;for(let o of e){let a=o+(this.astral?Ee(Xt(i,o)):1);n&&s[n-1]==o?s[n-1]=a:(s[n++]=o,s[n++]=a)}return this.ret(t-i.length,s)}}class lw{constructor(t){this.pattern=t,this.matched=[],this.score=0,this.folded=t.toLowerCase()}match(t){if(t.length<this.pattern.length)return null;let e=t.slice(0,this.pattern.length),i=e==this.pattern?0:e.toLowerCase()==this.folded?-200:null;return i==null?null:(this.matched=[0,e.length],this.score=i+(t.length==this.pattern.length?0:-100),this)}}const bt=O.define({combine(r){return be(r,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:hw,filterStrict:!1,compareCompletions:(t,e)=>(t.sortText||t.label).localeCompare(e.sortText||e.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(t,e)=>t&&e,closeOnBlur:(t,e)=>t&&e,icons:(t,e)=>t&&e,tooltipClass:(t,e)=>i=>ff(t(i),e(i)),optionClass:(t,e)=>i=>ff(t(i),e(i)),addToOptions:(t,e)=>t.concat(e),filterStrict:(t,e)=>t||e})}});function ff(r,t){return r?t?r+" "+t:r:t}function hw(r,t,e,i,s,n){let o=r.textDirection==X.RTL,a=o,l=!1,h="top",c,u,d=t.left-s.left,f=s.right-t.right,p=i.right-i.left,m=i.bottom-i.top;if(a&&d<Math.min(p,f)?a=!1:!a&&f<Math.min(p,d)&&(a=!0),p<=(a?d:f))c=Math.max(s.top,Math.min(e.top,s.bottom-m))-t.top,u=Math.min(400,a?d:f);else{l=!0,u=Math.min(400,(o?t.right:s.right-t.left)-30);let S=s.bottom-t.bottom;S>=m||S>t.top?c=e.bottom-t.top:(h="bottom",c=t.bottom-e.top)}let g=(t.bottom-t.top)/n.offsetHeight,v=(t.right-t.left)/n.offsetWidth;return{style:`${h}: ${c/g}px; max-width: ${u/v}px`,class:"cm-completionInfo-"+(l?o?"left-narrow":"right-narrow":a?"left":"right")}}function cw(r){let t=r.addToOptions.slice();return r.icons&&t.push({render(e){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),e.type&&i.classList.add(...e.type.split(/\s+/g).map(s=>"cm-completionIcon-"+s)),i.setAttribute("aria-hidden","true"),i},position:20}),t.push({render(e,i,s,n){let o=document.createElement("span");o.className="cm-completionLabel";let a=e.displayLabel||e.label,l=0;for(let h=0;h<n.length;){let c=n[h++],u=n[h++];c>l&&o.appendChild(document.createTextNode(a.slice(l,c)));let d=o.appendChild(document.createElement("span"));d.appendChild(document.createTextNode(a.slice(c,u))),d.className="cm-completionMatchedText",l=u}return l<a.length&&o.appendChild(document.createTextNode(a.slice(l))),o},position:50},{render(e){if(!e.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=e.detail,i},position:80}),t.sort((e,i)=>e.position-i.position).map(e=>e.render)}function ll(r,t,e){if(r<=e)return{from:0,to:r};if(t<0&&(t=0),t<=r>>1){let s=Math.floor(t/e);return{from:s*e,to:(s+1)*e}}let i=Math.floor((r-t)/e);return{from:r-(i+1)*e,to:r-i*e}}class uw{constructor(t,e,i){this.view=t,this.stateField=e,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:l=>this.placeInfo(l),key:this},this.space=null,this.currentClass="";let s=t.state.field(e),{options:n,selected:o}=s.open,a=t.state.facet(bt);this.optionContent=cw(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=ll(n.length,o,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(t.state),this.dom.addEventListener("mousedown",l=>{let{options:h}=t.state.field(e).open;for(let c=l.target,u;c&&c!=this.dom;c=c.parentNode)if(c.nodeName=="LI"&&(u=/-(\d+)$/.exec(c.id))&&+u[1]<h.length){this.applyCompletion(t,h[+u[1]]),l.preventDefault();return}}),this.dom.addEventListener("focusout",l=>{let h=t.state.field(this.stateField,!1);h&&h.tooltip&&t.state.facet(bt).closeOnBlur&&l.relatedTarget!=t.contentDOM&&t.dispatch({effects:ss.of(null)})}),this.showOptions(n,s.id)}mount(){this.updateSel()}showOptions(t,e){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t,e,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(t){var e;let i=t.state.field(this.stateField),s=t.startState.field(this.stateField);if(this.updateTooltipClass(t.state),i!=s){let{options:n,selected:o,disabled:a}=i.open;(!s.open||s.open.options!=n)&&(this.range=ll(n.length,o,t.state.facet(bt).maxRenderedOptions),this.showOptions(n,i.id)),this.updateSel(),a!=((e=s.open)===null||e===void 0?void 0:e.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!a)}}updateTooltipClass(t){let e=this.tooltipClass(t);if(e!=this.currentClass){for(let i of this.currentClass.split(" "))i&&this.dom.classList.remove(i);for(let i of e.split(" "))i&&this.dom.classList.add(i);this.currentClass=e}}positioned(t){this.space=t,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let t=this.view.state.field(this.stateField),e=t.open;(e.selected>-1&&e.selected<this.range.from||e.selected>=this.range.to)&&(this.range=ll(e.options.length,e.selected,this.view.state.facet(bt).maxRenderedOptions),this.showOptions(e.options,t.id));let i=this.updateSelectedOption(e.selected);if(i){this.destroyInfo();let{completion:s}=e.options[e.selected],{info:n}=s;if(!n)return;let o=typeof n=="string"?document.createTextNode(n):n(s);if(!o)return;"then"in o?o.then(a=>{a&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(a,s)}).catch(a=>Jt(this.view.state,a,"completion info")):(this.addInfoPane(o,s),i.setAttribute("aria-describedby",this.info.id))}}addInfoPane(t,e){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",i.id="cm-completionInfo-"+Math.floor(Math.random()*65535).toString(16),t.nodeType!=null)i.appendChild(t),this.infoDestroy=null;else{let{dom:s,destroy:n}=t;i.appendChild(s),this.infoDestroy=n||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(t){let e=null;for(let i=this.list.firstChild,s=this.range.from;i;i=i.nextSibling,s++)i.nodeName!="LI"||!i.id?s--:s==t?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),e=i):i.hasAttribute("aria-selected")&&(i.removeAttribute("aria-selected"),i.removeAttribute("aria-describedby"));return e&&fw(this.list,e),e}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let e=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),s=t.getBoundingClientRect(),n=this.space;if(!n){let o=this.dom.ownerDocument.documentElement;n={left:0,top:0,right:o.clientWidth,bottom:o.clientHeight}}return s.top>Math.min(n.bottom,e.bottom)-10||s.bottom<Math.max(n.top,e.top)+10?null:this.view.state.facet(bt).positionInfo(this.view,e,s,i,n,this.dom)}placeInfo(t){this.info&&(t?(t.style&&(this.info.style.cssText=t.style),this.info.className="cm-tooltip cm-completionInfo "+(t.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(t,e,i){const s=document.createElement("ul");s.id=e,s.setAttribute("role","listbox"),s.setAttribute("aria-expanded","true"),s.setAttribute("aria-label",this.view.state.phrase("Completions")),s.addEventListener("mousedown",o=>{o.target==s&&o.preventDefault()});let n=null;for(let o=i.from;o<i.to;o++){let{completion:a,match:l}=t[o],{section:h}=a;if(h){let d=typeof h=="string"?h:h.name;if(d!=n&&(o>i.from||i.from==0))if(n=d,typeof h!="string"&&h.header)s.appendChild(h.header(h));else{let f=s.appendChild(document.createElement("completion-section"));f.textContent=d}}const c=s.appendChild(document.createElement("li"));c.id=e+"-"+o,c.setAttribute("role","option");let u=this.optionClass(a);u&&(c.className=u);for(let d of this.optionContent){let f=d(a,this.view.state,this.view,l);f&&c.appendChild(f)}}return i.from&&s.classList.add("cm-completionListIncompleteTop"),i.to<t.length&&s.classList.add("cm-completionListIncompleteBottom"),s}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function dw(r,t){return e=>new uw(e,r,t)}function fw(r,t){let e=r.getBoundingClientRect(),i=t.getBoundingClientRect(),s=e.height/r.offsetHeight;i.top<e.top?r.scrollTop-=(e.top-i.top)/s:i.bottom>e.bottom&&(r.scrollTop+=(i.bottom-e.bottom)/s)}function pf(r){return(r.boost||0)*100+(r.apply?10:0)+(r.info?5:0)+(r.type?1:0)}function pw(r,t){let e=[],i=null,s=null,n=c=>{e.push(c);let{section:u}=c.completion;if(u){i||(i=[]);let d=typeof u=="string"?u:u.name;i.some(f=>f.name==d)||i.push(typeof u=="string"?{name:d}:u)}},o=t.facet(bt);for(let c of r)if(c.hasResult()){let u=c.result.getMatch;if(c.result.filter===!1)for(let d of c.result.options)n(new hf(d,c.source,u?u(d):[],1e9-e.length));else{let d=t.sliceDoc(c.from,c.to),f,p=o.filterStrict?new lw(d):new aw(d);for(let m of c.result.options)if(f=p.match(m.label)){let g=m.displayLabel?u?u(m,f.matched):[]:f.matched,v=f.score+(m.boost||0);if(n(new hf(m,c.source,g,v)),typeof m.section=="object"&&m.section.rank==="dynamic"){let{name:S}=m.section;s||(s=Object.create(null)),s[S]=Math.max(v,s[S]||-1e9)}}}}if(i){let c=Object.create(null),u=0,d=(f,p)=>(f.rank==="dynamic"&&p.rank==="dynamic"?s[p.name]-s[f.name]:0)||(typeof f.rank=="number"?f.rank:1e9)-(typeof p.rank=="number"?p.rank:1e9)||(f.name<p.name?-1:1);for(let f of i.sort(d))u-=1e5,c[f.name]=u;for(let f of e){let{section:p}=f.completion;p&&(f.score+=c[typeof p=="string"?p:p.name])}}let a=[],l=null,h=o.compareCompletions;for(let c of e.sort((u,d)=>d.score-u.score||h(u.completion,d.completion))){let u=c.completion;!l||l.label!=u.label||l.detail!=u.detail||l.type!=null&&u.type!=null&&l.type!=u.type||l.apply!=u.apply||l.boost!=u.boost?a.push(c):pf(c.completion)>pf(l)&&(a[a.length-1]=c),l=c.completion}return a}class mr{constructor(t,e,i,s,n,o){this.options=t,this.attrs=e,this.tooltip=i,this.timestamp=s,this.selected=n,this.disabled=o}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new mr(this.options,mf(e,t),this.tooltip,this.timestamp,t,this.disabled)}static build(t,e,i,s,n,o){if(s&&!o&&t.some(h=>h.isPending))return s.setDisabled();let a=pw(t,e);if(!a.length)return s&&t.some(h=>h.isPending)?s.setDisabled():null;let l=e.facet(bt).selectOnOpen?0:-1;if(s&&s.selected!=l&&s.selected!=-1){let h=s.options[s.selected].completion;for(let c=0;c<a.length;c++)if(a[c].completion==h){l=c;break}}return new mr(a,mf(i,l),{pos:t.reduce((h,c)=>c.hasResult()?Math.min(h,c.from):h,1e8),create:xw,above:n.aboveCursor},s?s.timestamp:Date.now(),l,!1)}map(t){return new mr(this.options,this.attrs,{...this.tooltip,pos:t.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new mr(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class Ln{constructor(t,e,i){this.active=t,this.id=e,this.open=i}static start(){return new Ln(yw,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(t){let{state:e}=t,i=e.facet(bt),s=(i.override||e.languageDataAt("autocomplete",Wi(e)).map(ow)).map(a=>(this.active.find(l=>l.source==a)||new ve(a,this.active.some(l=>l.state!=0)?1:0)).update(t,i));s.length==this.active.length&&s.every((a,l)=>a==this.active[l])&&(s=this.active);let n=this.open,o=t.effects.some(a=>a.is(hl));n&&t.docChanged&&(n=n.map(t.changes)),t.selection||s.some(a=>a.hasResult()&&t.changes.touchesRange(a.from,a.to))||!mw(s,this.active)||o?n=mr.build(s,e,this.id,n,i,o):n&&n.disabled&&!s.some(a=>a.isPending)&&(n=null),!n&&s.every(a=>!a.isPending)&&s.some(a=>a.hasResult())&&(s=s.map(a=>a.hasResult()?new ve(a.source,0):a));for(let a of t.effects)a.is(vf)&&(n=n&&n.setSelected(a.value,this.id));return s==this.active&&n==this.open?this:new Ln(s,this.id,n)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?gw:vw}}function mw(r,t){if(r==t)return!0;for(let e=0,i=0;;){for(;e<r.length&&!r[e].hasResult();)e++;for(;i<t.length&&!t[i].hasResult();)i++;let s=e==r.length,n=i==t.length;if(s||n)return s==n;if(r[e++].result!=t[i++].result)return!1}}const gw={"aria-autocomplete":"list"},vw={};function mf(r,t){let e={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":r};return t>-1&&(e["aria-activedescendant"]=r+"-"+t),e}const yw=[];function gf(r,t){if(r.isUserEvent("input.complete")){let i=r.annotation(uf);if(i&&t.activateOnCompletion(i))return 12}let e=r.isUserEvent("input.type");return e&&t.activateOnTyping?5:e?1:r.isUserEvent("delete.backward")?2:r.selection?8:r.docChanged?16:0}class ve{constructor(t,e,i=!1){this.source=t,this.state=e,this.explicit=i}hasResult(){return!1}get isPending(){return this.state==1}update(t,e){let i=gf(t,e),s=this;(i&8||i&16&&this.touches(t))&&(s=new ve(s.source,0)),i&4&&s.state==0&&(s=new ve(this.source,1)),s=s.updateFor(t,i);for(let n of t.effects)if(n.is(Pn))s=new ve(s.source,1,n.value);else if(n.is(ss))s=new ve(s.source,0);else if(n.is(hl))for(let o of n.value)o.source==s.source&&(s=o);return s}updateFor(t,e){return this.map(t.changes)}map(t){return this}touches(t){return t.changes.touchesRange(Wi(t.state))}}class gr extends ve{constructor(t,e,i,s,n,o){super(t,3,e),this.limit=i,this.result=s,this.from=n,this.to=o}hasResult(){return!0}updateFor(t,e){var i;if(!(e&3))return this.map(t.changes);let s=this.result;s.map&&!t.changes.empty&&(s=s.map(s,t.changes));let n=t.changes.mapPos(this.from),o=t.changes.mapPos(this.to,1),a=Wi(t.state);if(a>o||!s||e&2&&(Wi(t.startState)==this.from||a<this.limit))return new ve(this.source,e&4?1:0);let l=t.changes.mapPos(this.limit);return ww(s.validFor,t.state,n,o)?new gr(this.source,this.explicit,l,s,n,o):s.update&&(s=s.update(s,n,o,new af(t.state,a,!1)))?new gr(this.source,this.explicit,l,s,s.from,(i=s.to)!==null&&i!==void 0?i:Wi(t.state)):new ve(this.source,1,this.explicit)}map(t){return t.empty?this:(this.result.map?this.result.map(this.result,t):this.result)?new gr(this.source,this.explicit,t.mapPos(this.limit),this.result,t.mapPos(this.from),t.mapPos(this.to,1)):new ve(this.source,0)}touches(t){return t.changes.touchesRange(this.from,this.to)}}function ww(r,t,e,i){if(!r)return!1;let s=t.sliceDoc(e,i);return typeof r=="function"?r(s,e,i,t):cf(r,!0).test(s)}const hl=F.define({map(r,t){return r.map(e=>e.map(t))}}),vf=F.define(),te=gt.define({create(){return Ln.start()},update(r,t){return r.update(t)},provide:r=>[tn.from(r,t=>t.tooltip),T.contentAttributes.from(r,t=>t.attrs)]});function cl(r,t){const e=t.completion.apply||t.completion.label;let i=r.state.field(te).active.find(s=>s.source==t.source);return i instanceof gr?(typeof e=="string"?r.dispatch({...nw(r.state,e,i.from,i.to),annotations:uf.of(t.completion)}):e(r,t.completion,i.from,i.to),!0):!1}const xw=dw(te,cl);function Nn(r,t="option"){return e=>{let i=e.state.field(te,!1);if(!i||!i.open||i.open.disabled||Date.now()-i.open.timestamp<e.state.facet(bt).interactionDelay)return!1;let s=1,n;t=="page"&&(n=mu(e,i.open.tooltip))&&(s=Math.max(2,Math.floor(n.dom.offsetHeight/n.dom.querySelector("li").offsetHeight)-1));let{length:o}=i.open.options,a=i.open.selected>-1?i.open.selected+s*(r?1:-1):r?0:o-1;return a<0?a=t=="page"?0:o-1:a>=o&&(a=t=="page"?o-1:0),e.dispatch({effects:vf.of(a)}),!0}}const bw=r=>{let t=r.state.field(te,!1);return r.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<r.state.facet(bt).interactionDelay?!1:cl(r,t.open.options[t.open.selected])},ul=r=>r.state.field(te,!1)?(r.dispatch({effects:Pn.of(!0)}),!0):!1,Sw=r=>{let t=r.state.field(te,!1);return!t||!t.active.some(e=>e.state!=0)?!1:(r.dispatch({effects:ss.of(null)}),!0)};class kw{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}const Aw=50,Cw=1e3,Iw=ut.fromClass(class{constructor(r){this.view=r,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of r.state.field(te).active)t.isPending&&this.startQuery(t)}update(r){let t=r.state.field(te),e=r.state.facet(bt);if(!r.selectionSet&&!r.docChanged&&r.startState.field(te)==t)return;let i=r.transactions.some(n=>{let o=gf(n,e);return o&8||(n.selection||n.docChanged)&&!(o&3)});for(let n=0;n<this.running.length;n++){let o=this.running[n];if(i||o.context.abortOnDocChange&&r.docChanged||o.updates.length+r.transactions.length>Aw&&Date.now()-o.time>Cw){for(let a of o.context.abortListeners)try{a()}catch(l){Jt(this.view.state,l)}o.context.abortListeners=null,this.running.splice(n--,1)}else o.updates.push(...r.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),r.transactions.some(n=>n.effects.some(o=>o.is(Pn)))&&(this.pendingStart=!0);let s=this.pendingStart?50:e.activateOnTypingDelay;if(this.debounceUpdate=t.active.some(n=>n.isPending&&!this.running.some(o=>o.active.source==n.source))?setTimeout(()=>this.startUpdate(),s):-1,this.composing!=0)for(let n of r.transactions)n.isUserEvent("input.type")?this.composing=2:this.composing==2&&n.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:r}=this.view,t=r.field(te);for(let e of t.active)e.isPending&&!this.running.some(i=>i.active.source==e.source)&&this.startQuery(e);this.running.length&&t.open&&t.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(bt).updateSyncTime))}startQuery(r){let{state:t}=this.view,e=Wi(t),i=new af(t,e,r.explicit,this.view),s=new kw(r,i);this.running.push(s),Promise.resolve(r.source(i)).then(n=>{s.context.aborted||(s.done=n||null,this.scheduleAccept())},n=>{this.view.dispatch({effects:ss.of(null)}),Jt(this.view.state,n)})}scheduleAccept(){this.running.every(r=>r.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(bt).updateSyncTime))}accept(){var r;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],e=this.view.state.facet(bt),i=this.view.state.field(te);for(let s=0;s<this.running.length;s++){let n=this.running[s];if(n.done===void 0)continue;if(this.running.splice(s--,1),n.done){let a=Wi(n.updates.length?n.updates[0].startState:this.view.state),l=Math.min(a,n.done.from+(n.active.explicit?0:1)),h=new gr(n.active.source,n.active.explicit,l,n.done,n.done.from,(r=n.done.to)!==null&&r!==void 0?r:a);for(let c of n.updates)h=h.update(c,e);if(h.hasResult()){t.push(h);continue}}let o=i.active.find(a=>a.source==n.active.source);if(o&&o.isPending)if(n.done==null){let a=new ve(n.active.source,0);for(let l of n.updates)a=a.update(l,e);a.isPending||t.push(a)}else this.startQuery(o)}(t.length||i.open&&i.open.disabled)&&this.view.dispatch({effects:hl.of(t)})}},{eventHandlers:{blur(r){let t=this.view.state.field(te,!1);if(t&&t.tooltip&&this.view.state.facet(bt).closeOnBlur){let e=t.open&&mu(this.view,t.open.tooltip);(!e||!e.dom.contains(r.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:ss.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Pn.of(!1)}),20),this.composing=0}}}),Mw=typeof navigator=="object"&&/Win/.test(navigator.platform),Ow=Ti.highest(T.domEventHandlers({keydown(r,t){let e=t.state.field(te,!1);if(!e||!e.open||e.open.disabled||e.open.selected<0||r.key.length>1||r.ctrlKey&&!(Mw&&r.altKey)||r.metaKey)return!1;let i=e.open.options[e.open.selected],s=e.active.find(o=>o.source==i.source),n=i.completion.commitCharacters||s.result.commitCharacters;return n&&n.indexOf(r.key)>-1&&cl(t,i),!1}})),Dw=T.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),ns={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},_i=F.define({map(r,t){return t.mapPos(r,-1,Wt.TrackAfter)??void 0}}),dl=new class extends ai{};dl.startSide=1,dl.endSide=-1;const yf=gt.define({create(){return W.empty},update(r,t){if(r=r.map(t.changes),t.selection){let e=t.state.doc.lineAt(t.selection.main.head);r=r.update({filter:i=>i>=e.from&&i<=e.to})}for(let e of t.effects)e.is(_i)&&(r=r.update({add:[dl.range(e.value,e.value+1)]}));return r}});function Tw(){return[Ew,yf]}const fl="()[]{}<>\xAB\xBB\xBB\xAB\uFF3B\uFF3D\uFF5B\uFF5D";function wf(r){for(let t=0;t<fl.length;t+=2)if(fl.charCodeAt(t)==r)return fl.charAt(t+1);return po(r<128?r:r+1)}function xf(r,t){return r.languageDataAt("closeBrackets",t)[0]||ns}const Rw=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),Ew=T.inputHandler.of((r,t,e,i)=>{if((Rw?r.composing:r.compositionStarted)||r.state.readOnly)return!1;let s=r.state.selection.main;if(i.length>2||i.length==2&&Ee(Xt(i,0))==1||t!=s.from||e!=s.to)return!1;let n=Nw(r.state,i);return n?(r.dispatch(n),!0):!1}),Pw=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let e=xf(r,r.selection.main.head).brackets||ns.brackets,i=null,s=r.changeByRange(n=>{if(n.empty){let o=Bw(r.doc,n.head);for(let a of e)if(a==o&&Bn(r.doc,n.head)==wf(Xt(a,0)))return{changes:{from:n.head-a.length,to:n.head+a.length},range:b.cursor(n.head-a.length)}}return{range:i=n}});return i||t(r.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!i},Lw=[{key:"Backspace",run:Pw}];function Nw(r,t){let e=xf(r,r.selection.main.head),i=e.brackets||ns.brackets;for(let s of i){let n=wf(Xt(s,0));if(t==s)return n==s?qw(r,s,i.indexOf(s+s+s)>-1,e):Fw(r,s,n,e.before||ns.before);if(t==n&&bf(r,r.selection.main.from))return Vw(r,s,n)}return null}function bf(r,t){let e=!1;return r.field(yf).between(0,r.doc.length,i=>{i==t&&(e=!0)}),e}function Bn(r,t){let e=r.sliceString(t,t+2);return e.slice(0,Ee(Xt(e,0)))}function Bw(r,t){let e=r.sliceString(t-2,t);return Ee(Xt(e,0))==e.length?e:e.slice(1)}function Fw(r,t,e,i){let s=null,n=r.changeByRange(o=>{if(!o.empty)return{changes:[{insert:t,from:o.from},{insert:e,from:o.to}],effects:_i.of(o.to+t.length),range:b.range(o.anchor+t.length,o.head+t.length)};let a=Bn(r.doc,o.head);return!a||/\s/.test(a)||i.indexOf(a)>-1?{changes:{insert:t+e,from:o.head},effects:_i.of(o.head+t.length),range:b.cursor(o.head+t.length)}:{range:s=o}});return s?null:r.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function Vw(r,t,e){let i=null,s=r.changeByRange(n=>n.empty&&Bn(r.doc,n.head)==e?{changes:{from:n.head,to:n.head+e.length,insert:e},range:b.cursor(n.head+e.length)}:i={range:n});return i?null:r.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function qw(r,t,e,i){let s=i.stringPrefixes||ns.stringPrefixes,n=null,o=r.changeByRange(a=>{if(!a.empty)return{changes:[{insert:t,from:a.from},{insert:t,from:a.to}],effects:_i.of(a.to+t.length),range:b.range(a.anchor+t.length,a.head+t.length)};let l=a.head,h=Bn(r.doc,l),c;if(h==t){if(Sf(r,l))return{changes:{insert:t+t,from:l},effects:_i.of(l+t.length),range:b.cursor(l+t.length)};if(bf(r,l)){let u=e&&r.sliceDoc(l,l+t.length*3)==t+t+t?t+t+t:t;return{changes:{from:l,to:l+u.length,insert:u},range:b.cursor(l+u.length)}}}else{if(e&&r.sliceDoc(l-2*t.length,l)==t+t&&(c=kf(r,l-2*t.length,s))>-1&&Sf(r,c))return{changes:{insert:t+t+t+t,from:l},effects:_i.of(l+t.length),range:b.cursor(l+t.length)};if(r.charCategorizer(l)(h)!=tt.Word&&kf(r,l,s)>-1&&!Ww(r,l,t,s))return{changes:{insert:t+t,from:l},effects:_i.of(l+t.length),range:b.cursor(l+t.length)}}return{range:n=a}});return n?null:r.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function Sf(r,t){let e=Et(r).resolveInner(t+1);return e.parent&&e.from==t}function Ww(r,t,e,i){let s=Et(r).resolveInner(t,-1),n=i.reduce((o,a)=>Math.max(o,a.length),0);for(let o=0;o<5;o++){let a=r.sliceDoc(s.from,Math.min(s.to,s.from+e.length+n)),l=a.indexOf(e);if(!l||l>-1&&i.indexOf(a.slice(0,l))>-1){let c=s.firstChild;for(;c&&c.from==s.from&&c.to-c.from>e.length+l;){if(r.sliceDoc(c.to-e.length,c.to)==e)return!1;c=c.firstChild}return!0}let h=s.to==t&&s.parent;if(!h)break;s=h}return!1}function kf(r,t,e){let i=r.charCategorizer(t);if(i(r.sliceDoc(t-1,t))!=tt.Word)return t;for(let s of e){let n=t-s.length;if(r.sliceDoc(n,t)==s&&i(r.sliceDoc(n-1,n))!=tt.Word)return n}return-1}function _w(r={}){return[Ow,te,bt.of(r),Iw,Hw,Dw]}const Af=[{key:"Ctrl-Space",run:ul},{mac:"Alt-`",run:ul},{mac:"Alt-i",run:ul},{key:"Escape",run:Sw},{key:"ArrowDown",run:Nn(!0)},{key:"ArrowUp",run:Nn(!1)},{key:"PageDown",run:Nn(!0,"page")},{key:"PageUp",run:Nn(!1,"page")},{key:"Enter",run:bw}],Hw=Ti.highest(Xs.computeN([bt],r=>r.facet(bt).defaultKeymap?[Af]:[]));class Cf{constructor(t,e,i){this.from=t,this.to=e,this.diagnostic=i}}class Hi{constructor(t,e,i){this.diagnostics=t,this.panel=e,this.selected=i}static init(t,e,i){let s=i.facet(os).markerFilter;s&&(t=s(t,i));let n=t.slice().sort((f,p)=>f.from-p.from||f.to-p.to),o=new Ye,a=[],l=0,h=i.doc.iter(),c=0,u=i.doc.length;for(let f=0;;){let p=f==n.length?null:n[f];if(!p&&!a.length)break;let m,g;if(a.length)m=l,g=a.reduce((w,C)=>Math.min(w,C.to),p&&p.from>m?p.from:1e8);else{if(m=p.from,m>u)break;g=p.to,a.push(p),f++}for(;f<n.length;){let w=n[f];if(w.from==m&&(w.to>w.from||w.to==m))a.push(w),f++,g=Math.min(w.to,g);else{g=Math.min(w.from,g);break}}g=Math.min(g,u);let v=!1;if(a.some(w=>w.from==m&&(w.to==g||g==u))&&(v=m==g,!v&&g-m<10)){let w=m-(c+h.value.length);w>0&&(h.next(w),c=m);for(let C=m;;){if(C>=g){v=!0;break}if(!h.lineBreak&&c+h.value.length>C)break;C=c+h.value.length,c+=h.value.length,h.next()}}let S=Bf(a);if(v)o.add(m,m,L.widget({widget:new Kw(S),diagnostics:a.slice()}));else{let w=a.reduce((C,x)=>x.markClass?C+" "+x.markClass:C,"");o.add(m,g,L.mark({class:"cm-lintRange cm-lintRange-"+S+w,diagnostics:a.slice(),inclusiveEnd:a.some(C=>C.to>g)}))}if(l=g,l==u)break;for(let w=0;w<a.length;w++)a[w].to<=l&&a.splice(w--,1)}let d=o.finish();return new Hi(d,e,vr(d))}}function vr(r,t=null,e=0){let i=null;return r.between(e,1e9,(s,n,{spec:o})=>{if(!(t&&o.diagnostics.indexOf(t)<0))if(!i)i=new Cf(s,n,t||o.diagnostics[0]);else{if(o.diagnostics.indexOf(i.diagnostic)<0)return!1;i=new Cf(i.from,n,i.diagnostic)}}),i}function If(r,t){let e=t.pos,i=t.end||e,s=r.state.facet(os).hideOn(r,e,i);if(s!=null)return s;let n=r.startState.doc.lineAt(t.pos);return!!(r.effects.some(o=>o.is(Fn))||r.changes.touchesRange(n.from,Math.max(n.to,i)))}function Mf(r,t){return r.field(le,!1)?t:t.concat(F.appendConfig.of(ix))}function Of(r,t){return{effects:Mf(r,[Fn.of(t)])}}const Fn=F.define(),pl=F.define(),Df=F.define(),le=gt.define({create(){return new Hi(L.none,null,null)},update(r,t){if(t.docChanged&&r.diagnostics.size){let e=r.diagnostics.map(t.changes),i=null,s=r.panel;if(r.selected){let n=t.changes.mapPos(r.selected.from,1);i=vr(e,r.selected.diagnostic,n)||vr(e,null,n)}!e.size&&s&&t.state.facet(os).autoPanel&&(s=null),r=new Hi(e,s,i)}for(let e of t.effects)if(e.is(Fn)){let i=t.state.facet(os).autoPanel?e.value.length?as.open:null:r.panel;r=Hi.init(e.value,i,t.state)}else e.is(pl)?r=new Hi(r.diagnostics,e.value?as.open:null,r.selected):e.is(Df)&&(r=new Hi(r.diagnostics,r.panel,e.value));return r},provide:r=>[jr.from(r,t=>t.panel),T.decorations.from(r,t=>t.diagnostics)]}),zw=L.mark({class:"cm-lintRange cm-lintRange-active"});function jw(r,t,e){let{diagnostics:i}=r.state.field(le),s,n=-1,o=-1;i.between(t-(e<0?1:0),t+(e>0?1:0),(l,h,{spec:c})=>{if(t>=l&&t<=h&&(l==h||(t>l||e>0)&&(t<h||e<0)))return s=c.diagnostics,n=l,o=h,!1});let a=r.state.facet(os).tooltipFilter;return s&&a&&(s=a(s,r.state)),s?{pos:n,end:o,above:r.state.doc.lineAt(n).to<o,create(){return{dom:Tf(r,s)}}}:null}function Tf(r,t){return Y("ul",{class:"cm-tooltip-lint"},t.map(e=>Lf(r,e,!1)))}const $w=r=>{let t=r.state.field(le,!1);(!t||!t.panel)&&r.dispatch({effects:Mf(r.state,[pl.of(!0)])});let e=Sa(r,as.open);return e&&e.dom.querySelector(".cm-panel-lint ul").focus(),!0},Rf=r=>{let t=r.state.field(le,!1);return!t||!t.panel?!1:(r.dispatch({effects:pl.of(!1)}),!0)},Gw=r=>{let t=r.state.field(le,!1);if(!t)return!1;let e=r.state.selection.main,i=t.diagnostics.iter(e.to+1);return!i.value&&(i=t.diagnostics.iter(0),!i.value||i.from==e.from&&i.to==e.to)?!1:(r.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),!0)},Uw=[{key:"Mod-Shift-m",run:$w,preventDefault:!0},{key:"F8",run:Gw}],os=O.define({combine(r){return{sources:r.map(t=>t.source).filter(t=>t!=null),...be(r.map(t=>t.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{delay:Math.max,markerFilter:Ef,tooltipFilter:Ef,needsRefresh:(t,e)=>t?e?i=>t(i)||e(i):t:e,hideOn:(t,e)=>t?e?(i,s,n)=>t(i,s,n)||e(i,s,n):t:e,autoPanel:(t,e)=>t||e})}}});function Ef(r,t){return r?t?(e,i)=>t(r(e,i),i):r:t}function Pf(r){let t=[];if(r)t:for(let{name:e}of r){for(let i=0;i<e.length;i++){let s=e[i];if(/[a-zA-Z]/.test(s)&&!t.some(n=>n.toLowerCase()==s.toLowerCase())){t.push(s);continue t}}t.push("")}return t}function Lf(r,t,e){var i;let s=e?Pf(t.actions):[];return Y("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},Y("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage(r):t.message),(i=t.actions)===null||i===void 0?void 0:i.map((n,o)=>{let a=!1,l=f=>{if(f.preventDefault(),a)return;a=!0;let p=vr(r.state.field(le).diagnostics,t);p&&n.apply(r,p.from,p.to)},{name:h}=n,c=s[o]?h.indexOf(s[o]):-1,u=c<0?h:[h.slice(0,c),Y("u",h.slice(c,c+1)),h.slice(c+1)],d=n.markClass?" "+n.markClass:"";return Y("button",{type:"button",class:"cm-diagnosticAction"+d,onclick:l,onmousedown:l,"aria-label":` Action: ${h}${c<0?"":` (access key "${s[o]})"`}.`},u)}),t.source&&Y("div",{class:"cm-diagnosticSource"},t.source))}class Kw extends Xe{constructor(t){super(),this.sev=t}eq(t){return t.sev==this.sev}toDOM(){return Y("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class Nf{constructor(t,e){this.diagnostic=e,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Lf(t,e,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class as{constructor(t){this.view=t,this.items=[];let e=s=>{if(!(s.ctrlKey||s.altKey||s.metaKey)){if(s.keyCode==27)Rf(this.view),this.view.focus();else if(s.keyCode==38||s.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(s.keyCode==40||s.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(s.keyCode==36)this.moveSelection(0);else if(s.keyCode==35)this.moveSelection(this.items.length-1);else if(s.keyCode==13)this.view.focus();else if(s.keyCode>=65&&s.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:n}=this.items[this.selectedIndex],o=Pf(n.actions);for(let a=0;a<o.length;a++)if(o[a].toUpperCase().charCodeAt(0)==s.keyCode){let l=vr(this.view.state.field(le).diagnostics,n);l&&n.actions[a].apply(t,l.from,l.to)}}else return;s.preventDefault()}},i=s=>{for(let n=0;n<this.items.length;n++)this.items[n].dom.contains(s.target)&&this.moveSelection(n)};this.list=Y("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:e,onclick:i}),this.dom=Y("div",{class:"cm-panel-lint"},this.list,Y("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Rf(this.view)},"\xD7")),this.update()}get selectedIndex(){let t=this.view.state.field(le).selected;if(!t)return-1;for(let e=0;e<this.items.length;e++)if(this.items[e].diagnostic==t.diagnostic)return e;return-1}update(){let{diagnostics:t,selected:e}=this.view.state.field(le),i=0,s=!1,n=null,o=new Set;for(t.between(0,this.view.state.doc.length,(a,l,{spec:h})=>{for(let c of h.diagnostics){if(o.has(c))continue;o.add(c);let u=-1,d;for(let f=i;f<this.items.length;f++)if(this.items[f].diagnostic==c){u=f;break}u<0?(d=new Nf(this.view,c),this.items.splice(i,0,d),s=!0):(d=this.items[u],u>i&&(this.items.splice(i,u-i),s=!0)),e&&d.diagnostic==e.diagnostic?d.dom.hasAttribute("aria-selected")||(d.dom.setAttribute("aria-selected","true"),n=d):d.dom.hasAttribute("aria-selected")&&d.dom.removeAttribute("aria-selected"),i++}});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)s=!0,this.items.pop();this.items.length==0&&(this.items.push(new Nf(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),s=!0),n?(this.list.setAttribute("aria-activedescendant",n.id),this.view.requestMeasure({key:this,read:()=>({sel:n.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:a,panel:l})=>{let h=l.height/this.list.offsetHeight;a.top<l.top?this.list.scrollTop-=(l.top-a.top)/h:a.bottom>l.bottom&&(this.list.scrollTop+=(a.bottom-l.bottom)/h)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),s&&this.sync()}sync(){let t=this.list.firstChild;function e(){let i=t;t=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;t!=i.dom;)e();t=i.dom.nextSibling}else this.list.insertBefore(i.dom,t);for(;t;)e()}moveSelection(t){if(this.selectedIndex<0)return;let e=this.view.state.field(le),i=vr(e.diagnostics,this.items[t].diagnostic);i&&this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:Df.of(i)})}static open(t){return new as(t)}}function Vn(r,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(r)}</svg>')`}function qn(r){return Vn(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${r}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Yw=T.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:qn("#d11")},".cm-lintRange-warning":{backgroundImage:qn("orange")},".cm-lintRange-info":{backgroundImage:qn("#999")},".cm-lintRange-hint":{backgroundImage:qn("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function Xw(r){return r=="error"?4:r=="warning"?3:r=="info"?2:1}function Bf(r){let t="hint",e=1;for(let i of r){let s=Xw(i.severity);s>e&&(e=s,t=i.severity)}return t}class Ff extends Be{constructor(t){super(),this.diagnostics=t,this.severity=Bf(t)}toDOM(t){let e=document.createElement("div");e.className="cm-lint-marker cm-lint-marker-"+this.severity;let i=this.diagnostics,s=t.state.facet(Wn).tooltipFilter;return s&&(i=s(i,t.state)),i.length&&(e.onmouseover=()=>Qw(t,e,i)),e}}function Jw(r,t){let e=i=>{let s=t.getBoundingClientRect();if(!(i.clientX>s.left-10&&i.clientX<s.right+10&&i.clientY>s.top-10&&i.clientY<s.bottom+10)){for(let n=i.target;n;n=n.parentNode)if(n.nodeType==1&&n.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",e),r.state.field(Vf)&&r.dispatch({effects:gl.of(null)})}};window.addEventListener("mousemove",e)}function Qw(r,t,e){function i(){let o=r.elementAtHeight(t.getBoundingClientRect().top+5-r.documentTop);r.coordsAtPos(o.from)&&r.dispatch({effects:gl.of({pos:o.from,above:!1,clip:!1,create(){return{dom:Tf(r,e),getCoords:()=>t.getBoundingClientRect()}}})}),t.onmouseout=t.onmousemove=null,Jw(r,t)}let{hoverTime:s}=r.state.facet(Wn),n=setTimeout(i,s);t.onmouseout=()=>{clearTimeout(n),t.onmouseout=t.onmousemove=null},t.onmousemove=()=>{clearTimeout(n),n=setTimeout(i,s)}}function Zw(r,t){let e=Object.create(null);for(let s of t){let n=r.lineAt(s.from);(e[n.from]||(e[n.from]=[])).push(s)}let i=[];for(let s in e)i.push(new Ff(e[s]).range(+s));return W.of(i,!0)}const tx=bu({class:"cm-gutter-lint",markers:r=>r.state.field(ml),widgetMarker:(r,t,e)=>{let i=[];return r.state.field(ml).between(e.from,e.to,(s,n,o)=>{s>e.from&&s<e.to&&i.push(...o.diagnostics)}),i.length?new Ff(i):null}}),ml=gt.define({create(){return W.empty},update(r,t){r=r.map(t.changes);let e=t.state.facet(Wn).markerFilter;for(let i of t.effects)if(i.is(Fn)){let s=i.value;e&&(s=e(s||[],t.state)),r=Zw(t.state.doc,s.slice(0))}return r}}),gl=F.define(),Vf=gt.define({create(){return null},update(r,t){return r&&t.docChanged&&(r=If(t,r)?null:{...r,pos:t.changes.mapPos(r.pos)}),t.effects.reduce((e,i)=>i.is(gl)?i.value:e,r)},provide:r=>tn.from(r)}),ex=T.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:".2em"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:Vn('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:Vn('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error":{content:Vn('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}}),ix=[le,T.decorations.compute([le],r=>{let{selected:t,panel:e}=r.field(le);return!t||!e||t.from==t.to?L.none:L.set([zw.range(t.from,t.to)])}),pu(jw,{hideOn:If}),Yw],Wn=O.define({combine(r){return be(r,{hoverTime:300,markerFilter:null,tooltipFilter:null})}});function rx(r={}){return[Wn.of(r),ml,tx,ex,Vf]}const sx=[n1(),l1(),C0(),Iv(),Z1(),p0(),w0(),$.allowMultipleSelections.of(!0),Hu(),ev(sv,{fallback:!0}),id(),Tw(),_w(),F0(),W0(),R0(),Py(),Xs.of([...Lw,...Gd,...of,...dd,...Y1,...Af,...Uw])];class Z{constructor(t,e){this.defaultParamValues=t,this.makeSignal=e}static make(t,e){return new Z(t,e)}new(t){const e={...t};for(const[i,s]of Object.entries(this.defaultParamValues))t.hasOwnProperty(i)||(e[i]=s());return this.makeSignal(e)}paramNames(){return Object.keys(this.defaultParamValues)}}class rt{constructor(t,e){this.defaultParamValues=t,this.codegenFn=e}static make(t,e){return new rt(t,e)}codegen(t){return this.codegenFn({...this.defaultParamValues,...t})}paramNames(){return Object.keys(this.defaultParamValues)}}const ls={"unary-":rt.make({x:"0"},r=>`(-${r.x})`),"+":rt.make({x:"0",y:"0"},r=>`(${r.x} + ${r.y})`),"-":rt.make({x:"0",y:"0"},r=>`(${r.x} - ${r.y})`),"*":rt.make({x:"0",y:"0"},r=>`(${r.x} * ${r.y})`),"/":rt.make({x:"0",y:"0"},r=>`(${r.x} / ifZero(${r.y}, 0.00001))`),"%":rt.make({x:"0",y:"0"},r=>`(${r.x} % ifZero(${r.y}, 0.00001))`),clamp:rt.make({input:"0",min:"0",max:"1"},r=>`Math.min(Math.max(${r.input}, ${r.min}), ${r.max})`),min:rt.make({input:"0",y:"0"},r=>`Math.min(${r.input}, ${r.y})`),max:rt.make({input:"0",y:"0"},r=>`Math.max(${r.input}, ${r.y})`),round:rt.make({input:"0"},r=>`Math.round(${r.input})`),abs:rt.make({input:"0"},r=>`Math.abs(${r.input})`),sqrt:rt.make({input:"0"},r=>`Math.sqrt(${r.input})`),norm:rt.make({input:"0",min:"-1",max:"1"},r=>`((input, min, max) => max <= min ? 0 : (input - min) / (max - min))(${r.input}, ${r.min}, ${r.max})`),scale:rt.make({input:"0",min:"0",max:"1"},r=>`((input, min, max) => input * (max - min) + min)(${r.input}, ${r.min}, ${r.max})`),escale:rt.make({input:"0",min:"0",max:"1"},r=>`((input, min, max) => {
      if (min === 0) {
        min = 0.001;
      }
      return min * Math.pow(max / min, input);
    })(${r.input}, ${r.min}, ${r.max})`),semitones:rt.make({input:"0"},r=>`Math.pow(2, ${r.input} / 12)`),quantizeFreq:rt.make({input:"0",base:"440"},r=>`((input, base) => (base * Math.pow(2, Math.round(12 * Math.log2(input / base)) / 12)))(${r.input}, ${r.base})`),switch2:rt.make({input:"0",pos:"0",neg:"0"},r=>`(${r.input} >= 0 ? ${r.pos} : ${r.neg})`),switch3:rt.make({input:"0",neg:"0",zero:"0",pos:"0"},r=>`((input, neg, zero, pos) => input === 0 ? zero : input < 0 ? neg : pos)(${r.input}, ${r.neg}, ${r.zero}, ${r.pos})`),softClip:rt.make({input:"0"},r=>`((input) => input <= -1 ? -2/3 : input >= 1 ? 2/3 : input - input ** 3 / 3)(${r.input})`)},je=class je{constructor(t,e=0,i,s,n){R(this,"lastFrameIdx",-1);var o;this.nextSample=t,this.value=e,this.noteOn=i,this.noteOff=s,this.writeSharedState=n,(o=je.newInstanceCollector)==null||o.push(this)}static doCollectingNewInstances(t,e){const i=je.newInstanceCollector;je.newInstanceCollector=e;try{return t()}finally{je.newInstanceCollector=i}}static new(t){return typeof t=="function"?new je(t):new je(t.nextSample,t.initialValue,t.noteOn,t.noteOff)}static scalar(t){return je.new({nextSample:()=>t,initialValue:t})}computeSample(t,e){return t!==this.lastFrameIdx&&(this.value=this.nextSample(e)),this.value}};R(je,"newInstanceCollector",null);let et=je;const P=et.scalar;function nx(r,t,e){let i="off",s=0;return et.new({nextSample(){switch(i){case"off":s=0;break;case"a":s=t.value>0?Math.min(s+he/t.value,1):1,s===1&&(i="d");break;case"d":s=e.value>0?Math.max(s-he/e.value,0):0,s===0&&(i="off");break}return s*r.value},initialValue:0,noteOn(){i="a"}})}function ox(r,t,e,i,s){let n="off",o=0;return et.new({nextSample(){switch(n){case"off":o=0;break;case"a":o=t.value>0?Math.min(o+he/t.value,1):1,o===1&&(n="d");break;case"d":o=e.value>0?Math.max(o-he/e.value,i.value):i.value,o===i.value&&(n="s");break;case"s":break;case"r":o=s.value>0?Math.max(o-he/s.value,0):0,o===0&&(n="off");break}return o*r.value},initialValue:0,noteOn(){n="a"},noteOff(){n="r"}})}function ax(r,t){let e="off",i=0;return et.new({nextSample(){let s;switch(e){case"off":s=0;break;case"on":t.value>0&&i++>=t.value*Ge?(e="off",s=0):s=1;break}return s*r.value},initialValue:0,noteOn(){e="on",i=0},noteOff(){t||(e="off")}})}function lx(r,t){let e=r.value;return et.new(()=>{if(t.value===0)e=r.value;else{const i=he/t.value,s=r.value-e;s>i?e+=i:s<-i?e-=i:e=r.value}return e})}function qf(r,t,e){let i=r.value,s=!1;return et.new({nextSample(){if(t.value===0)i=r.value;else if(s)i=r.value,s=!1;else{const n=Math.pow(2,1/(t.value*Ge));i<r.value?i=Math.min(i*n,r.value):i>r.value&&(i=Math.max(i/n,r.value))}return i},initialValue:i,noteOn(n,o){e&&!o&&n.noteNums.length===1&&(s=!0)}})}const Wf=10,hx=Wf*Ge;function cx(r,t){const e=hx,i=new Float32Array(e);let s=0;return et.new(()=>{let n=s-Math.min(t.value,Wf)*Ge;return n<0&&(n+=e),i[s++]=r.value,s>=e&&(s=0),Up(i,n)})}const vl=4,_f=1/vl,ux=1/(Ge*vl),dx=1.8,fx=5,px=Ge*.425,mx=1e-5,yl=.95;function ti(r,t,e,i){let s=[0,0,0,0],n=[0,0,0,0],o=1,a=1,l=1,h=0,c=1,u=1,d=0;function f(){const w=Te(e.value,fx,px)*kt*ux,C=w*w,x=w*C,k=w*x;o=.9892*w-.4324*C+.1381*x-.0202*k,l=1.006+.0536*w-.095*C-.05*k}function p(){a=4*Te(i.value,0,1)*dx}function m(w){c=Math.max(w,0),c>1?(c=Math.min(c,4),u=1+(c-1)*(1-h)):u=c}function g(w){h=Te(w,0,.5),m(c)}function v(w,C){let x=w*.76923077+.23076923*s[C]-n[C];return x=x*o+n[C],n[C]=x,s[C]=w,x}function S(w,C,x,k,A){switch(r){case"lp24":return A;case"lp12":return x;case"bp24":return(x+A)*4-k*8;case"bp12":return(C-x)*2;case"hp24":return w+A-(C+k)*4+x*6;case"hp12":return w+x-C*2;default:return 0}}return m(1),g(.5),et.new(()=>{f(),p();let w=t.value*u;if(Math.abs(w)<mx){for(let k=0;k<4;k++)s[k]*=yl,n[k]*=yl;d*=yl}let C=0,x=0;for(let k=0;k<vl;k++){const A=x*d+(1-x)*w,B=Ul(A-(n[3]-h*A)*a*l),q=v(B,0),_=v(q,1),N=v(_,2),E=v(N,3);C+=S(B,q,_,N,E)*_f,x+=_f}return d=w,C})}const _n={sine:Z.make({input:()=>P(440)},r=>{const t=r.input;let e=0;return et.new(()=>{const i=Math.sin(e*kt),s=t.value*he;return e+=s,e-=Math.floor(e),i})}),saw:Z.make({input:()=>P(440)},r=>{const t=r.input;let e=0;return et.new(()=>{const i=2*e-1,s=t.value*he,n=i-hs(e,s);return e+=s,e-=Math.floor(e),n})}),tri:Z.make({input:()=>P(440)},r=>{const t=r.input;let e=0,i=0;return et.new(()=>{const s=t.value*he,n=(e>=.25&&e<.75?-1:1)-hs((e+.75)%1,s)+hs((e+.25)%1,s);return i=.999*i+n*s*4,e+=s,e-=Math.floor(e),i})}),pulse:Z.make({input:()=>P(440),w:()=>P(.5),sync:()=>P(0)},r=>{const{input:t,w:e,sync:i}=r;let s=0,n=0;return et.new(()=>{const o=s<e.value?-1:1,a=t.value*he,l=o-hs(s,a)+hs((s-e.value+1)%1,a);let h=!1;if(n<0&&i.value>=0){const c=-n/(i.value-n);s=Math.floor((1-c)*a),h=!0}return n=i.value,h||(s+=a,s-=Math.floor(s)),l})}),lglide:Z.make({input:()=>P(0),t:()=>P(.1)},r=>lx(r.input,r.t)),eglide:Z.make({input:()=>P(0),t:()=>P(1)},r=>qf(r.input,r.t,!1)),legato:Z.make({input:()=>P(0),t:()=>P(1)},r=>qf(r.input,r.t,!0)),ad:Z.make({input:()=>P(1),a:()=>P(0),d:()=>P(.2)},r=>nx(r.input,r.a,r.d)),adsr:Z.make({input:()=>P(1),a:()=>P(0),d:()=>P(0),s:()=>P(1),r:()=>P(.2)},r=>ox(r.input,r.a,r.d,r.s,r.r)),gate:Z.make({input:()=>P(1),t:()=>P(0)},r=>ax(r.input,r.t)),lpf:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("lp24",r.input,r.cf,r.q)),lpf12:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("lp12",r.input,r.cf,r.q)),lpf24:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("lp24",r.input,r.cf,r.q)),hpf:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("hp24",r.input,r.cf,r.q)),hpf12:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("hp12",r.input,r.cf,r.q)),hpf24:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("hp24",r.input,r.cf,r.q)),bpf:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("bp24",r.input,r.cf,r.q)),bpf12:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("bp12",r.input,r.cf,r.q)),bpf24:Z.make({input:()=>P(0),cf:()=>P(1e3),q:()=>P(.2)},r=>ti("bp24",r.input,r.cf,r.q)),delay:Z.make({input:()=>P(0),t:()=>P(.25)},r=>cx(r.input,r.t)),beats:Z.make({input:()=>P(.25)},r=>{const t=r.input;return et.new(e=>60/e.params[io]*t.value)}),latch:Z.make({input:()=>P(0),useLastValue:()=>P(0)},r=>{const{input:t,useLastValue:e}=r;let i=0;return et.new(()=>(e.value===0&&(i=t.value),i))}),dcBlock:Z.make({input:()=>P(0)},r=>{const{input:t}=r,e=.995;let i=0,s=0;return et.new(()=>{const n=t.value,o=n-i+e*s;return i=n,s=o,o})}),junoChorus:Z.make({input:()=>P(0),type:()=>P(0)},r=>{const{input:t,type:e}=r,i=2048,s=i-1,n=.4,o=.5,a=40,l=60,h=400,c=480,u=.7,d=.6,f=.86,p=80,m=100,g=300,v=350,S=.7,w=new Float32Array(i),C=new Float32Array(i);let x=0,k=0,A=0;const B=(q,_)=>{const N=_%i,E=N<0?N+i:N,H=Math.floor(E),z=H+1&s,U=E-H,nt=q[H],xt=q[z];return nt+(xt-nt)*U};return et.new({nextSample(q){const _=t.value,N=e.value;let E,H,z,U,nt,xt,Yt,lt;if(N<1/3)lt=_;else{N<2/3?(E=n,H=o,z=a,U=l,nt=h,xt=c,Yt=u):(E=d,H=f,z=p,U=m,nt=g,xt=v,Yt=S);const se=Math.sin(k*kt),Oe=Math.sin(A*kt),ne=nt+se*z,we=xt+Oe*U;w[x]=_,C[x]=_;const si=x-ne,ki=x-we,wr=B(w,si),Zn=B(C,ki),Vb=(wr+Zn)*.5;lt=_*(1-Yt)+Vb*Yt,k+=E*he,A+=H*he,k-=Math.floor(k),A-=Math.floor(A),x=x+1&s}return lt}})})};function hs(r,t){return r<t?(r/=t,r+r-r*r-1):r>1-t?(r=(r-1)/t,r*r+r+r+1):0}function gx(r,t){const e=document.createElement("div");e.className="editor-container",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.overflow="hidden",e.style.pointerEvents="auto",r.appendChild(e);const i=pu((u,d,f)=>{const{from:p,to:m,text:g}=u.state.doc.lineAt(d);let v=d,S=d;for(;v>p&&/\w/.test(g[v-p-1]);)v--;for(;S<m&&/\w/.test(g[S-p]);)S++;if(v===d&&f<0||S===d&&f>0)return null;const w=g.slice(v-p,S-p),C=ls[w]||_n[w];if(!C)return null;const x=C.paramNames().join(", ");return{pos:v,end:S,below:!0,create(k){let A=document.createElement("div");return A.classList.add("module-info-tooltip"),A.textContent=`${w}(${x})`,{dom:A}}}}),s=[sx,Hu(),id(),Hy({caseSensitive:!1,regexp:!1}),rx(),i,T.updateListener.of(u=>{u.docChanged&&c()}),Xs.of([{key:"Mod-s",preventDefault:!0,run:()=>(t(h),!0)},{key:"Mod-m",preventDefault:!0,run:()=>(o(a()),!0)},...dd,...of,...Gd]),T.theme({"&":{height:"100%",fontSize:"20px"},".cm-scroller":{overflow:"auto",height:"100%"}})],n=new T({state:$.create({doc:"this is the source code for the synth",extensions:s}),parent:e});function o(u){const d=n.state.selection.ranges[0].from;n.dispatch({changes:{from:d,insert:u},selection:{anchor:d,head:d+u.length},scrollIntoView:!0})}function a(){const u=["unary-","+","-","*","/","%"],d=[...Object.keys(ls),...Object.keys(_n)].filter(p=>!u.includes(p)),f=[];for(let p=0;p<d.length;p++)f.push(d[p]),p<d.length-1&&f.push(" "),(p+1)%10===0&&f.push(`
`);return f.join("")}function l(u){n.setState($.create({doc:u,extensions:s}))}function h(u){n.dispatch(Of(n.state,u.errors.map(d=>({from:d.interval.startIdx,to:d.interval.endIdx,severity:"error",message:d.message}))))}function c(){n.dispatch(Of(n.state,[]))}return{view:n,container:e,setContents:l}}function zt(r){const t=r||"";return function(){throw new Error("this method "+t+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function xi(r,t){if(!r)throw new Error(t||"Assertion failed")}function wl(r,t,e){let i;Object.defineProperty(r,t,{get(){return i||(i=e.call(this)),i}})}function vx(r){return r&&Object.assign({},r)}function Hf(r,t){const e=[];for(;t-- >0;)e.push(r());return e}function zf(r,t){return new Array(t+1).join(r)}function Hn(r,t){return Hf(()=>r,t)}function xl(r){const t=[];for(let e=0;e<r.length;e++){const i=r[e];r.lastIndexOf(i)!==e&&t.indexOf(i)<0&&t.push(i)}return t}function jf(r){const t=[];return r.forEach(e=>{t.indexOf(e)<0&&t.push(e)}),t}function zi(r){const t=r[0];return t===t.toUpperCase()}function $f(r){return!zi(r)}function Gf(r,t,e){const i=e||" ";return r.length<t?zf(i,t-r.length)+r:r}function ji(){this.strings=[]}ji.prototype.append=function(r){this.strings.push(r)},ji.prototype.contents=function(){return this.strings.join("")};const bl=r=>String.fromCodePoint(parseInt(r,16));function Uf(r){if(r.charAt(0)==="\\")switch(r.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";case"v":return"\v";case"x":return bl(r.slice(2,4));case"u":return r.charAt(2)==="{"?bl(r.slice(3,-1)):bl(r.slice(2,6));default:return r.charAt(1)}else return r}function Sl(r){if(r==null)return String(r);const t=Object.prototype.toString.call(r);try{let e;return r.constructor&&r.constructor.name?e=r.constructor.name:t.indexOf("[object ")===0?e=t.slice(8,-1):e=typeof r,e+": "+JSON.stringify(String(r))}catch{return t}}function Kf(r,t="unexpected null value"){if(r==null)throw new Error(t);return r}const yx=Object.freeze(Object.defineProperty({__proto__:null,StringBuffer:ji,abstract:zt,assert:xi,checkNotNull:Kf,clone:vx,copyWithoutDuplicates:jf,defineLazyProperty:wl,getDuplicates:xl,isLexical:$f,isSyntactic:zi,padLeft:Gf,repeat:Hn,repeatFn:Hf,repeatStr:zf,unescapeCodePoint:Uf,unexpectedObjToString:Sl},Symbol.toStringTag,{value:"Module"})),wx={Lu:new RegExp("\\p{Lu}","u"),Ll:new RegExp("\\p{Ll}","u"),Lt:new RegExp("\\p{Lt}","u"),Lm:new RegExp("\\p{Lm}","u"),Lo:new RegExp("\\p{Lo}","u"),Nl:new RegExp("\\p{Nl}","u"),Nd:new RegExp("\\p{Nd}","u"),Mn:new RegExp("\\p{Mn}","u"),Mc:new RegExp("\\p{Mc}","u"),Pc:new RegExp("\\p{Pc}","u"),Zs:new RegExp("\\p{Zs}","u"),L:new RegExp("\\p{Letter}","u"),Ltmo:new RegExp("\\p{Lt}|\\p{Lm}|\\p{Lo}","u")};class V{constructor(){if(this.constructor===V)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(t){return t&&(this.source=t.trimmed()),this}}const Lt=Object.create(V.prototype),Nt=Object.create(V.prototype);class Ot extends V{constructor(t){super(),this.obj=t}}class Bt extends V{constructor(t,e){super(),this.from=t,this.to=e,this.matchCodePoint=t.length>1||e.length>1}}class Ft extends V{constructor(t){super(),this.index=t}}class yt extends V{constructor(t){super(),this.terms=t}}class zn extends yt{constructor(t,e,i){const s=t.rules[e].body;super([i,s]),this.superGrammar=t,this.name=e,this.body=i}}class jn extends yt{constructor(t,e,i,s){const n=t.rules[e].body;super([...i,n,...s]),this.superGrammar=t,this.ruleName=e,this.expansionPos=i.length}}class St extends V{constructor(t){super(),this.factors=t}}class jt extends V{constructor(t){super(),this.expr=t}}class $i extends jt{}class yr extends jt{}class ei extends jt{}$i.prototype.operator="*",yr.prototype.operator="+",ei.prototype.operator="?",$i.prototype.minNumMatches=0,yr.prototype.minNumMatches=1,ei.prototype.minNumMatches=0,$i.prototype.maxNumMatches=Number.POSITIVE_INFINITY,yr.prototype.maxNumMatches=Number.POSITIVE_INFINITY,ei.prototype.maxNumMatches=1;class $t extends V{constructor(t){super(),this.expr=t}}class Gt extends V{constructor(t){super(),this.expr=t}}class ee extends V{constructor(t){super(),this.expr=t}}class K extends V{constructor(t,e=[]){super(),this.ruleName=t,this.args=e}isSyntactic(){return zi(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}}class Dt extends V{constructor(t){super(),this.category=t,this.pattern=wx[t]}}function st(r,t){let e;return t?(e=new Error(t.getLineAndColumnMessage()+r),e.shortMessage=r,e.interval=t):e=new Error(r),e}function kl(){return st("Interval sources don't match")}function xx(r){const t=new Error;return Object.defineProperty(t,"message",{enumerable:!0,get(){return r.message}}),Object.defineProperty(t,"shortMessage",{enumerable:!0,get(){return"Expected "+r.getExpectedText()}}),t.interval=r.getInterval(),t}function bx(r,t,e){const i=t?`Grammar ${r} is not declared in namespace '${t}'`:"Undeclared grammar "+r;return st(i,e)}function Sx(r,t){return st("Grammar "+r.name+" is already declared in this namespace")}function kx(r){return st(`Grammar '${r.name}' does not support incremental parsing`)}function Yf(r,t,e){return st("Rule "+r+" is not declared in grammar "+t,e)}function Ax(r,t,e){return st("Cannot override rule "+r+" because it is not declared in "+t,e)}function Cx(r,t,e){return st("Cannot extend rule "+r+" because it is not declared in "+t,e)}function Xf(r,t,e,i){let s="Duplicate declaration for rule '"+r+"' in grammar '"+t+"'";return t!==e&&(s+=" (originally declared in '"+e+"')"),st(s,i)}function Jf(r,t,e,i){return st("Wrong number of parameters for rule "+r+" (expected "+t+", got "+e+")",i)}function Ix(r,t,e,i){return st("Wrong number of arguments for rule "+r+" (expected "+t+", got "+e+")",i)}function Qf(r,t,e){return st("Duplicate parameter names in rule "+r+": "+t.join(", "),e)}function Mx(r,t){return st("Invalid parameter to rule "+r+": "+t+" has arity "+t.getArity()+", but parameter expressions must have arity 1",t.source)}const Ox="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function Dx(r,t){return st("Cannot apply syntactic rule "+r+" from here (inside a lexical context)",t.source)}function Tx(r){const{ruleName:t}=r;return st(`applySyntactic is for syntactic rules, but '${t}' is a lexical rule. `+Ox,r.source)}function Rx(r){return st("applySyntactic is not required here (in a syntactic context)",r.source)}function Zf(r,t){return st("Incorrect argument type: expected "+r,t.source)}function Ex(r){return st("'...' can appear at most once in a rule body",r.source)}function Px(r){const t=r._node;xi(t&&t.isNonterminal()&&t.ctorName==="escapeChar_unicodeCodePoint");const e=r.children.slice(1,-1).map(s=>s.source),i=e[0].coverageWith(...e.slice(1));return st(`U+${i.contents} is not a valid Unicode code point`,i)}function tp(r,t){const e=t.length>0?t[t.length-1].args:[];let i="Nullable expression "+r.expr.substituteParams(e)+" is not allowed inside '"+r.operator+"' (possible infinite loop)";if(t.length>0){const s=t.map(n=>new K(n.ruleName,n.args)).join(`
`);i+=`
Application stack (most recent application last):
`+s}return st(i,r.expr.source)}function ep(r,t,e,i){return st("Rule "+r+" involves an alternation which has inconsistent arity (expected "+t+", got "+e+")",i.source)}function Lx(r){const t=r.map(e=>e.message);return st(["Errors:"].concat(t).join(`
- `),r[0].interval)}function Nx(r,t,e,i){let s=i.slice(0,-1).map(l=>{const h="  "+l[0].name+" > "+l[1];return l.length===3?h+" for '"+l[2]+"'":h}).join(`
`);s+=`
  `+t+" > "+r;let n="";r==="_iter"&&(n=[`
NOTE: as of Ohm v16, there is no default action for iteration nodes \u2014 see `,"  https://ohmjs.org/d/dsa for details."].join(`
`));const o=[`Missing semantic action for '${r}' in ${e} '${t}'.${n}`,"Action stack (most recent call last):",s].join(`
`),a=st(o);return a.name="missingSemanticAction",a}function Bx(r){if(r.length===1)throw r[0];if(r.length>1)throw Lx(r)}function Fx(r){let t=0;return r.map(e=>{const i=e.toString();return t=Math.max(t,i.length),i}).map(e=>Gf(e,t))}function ip(r,t,e){const i=r.length,s=r.slice(0,e),n=r.slice(e+t.length);return(s+t+n).substr(0,i)}function Vx(...r){const t=this,{offset:e}=t,{repeatStr:i}=yx,s=new ji;s.append("Line "+t.lineNum+", col "+t.colNum+`:
`);const n=Fx([t.prevLine==null?0:t.lineNum-1,t.lineNum,t.nextLine==null?0:t.lineNum+1]),o=(c,u,d)=>{s.append(d+n[c]+" | "+u+`
`)};t.prevLine!=null&&o(0,t.prevLine,"  "),o(1,t.line,"> ");const a=t.line.length;let l=i(" ",a+1);for(let c=0;c<r.length;++c){let u=r[c][0],d=r[c][1];xi(u>=0&&u<=d,"range start must be >= 0 and <= end");const f=e-t.colNum+1;u=Math.max(0,u-f),d=Math.min(d-f,a),l=ip(l,i("~",d-u),u)}const h=2+n[1].length+3;return s.append(i(" ",h)),l=ip(l,"^",t.colNum-1),s.append(l.replace(/ +$/,"")+`
`),t.nextLine!=null&&o(2,t.nextLine,"  "),s.contents()}let Al=[];function rp(r){Al.push(r)}function qx(r){Al.forEach(t=>{t(r)}),Al=null}function Cl(r,t){let e=1,i=1,s=0,n=0,o=null,a=null,l=-1;for(;s<t;){const u=r.charAt(s++);u===`
`?(e++,i=1,l=n,n=s):u!=="\r"&&i++}let h=r.indexOf(`
`,n);if(h===-1)h=r.length;else{const u=r.indexOf(`
`,h+1);o=u===-1?r.slice(h):r.slice(h,u),o=o.replace(/^\r?\n/,"").replace(/\r$/,"")}l>=0&&(a=r.slice(l,n).replace(/\r?\n$/,""));const c=r.slice(n,h).replace(/\r$/,"");return{offset:t,lineNum:e,colNum:i,line:c,prevLine:a,nextLine:o,toString:Vx}}function Il(r,t,...e){return Cl(r,t).toString(...e)}const sp=(()=>{let r=0;return t=>""+t+r++})();class Vt{constructor(t,e,i){this.sourceString=t,this.startIdx=e,this.endIdx=i}get contents(){return this._contents===void 0&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(...t){return Vt.coverage(...t,this)}collapsedLeft(){return new Vt(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new Vt(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return Cl(this.sourceString,this.startIdx)}getLineAndColumnMessage(){const t=[this.startIdx,this.endIdx];return Il(this.sourceString,this.startIdx,t)}minus(t){if(this.sourceString!==t.sourceString)throw kl();return this.startIdx===t.startIdx&&this.endIdx===t.endIdx?[]:this.startIdx<t.startIdx&&t.endIdx<this.endIdx?[new Vt(this.sourceString,this.startIdx,t.startIdx),new Vt(this.sourceString,t.endIdx,this.endIdx)]:this.startIdx<t.endIdx&&t.endIdx<this.endIdx?[new Vt(this.sourceString,t.endIdx,this.endIdx)]:this.startIdx<t.startIdx&&t.startIdx<this.endIdx?[new Vt(this.sourceString,this.startIdx,t.startIdx)]:[this]}relativeTo(t){if(this.sourceString!==t.sourceString)throw kl();return xi(this.startIdx>=t.startIdx&&this.endIdx<=t.endIdx,"other interval does not cover this one"),new Vt(this.sourceString,this.startIdx-t.startIdx,this.endIdx-t.startIdx)}trimmed(){const{contents:t}=this,e=this.startIdx+t.match(/^\s*/)[0].length,i=this.endIdx-t.match(/\s*$/)[0].length;return new Vt(this.sourceString,e,i)}subInterval(t,e){const i=this.startIdx+t;return new Vt(this.sourceString,i,i+e)}}Vt.coverage=function(r,...t){let{startIdx:e,endIdx:i}=r;for(const s of t){if(s.sourceString!==r.sourceString)throw kl();e=Math.min(e,s.startIdx),i=Math.max(i,s.endIdx)}return new Vt(r.sourceString,e,i)};const Wx=65535;class $n{constructor(t){this.source=t,this.pos=0,this.examinedLength=0}atEnd(){const t=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),t}next(){const t=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),t}nextCharCode(){const t=this.next();return t&&t.charCodeAt(0)}nextCodePoint(){const t=this.source.slice(this.pos++).codePointAt(0);return t>Wx&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),t}matchString(t,e){let i;if(e){for(i=0;i<t.length;i++){const s=this.next(),n=t[i];if(s==null||s.toUpperCase()!==n.toUpperCase())return!1}return!0}for(i=0;i<t.length;i++)if(this.next()!==t[i])return!1;return!0}sourceSlice(t,e){return this.source.slice(t,e)}interval(t,e){return new Vt(this.source,t,e||this.pos)}}class np{constructor(t,e,i,s,n,o,a){this.matcher=t,this.input=e,this.startExpr=i,this._cst=s,this._cstOffset=n,this._rightmostFailurePosition=o,this._rightmostFailures=a,this.failed()&&(wl(this,"message",function(){const l="Expected "+this.getExpectedText();return Il(this.input,this.getRightmostFailurePosition())+l}),wl(this,"shortMessage",function(){const l="expected "+this.getExpectedText(),h=Cl(this.input,this.getRightmostFailurePosition());return"Line "+h.lineNum+", col "+h.colNum+": "+l}))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);const t=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=t.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");const t=new ji;let e=this.getRightmostFailures();e=e.filter(i=>!i.isFluffy());for(let i=0;i<e.length;i++)i>0&&(i===e.length-1?t.append(e.length>2?", or ":" or "):t.append(", ")),t.append(e[i].toString());return t.contents()}getInterval(){const t=this.getRightmostFailurePosition();return new Vt(this.input,t,t)}}class _x{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(t){return this.applicationMemoKeyStack.indexOf(t.toMemoKey())>=0}enter(t){this.applicationMemoKeyStack.push(t.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(t,e){e.isLeftRecursion=!0,e.headApplication=t,e.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=e;const{applicationMemoKeyStack:i}=this,s=i.indexOf(t.toMemoKey())+1,n=i.slice(s);e.isInvolved=function(o){return n.indexOf(o)>=0},e.updateInvolvedApplicationMemoKeys=function(){for(let o=s;o<i.length;o++){const a=i[o];this.isInvolved(a)||n.push(a)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(t){if(!t.isLeftRecursion)return!0;const{applicationMemoKeyStack:e}=this;for(let i=0;i<e.length;i++){const s=e[i];if(t.isInvolved(s))return!1}return!0}memoize(t,e){return this.memo[t]=e,this.maxExaminedLength=Math.max(this.maxExaminedLength,e.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,e.rightmostFailureOffset),e}clearObsoleteEntries(t,e){if(t+this.maxExaminedLength<=e)return;const{memo:i}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(i).forEach(s=>{const n=i[s];t+n.examinedLength>e?delete i[s]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,n.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,n.rightmostFailureOffset))})}}const Hx="\u2717",zx="\u2713",jx="\u22C5",$x="\u21D2",Gx="\u2409",Ux="\u240A",Kx="\u240D",Ml={succeeded:1,isRootNode:2,isImplicitSpaces:4,isMemoized:8,isHeadOfLeftRecursion:16,terminatesLR:32};function Yx(r){return Hn(" ",r).join("")}function Xx(r,t,e){const i=op(r.slice(t,t+e));return i.length<e?i+Hn(" ",e-i.length).join(""):i}function op(r){return typeof r=="string"?r.replace(/ /g,jx).replace(/\t/g,Gx).replace(/\n/g,Ux).replace(/\r/g,Kx):String(r)}class bi{constructor(t,e,i,s,n,o,a){this.input=t,this.pos=this.pos1=e,this.pos2=i,this.source=new Vt(t,e,i),this.expr=s,this.bindings=o,this.children=a||[],this.terminatingLREntry=null,this._flags=n?Ml.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(t){const e=new bi(this.input,this.pos,this.pos2,t,this.succeeded,this.bindings,this.children);return e.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,e.isImplicitSpaces=this.isImplicitSpaces,e.isMemoized=this.isMemoized,e.isRootNode=this.isRootNode,e.terminatesLR=this.terminatesLR,e.terminatingLREntry=this.terminatingLREntry,e}recordLRTermination(t,e){this.terminatingLREntry=new bi(this.input,this.pos,this.pos2,this.expr,!1,[e],[t]),this.terminatingLREntry.terminatesLR=!0}walk(t,e){let i=t;typeof i=="function"&&(i={enter:i});function s(n,o,a){let l=!0;i.enter&&i.enter.call(e,n,o,a)===bi.prototype.SKIP&&(l=!1),l&&(n.children.forEach(h=>{s(h,n,a+1)}),i.exit&&i.exit.call(e,n,o,a))}this.isRootNode?this.children.forEach(n=>{s(n,null,0)}):s(this,null,0)}toString(){const t=new ji;return this.walk((e,i,s)=>{if(!e)return this.SKIP;if(e.expr.constructor.name!=="Alt"){if(t.append(Xx(e.input,e.pos,10)+Yx(s*2+1)),t.append((e.succeeded?zx:Hx)+" "+e.displayString),e.isHeadOfLeftRecursion&&t.append(" (LR)"),e.succeeded){const n=op(e.source.contents);t.append(" "+$x+"  "),t.append(typeof n=="string"?'"'+n+'"':n)}t.append(`
`)}}),t.contents()}}bi.prototype.SKIP={},Object.keys(Ml).forEach(r=>{const t=Ml[r];Object.defineProperty(bi.prototype,r,{get(){return(this._flags&t)!==0},set(e){e?this._flags|=t:this._flags&=~t}})}),V.prototype.allowsSkippingPrecedingSpace=zt("allowsSkippingPrecedingSpace"),Lt.allowsSkippingPrecedingSpace=Nt.allowsSkippingPrecedingSpace=K.prototype.allowsSkippingPrecedingSpace=Ot.prototype.allowsSkippingPrecedingSpace=Bt.prototype.allowsSkippingPrecedingSpace=Dt.prototype.allowsSkippingPrecedingSpace=function(){return!0},yt.prototype.allowsSkippingPrecedingSpace=jt.prototype.allowsSkippingPrecedingSpace=ee.prototype.allowsSkippingPrecedingSpace=Gt.prototype.allowsSkippingPrecedingSpace=$t.prototype.allowsSkippingPrecedingSpace=Ft.prototype.allowsSkippingPrecedingSpace=St.prototype.allowsSkippingPrecedingSpace=function(){return!1};let cs;rp(r=>{cs=r});let Gn;V.prototype.assertAllApplicationsAreValid=function(r,t){Gn=0,this._assertAllApplicationsAreValid(r,t)},V.prototype._assertAllApplicationsAreValid=zt("_assertAllApplicationsAreValid"),Lt._assertAllApplicationsAreValid=Nt._assertAllApplicationsAreValid=Ot.prototype._assertAllApplicationsAreValid=Bt.prototype._assertAllApplicationsAreValid=Ft.prototype._assertAllApplicationsAreValid=Dt.prototype._assertAllApplicationsAreValid=function(r,t){},ee.prototype._assertAllApplicationsAreValid=function(r,t){Gn++,this.expr._assertAllApplicationsAreValid(r,t),Gn--},yt.prototype._assertAllApplicationsAreValid=function(r,t){for(let e=0;e<this.terms.length;e++)this.terms[e]._assertAllApplicationsAreValid(r,t)},St.prototype._assertAllApplicationsAreValid=function(r,t){for(let e=0;e<this.factors.length;e++)this.factors[e]._assertAllApplicationsAreValid(r,t)},jt.prototype._assertAllApplicationsAreValid=$t.prototype._assertAllApplicationsAreValid=Gt.prototype._assertAllApplicationsAreValid=function(r,t){this.expr._assertAllApplicationsAreValid(r,t)},K.prototype._assertAllApplicationsAreValid=function(r,t,e=!1){const i=t.rules[this.ruleName],s=zi(r)&&Gn===0;if(!i)throw Yf(this.ruleName,t.name,this.source);if(!e&&zi(this.ruleName)&&!s)throw Dx(this.ruleName,this);const n=this.args.length,o=i.formals.length;if(n!==o)throw Ix(this.ruleName,o,n,this.source);const a=cs&&i===cs.rules.applySyntactic;if(cs&&i===cs.rules.caseInsensitive&&!(this.args[0]instanceof Ot))throw Zf('a Terminal (e.g. "abc")',this.args[0]);if(a){const l=this.args[0];if(!(l instanceof K))throw Zf("a syntactic rule application",l);if(!zi(l.ruleName))throw Tx(l);if(s)throw Rx(this)}this.args.forEach(l=>{if(l._assertAllApplicationsAreValid(r,t,a),l.getArity()!==1)throw Mx(this.ruleName,l)})},V.prototype.assertChoicesHaveUniformArity=zt("assertChoicesHaveUniformArity"),Lt.assertChoicesHaveUniformArity=Nt.assertChoicesHaveUniformArity=Ot.prototype.assertChoicesHaveUniformArity=Bt.prototype.assertChoicesHaveUniformArity=Ft.prototype.assertChoicesHaveUniformArity=ee.prototype.assertChoicesHaveUniformArity=Dt.prototype.assertChoicesHaveUniformArity=function(r){},yt.prototype.assertChoicesHaveUniformArity=function(r){if(this.terms.length===0)return;const t=this.terms[0].getArity();for(let e=0;e<this.terms.length;e++){const i=this.terms[e];i.assertChoicesHaveUniformArity();const s=i.getArity();if(t!==s)throw ep(r,t,s,i)}},zn.prototype.assertChoicesHaveUniformArity=function(r){const t=this.terms[0].getArity(),e=this.terms[1].getArity();if(t!==e)throw ep(r,e,t,this.terms[0])},St.prototype.assertChoicesHaveUniformArity=function(r){for(let t=0;t<this.factors.length;t++)this.factors[t].assertChoicesHaveUniformArity(r)},jt.prototype.assertChoicesHaveUniformArity=function(r){this.expr.assertChoicesHaveUniformArity(r)},$t.prototype.assertChoicesHaveUniformArity=function(r){},Gt.prototype.assertChoicesHaveUniformArity=function(r){this.expr.assertChoicesHaveUniformArity(r)},K.prototype.assertChoicesHaveUniformArity=function(r){},V.prototype.assertIteratedExprsAreNotNullable=zt("assertIteratedExprsAreNotNullable"),Lt.assertIteratedExprsAreNotNullable=Nt.assertIteratedExprsAreNotNullable=Ot.prototype.assertIteratedExprsAreNotNullable=Bt.prototype.assertIteratedExprsAreNotNullable=Ft.prototype.assertIteratedExprsAreNotNullable=Dt.prototype.assertIteratedExprsAreNotNullable=function(r){},yt.prototype.assertIteratedExprsAreNotNullable=function(r){for(let t=0;t<this.terms.length;t++)this.terms[t].assertIteratedExprsAreNotNullable(r)},St.prototype.assertIteratedExprsAreNotNullable=function(r){for(let t=0;t<this.factors.length;t++)this.factors[t].assertIteratedExprsAreNotNullable(r)},jt.prototype.assertIteratedExprsAreNotNullable=function(r){if(this.expr.assertIteratedExprsAreNotNullable(r),this.expr.isNullable(r))throw tp(this,[])},ei.prototype.assertIteratedExprsAreNotNullable=$t.prototype.assertIteratedExprsAreNotNullable=Gt.prototype.assertIteratedExprsAreNotNullable=ee.prototype.assertIteratedExprsAreNotNullable=function(r){this.expr.assertIteratedExprsAreNotNullable(r)},K.prototype.assertIteratedExprsAreNotNullable=function(r){this.args.forEach(t=>{t.assertIteratedExprsAreNotNullable(r)})};class Ol{constructor(t){this.matchLength=t}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(t){if(this.children)return this.children[t]}indexOfChild(t){return this.children.indexOf(t)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(this.numChildren()!==1)throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(t){const e=this.indexOfChild(t);if(e<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(e===0)throw new Error("cannot get child before first child");return this.childAt(e-1)}childAfter(t){const e=this.indexOfChild(t);if(e<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(e===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(e+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}}class Gi extends Ol{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}}class Jx extends Ol{constructor(t,e,i,s){super(s),this.ruleName=t,this.children=e,this.childOffsets=i}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return $f(this.ctorName)}isSyntactic(){return zi(this.ctorName)}}class ap extends Ol{constructor(t,e,i,s){super(i),this.children=t,this.childOffsets=e,this.optional=s}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}}V.prototype.eval=zt("eval"),Lt.eval=function(r){const{inputStream:t}=r,e=t.pos,i=t.nextCodePoint();return i!==void 0?(r.pushBinding(new Gi(String.fromCodePoint(i).length),e),!0):(r.processFailure(e,this),!1)},Nt.eval=function(r){const{inputStream:t}=r,e=t.pos;return t.atEnd()?(r.pushBinding(new Gi(0),e),!0):(r.processFailure(e,this),!1)},Ot.prototype.eval=function(r){const{inputStream:t}=r,e=t.pos;return t.matchString(this.obj)?(r.pushBinding(new Gi(this.obj.length),e),!0):(r.processFailure(e,this),!1)},Bt.prototype.eval=function(r){const{inputStream:t}=r,e=t.pos,i=this.matchCodePoint?t.nextCodePoint():t.nextCharCode();return i!==void 0&&this.from.codePointAt(0)<=i&&i<=this.to.codePointAt(0)?(r.pushBinding(new Gi(String.fromCodePoint(i).length),e),!0):(r.processFailure(e,this),!1)},Ft.prototype.eval=function(r){return r.eval(r.currentApplication().args[this.index])},ee.prototype.eval=function(r){r.enterLexifiedContext();const t=r.eval(this.expr);return r.exitLexifiedContext(),t},yt.prototype.eval=function(r){for(let t=0;t<this.terms.length;t++)if(r.eval(this.terms[t]))return!0;return!1},St.prototype.eval=function(r){for(let t=0;t<this.factors.length;t++){const e=this.factors[t];if(!r.eval(e))return!1}return!0},jt.prototype.eval=function(r){const{inputStream:t}=r,e=t.pos,i=this.getArity(),s=[],n=[];for(;s.length<i;)s.push([]),n.push([]);let o=0,a=e,l;for(;o<this.maxNumMatches&&r.eval(this.expr);){if(t.pos===a)throw tp(this,r._applicationStack);a=t.pos,o++;const d=r._bindings.splice(r._bindings.length-i,i),f=r._bindingOffsets.splice(r._bindingOffsets.length-i,i);for(l=0;l<d.length;l++)s[l].push(d[l]),n[l].push(f[l])}if(o<this.minNumMatches)return!1;let h=r.posToOffset(e),c=0;if(o>0){const d=s[i-1],f=n[i-1],p=f[f.length-1]+d[d.length-1].matchLength;h=n[0][0],c=p-h}const u=this instanceof ei;for(l=0;l<s.length;l++)r._bindings.push(new ap(s[l],n[l],c,u)),r._bindingOffsets.push(h);return!0},$t.prototype.eval=function(r){const{inputStream:t}=r,e=t.pos;r.pushFailuresInfo();const i=r.eval(this.expr);return r.popFailuresInfo(),i?(r.processFailure(e,this),!1):(t.pos=e,!0)},Gt.prototype.eval=function(r){const{inputStream:t}=r,e=t.pos;return r.eval(this.expr)?(t.pos=e,!0):!1},K.prototype.eval=function(r){const t=r.currentApplication(),e=t?t.args:[],i=this.substituteParams(e),s=r.getCurrentPosInfo();if(s.isActive(i))return i.handleCycle(r);const n=i.toMemoKey(),o=s.memo[n];if(o&&s.shouldUseMemoizedResult(o)){if(r.hasNecessaryInfo(o))return r.useMemoizedResult(r.inputStream.pos,o);delete s.memo[n]}return i.reallyEval(r)},K.prototype.handleCycle=function(r){const t=r.getCurrentPosInfo(),{currentLeftRecursion:e}=t,i=this.toMemoKey();let s=t.memo[i];return e&&e.headApplication.toMemoKey()===i?s.updateInvolvedApplicationMemoKeys():s||(s=t.memoize(i,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),t.startLeftRecursion(this,s)),r.useMemoizedResult(r.inputStream.pos,s)},K.prototype.reallyEval=function(r){const{inputStream:t}=r,e=t.pos,i=r.getCurrentPosInfo(),s=r.grammar.rules[this.ruleName],{body:n}=s,{description:o}=s;r.enterApplication(i,this),o&&r.pushFailuresInfo();const a=t.examinedLength;t.examinedLength=0;let l=this.evalOnce(n,r);const h=i.currentLeftRecursion,c=this.toMemoKey(),u=h&&h.headApplication.toMemoKey()===c;let d;r.doNotMemoize?r.doNotMemoize=!1:u?(l=this.growSeedResult(n,r,e,h,l),i.endLeftRecursion(),d=h,d.examinedLength=t.examinedLength-e,d.rightmostFailureOffset=r._getRightmostFailureOffset(),i.memoize(c,d)):(!h||!h.isInvolved(c))&&(d=i.memoize(c,{matchLength:t.pos-e,examinedLength:t.examinedLength-e,value:l,failuresAtRightmostPosition:r.cloneRecordedFailures(),rightmostFailureOffset:r._getRightmostFailureOffset()}));const f=!!l;if(o&&(r.popFailuresInfo(),f||r.processFailure(e,this),d&&(d.failuresAtRightmostPosition=r.cloneRecordedFailures())),r.isTracing()&&d){const p=r.getTraceEntry(e,this,f,f?[l]:[]);u&&(xi(p.terminatingLREntry!=null||!f),p.isHeadOfLeftRecursion=!0),d.traceEntry=p}return t.examinedLength=Math.max(t.examinedLength,a),r.exitApplication(i,l),f},K.prototype.evalOnce=function(r,t){const{inputStream:e}=t,i=e.pos;if(t.eval(r)){const s=r.getArity(),n=t._bindings.splice(t._bindings.length-s,s),o=t._bindingOffsets.splice(t._bindingOffsets.length-s,s),a=e.pos-i;return new Jx(this.ruleName,n,o,a)}else return!1},K.prototype.growSeedResult=function(r,t,e,i,s){if(!s)return!1;const{inputStream:n}=t;for(;;){if(i.matchLength=n.pos-e,i.value=s,i.failuresAtRightmostPosition=t.cloneRecordedFailures(),t.isTracing()){const o=t.trace[t.trace.length-1];i.traceEntry=new bi(t.input,e,n.pos,this,!0,[s],[o.clone()])}if(n.pos=e,s=this.evalOnce(r,t),n.pos-e<=i.matchLength)break;t.isTracing()&&t.trace.splice(-2,1)}return t.isTracing()&&i.traceEntry.recordLRTermination(t.trace.pop(),s),n.pos=e+i.matchLength,i.value},Dt.prototype.eval=function(r){const{inputStream:t}=r,e=t.pos,i=t.next();return i&&this.pattern.test(i)?(r.pushBinding(new Gi(i.length),e),!0):(r.processFailure(e,this),!1)},V.prototype.getArity=zt("getArity"),Lt.getArity=Nt.getArity=Ot.prototype.getArity=Bt.prototype.getArity=Ft.prototype.getArity=K.prototype.getArity=Dt.prototype.getArity=function(){return 1},yt.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()},St.prototype.getArity=function(){let r=0;for(let t=0;t<this.factors.length;t++)r+=this.factors[t].getArity();return r},jt.prototype.getArity=function(){return this.expr.getArity()},$t.prototype.getArity=function(){return 0},Gt.prototype.getArity=ee.prototype.getArity=function(){return this.expr.getArity()};function Me(r,t){const e={};if(r.source&&t){const i=r.source.relativeTo(t);e.sourceInterval=[i.startIdx,i.endIdx]}return e}V.prototype.outputRecipe=zt("outputRecipe"),Lt.outputRecipe=function(r,t){return["any",Me(this,t)]},Nt.outputRecipe=function(r,t){return["end",Me(this,t)]},Ot.prototype.outputRecipe=function(r,t){return["terminal",Me(this,t),this.obj]},Bt.prototype.outputRecipe=function(r,t){return["range",Me(this,t),this.from,this.to]},Ft.prototype.outputRecipe=function(r,t){return["param",Me(this,t),this.index]},yt.prototype.outputRecipe=function(r,t){return["alt",Me(this,t)].concat(this.terms.map(e=>e.outputRecipe(r,t)))},zn.prototype.outputRecipe=function(r,t){return this.terms[0].outputRecipe(r,t)},jn.prototype.outputRecipe=function(r,t){const e=this.terms.slice(0,this.expansionPos),i=this.terms.slice(this.expansionPos+1);return["splice",Me(this,t),e.map(s=>s.outputRecipe(r,t)),i.map(s=>s.outputRecipe(r,t))]},St.prototype.outputRecipe=function(r,t){return["seq",Me(this,t)].concat(this.factors.map(e=>e.outputRecipe(r,t)))},$i.prototype.outputRecipe=yr.prototype.outputRecipe=ei.prototype.outputRecipe=$t.prototype.outputRecipe=Gt.prototype.outputRecipe=ee.prototype.outputRecipe=function(r,t){return[this.constructor.name.toLowerCase(),Me(this,t),this.expr.outputRecipe(r,t)]},K.prototype.outputRecipe=function(r,t){return["app",Me(this,t),this.ruleName,this.args.map(e=>e.outputRecipe(r,t))]},Dt.prototype.outputRecipe=function(r,t){return["unicodeChar",Me(this,t),this.category]},V.prototype.introduceParams=zt("introduceParams"),Lt.introduceParams=Nt.introduceParams=Ot.prototype.introduceParams=Bt.prototype.introduceParams=Ft.prototype.introduceParams=Dt.prototype.introduceParams=function(r){return this},yt.prototype.introduceParams=function(r){return this.terms.forEach((t,e,i)=>{i[e]=t.introduceParams(r)}),this},St.prototype.introduceParams=function(r){return this.factors.forEach((t,e,i)=>{i[e]=t.introduceParams(r)}),this},jt.prototype.introduceParams=$t.prototype.introduceParams=Gt.prototype.introduceParams=ee.prototype.introduceParams=function(r){return this.expr=this.expr.introduceParams(r),this},K.prototype.introduceParams=function(r){const t=r.indexOf(this.ruleName);if(t>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new Ft(t).withSource(this.source)}else return this.args.forEach((e,i,s)=>{s[i]=e.introduceParams(r)}),this},V.prototype.isNullable=function(r){return this._isNullable(r,Object.create(null))},V.prototype._isNullable=zt("_isNullable"),Lt._isNullable=Bt.prototype._isNullable=Ft.prototype._isNullable=yr.prototype._isNullable=Dt.prototype._isNullable=function(r,t){return!1},Nt._isNullable=function(r,t){return!0},Ot.prototype._isNullable=function(r,t){return typeof this.obj=="string"?this.obj==="":!1},yt.prototype._isNullable=function(r,t){return this.terms.length===0||this.terms.some(e=>e._isNullable(r,t))},St.prototype._isNullable=function(r,t){return this.factors.every(e=>e._isNullable(r,t))},$i.prototype._isNullable=ei.prototype._isNullable=$t.prototype._isNullable=Gt.prototype._isNullable=function(r,t){return!0},ee.prototype._isNullable=function(r,t){return this.expr._isNullable(r,t)},K.prototype._isNullable=function(r,t){const e=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(t,e)){const{body:i}=r.rules[this.ruleName],s=i.substituteParams(this.args);t[e]=!1,t[e]=s._isNullable(r,t)}return t[e]},V.prototype.substituteParams=zt("substituteParams"),Lt.substituteParams=Nt.substituteParams=Ot.prototype.substituteParams=Bt.prototype.substituteParams=Dt.prototype.substituteParams=function(r){return this},Ft.prototype.substituteParams=function(r){return Kf(r[this.index])},yt.prototype.substituteParams=function(r){return new yt(this.terms.map(t=>t.substituteParams(r)))},St.prototype.substituteParams=function(r){return new St(this.factors.map(t=>t.substituteParams(r)))},jt.prototype.substituteParams=$t.prototype.substituteParams=Gt.prototype.substituteParams=ee.prototype.substituteParams=function(r){return new this.constructor(this.expr.substituteParams(r))},K.prototype.substituteParams=function(r){if(this.args.length===0)return this;{const t=this.args.map(e=>e.substituteParams(r));return new K(this.ruleName,t)}};function lp(r){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(r)}function Dl(r){const t=Object.create(null);r.forEach(e=>{t[e]=(t[e]||0)+1}),Object.keys(t).forEach(e=>{if(t[e]<=1)return;let i=1;r.forEach((s,n)=>{s===e&&(r[n]=s+"_"+i++)})})}V.prototype.toArgumentNameList=zt("toArgumentNameList"),Lt.toArgumentNameList=function(r,t){return["any"]},Nt.toArgumentNameList=function(r,t){return["end"]},Ot.prototype.toArgumentNameList=function(r,t){return typeof this.obj=="string"&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+r]},Bt.prototype.toArgumentNameList=function(r,t){let e=this.from+"_to_"+this.to;return lp(e)||(e="_"+e),lp(e)||(e="$"+r),[e]},yt.prototype.toArgumentNameList=function(r,t){const e=this.terms.map(n=>n.toArgumentNameList(r,!0)),i=[],s=e[0].length;for(let n=0;n<s;n++){const o=[];for(let l=0;l<this.terms.length;l++)o.push(e[l][n]);const a=jf(o);i.push(a.join("_or_"))}return t||Dl(i),i},St.prototype.toArgumentNameList=function(r,t){let e=[];return this.factors.forEach(i=>{const s=i.toArgumentNameList(r,!0);e=e.concat(s),r+=s.length}),t||Dl(e),e},jt.prototype.toArgumentNameList=function(r,t){const e=this.expr.toArgumentNameList(r,t).map(i=>i[i.length-1]==="s"?i+"es":i+"s");return t||Dl(e),e},ei.prototype.toArgumentNameList=function(r,t){return this.expr.toArgumentNameList(r,t).map(e=>"opt"+e[0].toUpperCase()+e.slice(1))},$t.prototype.toArgumentNameList=function(r,t){return[]},Gt.prototype.toArgumentNameList=ee.prototype.toArgumentNameList=function(r,t){return this.expr.toArgumentNameList(r,t)},K.prototype.toArgumentNameList=function(r,t){return[this.ruleName]},Dt.prototype.toArgumentNameList=function(r,t){return["$"+r]},Ft.prototype.toArgumentNameList=function(r,t){return["param"+this.index]},V.prototype.toDisplayString=zt("toDisplayString"),yt.prototype.toDisplayString=St.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"},Lt.toDisplayString=Nt.toDisplayString=jt.prototype.toDisplayString=$t.prototype.toDisplayString=Gt.prototype.toDisplayString=ee.prototype.toDisplayString=Ot.prototype.toDisplayString=Bt.prototype.toDisplayString=Ft.prototype.toDisplayString=function(){return this.toString()},K.prototype.toDisplayString=function(){if(this.args.length>0){const r=this.args.map(t=>t.toDisplayString());return this.ruleName+"<"+r.join(",")+">"}else return this.ruleName},Dt.prototype.toDisplayString=function(){return"Unicode ["+this.category+"] character"};function Qx(r){return r==="description"||r==="string"||r==="code"}class ie{constructor(t,e,i){if(!Qx(i))throw new Error("invalid Failure type: "+i);this.pexpr=t,this.text=e,this.type=i,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return this.type==="description"}isStringTerminal(){return this.type==="string"}isCode(){return this.type==="code"}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(t){return this.getText()===t.getText()&&this.type===t.type&&(!this.isFluffy()||this.isFluffy()&&t.isFluffy())}toString(){return this.type==="string"?JSON.stringify(this.getText()):this.getText()}clone(){const t=new ie(this.pexpr,this.text,this.type);return this.isFluffy()&&t.makeFluffy(),t}toKey(){return this.toString()+"#"+this.type}}V.prototype.toFailure=zt("toFailure"),Lt.toFailure=function(r){return new ie(this,"any object","description")},Nt.toFailure=function(r){return new ie(this,"end of input","description")},Ot.prototype.toFailure=function(r){return new ie(this,this.obj,"string")},Bt.prototype.toFailure=function(r){return new ie(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")},$t.prototype.toFailure=function(r){const t=this.expr===Lt?"nothing":"not "+this.expr.toFailure(r);return new ie(this,t,"description")},Gt.prototype.toFailure=function(r){return this.expr.toFailure(r)},K.prototype.toFailure=function(r){let{description:t}=r.rules[this.ruleName];return t||(t=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName),new ie(this,t,"description")},Dt.prototype.toFailure=function(r){return new ie(this,"a Unicode ["+this.category+"] character","description")},yt.prototype.toFailure=function(r){const t="("+this.terms.map(e=>e.toFailure(r)).join(" or ")+")";return new ie(this,t,"description")},St.prototype.toFailure=function(r){const t="("+this.factors.map(e=>e.toFailure(r)).join(" ")+")";return new ie(this,t,"description")},jt.prototype.toFailure=function(r){const t="("+this.expr.toFailure(r)+this.operator+")";return new ie(this,t,"description")},V.prototype.toString=zt("toString"),Lt.toString=function(){return"any"},Nt.toString=function(){return"end"},Ot.prototype.toString=function(){return JSON.stringify(this.obj)},Bt.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)},Ft.prototype.toString=function(){return"$"+this.index},ee.prototype.toString=function(){return"#("+this.expr.toString()+")"},yt.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(r=>r.toString()).join(" | ")+")"},St.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(r=>r.toString()).join(" ")+")"},jt.prototype.toString=function(){return this.expr+this.operator},$t.prototype.toString=function(){return"~"+this.expr},Gt.prototype.toString=function(){return"&"+this.expr},K.prototype.toString=function(){if(this.args.length>0){const r=this.args.map(t=>t.toString());return this.ruleName+"<"+r.join(",")+">"}else return this.ruleName},Dt.prototype.toString=function(){return"\\p{"+this.category+"}"};class Tl extends V{constructor(t){super(),this.obj=t}_getString(t){const e=t.currentApplication().args[this.obj.index];return xi(e instanceof Ot,"expected a Terminal expression"),e.obj}allowsSkippingPrecedingSpace(){return!0}eval(t){const{inputStream:e}=t,i=e.pos,s=this._getString(t);return e.matchString(s,!0)?(t.pushBinding(new Gi(s.length),i),!0):(t.processFailure(i,this),!1)}getArity(){return 1}substituteParams(t){return new Tl(this.obj.substituteParams(t))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(t){return new ie(this,this.obj.toFailure(t)+" (case-insensitive)","description")}_isNullable(t,e){return this.obj._isNullable(t,e)}}let hp;rp(r=>{hp=r.rules.applySyntactic.body});const Rl=new K("spaces");class Zx{constructor(t,e,i){this.matcher=t,this.startExpr=e,this.grammar=t.grammar,this.input=t.getInput(),this.inputStream=new $n(this.input),this.memoTable=t._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],i!==void 0&&(this.positionToRecordFailures=i,this.recordedFailures=Object.create(null))}posToOffset(t){return t-this._posStack[this._posStack.length-1]}enterApplication(t,e){this._posStack.push(this.inputStream.pos),this._applicationStack.push(e),this.inLexifiedContextStack.push(!1),t.enter(e),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(t,e){const i=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),t.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),e&&this.pushBinding(e,i)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){const t=this.currentApplication();return t?t.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(Rl),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(t){return t.allowsSkippingPrecedingSpace()&&t!==Rl?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(t,e){this._bindings.push(t),this._bindingOffsets.push(this.posToOffset(e))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(t){for(;this._bindings.length>t;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(t){let e=this.memoTable[t];return e||(e=this.memoTable[t]=new _x),e}processFailure(t,e){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,t),this.recordedFailures&&t===this.positionToRecordFailures){const i=this.currentApplication();i&&(e=e.substituteParams(i.args)),this.recordFailure(e.toFailure(this.grammar),!1)}}recordFailure(t,e){const i=t.toKey();this.recordedFailures[i]?this.recordedFailures[i].isFluffy()&&!t.isFluffy()&&this.recordedFailures[i].clearFluffy():this.recordedFailures[i]=e?t.clone():t}recordFailures(t,e){Object.keys(t).forEach(i=>{this.recordFailure(t[i],e)})}cloneRecordedFailures(){if(!this.recordedFailures)return;const t=Object.create(null);return Object.keys(this.recordedFailures).forEach(e=>{t[e]=this.recordedFailures[e].clone()}),t}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(t,e){const i=this.memoTable[t];if(i&&e instanceof K){const s=i.memo[e.toMemoKey()];if(s&&s.traceEntry){const n=s.traceEntry.cloneWithExpr(e);return n.isMemoized=!0,n}}return null}getTraceEntry(t,e,i,s){if(e instanceof K){const n=this.currentApplication(),o=n?n.args:[];e=e.substituteParams(o)}return this.getMemoizedTraceEntry(t,e)||new bi(this.input,t,this.inputStream.pos,e,i,s,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(t){return this.trace&&!t.traceEntry?!1:this.recordedFailures&&this.inputStream.pos+t.rightmostFailureOffset===this.positionToRecordFailures?!!t.failuresAtRightmostPosition:!0}useMemoizedResult(t,e){this.trace&&this.trace.push(e.traceEntry);const i=this.inputStream.pos+e.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,i),this.recordedFailures&&this.positionToRecordFailures===i&&e.failuresAtRightmostPosition&&this.recordFailures(e.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,e.examinedLength+t),e.value?(this.inputStream.pos+=e.matchLength,this.pushBinding(e.value,t),!0):!1}eval(t){const{inputStream:e}=this,i=this._bindings.length,s=this.userData;let n;this.recordedFailures&&(n=this.recordedFailures,this.recordedFailures=Object.create(null));const o=e.pos,a=this.maybeSkipSpacesBefore(t);let l;this.trace&&(l=this.trace,this.trace=[]);const h=t.eval(this);if(this.trace){const c=this._bindings.slice(i),u=this.getTraceEntry(a,t,h,c);u.isImplicitSpaces=t===Rl,u.isRootNode=t===this.startExpr,l.push(u),this.trace=l}return h?this.recordedFailures&&e.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach(c=>{this.recordedFailures[c].makeFluffy()}):(e.pos=o,this.truncateBindings(i),this.userData=s),this.recordedFailures&&this.recordFailures(n,!1),t===hp&&this.skipSpaces(),h}getMatchResult(){this.grammar._setUpMatchState(this),this.eval(this.startExpr);let t;this.recordedFailures&&(t=Object.keys(this.recordedFailures).map(i=>this.recordedFailures[i]));const e=this._bindings[0];return e&&(e.grammar=this.grammar),new np(this.matcher,this.input,this.startExpr,e,this._bindingOffsets[0],this.rightmostFailurePosition,t)}getTrace(){this.trace=[];const t=this.getMatchResult(),e=this.trace[this.trace.length-1];return e.result=t,e}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}}class tb{constructor(t){this.grammar=t,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(t){return this._input!==t&&this.replaceInputRange(0,this._input.length,t),this}replaceInputRange(t,e,i){const s=this._input,n=this._memoTable;if(t<0||t>s.length||e<0||e>s.length||t>e)throw new Error("Invalid indices: "+t+" and "+e);this._input=s.slice(0,t)+i+s.slice(e),this._input!==s&&n.length>0&&(this._isMemoTableStale=!0);const o=n.slice(e);n.length=t;for(let a=0;a<i.length;a++)n.push(void 0);for(const a of o)n.push(a);for(let a=0;a<t;a++){const l=n[a];l&&l.clearObsoleteEntries(a,t)}return this}match(t,e={incremental:!0}){return this._match(this._getStartExpr(t),{incremental:e.incremental,tracing:!1})}trace(t,e={incremental:!0}){return this._match(this._getStartExpr(t),{incremental:e.incremental,tracing:!0})}_match(t,e={}){const i={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...e};if(!i.incremental)this._resetMemoTable();else if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw kx(this.grammar);const s=new Zx(this,t,i.positionToRecordFailures);return i.tracing?s.getTrace():s.getMatchResult()}_getStartExpr(t){const e=t||this.grammar.defaultStartRule;if(!e)throw new Error("Missing start rule argument -- the grammar has no default start rule.");const i=this.grammar.parseApplication(e);return new St([i,Nt])}}const us=[],El=(r,t)=>Object.prototype.hasOwnProperty.call(r,t);class cp{constructor(t,e,i){this._node=t,this.source=e,this._baseInterval=i,t.isNonterminal()&&xi(e===i),this._childWrappers=[]}_forgetMemoizedResultFor(t){delete this._node[this._semantics.attributeKeys[t]],this.children.forEach(e=>{e._forgetMemoizedResultFor(t)})}child(t){if(!(0<=t&&t<this._node.numChildren()))return;let e=this._childWrappers[t];if(!e){const i=this._node.childAt(t),s=this._node.childOffsets[t],n=this._baseInterval.subInterval(s,i.matchLength),o=i.isNonterminal()?n:this._baseInterval;e=this._childWrappers[t]=this._semantics.wrap(i,n,o)}return e}_children(){for(let t=0;t<this._node.numChildren();t++)this.child(t);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(t){const e=t||[],i=e.map(o=>o._node),s=new ap(i,[],-1,!1),n=this._semantics.wrap(s,null,null);return n._childWrappers=e,n}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}}class re{constructor(t,e){const i=this;if(this.grammar=t,this.checkedActionDicts=!1,this.Wrapper=class extends(e?e.Wrapper:cp){constructor(s,n,o){super(s,n,o),i.checkActionDictsIfHaventAlready(),this._semantics=i}toString(){return"[semantics wrapper for "+i.grammar.name+"]"}},this.super=e,e){if(!(t.equals(this.super.grammar)||t._inheritsFrom(this.super.grammar)))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+t.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(const s in this.attributes)Object.defineProperty(this.attributeKeys,s,{value:sp(s)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let t;for(t in this.operations)this.operations[t].checkActionDict(this.grammar);for(t in this.attributes)this.attributes[t].checkActionDict(this.grammar)}toRecipe(t){function e(s){return s.super!==re.BuiltInSemantics._getSemantics()}let i=`(function(g) {
`;if(e(this)){i+="  var semantics = "+this.super.toRecipe(!0)+"(g";const s=this.super.grammar;let n=this.grammar;for(;n!==s;)i+=".superGrammar",n=n.superGrammar;i+=`);
`,i+="  return g.extendSemantics(semantics)"}else i+="  return g.createSemantics()";return["Operation","Attribute"].forEach(s=>{const n=this[s.toLowerCase()+"s"];Object.keys(n).forEach(o=>{const{actionDict:a,formals:l,builtInDefault:h}=n[o];let c=o;l.length>0&&(c+="("+l.join(", ")+")");let u;e(this)&&this.super[s.toLowerCase()+"s"][o]?u="extend"+s:u="add"+s,i+=`
    .`+u+"("+JSON.stringify(c)+", {";const d=[];Object.keys(a).forEach(f=>{if(a[f]!==h){let p=a[f].toString().trim();p=p.replace(/^.*\(/,"function("),d.push(`
      `+JSON.stringify(f)+": "+p)}}),i+=d.join(",")+`
    })`})}),i+=`;
  })`,t||(i=`(function() {
  var grammar = this.fromRecipe(`+this.grammar.toRecipe()+`);
  var semantics = `+i+`(grammar);
  return semantics;
});
`),i}addOperationOrAttribute(t,e,i){const s=t+"s",n=up(e,t),{name:o}=n,{formals:a}=n;this.assertNewName(o,t);const l=eb(t,o,u),h={_default:l};Object.keys(i).forEach(d=>{h[d]=i[d]});const c=t==="operation"?new ds(o,a,h,l):new Pl(o,h,l);c.checkActionDict(this.grammar),this[s][o]=c;function u(...d){const f=this._semantics[s][o];if(arguments.length!==f.formals.length)throw new Error("Invalid number of arguments passed to "+o+" "+t+" (expected "+f.formals.length+", got "+arguments.length+")");const p=Object.create(null);for(const[v,S]of Object.entries(d)){const w=f.formals[v];p[w]=S}const m=this.args;this.args=p;const g=f.execute(this._semantics,this);return this.args=m,g}t==="operation"?(this.Wrapper.prototype[o]=u,this.Wrapper.prototype[o].toString=function(){return"["+o+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,o,{get:u,configurable:!0}),Object.defineProperty(this.attributeKeys,o,{value:sp(o)}))}extendOperationOrAttribute(t,e,i){const s=t+"s";if(up(e,"attribute"),!(this.super&&e in this.super[s]))throw new Error("Cannot extend "+t+" '"+e+"': did not inherit an "+t+" with that name");if(El(this[s],e))throw new Error("Cannot extend "+t+" '"+e+"' again");const n=this[s][e].formals,o=this[s][e].actionDict,a=Object.create(o);Object.keys(i).forEach(l=>{a[l]=i[l]}),this[s][e]=t==="operation"?new ds(e,n,a):new Pl(e,a),this[s][e].checkActionDict(this.grammar)}assertNewName(t,e){if(El(cp.prototype,t))throw new Error("Cannot add "+e+" '"+t+"': that's a reserved name");if(t in this.operations)throw new Error("Cannot add "+e+" '"+t+"': an operation with that name already exists");if(t in this.attributes)throw new Error("Cannot add "+e+" '"+t+"': an attribute with that name already exists")}wrap(t,e,i){const s=i||e;return t instanceof this.Wrapper?t:new this.Wrapper(t,e,s)}}function up(r,t){if(!re.prototypeGrammar)return xi(r.indexOf("(")===-1),{name:r,formals:[]};const e=re.prototypeGrammar.match(r,t==="operation"?"OperationSignature":"AttributeSignature");if(e.failed())throw new Error(e.message);return re.prototypeGrammarSemantics(e).parse()}function eb(r,t,e){return function(...i){const s=(this._semantics.operations[t]||this._semantics.attributes[t]).formals.map(n=>this.args[n]);if(!this.isIteration()&&i.length===1)return e.apply(i[0],s);throw Nx(this.ctorName,t,r,us)}}re.createSemantics=function(r,t){const e=new re(r,t!==void 0?t:re.BuiltInSemantics._getSemantics()),i=function(s){if(!(s instanceof np))throw new TypeError("Semantics expected a MatchResult, but got "+Sl(s));if(s.failed())throw new TypeError("cannot apply Semantics to "+s.toString());const n=s._cst;if(n.grammar!==r)throw new Error("Cannot use a MatchResult from grammar '"+n.grammar.name+"' with a semantics for '"+r.name+"'");const o=new $n(s.input);return e.wrap(n,o.interval(s._cstOffset,s.input.length))};return i.addOperation=function(s,n){return e.addOperationOrAttribute("operation",s,n),i},i.extendOperation=function(s,n){return e.extendOperationOrAttribute("operation",s,n),i},i.addAttribute=function(s,n){return e.addOperationOrAttribute("attribute",s,n),i},i.extendAttribute=function(s,n){return e.extendOperationOrAttribute("attribute",s,n),i},i._getActionDict=function(s){const n=e.operations[s]||e.attributes[s];if(!n)throw new Error('"'+s+'" is not a valid operation or attribute name in this semantics for "'+r.name+'"');return n.actionDict},i._remove=function(s){let n;return s in e.operations?(n=e.operations[s],delete e.operations[s]):s in e.attributes&&(n=e.attributes[s],delete e.attributes[s]),delete e.Wrapper.prototype[s],n},i.getOperationNames=function(){return Object.keys(e.operations)},i.getAttributeNames=function(){return Object.keys(e.attributes)},i.getGrammar=function(){return e.grammar},i.toRecipe=function(s){return e.toRecipe(s)},i.toString=e.toString.bind(e),i._getSemantics=function(){return e},i};class ds{constructor(t,e,i,s){this.name=t,this.formals=e,this.actionDict=i,this.builtInDefault=s}checkActionDict(t){t._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(t,e){try{const{ctorName:i}=e._node;let s=this.actionDict[i];return s?(us.push([this,i]),s.apply(e,e._children())):e.isNonterminal()&&(s=this.actionDict._nonterminal,s)?(us.push([this,"_nonterminal",i]),s.apply(e,e._children())):(us.push([this,"default action",i]),this.actionDict._default.apply(e,e._children()))}finally{us.pop()}}}ds.prototype.typeName="operation";class Pl extends ds{constructor(t,e,i){super(t,[],e,i)}execute(t,e){const i=e._node,s=t.attributeKeys[this.name];return El(i,s)||(i[s]=ds.prototype.execute.call(this,t,e)),i[s]}}Pl.prototype.typeName="attribute";const dp=["_iter","_terminal","_nonterminal","_default"];function fp(r){return Object.keys(r.rules).sort().map(t=>r.rules[t])}const ib=r=>r.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");let pp,mp;class Ut{constructor(t,e,i,s){if(this.name=t,this.superGrammar=e,this.rules=i,s){if(!(s in i))throw new Error("Invalid start rule: '"+s+"' is not a rule in grammar '"+t+"'");this.defaultStartRule=s}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new tb(this)}isBuiltIn(){return this===Ut.ProtoBuiltInRules||this===Ut.BuiltInRules}equals(t){if(this===t)return!0;if(t==null||this.name!==t.name||this.defaultStartRule!==t.defaultStartRule||!(this.superGrammar===t.superGrammar||this.superGrammar.equals(t.superGrammar)))return!1;const e=fp(this),i=fp(t);return e.length===i.length&&e.every((s,n)=>s.description===i[n].description&&s.formals.join(",")===i[n].formals.join(",")&&s.body.toString()===i[n].body.toString())}match(t,e){const i=this.matcher();return i.replaceInputRange(0,0,t),i.match(e)}trace(t,e){const i=this.matcher();return i.replaceInputRange(0,0,t),i.trace(e)}createSemantics(){return re.createSemantics(this)}extendSemantics(t){return re.createSemantics(this,t._getSemantics())}_checkTopDownActionDict(t,e,i){const s=[];for(const n in i){const o=i[n];if(!dp.includes(n)&&!(n in this.rules)){s.push(`'${n}' is not a valid semantic action for '${this.name}'`);continue}if(typeof o!="function"){s.push(`'${n}' must be a function in an action dictionary for '${this.name}'`);continue}const a=o.length,l=this._topDownActionArity(n);if(a!==l){let h;n==="_iter"||n==="_nonterminal"?h=`it should use a rest parameter, e.g. \`${n}(...children) {}\`. NOTE: this is new in Ohm v16 \u2014 see https://ohmjs.org/d/ati for details.`:h=`expected ${l}, got ${a}`,s.push(`Semantic action '${n}' has the wrong arity: ${h}`)}}if(s.length>0){const n=s.map(a=>"- "+a),o=new Error([`Found errors in the action dictionary of the '${e}' ${t}:`,...n].join(`
`));throw o.problems=s,o}}_topDownActionArity(t){return dp.includes(t)?0:this.rules[t].body.getArity()}_inheritsFrom(t){let e=this.superGrammar;for(;e;){if(e.equals(t,!0))return!0;e=e.superGrammar}return!1}toRecipe(t=void 0){const e={};this.source&&(e.source=this.source.contents);let i=null;this.defaultStartRule&&(i=this.defaultStartRule);const s={};Object.keys(this.rules).forEach(a=>{const l=this.rules[a],{body:h}=l,c=!this.superGrammar||!this.superGrammar.rules[a];let u;c?u="define":u=h instanceof zn?"extend":"override";const d={};if(l.source&&this.source){const m=l.source.relativeTo(this.source);d.sourceInterval=[m.startIdx,m.endIdx]}const f=c?l.description:null,p=h.outputRecipe(l.formals,this.source);s[a]=[u,d,f,l.formals,p]});let n="null";t?n=t:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(n=this.superGrammar.toRecipe());const o=[...["grammar",e,this.name].map(JSON.stringify),n,...[i,s].map(JSON.stringify)];return ib(`[${o.join(",")}]`)}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){const t=new ji;t.append("{");let e=!0;for(const i in this.rules){const{body:s}=this.rules[i];e?e=!1:t.append(","),t.append(`
`),t.append("  "),this.addSemanticActionTemplate(i,s,t)}return t.append(`
}`),t.contents()}addSemanticActionTemplate(t,e,i){i.append(t),i.append(": function(");const s=this._topDownActionArity(t);i.append(Hn("_",s).join(", ")),i.append(`) {
`),i.append("  }")}parseApplication(t){let e;if(t.indexOf("<")===-1)e=new K(t);else{const s=pp.match(t,"Base_application");e=mp(s,{})}if(!(e.ruleName in this.rules))throw Yf(e.ruleName,this.name);const{formals:i}=this.rules[e.ruleName];if(i.length!==e.args.length){const{source:s}=this.rules[e.ruleName];throw Jf(e.ruleName,i.length,e.args.length,s)}return e}_setUpMatchState(t){this._matchStateInitializer&&this._matchStateInitializer(t)}}Ut.ProtoBuiltInRules=new Ut("ProtoBuiltInRules",void 0,{any:{body:Lt,formals:[],description:"any character",primitive:!0},end:{body:Nt,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new Tl(new Ft(0)),formals:["str"],primitive:!0},lower:{body:new Dt("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new Dt("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new Dt("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new $i(new K("space")),formals:[]},space:{body:new Bt("\0"," "),formals:[],description:"a space"}}),Ut.initApplicationParser=function(r,t){pp=r,mp=t};class gp{constructor(t){this.name=t}sourceInterval(t,e){return this.source.subInterval(t,e-t)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar(this.name==="BuiltInRules"?Ut.ProtoBuiltInRules:Ut.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(t,e){const i=this.ensureSuperGrammar().rules[t];if(!i)throw Ax(t,this.superGrammar.name,e);return i}installOverriddenOrExtendedRule(t,e,i,s){const n=xl(e);if(n.length>0)throw Qf(t,n,s);const o=this.ensureSuperGrammar().rules[t],a=o.formals,l=a?a.length:0;if(e.length!==l)throw Jf(t,l,e.length,s);return this.install(t,e,i,o.description,s)}install(t,e,i,s,n,o=!1){return this.rules[t]={body:i.introduceParams(e),formals:e,description:s,source:n,primitive:o},this}withSuperGrammar(t){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=t,this.rules=Object.create(t.rules),t.isBuiltIn()||(this.defaultStartRule=t.defaultStartRule),this}withDefaultStartRule(t){return this.defaultStartRule=t,this}withSource(t){return this.source=new $n(t).interval(0,t.length),this}build(){const t=new Ut(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);t._matchStateInitializer=t.superGrammar._matchStateInitializer,t.supportsIncrementalParsing=t.superGrammar.supportsIncrementalParsing;const e=[];let i=!1;return Object.keys(t.rules).forEach(s=>{const{body:n}=t.rules[s];try{n.assertChoicesHaveUniformArity(s)}catch(o){e.push(o)}try{n.assertAllApplicationsAreValid(s,t)}catch(o){e.push(o),i=!0}}),i||Object.keys(t.rules).forEach(s=>{const{body:n}=t.rules[s];try{n.assertIteratedExprsAreNotNullable(t,[])}catch(o){e.push(o)}}),e.length>0&&Bx(e),this.source&&(t.source=this.source),t}define(t,e,i,s,n,o){if(this.ensureSuperGrammar(),this.superGrammar.rules[t])throw Xf(t,this.name,this.superGrammar.name,n);if(this.rules[t])throw Xf(t,this.name,this.name,n);const a=xl(e);if(a.length>0)throw Qf(t,a,n);return this.install(t,e,i,s,n,o)}override(t,e,i,s,n){return this.ensureSuperGrammarRuleForOverriding(t,n),this.installOverriddenOrExtendedRule(t,e,i,n),this}extend(t,e,i,s,n){if(!this.ensureSuperGrammar().rules[t])throw Cx(t,this.superGrammar.name,n);const o=new zn(this.superGrammar,t,i);return o.source=i.source,this.installOverriddenOrExtendedRule(t,e,o,n),this}}class Un{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(t){return new gp(t)}grammar(t,e,i,s,n){const o=new gp(e);return i&&o.withSuperGrammar(i instanceof Ut?i:this.fromRecipe(i)),s&&o.withDefaultStartRule(s),t&&t.source&&o.withSource(t.source),this.currentDecl=o,Object.keys(n).forEach(a=>{this.currentRuleName=a;const l=n[a],h=l[0],c=l[1],u=l[2],d=l[3],f=this.fromRecipe(l[4]);let p;o.source&&c&&c.sourceInterval&&(p=o.source.subInterval(c.sourceInterval[0],c.sourceInterval[1]-c.sourceInterval[0])),o[h](a,d,f,u,p)}),this.currentRuleName=this.currentDecl=null,o.build()}terminal(t){return new Ot(t)}range(t,e){return new Bt(t,e)}param(t){return new Ft(t)}alt(...t){let e=[];for(let i of t)i instanceof V||(i=this.fromRecipe(i)),i instanceof yt?e=e.concat(i.terms):e.push(i);return e.length===1?e[0]:new yt(e)}seq(...t){let e=[];for(let i of t)i instanceof V||(i=this.fromRecipe(i)),i instanceof St?e=e.concat(i.factors):e.push(i);return e.length===1?e[0]:new St(e)}star(t){return t instanceof V||(t=this.fromRecipe(t)),new $i(t)}plus(t){return t instanceof V||(t=this.fromRecipe(t)),new yr(t)}opt(t){return t instanceof V||(t=this.fromRecipe(t)),new ei(t)}not(t){return t instanceof V||(t=this.fromRecipe(t)),new $t(t)}lookahead(t){return t instanceof V||(t=this.fromRecipe(t)),new Gt(t)}lex(t){return t instanceof V||(t=this.fromRecipe(t)),new ee(t)}app(t,e){return e&&e.length>0&&(e=e.map(function(i){return i instanceof V?i:this.fromRecipe(i)},this)),new K(t,e)}splice(t,e){return new jn(this.currentDecl.superGrammar,this.currentRuleName,t.map(i=>this.fromRecipe(i)),e.map(i=>this.fromRecipe(i)))}fromRecipe(t){const e=t[0]==="grammar"?t.slice(1):t.slice(2),i=this[t[0]](...e),s=t[1];return s&&s.sourceInterval&&this.currentDecl&&i.withSource(this.currentDecl.sourceInterval(...s.sourceInterval)),i}}function Ll(r){return typeof r=="function"?r.call(new Un):(typeof r=="string"&&(r=JSON.parse(r)),new Un().fromRecipe(r))}const Nl=Ll(["grammar",{source:`BuiltInRules {

  alnum  (an alpha-numeric character)
    = letter
    | digit

  letter  (a letter)
    = lower
    | upper
    | unicodeLtmo

  digit  (a digit)
    = "0".."9"

  hexDigit  (a hexadecimal digit)
    = digit
    | "a".."f"
    | "A".."F"

  ListOf<elem, sep>
    = NonemptyListOf<elem, sep>
    | EmptyListOf<elem, sep>

  NonemptyListOf<elem, sep>
    = elem (sep elem)*

  EmptyListOf<elem, sep>
    = /* nothing */

  listOf<elem, sep>
    = nonemptyListOf<elem, sep>
    | emptyListOf<elem, sep>

  nonemptyListOf<elem, sep>
    = elem (sep elem)*

  emptyListOf<elem, sep>
    = /* nothing */

  // Allows a syntactic rule application within a lexical context.
  applySyntactic<app> = app
}`},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);Ut.BuiltInRules=Nl,qx(Ut.BuiltInRules);const Bl=Ll(["grammar",{source:`Ohm {

  Grammars
    = Grammar*

  Grammar
    = ident SuperGrammar? "{" Rule* "}"

  SuperGrammar
    = "<:" ident

  Rule
    = ident Formals? ruleDescr? "="  RuleBody  -- define
    | ident Formals?            ":=" OverrideRuleBody  -- override
    | ident Formals?            "+=" RuleBody  -- extend

  RuleBody
    = "|"? NonemptyListOf<TopLevelTerm, "|">

  TopLevelTerm
    = Seq caseName  -- inline
    | Seq

  OverrideRuleBody
    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">

  OverrideTopLevelTerm
    = "..."  -- superSplice
    | TopLevelTerm

  Formals
    = "<" ListOf<ident, ","> ">"

  Params
    = "<" ListOf<Seq, ","> ">"

  Alt
    = NonemptyListOf<Seq, "|">

  Seq
    = Iter*

  Iter
    = Pred "*"  -- star
    | Pred "+"  -- plus
    | Pred "?"  -- opt
    | Pred

  Pred
    = "~" Lex  -- not
    | "&" Lex  -- lookahead
    | Lex

  Lex
    = "#" Base  -- lex
    | Base

  Base
    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application
    | oneCharTerminal ".." oneCharTerminal           -- range
    | terminal                                       -- terminal
    | "(" Alt ")"                                    -- paren

  ruleDescr  (a rule description)
    = "(" ruleDescrText ")"

  ruleDescrText
    = (~")" any)*

  caseName
    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

  ident  (an identifier)
    = name

  terminal
    = "\\"" terminalChar* "\\""

  oneCharTerminal
    = "\\"" terminalChar "\\""

  terminalChar
    = escapeChar
      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"

  escapeChar  (an escape sequence)
    = "\\\\\\\\"                                     -- backslash
    | "\\\\\\""                                     -- doubleQuote
    | "\\\\\\'"                                     -- singleQuote
    | "\\\\b"                                      -- backspace
    | "\\\\n"                                      -- lineFeed
    | "\\\\r"                                      -- carriageReturn
    | "\\\\t"                                      -- tab
    | "\\\\u{" hexDigit hexDigit? hexDigit?
             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint
    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape
    | "\\\\x" hexDigit hexDigit                    -- hexEscape

  space
   += comment

  comment
    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine
    | "/*" (~"*/" any)* "*/"  -- multiLine

  tokens = token*

  token = caseName | comment | ident | operator | punctuation | terminal | any

  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"

  punctuation = "<" | ">" | "," | "--"
}`},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},`
`]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},`
`]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},`
`],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},`
`]],["range",{sourceInterval:[1639,1660]},"\0","\u{10FFFF}"]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},`
`]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},`
`],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]),Fl=Object.create(V.prototype);function vp(r,t){for(const e in r)if(e===t)return!0;return!1}function yp(r,t,e){const i=new Un;let s,n,o,a=!1;return(e||Bl).createSemantics().addOperation("visit",{Grammars(l){return l.children.map(h=>h.visit())},Grammar(l,h,c,u,d){const f=l.visit();s=i.newGrammar(f),h.child(0)&&h.child(0).visit(),u.children.map(m=>m.visit());const p=s.build();if(p.source=this.source.trimmed(),vp(t,f))throw Sx(p);return t[f]=p,p},SuperGrammar(l,h){const c=h.visit();if(c==="null")s.withSuperGrammar(null);else{if(!t||!vp(t,c))throw bx(c,t,h.source);s.withSuperGrammar(t[c])}},Rule_define(l,h,c,u,d){n=l.visit(),o=h.children.map(g=>g.visit())[0]||[],!s.defaultStartRule&&s.ensureSuperGrammar()!==Ut.ProtoBuiltInRules&&s.withDefaultStartRule(n);const f=d.visit(),p=c.children.map(g=>g.visit())[0],m=this.source.trimmed();return s.define(n,o,f,p,m)},Rule_override(l,h,c,u){n=l.visit(),o=h.children.map(p=>p.visit())[0]||[];const d=this.source.trimmed();s.ensureSuperGrammarRuleForOverriding(n,d),a=!0;const f=u.visit();return a=!1,s.override(n,o,f,null,d)},Rule_extend(l,h,c,u){n=l.visit(),o=h.children.map(p=>p.visit())[0]||[];const d=u.visit(),f=this.source.trimmed();return s.extend(n,o,d,null,f)},RuleBody(l,h){return i.alt(...h.visit()).withSource(this.source)},OverrideRuleBody(l,h){const c=h.visit(),u=c.indexOf(Fl);if(u>=0){const d=c.slice(0,u),f=c.slice(u+1);return f.forEach(p=>{if(p===Fl)throw Ex(p)}),new jn(s.superGrammar,n,d,f).withSource(this.source)}else return i.alt(...c).withSource(this.source)},Formals(l,h,c){return h.visit()},Params(l,h,c){return h.visit()},Alt(l){return i.alt(...l.visit()).withSource(this.source)},TopLevelTerm_inline(l,h){const c=n+"_"+h.visit(),u=l.visit(),d=this.source.trimmed(),f=!(s.superGrammar&&s.superGrammar.rules[c]);a&&!f?s.override(c,o,u,null,d):s.define(c,o,u,null,d);const p=o.map(m=>i.app(m));return i.app(c,p).withSource(u.source)},OverrideTopLevelTerm_superSplice(l){return Fl},Seq(l){return i.seq(...l.children.map(h=>h.visit())).withSource(this.source)},Iter_star(l,h){return i.star(l.visit()).withSource(this.source)},Iter_plus(l,h){return i.plus(l.visit()).withSource(this.source)},Iter_opt(l,h){return i.opt(l.visit()).withSource(this.source)},Pred_not(l,h){return i.not(h.visit()).withSource(this.source)},Pred_lookahead(l,h){return i.lookahead(h.visit()).withSource(this.source)},Lex_lex(l,h){return i.lex(h.visit()).withSource(this.source)},Base_application(l,h){const c=h.children.map(u=>u.visit())[0]||[];return i.app(l.visit(),c).withSource(this.source)},Base_range(l,h,c){return i.range(l.visit(),c.visit()).withSource(this.source)},Base_terminal(l){return i.terminal(l.visit()).withSource(this.source)},Base_paren(l,h,c){return h.visit()},ruleDescr(l,h,c){return h.visit()},ruleDescrText(l){return this.sourceString.trim()},caseName(l,h,c,u,d){return c.visit()},name(l,h){return this.sourceString},nameFirst(l){},nameRest(l){},terminal(l,h,c){return h.children.map(u=>u.visit()).join("")},oneCharTerminal(l,h,c){return h.visit()},escapeChar(l){try{return Uf(this.sourceString)}catch(h){throw h instanceof RangeError&&h.message.startsWith("Invalid code point ")?Px(l):h}},NonemptyListOf(l,h,c){return[l.visit()].concat(c.children.map(u=>u.visit()))},EmptyListOf(){return[]},_terminal(){return this.sourceString}})(r).visit()}const rb=Ll(["grammar",{source:`OperationsAndAttributes {

  AttributeSignature =
    name

  OperationSignature =
    name Formals?

  Formals
    = "(" ListOf<name, ","> ")"

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

}`},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);sb(Ut.BuiltInRules),nb(rb);function sb(r){const t={empty(){return this.iteration()},nonEmpty(e,i,s){return this.iteration([e].concat(s.children))},self(...e){return this}};re.BuiltInSemantics=re.createSemantics(r,null).addOperation("asIteration",{emptyListOf:t.empty,nonemptyListOf:t.nonEmpty,EmptyListOf:t.empty,NonemptyListOf:t.nonEmpty,_iter:t.self})}function nb(r){re.prototypeGrammarSemantics=r.createSemantics().addOperation("parse",{AttributeSignature(t){return{name:t.parse(),formals:[]}},OperationSignature(t,e){return{name:t.parse(),formals:e.children.map(i=>i.parse())[0]||[]}},Formals(t,e,i){return e.asIteration().children.map(s=>s.parse())},name(t,e){return this.sourceString}}),re.prototypeGrammar=r}function ob(r){let t=0;const e=[0],i=()=>e[e.length-1],s={},n=/( *).*(?:$|\r?\n|\r)/g;let o;for(;(o=n.exec(r))!=null;){const[a,l]=o;if(a.length===0)break;const h=l.length,c=i(),u=t+h;if(h>c)e.push(h),s[u]=1;else if(h<c){const d=e.length;for(;i()!==h;)e.pop();s[u]=-1*(d-e.length)}t+=a.length}return e.length>1&&(s[t]=1-e.length),s}const wp="an indented block",xp="a dedent",bp=1114112;class ab extends $n{constructor(t){super(t.input),this.state=t}_indentationAt(t){return this.state.userData[t]||0}atEnd(){return super.atEnd()&&this._indentationAt(this.pos)===0}next(){if(this._indentationAt(this.pos)!==0){this.examinedLength=Math.max(this.examinedLength,this.pos);return}return super.next()}nextCharCode(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),bp):super.nextCharCode()}nextCodePoint(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),bp):super.nextCodePoint()}}class Sp extends V{constructor(t=!0){super(),this.isIndent=t}allowsSkippingPrecedingSpace(){return!0}eval(t){const{inputStream:e}=t,i=t.userData;t.doNotMemoize=!0;const s=e.pos,n=this.isIndent?1:-1;return(i[s]||0)*n>0?(t.userData=Object.create(i),t.userData[s]-=n,t.pushBinding(new Gi(0),s),!0):(t.processFailure(s,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(t,e){}_isNullable(t,e){return!1}assertChoicesHaveUniformArity(t){}assertIteratedExprsAreNotNullable(t){}introduceParams(t){return this}substituteParams(t){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(t){const e=this.isIndent?wp:xp;return new ie(this,e,"description")}}const lb=new K("indent"),hb=new K("dedent"),cb=new jn(Nl,"any",[lb,hb],[]),ub=new Un().newGrammar("IndentationSensitive").withSuperGrammar(Nl).define("indent",[],new Sp(!0),wp,void 0,!0).define("dedent",[],new Sp(!1),xp,void 0,!0).extend("any",[],cb,"any character",void 0).build();Object.assign(ub,{_matchStateInitializer(r){r.userData=ob(r.input),r.inputStream=new ab(r)},supportsIncrementalParsing:!1}),Ut.initApplicationParser(Bl,yp);const db=r=>!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r);function fb(r,t){const e=Bl.match(r,"Grammars");if(e.failed())throw xx(e);return yp(e,t)}function pb(r,t){const e=mb(r),i=Object.keys(e);if(i.length===0)throw new Error("Missing grammar definition");if(i.length>1){const s=e[i[1]].source;throw new Error(Il(s.sourceString,s.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return e[i[0]]}function mb(r,t){const e=Object.create({});if(typeof r!="string")if(db(r))r=r.toString();else throw new TypeError("Expected string as first argument, got "+Sl(r));return fb(r,e),e}const kp={noise:()=>et.new(()=>Math.random()*2-1),pinkNoise:()=>{const r=new Array(16).fill(0);let t=0,e=0;return et.new(()=>(t-=r[e],r[e]=2*Math.random()-1,t+=r[e],e=(e+1)%16,t/16))},noteFreq:()=>et.new(r=>r.noteFreq*Math.pow(2,r.params[De]/12)),noteVel:()=>et.new(r=>r.noteVel)};class Vl{constructor(t){this.errors=t}}class fs extends Error{constructor(t,e){super(t),this.interval=e}}const Ap=pb(String.raw`
  MSynth {
    Prog = Decl+

    Decl
      = ident "=" Expr

    Expr = ArrowExpr

    ArrowExpr
      = ArrowExpr ">>" ident Args?  -- send
      | AddExpr

    AddExpr
      = AddExpr "+" MulExpr  -- plus
      | AddExpr "-" MulExpr  -- minus
      | MulExpr

    MulExpr
      = MulExpr "*" NegExpr  -- times
      | MulExpr "/" NegExpr  -- div
      | MulExpr "%" NegExpr  -- mod
      | NegExpr

    NegExpr
      = "-" NegExpr  -- neg
      | SendExpr

    SendExpr
      = SendExpr ~(ident "=") ident Args?  -- send
      | PriExpr

    PriExpr
      = ident Args    -- call
      | ident         -- ref
      | number        -- num
      | "(" Expr ")"  -- par

    Args = "(" ListOf<Arg, ","> ")"

    Arg  (an argument)
      = ident ":" Expr  -- nameAndExpr
      | ident           -- nameIsExpr

    ident  (an identifier)
      = ~keyword "$"? letter alnum*

    number  (a number)
      = digit* "." digit+  -- fract
      | digit+             -- whole

    keyword = def | this
    def = "def" ~alnum
    this = "this" ~alnum

    space += "//" (~"\n" any)*  -- comment
  }
`);class ql{constructor(t){this.interval=t}}class gb extends ql{constructor(t,e){super(e),this.decls=t}checkDuplicateDeclarations(t){const e=new Set;for(const i of this.decls)e.has(i.name)?t.push(new fs(`duplicate declaration of signal ${i.name}`,i.interval)):e.add(i.name)}checkCalls(t){for(const e of this.decls)e.checkCalls(t)}checkRefs(t){const e=new Set;this.addRefs(e);const i=new Set,s=new Set;for(const n of e){const o=Ip(n);o!==null?i.add(o):ao.has(n)?i.add(ao.get(n)):kp.hasOwnProperty(n)?s.add(n):this.decls.some(a=>a.name===n)||t.push(new fs(`undeclared reference: ${n}`,this.interval))}return{params:[...i],builtins:[...s]}}addRefs(t){for(const e of this.decls)e.addRefs(t)}trans(t){const e=s=>this.decls.some(n=>n.name===s);let i;return e("left")&&e("right")?i=["__left","__right"]:e("out")?i=["__out"]:i=["Signal.scalar(0)"],`(() => {
      ${t.params.map(s=>`const __param${s} = Signal.new((synth) => synth.params[${s}]);`).join(`
`)}
      ${[...ao.entries()].filter(([s,n])=>t.params.includes(n)).map(([s,n])=>`const __${s} = __param${n};`).join(`
`)}
      ${t.builtins.map(s=>`const __${s} = __.${s}();`).join(`
`)}
      ${this.decls.map(s=>`let __${s.name};`).join(`
`)}
      ${this.decls.map(s=>s.trans()).join(`
`)}
      ${this.decls.map(s=>`__${s.name} = __${s.name}.force();`).join(`
`)}
      return [${i.join(", ")}];
    })()`}}class vb extends ql{constructor(t,e,i){super(i),this.name=t,this.rhs=e}checkCalls(t){this.rhs.checkCalls(t)}addRefs(t){this.rhs.addRefs(t)}trans(){const t=[],e=this.rhs.trans("signal",t),i=t.length===0?e:`{
      ${t.map((s,n)=>`const tmp${n} = ${s};`).join(`
`)}
      return ${e};
    }`;return`__${this.name} = lazy(() => ${i});`}}class Wl extends ql{constructor(t,e=[]){super(t),this.children=e}checkCalls(t){for(const e of this.children)e.checkCalls(t)}addRefs(t){for(const e of this.children)e.addRefs(t)}}class Kt{constructor(t,e,i){this.name=t,this.expr=e,this.interval=i}trans(t){return`${this.name}: ${this.expr.trans("signal",t)}`}}class ii extends Wl{constructor(t,e,i){super(i,e.map(s=>s.expr)),this.name=t,this.args=e}checkCalls(t){super.checkCalls(t);const e=ls[this.name]||_n[this.name];if(!e){t.push(new fs(`undeclared module: ${this.name}`,this.interval));return}for(const{name:i}of this.args)e.defaultParamValues.hasOwnProperty(i)||t.push(new fs(`${i} is not a valid argument for module ${this.name}`,this.interval))}trans(t,e){let i;if(ls.hasOwnProperty(this.name)){const s=ls[this.name],n={};for(const{name:o,expr:a}of this.args)n[o]=a.trans("number",e);if(i=s.codegen(n),t==="signal"){const o=e.length;e.push(`Signal.new(() => ${i})`),i=`tmp${o}`}}else{const s=this.args.map(({name:o,expr:a})=>`${o}: ${a.trans("signal",e)}`).join(", ");i=`_.${this.name}.new({ ${s} })`;const n=e.length;e.push(i),i=`tmp${n}`,t==="number"&&(i=`${i}.value`)}return i}}class Cp extends Wl{constructor(t,e){super(e),this.name=t}addRefs(t){t.add(this.name)}trans(t,e){const i=Ip(this.name),s=i!==null?`__param${i}`:`__${this.name}`;return t==="signal"?s:`${s}.value`}}class yb extends Wl{constructor(t,e){super(e),this.value=t}trans(t){const e=""+this.value;return t==="number"?e:`Signal.scalar(${e})`}}function Ip(r){if(!(r.startsWith("param")&&[...r.slice(5)].every(e=>"0"<=e&&e<="9")))return null;const t=parseInt(r.slice(5));return 0<=t&&t<=127?t:null}const wb=Ap.createSemantics().addOperation("toAst",{Prog(r){return new gb(r.toAst(),this.source)},Decl(r,t,e){return new vb(r.sourceString,e.toAst(),this.source)},ArrowExpr_send(r,t,e,i){var s;return new ii(e.sourceString,[new Kt("input",r.toAst(),r.source),...((s=i.child(0))==null?void 0:s.toAst())??[]],this.source)},AddExpr_plus(r,t,e){return new ii("+",[new Kt("x",r.toAst(),r.source),new Kt("y",e.toAst(),e.source)],this.source)},AddExpr_minus(r,t,e){return new ii("-",[new Kt("x",r.toAst(),r.source),new Kt("y",e.toAst(),e.source)],this.source)},MulExpr_times(r,t,e){return new ii("*",[new Kt("x",r.toAst(),r.source),new Kt("y",e.toAst(),e.source)],this.source)},MulExpr_div(r,t,e){return new ii("/",[new Kt("x",r.toAst(),r.source),new Kt("y",e.toAst(),e.source)],this.source)},MulExpr_mod(r,t,e){return new ii("%",[new Kt("x",r.toAst(),r.source),new Kt("y",e.toAst(),e.source)],this.source)},NegExpr_neg(r,t){return new ii("unary-",[new Kt("x",t.toAst(),t.source)],this.source)},SendExpr_send(r,t,e){var i;return new ii(t.sourceString,[new Kt("input",r.toAst(),r.source),...((i=e.child(0))==null?void 0:i.toAst())??[]],this.source)},PriExpr_call(r,t){return new ii(r.sourceString,t.toAst(),this.source)},PriExpr_ref(r){return new Cp(this.sourceString,this.source)},PriExpr_num(r){return new yb(parseFloat(this.sourceString),this.source)},PriExpr_par(r,t,e){return t.toAst()},Args(r,t,e){return t.toAst()},Arg_nameAndExpr(r,t,e){return new Kt(r.sourceString,e.toAst(),this.source)},Arg_nameIsExpr(r){return new Kt(r.sourceString,new Cp(r.sourceString,this.source),this.source)},ident(r,t,e){return this.sourceString},NonemptyListOf(r,t,e){return[r.toAst()].concat(e.toAst())},EmptyListOf(){return[]},_iter(...r){return r.map(t=>t.toAst())}});function xb(r){const t=[],e=Ap.match(r);if(e.failed()){const o=e.getRightmostFailures().map(a=>a.type==="string"?`"${a.text}"`:a.text);throw o.length>1&&(o[o.length-1]="or "+o[o.length-1]),t.push(new fs(`expected ${o.join(", ")}`,e.getInterval())),new Vl(t)}const i=wb(e).toAst();i.checkDuplicateDeclarations(t),i.checkCalls(t);const s=i.checkRefs(t);if(t.length>0)throw new Vl(t);const n=i.trans(s);return console.log(`compiled code:
`,n),()=>bb(n)}function bb(r){const t=Object.create(_n),e=kp,i=n=>{let o=null;const a=()=>(o||(o=n()),o),l=et.new({nextSample:h=>a().nextSample(h),initialValue:0,noteOn:(h,c)=>{var u,d;return(d=(u=a()).noteOn)==null?void 0:d.call(u,h,c)},noteOff:()=>{var h,c;return(c=(h=a()).noteOff)==null?void 0:c.call(h)}});return l.force=a,l},s=(n,o)=>n===0?o:n;return new Function("Signal","_","__","lazy","ifZero","fastTanh",`return ${r};`)(et,t,e,i,s,Ul)}const Sb=document.getElementById("ui"),Kn=gx(Sb,r=>{try{ft==null||ft.savePatch()}catch(t){t instanceof Vl?r(t):console.error("error saving patch",t)}});let it=0,wt=0,Ui=0;function Mp(){it=(innerWidth-2*xe)/13,wt=(innerHeight-2*xe)/8,Ui=wt/1.5,Mi.layout()}window.addEventListener("resize",Mp),Mp();const kb=8;class Ab{constructor(t,e){R(this,"params",new Float32Array(new SharedArrayBuffer(512)));R(this,"note",-1);this.synth=t,this.channel=e}noteOn(t,e){this.isOn&&this.noteOff(this.note,127),this.note=t,this.synth.sendToWorklet({command:"process midi message",data:Ai(this.channel,t,e)})}noteOff(t,e){this.note=-1,this.synth.sendToWorklet({command:"process midi message",data:$e(this.channel,t,e)})}get isOn(){return this.note!==-1}get freq(){return Gp(this.note)*Math.pow(2,this.params[De]/12)}}class Op{constructor(t="pwm"){R(this,"patch");R(this,"mode","mpe");R(this,"worklet",null);R(this,"voices",[]);R(this,"octave",0);R(this,"analyzer",null);R(this,"timeDomainData",null);R(this,"lnf",220);if(this.patch=eh.find(e=>e.name===t),!this.patch)throw new Error("unknown patch name! "+t);for(let e=0;e<kb;e++)this.voices.push(new Ab(this,e))}init(){this.worklet=new AudioWorkletNode(Ii,"msynth"),this.sendToWorklet({command:"init",voiceParams:this.voices.map(e=>e.params.buffer)}),this.analyzer=Ii.createAnalyser(),this.analyzer.fftSize=2048;const t=this.analyzer.fftSize;this.timeDomainData=new Uint8Array(t),this.worklet.channelInterpretation="discrete",this.worklet.channelCount=2,this.worklet.channelCountMode="explicit",this.worklet.connect(this.analyzer).connect(Ii.destination),this.worklet.port.onmessage=e=>Bb(e.data),this.loadPatch(this.patch)}makeActive(){ft=this,this.loadPatchInEditor()}getTimeDomainData(){return!this.analyzer||!this.timeDomainData?null:(this.analyzer.getByteTimeDomainData(this.timeDomainData),this.timeDomainData)}sendToWorklet(t){var e;(e=this.worklet)==null||e.port.postMessage(t)}loadPatch(t,e=!0){var s,n,o,a,l,h,c,u,d,f;this.patch=t,console.log("loading patch",t.code),this.sendToWorklet({command:"load patch",code:t.code,mono:((s=t.options)==null?void 0:s.mono)??!1});const i=((n=t.options)==null?void 0:n.tempo)??120;this.setParam(io,i),ri.synth===this&&(ri.setTempo(i),ri.setTriggerPeriod(((o=t.options)==null?void 0:o.triggerPeriod)??1/4),ri.setNoteDuration(((a=t.options)==null?void 0:a.noteDuration)??.5)),this.setParam(ro,((l=t.options)==null?void 0:l.paramA)??0),this.setParam(so,((h=t.options)==null?void 0:h.paramB)??0),this.setParam(no,((c=t.options)==null?void 0:c.paramC)??0),this.setParam(oo,((u=t.options)==null?void 0:u.paramD)??0),this.setParam(eo,.2),this.octave=((d=t.options)==null?void 0:d.octave)??0,this.mode=((f=t.options)==null?void 0:f.mode)??"mpe",ft===this&&e&&this.loadPatchInEditor()}loadPatchInEditor(){Kn.setContents(this.patch.code)}savePatch(){const t=Kn.view.state.doc.toString();xb(t),this.patch.code=t,this.loadPatch(this.patch,!1)}grabVoice(){var i;if((i=this.patch.options)!=null&&i.mono)return this.voices.find(s=>s.channel===0);const t=[...ye.values()],e=this.voices.findLast(s=>!t.some(n=>n.voice===s))??this.voices.at(-1);return this.voices.splice(this.voices.indexOf(e),1),this.voices.unshift(e),e}setParam(t,e){for(const i of this.voices)i.params[t]=e}getLowestNoteFreq(){let t=1/0;for(const e of this.voices)e.isOn&&e.freq<t&&(t=e.freq);return Number.isFinite(t)&&(this.lnf=t),this.lnf}controls(){const t=new jl({w:()=>it*4},this).addChild(new co({values:eh,getValue:()=>this.patch,setValue:i=>this.loadPatch(i),valueToString:i=>i.name}),"top left").addChild(new co({values:["mpe","string","piano","strum"],getValue:()=>this.mode,setValue:i=>this.mode=i,valueToString:i=>i}),"top right").addChild(new co({values:[2,1,0,-1,-2],getValue:()=>this.octave,setValue:i=>this.octave=i,valueToString:i=>"octave "+(i>0?"+":"")+i}),"bottom right"),e=new Ql({w:()=>it}).addChild(new Pp({h:()=>Ui,label:"(a,b)"},this,ro,so)).addChild(new Pp({h:()=>Ui,label:"(c,d)"},this,no,oo)).addChild(new Pb({h:()=>Ui,label:"vol"},this,eo));return new Jl({h:()=>Ui*3,isActive:()=>ft===this}).addChild(t).addChild(e)}}const _l=new Op("rebel yell"),Yn=new Op("stranger things");let ft=_l;async function Cb(){const r=await navigator.requestMIDIAccess(),[t]=[...r.inputs.values()];if(t){console.log("midi input",t);const e=new Map;t.onmidimessage=i=>{var a,l;const[s,n,o]=i.data;switch(s>>4){case 9:{const h=n,c=o;if(c===0)(a=e.get(h))==null||a.noteOff(h,c);else{const u=ft.grabVoice();e.set(h,u),u.params[De]=0,u.params[Yi]=0,u.params[Xi]=c/127,u.noteOn(h,c)}break}case 8:{const h=n,c=o;(l=e.get(h))==null||l.noteOff(h,c);break}case 14:{const h=((o<<7|n)-8192)/8192,c=h*(h>0?3:12);ft.setParam(De,c);break}}}}}try{await Cb()}catch(r){console.log("unable to set up midi",r)}const Ib=47,Mb=5;let Xn=!1,ze=0;class Ob{constructor(t,e,i){R(this,"isBeingPlayedBySequencer",!1);this.col=t,this.row=e,this.noteName=i}get note(){return Ib+12*ft.octave+Mb*(7-this.row)+this.col}get x(){return xe+this.col*it}get y(){return xe+(this.row+ze)*wt}get rightX(){return this.x+it}get bottomY(){return this.y+wt}get centerX(){return this.x+it/2}get centerY(){return this.y+wt/2}contains(t,e){return this.x<=t&&t<=this.rightX&&this.y<=e&&e<=this.bottomY}render(){if(y.beginPath(),y.lineWidth=3,y.strokeStyle="#efefef",y.roundRect(this.x,this.y,it,wt,ni),y.stroke(),ft.mode==="strum"&&this.col>=br){y.beginPath(),y.fillStyle=Hp,y.roundRect(this.x,this.y,it,wt,ni),y.fill();return}y.beginPath(),y.fillStyle=this.noteName===""?$l:to,y.roundRect(this.x,this.y,it,wt,ni),y.fill(),ft===Yn&&this.isBeingPlayedBySequencer&&(y.beginPath(),y.fillStyle=this.noteName===""?$p:jp,y.roundRect(this.x+20,this.y+20,it-40,wt-40,ni),y.fill()),this.noteName!==""&&(y.globalAlpha=.5,y.beginPath(),y.font=ht.pad.cssFontString,y.fillStyle=Gl,y.fillText(this.noteName,this.x+4,this.y+16),y.fill(),y.globalAlpha=1)}}const Dp=13,Tp=6,Hl=2,qt=[],Db=["C","","D","","E","F","","G","","A","","B"];let Rp=0;for(let r=Hl;r<Hl+Tp;r++){for(let t=0;t<Dp;t++)qt.push(new Ob(t,r,Db[(Rp+t)%12]));Rp+=7}const ye=new Map;class Ki{constructor(t,e,i,s,n){R(this,"x");R(this,"y");R(this,"quantizationOffset",0);R(this,"voice",null);R(this,"pad",null);R(this,"speedTracker",new Kp);R(this,"lastT",0);this.id=t,this.x0=e,this.y0=i,this.pressure=s,this.synth=n,this.x=e,this.y=i,ye.set(t,this),this.move(e,i,s)}static add(t,e,i,s,n=ft){switch(n.mode){case"piano":return new Tb(t,e,i,s,n);case"mpe":return new Ep(t,e,i,s,n);case"string":return new Jn(t,e,i,s,n);case"strum":{const o=qt.find(a=>a.contains(e,i));return o&&o.col>=br?new Eb(t,e,i,s,n):new Qn(t,e,i,s,n)}default:throw new Error("unknown mode! "+n.mode)}}static updateQuantizationOffsets(){for(const t of ye.values())(t instanceof Ep||t instanceof Jn)&&t.updateQuantizationOffset()}updateQuantizationOffset(){const t=qt.find(n=>{var o;return n.row===((o=this.pad)==null?void 0:o.row)&&n.contains(this.x,this.y)});if(this.speedTracker.speed>.025||!this.pad||!t){this.lastT=performance.now();return}const e=performance.now(),i=.005*(e-this.lastT),s=(t.centerX-this.x)/it;this.quantizationOffset=i*s+(1-i)*this.quantizationOffset,this.updateGlide(),this.lastT=e}updateGlide(){const t=(this.x-this.pad.centerX)/it+this.quantizationOffset;this.voice.params[De]=t}}class Tb extends Ki{move(t,e,i){const s=qt.find(o=>o.contains(t,e))??this.pad,n=s!==this.pad;this.pad&&n&&(this.voice.noteOff(this.pad.note,127),this.voice=null),s&&n&&(this.voice=this.synth.grabVoice()),this.pad=s,this.pad&&(this.voice.params[De]=0,this.voice.params[Yi]=Te((this.pad.centerY-e)/(wt/2),-1,1),this.voice.params[Xi]=i,n&&this.voice.noteOn(this.pad.note,127))}lift(){var t;(t=this.voice)==null||t.noteOff(this.pad.note,127)}render(){zl(this.pad,this.voice)}}class Ep extends Ki{move(t,e,i){this.x=t,this.y=e,this.speedTracker.addPos(t);const s=qt.find(o=>{var a;return o.row!==((a=this.pad)==null?void 0:a.row)&&o.contains(t,e)})??this.pad,n=s!==this.pad;this.pad&&n&&(this.voice.noteOff(this.pad.note,127),this.voice=null),s&&n&&(this.voice=this.synth.grabVoice(),this.quantizationOffset=(s.centerX-t)/it),this.pad=s,this.pad&&(this.updateGlide(),this.voice.params[Yi]=Te((this.pad.centerY-e)/(wt/2),-1,1),this.voice.params[Xi]=i,n&&this.voice.noteOn(this.pad.note,127))}lift(){var t;(t=this.voice)==null||t.noteOff(this.pad.note,127)}render(){zl(this.pad,this.voice)}}class Jn extends Ki{constructor(){super(...arguments);R(this,"pressure",0)}move(e,i,s){this.x=e,this.y=i,this.pressure=s,this.speedTracker.addPos(e);const n=qt.find(l=>{var h;return l.row!==((h=this.pad)==null?void 0:h.row)&&l.contains(e,i)}),o=n?ps(n.row):this.pad,a=o!==this.pad;if(this.pad&&a){const l=this.pad.row;this.pad=null,this.updateRow(l),this.voice=null}o&&a&&(this.voice=this.synth.voices[o.row],this.quantizationOffset=(n.centerX-e)/it),this.pad=o,this.pad&&this.updateRow(this.pad.row)}updateRow(e){const i=this.synth.voices[e],s=ps(e),n=this.getHighestFinger(e);n?(n.updateParams(),i.isOn||i.noteOn(s.note,127)):i.noteOff(s.note,127)}getHighestFinger(e){var s;let i=null;for(const n of ye.values())!(n instanceof Jn)||((s=n.pad)==null?void 0:s.row)!==e||(!i||n.x>i.x)&&(i=n);return i}updateParams(){if(!this.pad||!this.voice)throw new Error("invariant violated!!!");this===this.getHighestFinger(this.pad.row)&&(this.updateGlide(),this.voice.params[Yi]=Te((this.pad.centerY-this.y)/(wt/2),-1,1),this.voice.params[Xi]=this.pressure)}updateGlide(){this.pad&&this===this.getHighestFinger(this.pad.row)&&super.updateGlide()}lift(){this.pad&&this.updateRow(this.pad.row)}render(){zl(this.pad,this.voice)}}function ps(r){return qt.find(t=>t.row===r&&t.col===0)}const Rb=.5;class Qn extends Ki{constructor(){super(...arguments);R(this,"pressure",0)}move(e,i,s){this.pad||(this.pad=qt.find(n=>n.col<12&&n.contains(e,i))??null),this.x=e,this.y=i,this.pressure=s,this.updateGlide()}updateGlide(){var e;this.pad&&((e=this.getHighestFinger(this.pad.row))==null||e._updateGlide())}_updateGlide(){const{row:e}=this.pad,i=ps(e),s=Math.abs(this.y-this.y0)/wt*Rb,n=this.synth.voices[e],o=this.getNearestFret();n.params[De]=o.note+s-i.note}getHighestFinger(e){var s;let i=null;for(const n of ye.values())!(n instanceof Qn)||((s=n.pad)==null?void 0:s.row)!==e||(!i||n.x>i.x)&&(i=n);return i}getNearestFret(){let e=this.pad,i=Math.abs(e.centerX-this.x);for(const s of qt){if(s.row!==this.pad.row||s.col>=br)continue;const n=Math.abs(s.centerX-this.x);n<i&&(e=s,i=n)}return e}lift(){if(this.updateGlide(),this.pad&&!this.getHighestFinger(this.pad.row)){const e=this.synth.voices[this.pad.row],i=ps(this.pad.row);e.noteOff(i.note,127)}}render(){if(!this.pad)return;const e=this.getNearestFret(),i=e.centerX,s=this.y-this.y0+e.centerY,n="rgba(100, 100, 100, 0.5)";y.beginPath(),y.fillStyle=n,y.arc(i,s,it/3,0,Math.PI*2),y.fill();for(let o of qt){if(o.col!==0||o.row===e.row)continue;const a=e.note-o.note;if(a<0||a>=br)continue;const l=o.centerX+a*it,h=s+o.y-e.y;y.beginPath(),y.strokeStyle=n,y.arc(l,h,it/3,0,Math.PI*2),y.stroke()}}}class Eb extends Ki{constructor(){super(...arguments);R(this,"velocity",1);R(this,"maxVelocity",0);R(this,"prev")}move(e,i,s){const n=performance.now(),o=Dp-br;this.x=innerWidth-xe-o*it/2,this.y=i,this.prev===void 0?(this.prev={t:performance.now(),y:i},this.velocity=this.maxVelocity=.5):this.velocity=Math.min(15*Math.abs(i-this.prev.y)/(n-this.prev.t)/wt,1),this.maxVelocity=Math.max(this.velocity,this.maxVelocity),this.prev.t=n,this.prev.y=i;const a=this.pad;if(this.pad=qt.find(d=>d.col===12&&d.contains(this.x,this.y))??null,this.pad===a||!this.pad)return;const{row:l,note:h}=ps(this.pad.row),c=ft.voices[l],u=[...ye.values()].find(d=>{var f;return d instanceof Qn&&((f=d.pad)==null?void 0:f.row)===l});u&&(u.updateGlide(),c.noteOn(h,127*this.velocity))}lift(){}render(){const e="rgba(100, 100, 100, 0.5)";y.beginPath(),y.fillStyle=e,y.arc(this.x,this.y,it/3,0,Math.PI*2),y.fill()}}function zl(r,t){if(!(!r||!t))for(let e of qt){if(e.col!==0)continue;const i=e.centerX+(r.note-e.note+t.params[De])*it,s=e.centerY-t.params[Yi]*(wt/2),n=`rgba(100, 100, 100, ${t.params[Xi]})`;e.row===r.row&&(y.beginPath(),y.arc(i,s,it/4,0,Math.PI*2),y.fillStyle=n,y.fill());for(let o=0;o<4;o++){y.beginPath(),y.strokeStyle=n;const a=(performance.now()/2e3+o/4)*kt;y.arc(i,s,it/3,a,a+kt/8),y.stroke()}}}class Pp extends im{constructor(t,e,i,s){super({isActive:()=>ft===e,getXValue:()=>{var n;return((n=e.voices[0])==null?void 0:n.params[i])??0},setXValue:n=>e.setParam(i,n),getYValue:()=>{var n;return((n=e.voices[0])==null?void 0:n.params[s])??0},setYValue:n=>e.setParam(s,n),...t})}}class Pb extends tm{constructor(t,e,i){super({isActive:()=>ft===e,getValue:()=>{var s;return((s=e.voices[0])==null?void 0:s.params[i])??0},setValue:s=>e.setParam(i,s),...t})}}const ms=class ms extends Ue{constructor(e,i){super({hasBackground:!0,isActive:()=>ft===this.synth,...e});R(this,"pointerDownY",null);this.synth=i}onPointerDown(e,i){return this.synth.makeActive(),this.pointerDownY=i,this}onPointerMove(e,i){const s=i-this.pointerDownY;Xn?ze=-Ci+(s>0?Math.min(s/wt,Ci):0):ze=s<0?Math.max(s/wt,-Ci):0}onPointerUp(e,i){Xn?ze>1-Ci?(Xn=!1,ze=0):ze=-Ci:ze<=-1?(Xn=!0,ze=-Ci):ze=0,this.pointerDownY=null}render(){super.render();const e=this.synth.getTimeDomainData();if(!e)return;const i=this.synth.getLowestNoteFreq(),s=Ge/i,n=Math.round(s*2);let o=0;for(let u=0;u<e.length-1;u++)if(e[u]<=128&&e[u+1]>128){o=u;break}y.beginPath();const a=Math.min(n,e.length-o),l=this.w/a;let h=this.x,c=0;for(let u=o;u<a;u++)c=e[u]/128*this.h/2,u===o?y.moveTo(h,c):y.lineTo(h,c),h+=l;y.lineWidth=1,y.strokeStyle=ft===this.synth?zp:_p,y.stroke()}};R(ms,"gradient",y.createLinearGradient(0,0,0,ct.height)),ms.gradient.addColorStop(0,"rgba(0, 255, 255, 0.8)"),ms.gradient.addColorStop(1,"rgba(0, 0, 128, 0.2)");let jl=ms;class Lb{constructor(t){R(this,"tempo",120);R(this,"triggerPeriod",1/4);R(this,"noteDuration",.5);R(this,"stepsRecorded",[]);R(this,"status","stopped");R(this,"currentStep",0);this.synth=t}setTempo(t){this.tempo=t,this.synth.sendToWorklet({command:"set tempo",value:t})}setTriggerPeriod(t){this.triggerPeriod=t,this.synth.sendToWorklet({command:"set trigger period",value:t})}setNoteDuration(t){this.noteDuration=t,this.synth.sendToWorklet({command:"set note duration",value:t})}start(){this.stepsRecorded.length!==0&&(this.synth.setParam(De,0),this.status="playing",this.currentStep=0,this.synth.sendToWorklet({command:"start sequencer"}))}stop(){this.status="stopped",this.synth.sendToWorklet({command:"stop sequencer"});for(const t of qt)t.isBeingPlayedBySequencer=!1}onNotePressed(t,e){this.status==="recording"&&(e&&this.stepsRecorded.push([]),this.stepsRecorded.at(-1).push(t))}onMessageFromWorklet(t){switch(t.event){case"seq step":{t.action==="noteOn"&&(this.currentStep=t.index);for(const e of this.stepsRecorded[t.index]||[])for(const i of qt)i.note===e&&(i.isBeingPlayedBySequencer=t.action==="noteOn");break}case"log":{lo(t.message);break}default:lo("??? "+JSON.stringify(t));break}}init(){this.synth.sendToWorklet({command:"load steps",steps:this.stepsRecorded})}controls(){const t={h:()=>Ui,isActive:()=>ft===this.synth},e=new em({...t,label:n=>`${n} bpm`,minValue:10,maxValue:200,getValue:()=>this.tempo,setValue:n=>this.setTempo(n)}),i=new Zl({...t,label:()=>this.status==="playing"?`step ${this.currentStep+1} / ${this.stepsRecorded.length}`:this.stepsRecorded.length===0?"record steps":`${this.stepsRecorded.length} steps`,pointerDownFn:()=>{this.stop(),this.stepsRecorded=[],this.status="recording"},pointerUpFn:()=>{this.synth.sendToWorklet({command:"load steps",steps:this.stepsRecorded}),this.stepsRecorded.length>0?this.start():this.stop()}}),s=new Zl({...t,label:()=>this.status==="recording"?"add rest":this.status==="playing"?"stop":"play",pointerDownFn:()=>{this.status==="recording"?this.stepsRecorded.push([]):this.status==="playing"?this.stop():this.start()},pointerUpFn:()=>{this.status==="recording"&&(this.synth.sendToWorklet({command:"load steps",steps:this.stepsRecorded}),this.stepsRecorded.length>0?this.start():this.stop())}});return new Ql({w:()=>it*3,isActive:()=>ft===this.synth}).addChild(e).addChild(i).addChild(s)}}const ri=new Lb(Yn),Nb=new Jl({layoutMode:"row",h:()=>Ui*3}).addChild(_l.controls()).addChild(Yn.controls()).addChild(ri.controls());Mi.options.layoutMode="column",Mi.addChild(Nb),ct.addEventListener("pointerdown",r=>{Fb(r.pointerId,r.offsetX,r.offsetY,Bp(r)),ye.has(r.pointerId)&&ct.setPointerCapture(r.pointerId)}),ct.addEventListener("pointermove",r=>{const t=ye.get(r.pointerId);t&&(t.move(r.offsetX,r.offsetY,Bp(r)),r.preventDefault())}),ct.addEventListener("pointerup",Lp),ct.addEventListener("pointercancel",Lp);function Lp(r){const t=ye.get(r.pointerId);t&&(ye.delete(r.pointerId),t.lift()),ct.releasePointerCapture(r.pointerId)}function Np(){y.clearRect(0,0,innerWidth,innerHeight);const r=xe+(Hl+Tp+ze)*wt;Kn.container.style.top=`${r}px`,Kn.container.style.height=`${Ci*wt}px`;for(const t of qt)t.render();for(const t of ye.values())t.render();Mi.recursiveRender(),Mi.recursiveRenderOnTop(),Jp(),Ki.updateQuantizationOffsets(),requestAnimationFrame(Np)}Np(),Zp(()=>{_l.init(),Yn.init(),ri.init()});function Bb(r){ri.onMessageFromWorklet(r)}function Fb(r,t,e,i){const s=[...ye.values()].some(n=>!!n.pad);for(const n of qt)if(n.contains(t,e)){ft===ri.synth&&ri.onNotePressed(n.note,!s),Ki.add(r,t,e,i);break}}function Bp(r){return r.pointerType==="pen"?r.pressure:r.pointerType==="touch"?Math.abs(Math.max(r.width,r.height)-20)/130:1}console.log(Mi)})();
