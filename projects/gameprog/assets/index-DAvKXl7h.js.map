{"version":3,"file":"index-DAvKXl7h.js","sources":["../../src/constants.ts","../../src/costumes.ts","../../src/sprite.ts","../../src/index.ts"],"sourcesContent":["export const TAU = 2 * Math.PI;\nexport const MAX_SCREEN_WIDTH = 5000;\nexport const MAX_SCREEN_HEIGHT = 5000;\n","import { Costume } from './types';\n\nconst costumes = new Map<string, Costume>();\n\nexport function get(name: string) {\n  const costume = costumes.get(name);\n  if (costume) {\n    return costume;\n  } else {\n    throw new Error('invalid costume name: ' + name);\n  }\n}\n\nlet nextId = 1;\n\nexport function add(element: HTMLCanvasElement | HTMLImageElement) {\n  const id = `costume_${nextId++}`;\n  costumes.set(id, costumeFromElement(element));\n  return id;\n}\n\nexport function loadSampleCostumes() {\n  costumes.set('bear', costumeFromElementId('bear'));\n  costumes.set('penguin', costumeFromElementId('penguin'));\n  costumes.set('blosh', costumeFromElementId('blosh'));\n  costumes.set('ball', costumeFromElementId('ball'));\n}\n\nfunction costumeFromElementId(id: string) {\n  return costumeFromElement(document.getElementById(id) as HTMLImageElement);\n}\n\nfunction costumeFromElement(element: HTMLImageElement | HTMLCanvasElement): Costume {\n  const w = element.width;\n  const h = element.height;\n  const canvas = document.createElement('canvas');\n  canvas.width = w;\n  canvas.height = h;\n  const ctx = canvas.getContext('2d', { willReadFrequently: true })!;\n  ctx.drawImage(element, 0, 0);\n  return { element, bounds: { x: -w / 2, y: -h / 2, w, h }, canvas, ctx };\n}\n","import { Position, Rect, ColorRgb, Costume } from './types';\nimport { MAX_SCREEN_WIDTH, MAX_SCREEN_HEIGHT, TAU } from './constants';\nimport * as costumes from './costumes';\n\nconst [collisionCanvas, collisionCtx] = createOffScreenCanvas(MAX_SCREEN_WIDTH, MAX_SCREEN_HEIGHT);\nconst [, mask1Ctx] = createOffScreenCanvas(MAX_SCREEN_WIDTH, MAX_SCREEN_HEIGHT);\nconst [, mask2Ctx] = createOffScreenCanvas(MAX_SCREEN_WIDTH, MAX_SCREEN_HEIGHT);\n\nexport class Sprite {\n  static readonly all = new Set<Sprite>();\n\n  static get(pos: Position): Sprite | null {\n    for (const sprite of this.all) {\n      if (sprite.containsPoint(pos)) {\n        return sprite;\n      }\n    }\n    return null;\n  }\n\n  private costume!: Costume; // initialized by the call to changeCostume() in the constructor\n\n  // Transform\n  pos = { x: 0, y: 0 };\n  headingInRadians = 0;\n  headingOffset = Math.PI / 2; // so that heading = 0 means up\n  scale = 1;\n\n  constructor(costumeName: string) {\n    this.changeCostume(costumeName);\n    Sprite.all.add(this);\n  }\n\n  changeCostume(costumeName: string) {\n    this.costume = costumes.get(costumeName);\n  }\n\n  moveTo(p: Position) {\n    this.pos.x = p.x;\n    this.pos.y = p.y;\n  }\n\n  moveBy(n: number) {\n    const angle = this.headingInRadians - this.headingOffset;\n    this.pos.x += n * Math.cos(angle);\n    this.pos.y += n * Math.sin(angle);\n  }\n\n  turnBy(angle: number) {\n    this.headingInRadians += (angle * Math.PI) / 180;\n  }\n\n  get heading() {\n    return (this.headingInRadians * 180) / Math.PI;\n  }\n\n  destroy() {\n    Sprite.all.delete(this);\n  }\n\n  drawOn(ctx: CanvasRenderingContext2D, drawHeading = false) {\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n    ctx.rotate(this.headingInRadians);\n    ctx.scale(this.scale, this.scale);\n    ctx.drawImage(this.costume.canvas, -this.costume.bounds.w / 2, -this.costume.bounds.h / 2);\n    ctx.restore();\n    if (drawHeading) {\n      const size = 15;\n      const diag = Math.sqrt(this.costume.bounds.w ** 2 + this.costume.bounds.h ** 2) / 2;\n\n      ctx.beginPath();\n      ctx.fillStyle = 'blue';\n      ctx.arc(this.pos.x, this.pos.y, size / 2, 0, TAU);\n      ctx.fill();\n\n      ctx.lineCap = 'round';\n      ctx.strokeStyle = 'blue';\n      ctx.lineWidth = 4;\n\n      const angle = this.headingInRadians - this.headingOffset;\n      const topX = this.pos.x + this.scale * diag * Math.cos(angle);\n      const topY = this.pos.y + this.scale * diag * Math.sin(angle);\n\n      ctx.beginPath();\n      ctx.moveTo(this.pos.x, this.pos.y);\n      ctx.lineTo(topX, topY);\n      ctx.stroke();\n\n      const angleInc = (3 * Math.PI) / 4;\n\n      ctx.beginPath();\n      ctx.moveTo(topX, topY);\n      ctx.lineTo(\n        topX + size * Math.cos(angle + angleInc),\n        topY + size * Math.sin(angle + angleInc),\n      );\n      ctx.stroke();\n\n      ctx.beginPath();\n      ctx.moveTo(topX, topY);\n      ctx.lineTo(\n        topX + size * Math.cos(angle - angleInc),\n        topY + size * Math.sin(angle - angleInc),\n      );\n      ctx.stroke();\n    }\n  }\n\n  containsPoint(worldPos: Position): boolean {\n    collisionCtx.clearRect(0, 0, collisionCanvas.width, collisionCanvas.height);\n    this.drawOn(collisionCtx);\n    const a = collisionCtx.getImageData(worldPos.x, worldPos.y, 1, 1).data[3];\n    return a > 0;\n  }\n\n  colorAt(worldPos: Position): ColorRgb {\n    collisionCtx.clearRect(0, 0, collisionCanvas.width, collisionCanvas.height);\n    this.drawOn(collisionCtx);\n    const [r, g, b] = collisionCtx.getImageData(worldPos.x, worldPos.y, 1, 1).data;\n    return { r, g, b };\n  }\n\n  colorSees(thisColor: ColorRgb, thatColor: ColorRgb, tolerance = 20): boolean {\n    const bb = this.fastBoundingBox();\n    const x = Math.max(0, bb.x);\n    const y = Math.max(0, bb.y);\n    const w = Math.min(collisionCanvas.width, bb.w);\n    const h = Math.min(collisionCanvas.height, bb.h);\n    if (w <= 0 || h <= 0) {\n      return false;\n    }\n\n    mask1Ctx.clearRect(x, y, w, h);\n    mask2Ctx.clearRect(x, y, w, h);\n    this.drawMaskOn(mask1Ctx, thisColor, tolerance);\n    for (const that of Sprite.all) {\n      if (that !== this) {\n        that.drawMaskOn(mask2Ctx, thatColor, tolerance);\n      }\n    }\n\n    const aData = mask1Ctx.getImageData(x, y, w, h).data;\n    const bData = mask2Ctx.getImageData(x, y, w, h).data;\n\n    for (let idx = 0; idx < aData.length; idx += 4) {\n      if (aData[idx + 3] > 0 && bData[idx + 3] > 0) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // helpers\n\n  private drawMaskOn(ctx: CanvasRenderingContext2D, color: ColorRgb, tolerance: number) {\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n    ctx.rotate(this.headingInRadians);\n    ctx.scale(this.scale, this.scale);\n    ctx.globalCompositeOperation = 'lighter';\n    ctx.imageSmoothingEnabled = false;\n    ctx.drawImage(\n      this.getMask(color, tolerance),\n      -this.costume.bounds.w / 2,\n      -this.costume.bounds.h / 2,\n    );\n    ctx.restore();\n  }\n\n  readonly masks = new Map<HTMLImageElement | HTMLCanvasElement, Map<string, HTMLCanvasElement>>();\n\n  private getMask(color: ColorRgb, tolerance: number) {\n    const masksByKey = this.getMasksByKey();\n    const key = `${color.r}:${color.g}:${color.b}:${tolerance}`;\n    let mask = masksByKey.get(key);\n    if (mask) {\n      return mask;\n    }\n\n    mask = document.createElement('canvas');\n    mask.width = this.costume.bounds.w;\n    mask.height = this.costume.bounds.h;\n    masksByKey.set(key, mask);\n\n    const ctx = mask.getContext('2d')!;\n    const src = this.costume.ctx.getImageData(\n      0,\n      0,\n      this.costume.bounds.w,\n      this.costume.bounds.h,\n    ).data;\n    const out = ctx.createImageData(this.costume.bounds.w, this.costume.bounds.h);\n    const dst = out.data;\n\n    for (let idx = 0; idx < src.length; idx += 4) {\n      const r = src[idx];\n      const g = src[idx + 1];\n      const b = src[idx + 2];\n      const a = src[idx + 3];\n\n      if (\n        a > 0 &&\n        Math.abs(r - color.r) <= tolerance &&\n        Math.abs(g - color.g) <= tolerance &&\n        Math.abs(b - color.b) <= tolerance\n      ) {\n        // White pixel (binary mask)\n        dst[idx] = 255;\n        dst[idx + 1] = 255;\n        dst[idx + 2] = 255;\n        dst[idx + 3] = 255;\n      }\n    }\n\n    ctx.putImageData(out, 0, 0);\n    return mask;\n  }\n\n  private getMasksByKey() {\n    let maskMap = this.masks.get(this.costume.element);\n    if (!maskMap) {\n      maskMap = new Map<string, HTMLCanvasElement>();\n      this.masks.set(this.costume.element, maskMap);\n    }\n    return maskMap;\n  }\n\n  boundingBox(): Rect {\n    collisionCtx.clearRect(0, 0, collisionCanvas.width, collisionCanvas.height);\n    this.drawOn(collisionCtx);\n\n    const fbb = this.fastBoundingBox();\n    const x0 = Math.max(0, fbb.x);\n    const xf = x0 + fbb.w;\n    const y0 = Math.max(0, fbb.y);\n    const yf = y0 + fbb.h;\n    const data = collisionCtx.getImageData(x0, y0, fbb.w, fbb.h).data;\n\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let y = y0; y < yf; y++) {\n      for (let x = x0; x < xf; x++) {\n        const idx = ((y - y0) * fbb.w + x - x0) * 4;\n        const alpha = data[idx + 3];\n        if (alpha > 0) {\n          minX = Math.min(minX, x);\n          minY = Math.min(minY, y);\n          maxX = Math.max(maxX, x);\n          maxY = Math.max(maxY, y);\n        }\n      }\n    }\n\n    const realW = maxX - minX;\n    const realH = maxY - minY;\n    return {\n      x: minX,\n      y: minY,\n      w: realW,\n      h: realH,\n    };\n  }\n\n  fastBoundingBox(): Rect {\n    const { x, y, w, h } = this.localBoundingBox();\n    const corner1 = this.localToWorld({ x, y });\n    const corner2 = this.localToWorld({ x, y: y + h });\n    const corner3 = this.localToWorld({ x: x + w, y });\n    const corner4 = this.localToWorld({ x: x + w, y: y + h });\n\n    const minX = Math.min(corner1.x, corner2.x, corner3.x, corner4.x);\n    const minY = Math.min(corner1.y, corner2.y, corner3.y, corner4.y);\n    const maxX = Math.max(corner1.x, corner2.x, corner3.x, corner4.x);\n    const maxY = Math.max(corner1.y, corner2.y, corner3.y, corner4.y);\n\n    return {\n      x: Math.floor(minX),\n      y: Math.floor(minY),\n      w: Math.ceil(maxX - minX),\n      h: Math.ceil(maxY - minY),\n    };\n  }\n\n  localBoundingBox(): Rect {\n    return this.costume.bounds;\n  }\n\n  private localToWorld(p: Position): Position {\n    // Apply scale\n    let sx = p.x * this.scale;\n    let sy = p.y * this.scale;\n\n    // Apply rotation\n    const cos = Math.cos(this.headingInRadians);\n    const sin = Math.sin(this.headingInRadians);\n\n    const rx = sx * cos - sy * sin;\n    const ry = sx * sin + sy * cos;\n\n    // Apply translation\n    return {\n      x: rx + this.pos.x,\n      y: ry + this.pos.y,\n    };\n  }\n}\n\n// helpers\n\nfunction createOffScreenCanvas(\n  w: number,\n  h: number,\n): [HTMLCanvasElement, CanvasRenderingContext2D] {\n  const canvas = document.createElement('canvas');\n  canvas.width = w;\n  canvas.height = h;\n  return [canvas, canvas.getContext('2d', { willReadFrequently: true })!];\n}\n","import { TAU } from './constants';\nimport * as costumes from './costumes';\nimport { loadSampleCostumes } from './costumes';\nimport { Sprite } from './sprite';\n\n// TODO: getters for topY, bottomY, leftX, rightX\n// TODO: simple scripts (e.g., ball bouncing)\n// TODO: when bear touches yellow, increment score and move bear back to start\n// TODO: z-indexes (more control over 2.5D)\n// TODO: costume editor\n\nconst uiDiv = document.getElementById('ui')!;\nconst canvas = document.createElement('canvas');\nuiDiv.appendChild(canvas);\nconst ctx = canvas.getContext('2d')!;\n\n// ----- resizing -----\n\nfunction resize() {\n  // set the canvas size\n  canvas.style.width = innerWidth + 'px';\n  canvas.style.height = innerHeight + 'px';\n\n  // calculate the internal pixel dimensions of the canvas\n  canvas.width = innerWidth * devicePixelRatio;\n  canvas.height = innerHeight * devicePixelRatio;\n\n  ctx.scale(devicePixelRatio, devicePixelRatio);\n}\n\nwindow.addEventListener('resize', resize);\nresize();\n\n// ----- rendering -----\n\nlet bear: Sprite | null = null;\nlet bearIsMoving = false;\n\nlet penguin: Sprite | null = null;\nlet blosh: Sprite | null = null;\nlet ball: Sprite | null = null;\nlet yellowSquare: Sprite | null = null;\nlet redSquare: Sprite | null = null;\n\nlet status = '';\nlet statusTime = 0;\n\nfunction showStatus(msg: string) {\n  status = msg;\n  statusTime = Date.now();\n}\n\nfunction render() {\n  ctx.clearRect(0, 0, innerWidth, innerHeight);\n  Sprite.all.forEach((s) => s.drawOn(ctx, pointedSprite === s));\n\n  // Sprite.all.forEach((s) => {\n  //   s.scale = 1 + 0.01 * Math.sin(Date.now() / 200);\n  //   s.turnBy(Math.PI / 10);\n  // });\n\n  if (bear && bearIsMoving) {\n    bear.moveBy(2);\n  }\n\n  if (status.length > 0 && Date.now() - statusTime < 2_000) {\n    ctx.save();\n    ctx.font = '20pt sans-serif';\n    const { width } = ctx.measureText(status);\n    ctx.beginPath();\n    ctx.fillStyle = '#00ff';\n    ctx.fillText(status, innerWidth - width - 20, innerHeight - 20);\n    ctx.fill();\n    ctx.restore();\n  }\n\n  document.body.style.backgroundColor = yellowSquare?.colorSees(\n    { r: 255, g: 255, b: 0 },\n    { r: 255, g: 0, b: 0 },\n  )\n    ? 'pink'\n    : '#eee';\n\n  requestAnimationFrame(render);\n}\n\nrender();\n\n// ----- add a couple objects -----\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  loadSampleCostumes();\n\n  yellowSquare = new Sprite(\n    createCostume(100, 100, (ctx) => {\n      ctx.fillStyle = 'yellow';\n      ctx.beginPath();\n      ctx.fillRect(0, 0, 100, 100);\n      ctx.fill();\n    }),\n  );\n  yellowSquare.pos.x = 400;\n  yellowSquare.pos.y = 600;\n\n  redSquare = new Sprite(\n    createCostume(100, 100, (ctx) => {\n      ctx.fillStyle = 'red';\n      ctx.beginPath();\n      ctx.fillRect(0, 0, 100, 100);\n      ctx.fill();\n    }),\n  );\n  redSquare.pos.x = 600;\n  redSquare.pos.y = 600;\n\n  bear = new Sprite('bear');\n  bear.pos.x = 300;\n  bear.pos.y = 200;\n\n  penguin = new Sprite('penguin');\n  penguin.pos.x = 430;\n  penguin.pos.y = 300;\n\n  blosh = new Sprite('blosh');\n  blosh.pos.x = 500;\n  blosh.pos.y = 200;\n  blosh.scale = 0.2;\n\n  ball = new Sprite('ball');\n  ball.pos.x = 800;\n  ball.pos.y = 400;\n});\n\nfunction createCostume(w: number, h: number, fn: (ctx: CanvasRenderingContext2D) => void) {\n  const canvas = document.createElement('canvas');\n  canvas.width = w;\n  canvas.height = h;\n\n  const ctx = canvas.getContext('2d')!;\n  fn(ctx);\n\n  return costumes.add(canvas);\n}\n\nlet pointedSprite: Sprite | null = null;\nlet prevX = -1;\nlet prevY = -1;\nlet prevAngle = 0;\ncanvas.addEventListener('pointermove', (e) => {\n  if (prevX < 0 || prevY < 0) {\n    prevX = e.x;\n    prevY = e.y;\n  }\n\n  if (e.ctrlKey) {\n    if (pointedSprite) {\n      const newAngle = Math.atan2(e.y - pointedSprite.pos.y, e.x - pointedSprite.pos.x);\n      const diff = ((((newAngle - prevAngle + Math.PI) % TAU) + TAU) % TAU) - Math.PI;\n      if (e.shiftKey) {\n        pointedSprite.headingOffset -= diff;\n      } else {\n        pointedSprite.turnBy((diff * 180) / Math.PI);\n      }\n      prevAngle = newAngle;\n    }\n  } else if (e.shiftKey) {\n    if (pointedSprite) {\n      pointedSprite.pos.x += e.x - prevX;\n      pointedSprite.pos.y += e.y - prevY;\n    }\n  } else if (e.altKey) {\n    if (pointedSprite) {\n      pointedSprite.scale = Math.max(0.05, pointedSprite.scale + (e.x - prevX) / 100);\n    }\n  } else {\n    pointedSprite = Sprite.get(e);\n    if (pointedSprite) {\n      prevAngle = Math.atan2(e.y - pointedSprite.pos.y, e.x - pointedSprite.pos.x);\n      const { r, g, b } = pointedSprite.colorAt(e);\n      showStatus(`{ r: ${r}, g: ${g}, b: ${b} }`);\n    }\n  }\n\n  prevX = e.x;\n  prevY = e.y;\n});\n\nwindow.addEventListener('keydown', (e) => {\n  if (e.code === 'Space') {\n    if (pointedSprite === bear && bear !== null) {\n      bearIsMoving = !bearIsMoving;\n    }\n  }\n});\n"],"names":["TAU","MAX_SCREEN_WIDTH","MAX_SCREEN_HEIGHT","costumes","get","name","costume","nextId","add","element","id","costumeFromElement","loadSampleCostumes","costumeFromElementId","w","h","canvas","ctx","collisionCanvas","collisionCtx","createOffScreenCanvas","mask1Ctx","mask2Ctx","Sprite","costumeName","pos","sprite","costumes.get","p","n","angle","drawHeading","diag","topX","topY","angleInc","worldPos","r","g","b","thisColor","thatColor","tolerance","bb","x","y","that","aData","bData","idx","color","masksByKey","key","mask","src","out","dst","maskMap","fbb","x0","xf","y0","yf","data","minX","minY","maxX","maxY","realW","realH","corner1","corner2","corner3","corner4","sx","sy","cos","sin","rx","ry","uiDiv","resize","bear","bearIsMoving","penguin","blosh","ball","yellowSquare","redSquare","status","statusTime","showStatus","msg","render","s","pointedSprite","width","createCostume","fn","costumes.add","prevX","prevY","prevAngle","newAngle","diff"],"mappings":"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"}